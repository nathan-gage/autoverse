(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();const rr=!1;var Wr=Array.isArray,jn=Array.prototype.indexOf,Xt=Array.from,Hr=Object.defineProperty,lt=Object.getOwnPropertyDescriptor,Vr=Object.getOwnPropertyDescriptors,qn=Object.prototype,Un=Array.prototype,_r=Object.getPrototypeOf,$r=Object.isExtensible;const Ae=()=>{};function Xn(t){return t()}function Bt(t){for(var e=0;e<t.length;e++)t[e]()}function Kr(){var t,e,r=new Promise((n,i)=>{t=n,e=i});return{promise:r,resolve:t,reject:e}}const K=2,mr=4,Wt=8,Wn=1<<24,Pe=16,$e=32,Qe=64,Ht=128,ve=512,H=1024,re=2048,pe=4096,ie=8192,De=16384,br=32768,Ve=65536,Rr=1<<17,Jr=1<<18,pt=1<<19,Zr=1<<20,ke=1<<25,Ke=32768,nr=1<<21,wr=1<<22,ze=1<<23,Ue=Symbol("$state"),Hn=Symbol("legacy props"),Vn=Symbol(""),it=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Qr(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Kn(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Jn(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Zn(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Qn(t){throw new Error("https://svelte.dev/e/effect_orphan")}function es(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ts(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function rs(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ns(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ss(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function is(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const as=1,os=2,en=4,ls=8,cs=16,fs=1,us=2,ds=4,hs=8,vs=16,ps=1,gs=2,J=Symbol(),_s="http://www.w3.org/1999/xhtml";function ms(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function tn(t){return t===this.v}function rn(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function nn(t){return!rn(t,this.v)}let gt=!1,bs=!1;function ws(){gt=!0}let B=null;function ft(t){B=t}function et(t,e=!1,r){B={p:B,i:!1,c:null,e:null,s:t,x:null,l:gt&&!e?{s:null,u:null,$:[]}:null}}function tt(t){var e=B,r=e.e;if(r!==null){e.e=null;for(var n of r)_n(n)}return e.i=!0,B=e.p,{}}function It(){return!gt||B!==null&&B.l===null}let at=[];function ys(){var t=at;at=[],Bt(t)}function _t(t){if(at.length===0){var e=at;queueMicrotask(()=>{e===at&&ys()})}at.push(t)}function sn(t){var e=O;if(e===null)return I.f|=ze,t;if((e.f&br)===0){if((e.f&Ht)===0)throw t;e.b.error(t)}else ut(t,e)}function ut(t,e){for(;e!==null;){if((e.f&Ht)!==0)try{e.b.error(t);return}catch(r){t=r}e=e.parent}throw t}const Lt=new Set;let G=null,fe=null,me=[],yr=null,sr=!1;class we{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#r=0;#l=null;#i=new Set;#s=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#r>0}process(e){me=[],this.apply();var r={parent:null,effect:null,effects:[],render_effects:[]};for(const n of e)this.#a(n,r);this.is_fork||this.#f(),this.is_deferred()?(this.#o(r.effects),this.#o(r.render_effects)):(G=null,Lr(r.render_effects),Lr(r.effects),this.#l?.resolve()),fe=null}#a(e,r){e.f^=H;for(var n=e.first;n!==null;){var i=n.f,s=(i&($e|Qe))!==0,a=s&&(i&H)!==0,l=a||(i&ie)!==0||this.skipped_effects.has(n);if((n.f&Ht)!==0&&n.b?.is_pending()&&(r={parent:r,effect:n,effects:[],render_effects:[]}),!l&&n.fn!==null){s?n.f^=H:(i&mr)!==0?r.effects.push(n):mt(n)&&((n.f&Pe)!==0&&this.#i.add(n),ht(n));var o=n.first;if(o!==null){n=o;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)c===r.effect&&(this.#o(r.effects),this.#o(r.render_effects),r=r.parent),n=c.next,c=c.parent}}#o(e){for(const r of e)(r.f&re)!==0?this.#i.add(r):(r.f&pe)!==0&&this.#s.add(r),this.#c(r.deps),V(r,H)}#c(e){if(e!==null)for(const r of e)(r.f&K)===0||(r.f&Ke)===0||(r.f^=Ke,this.#c(r.deps))}capture(e,r){this.previous.has(e)||this.previous.set(e,r),(e.f&ze)===0&&(this.current.set(e,e.v),fe?.set(e,e.v))}activate(){G=this,this.apply()}deactivate(){G===this&&(G=null,fe=null)}flush(){if(this.activate(),me.length>0){if(Ss(),G!==null&&G!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#f(){if(this.#r===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#u()}#u(){if(Lt.size>1){this.previous.clear();var e=fe,r=!0,n={parent:null,effect:null,effects:[],render_effects:[]};for(const s of Lt){if(s===this){r=!1;continue}const a=[];for(const[o,c]of this.current){if(s.current.has(o))if(r&&c!==s.current.get(o))s.current.set(o,c);else continue;a.push(o)}if(a.length===0)continue;const l=[...s.current.keys()].filter(o=>!this.current.has(o));if(l.length>0){var i=me;me=[];const o=new Set,c=new Map;for(const f of a)an(f,l,o,c);if(me.length>0){G=s,s.apply();for(const f of me)s.#a(f,n);s.deactivate()}me=i}}G=null,fe=e}this.committed=!0,Lt.delete(this)}increment(e){this.#n+=1,e&&(this.#r+=1)}decrement(e){this.#n-=1,e&&(this.#r-=1),this.revive()}revive(){for(const e of this.#i)this.#s.delete(e),V(e,re),Je(e);for(const e of this.#s)V(e,pe),Je(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Kr()).promise}static ensure(){if(G===null){const e=G=new we;Lt.add(G),we.enqueue(()=>{G===e&&e.flush()})}return G}static enqueue(e){_t(e)}apply(){}}function Ss(){var t=We;sr=!0;var e=null;try{var r=0;for(zt(!0);me.length>0;){var n=we.ensure();if(r++>1e3){var i,s;xs()}n.process(me),Ye.clear()}}finally{sr=!1,zt(t),yr=null}}function xs(){try{es()}catch(t){ut(t,yr)}}let Ce=null;function Lr(t){var e=t.length;if(e!==0){for(var r=0;r<e;){var n=t[r++];if((n.f&(De|ie))===0&&mt(n)&&(Ce=new Set,ht(n),n.deps===null&&n.first===null&&n.nodes===null&&(n.teardown===null&&n.ac===null?yn(n):n.fn=null),Ce?.size>0)){Ye.clear();for(const i of Ce){if((i.f&(De|ie))!==0)continue;const s=[i];let a=i.parent;for(;a!==null;)Ce.has(a)&&(Ce.delete(a),s.push(a)),a=a.parent;for(let l=s.length-1;l>=0;l--){const o=s[l];(o.f&(De|ie))===0&&ht(o)}}Ce.clear()}}Ce=null}}function an(t,e,r,n){if(!r.has(t)&&(r.add(t),t.reactions!==null))for(const i of t.reactions){const s=i.f;(s&K)!==0?an(i,e,r,n):(s&(wr|Pe))!==0&&(s&re)===0&&on(i,e,n)&&(V(i,re),Je(i))}}function on(t,e,r){const n=r.get(t);if(n!==void 0)return n;if(t.deps!==null)for(const i of t.deps){if(e.includes(i))return!0;if((i.f&K)!==0&&on(i,e,r))return r.set(i,!0),!0}return r.set(t,!1),!1}function Je(t){for(var e=yr=t;e.parent!==null;){e=e.parent;var r=e.f;if(sr&&e===O&&(r&Pe)!==0&&(r&Jr)===0)return;if((r&(Qe|$e))!==0){if((r&H)===0)return;e.f^=H}}me.push(e)}function Es(t){let e=0,r=Ze(0),n;return()=>{kt()&&(v(r),Kt(()=>(e===0&&(n=N(()=>t(()=>Mt(r)))),e+=1,()=>{_t(()=>{e-=1,e===0&&(n?.(),n=void 0,Mt(r))})})))}}var Ms=Ve|pt|Ht;function Cs(t,e,r){new ks(t,e,r)}class ks{parent;#e=!1;#t;#n=null;#r;#l;#i;#s=null;#a=null;#o=null;#c=null;#f=null;#u=0;#d=0;#v=!1;#h=null;#b=Es(()=>(this.#h=Ze(this.#u),()=>{this.#h=null}));constructor(e,r,n){this.#t=e,this.#r=r,this.#l=n,this.parent=O.b,this.#e=!!this.#r.pending,this.#i=Jt(()=>{O.b=this;{var i=this.#_();try{this.#s=ce(()=>n(i))}catch(s){this.error(s)}this.#d>0?this.#g():this.#e=!1}return()=>{this.#f?.remove()}},Ms)}#w(){try{this.#s=ce(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#y(){const e=this.#r.pending;e&&(this.#a=ce(()=>e(this.#t)),we.enqueue(()=>{var r=this.#_();this.#s=this.#p(()=>(we.ensure(),ce(()=>this.#l(r)))),this.#d>0?this.#g():(Xe(this.#a,()=>{this.#a=null}),this.#e=!1)}))}#_(){var e=this.#t;return this.#e&&(this.#f=je(),this.#t.before(this.#f),e=this.#f),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#r.pending}#p(e){var r=O,n=I,i=B;Se(this.#i),ee(this.#i),ft(this.#i.ctx);try{return e()}catch(s){return sn(s),null}finally{Se(r),ee(n),ft(i)}}#g(){const e=this.#r.pending;this.#s!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#f),En(this.#s,this.#c)),this.#a===null&&(this.#a=ce(()=>e(this.#t)))}#m(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#m(e);return}this.#d+=e,this.#d===0&&(this.#e=!1,this.#a&&Xe(this.#a,()=>{this.#a=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#m(e),this.#u+=e,this.#h&&dt(this.#h,this.#u)}get_effect_pending(){return this.#b(),v(this.#h)}error(e){var r=this.#r.onerror;let n=this.#r.failed;if(this.#v||!r&&!n)throw e;this.#s&&(te(this.#s),this.#s=null),this.#a&&(te(this.#a),this.#a=null),this.#o&&(te(this.#o),this.#o=null);var i=!1,s=!1;const a=()=>{if(i){ms();return}i=!0,s&&is(),we.ensure(),this.#u=0,this.#o!==null&&Xe(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#s=this.#p(()=>(this.#v=!1,ce(()=>this.#l(this.#t)))),this.#d>0?this.#g():this.#e=!1};var l=I;try{ee(null),s=!0,r?.(e,a),s=!1}catch(o){ut(o,this.#i&&this.#i.parent)}finally{ee(l)}n&&_t(()=>{this.#o=this.#p(()=>{we.ensure(),this.#v=!0;try{return ce(()=>{n(this.#t,()=>e,()=>a)})}catch(o){return ut(o,this.#i.parent),null}finally{this.#v=!1}})})}}function As(t,e,r,n){const i=It()?Vt:Sr;if(r.length===0&&t.length===0){n(e.map(i));return}var s=G,a=O,l=Ds();function o(){Promise.all(r.map(c=>Ts(c))).then(c=>{l();try{n([...e.map(i),...c])}catch(f){(a.f&De)===0&&ut(f,a)}s?.deactivate(),Gt()}).catch(c=>{ut(c,a)})}t.length>0?Promise.all(t).then(()=>{l();try{return o()}finally{s?.deactivate(),Gt()}}):o()}function Ds(){var t=O,e=I,r=B,n=G;return function(s=!0){Se(t),ee(e),ft(r),s&&n?.activate()}}function Gt(){Se(null),ee(null),ft(null)}function Vt(t){var e=K|re,r=I!==null&&(I.f&K)!==0?I:null;return O!==null&&(O.f|=pt),{ctx:B,deps:null,effects:null,equals:tn,f:e,fn:t,reactions:null,rv:0,v:J,wv:0,parent:r??O,ac:null}}function Ts(t,e){let r=O;r===null&&Kn();var n=r.b,i=void 0,s=Ze(J),a=!I,l=new Map;return Bs(()=>{var o=Kr();i=o.promise;try{Promise.resolve(t()).then(o.resolve,o.reject).then(()=>{c===G&&c.committed&&c.deactivate(),Gt()})}catch(d){o.reject(d),Gt()}var c=G;if(a){var f=!n.is_pending();n.update_pending_count(1),c.increment(f),l.get(c)?.reject(it),l.delete(c),l.set(c,o)}const u=(d,h=void 0)=>{if(c.activate(),h)h!==it&&(s.f|=ze,dt(s,h));else{(s.f&ze)!==0&&(s.f^=ze),dt(s,d);for(const[g,m]of l){if(l.delete(g),g===c)break;m.reject(it)}}a&&(n.update_pending_count(-1),c.decrement(f))};o.promise.then(u,d=>u(null,d||"unknown"))}),Mr(()=>{for(const o of l.values())o.reject(it)}),new Promise(o=>{function c(f){function u(){f===i?o(s):c(i)}f.then(u,u)}c(i)})}function Sr(t){const e=Vt(t);return e.equals=nn,e}function ln(t){var e=t.effects;if(e!==null){t.effects=null;for(var r=0;r<e.length;r+=1)te(e[r])}}function Is(t){for(var e=t.parent;e!==null;){if((e.f&K)===0)return(e.f&De)===0?e:null;e=e.parent}return null}function xr(t){var e,r=O;Se(Is(t));try{t.f&=~Ke,ln(t),e=An(t)}finally{Se(r)}return e}function cn(t){var e=xr(t);if(t.equals(e)||(G?.is_fork||(t.v=e),t.wv=Cn()),!rt)if(fe!==null)(kt()||G?.is_fork)&&fe.set(t,e);else{var r=(t.f&ve)===0?pe:H;V(t,r)}}let ir=new Set;const Ye=new Map;let fn=!1;function Ze(t,e){var r={f:0,v:t,reactions:null,equals:tn,rv:0,wv:0};return r}function Me(t,e){const r=Ze(t);return zs(r),r}function se(t,e=!1,r=!0){const n=Ze(t);return e||(n.equals=nn),gt&&r&&B!==null&&B.l!==null&&(B.l.s??=[]).push(n),n}function Ne(t,e){return F(t,N(()=>v(t))),e}function F(t,e,r=!1){I!==null&&(!ye||(I.f&Rr)!==0)&&It()&&(I.f&(K|Pe|wr|Rr))!==0&&!Te?.includes(t)&&ss();let n=r?ot(e):e;return dt(t,n)}function dt(t,e){if(!t.equals(e)){var r=t.v;rt?Ye.set(t,e):Ye.set(t,r),t.v=e;var n=we.ensure();n.capture(t,r),(t.f&K)!==0&&((t.f&re)!==0&&xr(t),V(t,(t.f&ve)!==0?H:pe)),t.wv=Cn(),un(t,re),It()&&O!==null&&(O.f&H)!==0&&(O.f&($e|Qe))===0&&(le===null?Ys([t]):le.push(t)),!n.is_fork&&ir.size>0&&!fn&&Ps()}return e}function Ps(){fn=!1;var t=We;zt(!0);const e=Array.from(ir);try{for(const r of e)(r.f&H)!==0&&V(r,pe),mt(r)&&ht(r)}finally{zt(t)}ir.clear()}function Mt(t){F(t,t.v+1)}function un(t,e){var r=t.reactions;if(r!==null)for(var n=It(),i=r.length,s=0;s<i;s++){var a=r[s],l=a.f;if(!(!n&&a===O)){var o=(l&re)===0;if(o&&V(a,e),(l&K)!==0){var c=a;fe?.delete(c),(l&Ke)===0&&(l&ve&&(a.f|=Ke),un(c,pe))}else o&&((l&Pe)!==0&&Ce!==null&&Ce.add(a),Je(a))}}}function ot(t){if(typeof t!="object"||t===null||Ue in t)return t;const e=_r(t);if(e!==qn&&e!==Un)return t;var r=new Map,n=Wr(t),i=Me(0),s=He,a=l=>{if(He===s)return l();var o=I,c=He;ee(null),Fr(s);var f=l();return ee(o),Fr(c),f};return n&&r.set("length",Me(t.length)),new Proxy(t,{defineProperty(l,o,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&rs();var f=r.get(o);return f===void 0?f=a(()=>{var u=Me(c.value);return r.set(o,u),u}):F(f,c.value,!0),!0},deleteProperty(l,o){var c=r.get(o);if(c===void 0){if(o in l){const f=a(()=>Me(J));r.set(o,f),Mt(i)}}else F(c,J),Mt(i);return!0},get(l,o,c){if(o===Ue)return t;var f=r.get(o),u=o in l;if(f===void 0&&(!u||lt(l,o)?.writable)&&(f=a(()=>{var h=ot(u?l[o]:J),g=Me(h);return g}),r.set(o,f)),f!==void 0){var d=v(f);return d===J?void 0:d}return Reflect.get(l,o,c)},getOwnPropertyDescriptor(l,o){var c=Reflect.getOwnPropertyDescriptor(l,o);if(c&&"value"in c){var f=r.get(o);f&&(c.value=v(f))}else if(c===void 0){var u=r.get(o),d=u?.v;if(u!==void 0&&d!==J)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return c},has(l,o){if(o===Ue)return!0;var c=r.get(o),f=c!==void 0&&c.v!==J||Reflect.has(l,o);if(c!==void 0||O!==null&&(!f||lt(l,o)?.writable)){c===void 0&&(c=a(()=>{var d=f?ot(l[o]):J,h=Me(d);return h}),r.set(o,c));var u=v(c);if(u===J)return!1}return f},set(l,o,c,f){var u=r.get(o),d=o in l;if(n&&o==="length")for(var h=c;h<u.v;h+=1){var g=r.get(h+"");g!==void 0?F(g,J):h in l&&(g=a(()=>Me(J)),r.set(h+"",g))}if(u===void 0)(!d||lt(l,o)?.writable)&&(u=a(()=>Me(void 0)),F(u,ot(c)),r.set(o,u));else{d=u.v!==J;var m=a(()=>ot(c));F(u,m)}var p=Reflect.getOwnPropertyDescriptor(l,o);if(p?.set&&p.set.call(f,c),!d){if(n&&typeof o=="string"){var b=r.get("length"),D=Number(o);Number.isInteger(D)&&D>=b.v&&F(b,D+1)}Mt(i)}return!0},ownKeys(l){v(i);var o=Reflect.ownKeys(l).filter(u=>{var d=r.get(u);return d===void 0||d.v!==J});for(var[c,f]of r)f.v!==J&&!(c in l)&&o.push(c);return o},setPrototypeOf(){ns()}})}var Or,dn,hn,vn;function $s(){if(Or===void 0){Or=window,dn=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,r=Text.prototype;hn=lt(e,"firstChild").get,vn=lt(e,"nextSibling").get,$r(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),$r(r)&&(r.__t=void 0)}}function je(t=""){return document.createTextNode(t)}function Ge(t){return hn.call(t)}function Pt(t){return vn.call(t)}function w(t,e){return Ge(t)}function ct(t,e=!1){{var r=Ge(t);return r instanceof Comment&&r.data===""?Pt(r):r}}function E(t,e=1,r=!1){let n=t;for(;e--;)n=Pt(n);return n}function Rs(t){t.textContent=""}function pn(){return!1}function Er(t){var e=I,r=O;ee(null),Se(null);try{return t()}finally{ee(e),Se(r)}}function gn(t){O===null&&(I===null&&Qn(),Zn()),rt&&Jn()}function Ls(t,e){var r=e.last;r===null?e.last=e.first=t:(r.next=t,t.prev=r,e.last=t)}function xe(t,e,r){var n=O;n!==null&&(n.f&ie)!==0&&(t|=ie);var i={ctx:B,deps:null,nodes:null,f:t|re|ve,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,wv:0,ac:null};if(r)try{ht(i),i.f|=br}catch(l){throw te(i),l}else e!==null&&Je(i);var s=i;if(r&&s.deps===null&&s.teardown===null&&s.nodes===null&&s.first===s.last&&(s.f&pt)===0&&(s=s.first,(t&Pe)!==0&&(t&Ve)!==0&&s!==null&&(s.f|=Ve)),s!==null&&(s.parent=n,n!==null&&Ls(s,n),I!==null&&(I.f&K)!==0&&(t&Qe)===0)){var a=I;(a.effects??=[]).push(s)}return i}function kt(){return I!==null&&!ye}function Mr(t){const e=xe(Wt,null,!1);return V(e,H),e.teardown=t,e}function ar(t){gn();var e=O.f,r=!I&&(e&$e)!==0&&(e&br)===0;if(r){var n=B;(n.e??=[]).push(t)}else return _n(t)}function _n(t){return xe(mr|Zr,t,!1)}function Os(t){return gn(),xe(Wt|Zr,t,!0)}function Ns(t){we.ensure();const e=xe(Qe|pt,t,!0);return(r={})=>new Promise(n=>{r.outro?Xe(e,()=>{te(e),n(void 0)}):(te(e),n(void 0))})}function Fs(t){return xe(mr,t,!1)}function Be(t,e){var r=B,n={effect:null,ran:!1,deps:t};r.l.$.push(n),n.effect=Kt(()=>{t(),!n.ran&&(n.ran=!0,N(e))})}function Cr(){var t=B;Kt(()=>{for(var e of t.l.$){e.deps();var r=e.effect;(r.f&H)!==0&&V(r,pe),mt(r)&&ht(r),e.ran=!1}})}function Bs(t){return xe(wr|pt,t,!0)}function Kt(t,e=0){return xe(Wt|e,t,!0)}function X(t,e=[],r=[],n=[]){As(n,e,r,i=>{xe(Wt,()=>t(...i.map(v)),!0)})}function Jt(t,e=0){var r=xe(Pe|e,t,!0);return r}function ce(t){return xe($e|pt,t,!0)}function mn(t){var e=t.teardown;if(e!==null){const r=rt,n=I;Nr(!0),ee(null);try{e.call(null)}finally{Nr(r),ee(n)}}}function bn(t,e=!1){var r=t.first;for(t.first=t.last=null;r!==null;){const i=r.ac;i!==null&&Er(()=>{i.abort(it)});var n=r.next;(r.f&Qe)!==0?r.parent=null:te(r,e),r=n}}function Gs(t){for(var e=t.first;e!==null;){var r=e.next;(e.f&$e)===0&&te(e),e=r}}function te(t,e=!0){var r=!1;(e||(t.f&Jr)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(wn(t.nodes.start,t.nodes.end),r=!0),bn(t,e&&!r),Yt(t,0),V(t,De);var n=t.nodes&&t.nodes.t;if(n!==null)for(const s of n)s.stop();mn(t);var i=t.parent;i!==null&&i.first!==null&&yn(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function wn(t,e){for(;t!==null;){var r=t===e?null:Pt(t);t.remove(),t=r}}function yn(t){var e=t.parent,r=t.prev,n=t.next;r!==null&&(r.next=n),n!==null&&(n.prev=r),e!==null&&(e.first===t&&(e.first=n),e.last===t&&(e.last=r))}function Xe(t,e,r=!0){var n=[];Sn(t,n,!0);var i=()=>{r&&te(t),e&&e()},s=n.length;if(s>0){var a=()=>--s||i();for(var l of n)l.out(a)}else i()}function Sn(t,e,r){if((t.f&ie)===0){t.f^=ie;var n=t.nodes&&t.nodes.t;if(n!==null)for(const l of n)(l.is_global||r)&&e.push(l);for(var i=t.first;i!==null;){var s=i.next,a=(i.f&Ve)!==0||(i.f&$e)!==0&&(t.f&Pe)!==0;Sn(i,e,a?r:!1),i=s}}}function kr(t){xn(t,!0)}function xn(t,e){if((t.f&ie)!==0){t.f^=ie,(t.f&H)===0&&(V(t,re),Je(t));for(var r=t.first;r!==null;){var n=r.next,i=(r.f&Ve)!==0||(r.f&$e)!==0;xn(r,i?e:!1),r=n}var s=t.nodes&&t.nodes.t;if(s!==null)for(const a of s)(a.is_global||e)&&a.in()}}function En(t,e){if(t.nodes)for(var r=t.nodes.start,n=t.nodes.end;r!==null;){var i=r===n?null:Pt(r);e.append(r),r=i}}let We=!1;function zt(t){We=t}let rt=!1;function Nr(t){rt=t}let I=null,ye=!1;function ee(t){I=t}let O=null;function Se(t){O=t}let Te=null;function zs(t){I!==null&&(Te===null?Te=[t]:Te.push(t))}let Q=null,ne=0,le=null;function Ys(t){le=t}let Mn=1,At=0,He=At;function Fr(t){He=t}function Cn(){return++Mn}function mt(t){var e=t.f;if((e&re)!==0)return!0;if(e&K&&(t.f&=~Ke),(e&pe)!==0){var r=t.deps;if(r!==null)for(var n=r.length,i=0;i<n;i++){var s=r[i];if(mt(s)&&cn(s),s.wv>t.wv)return!0}(e&ve)!==0&&fe===null&&V(t,H)}return!1}function kn(t,e,r=!0){var n=t.reactions;if(n!==null&&!Te?.includes(t))for(var i=0;i<n.length;i++){var s=n[i];(s.f&K)!==0?kn(s,e,!1):e===s&&(r?V(s,re):(s.f&H)!==0&&V(s,pe),Je(s))}}function An(t){var e=Q,r=ne,n=le,i=I,s=Te,a=B,l=ye,o=He,c=t.f;Q=null,ne=0,le=null,I=(c&($e|Qe))===0?t:null,Te=null,ft(t.ctx),ye=!1,He=++At,t.ac!==null&&(Er(()=>{t.ac.abort(it)}),t.ac=null);try{t.f|=nr;var f=t.fn,u=f(),d=t.deps;if(Q!==null){var h;if(Yt(t,ne),d!==null&&ne>0)for(d.length=ne+Q.length,h=0;h<Q.length;h++)d[ne+h]=Q[h];else t.deps=d=Q;if(kt()&&(t.f&ve)!==0)for(h=ne;h<d.length;h++)(d[h].reactions??=[]).push(t)}else d!==null&&ne<d.length&&(Yt(t,ne),d.length=ne);if(It()&&le!==null&&!ye&&d!==null&&(t.f&(K|pe|re))===0)for(h=0;h<le.length;h++)kn(le[h],t);return i!==null&&i!==t&&(At++,le!==null&&(n===null?n=le:n.push(...le))),(t.f&ze)!==0&&(t.f^=ze),u}catch(g){return sn(g)}finally{t.f^=nr,Q=e,ne=r,le=n,I=i,Te=s,ft(a),ye=l,He=o}}function js(t,e){let r=e.reactions;if(r!==null){var n=jn.call(r,t);if(n!==-1){var i=r.length-1;i===0?r=e.reactions=null:(r[n]=r[i],r.pop())}}r===null&&(e.f&K)!==0&&(Q===null||!Q.includes(e))&&(V(e,pe),(e.f&ve)!==0&&(e.f^=ve,e.f&=~Ke),ln(e),Yt(e,0))}function Yt(t,e){var r=t.deps;if(r!==null)for(var n=e;n<r.length;n++)js(t,r[n])}function ht(t){var e=t.f;if((e&De)===0){V(t,H);var r=O,n=We;O=t,We=!0;try{(e&(Pe|Wn))!==0?Gs(t):bn(t),mn(t);var i=An(t);t.teardown=typeof i=="function"?i:null,t.wv=Mn;var s;rr&&bs&&(t.f&re)!==0&&t.deps}finally{We=n,O=r}}}function v(t){var e=t.f,r=(e&K)!==0;if(I!==null&&!ye){var n=O!==null&&(O.f&De)!==0;if(!n&&!Te?.includes(t)){var i=I.deps;if((I.f&nr)!==0)t.rv<At&&(t.rv=At,Q===null&&i!==null&&i[ne]===t?ne++:Q===null?Q=[t]:Q.includes(t)||Q.push(t));else{(I.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[I]:s.includes(I)||s.push(I)}}}if(rt){if(Ye.has(t))return Ye.get(t);if(r){var a=t,l=a.v;return((a.f&H)===0&&a.reactions!==null||Tn(a))&&(l=xr(a)),Ye.set(a,l),l}}else r&&(!fe?.has(t)||G?.is_fork&&!kt())&&(a=t,mt(a)&&cn(a),We&&kt()&&(a.f&ve)===0&&Dn(a));if(fe?.has(t))return fe.get(t);if((t.f&ze)!==0)throw t.v;return t.v}function Dn(t){if(t.deps!==null){t.f^=ve;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&K)!==0&&(e.f&ve)===0&&Dn(e)}}function Tn(t){if(t.v===J)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Ye.has(e)||(e.f&K)!==0&&Tn(e))return!0;return!1}function N(t){var e=ye;try{return ye=!0,t()}finally{ye=e}}const qs=-7169;function V(t,e){t.f=t.f&qs|e}function Us(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ue in t)or(t);else if(!Array.isArray(t))for(let e in t){const r=t[e];typeof r=="object"&&r&&Ue in r&&or(r)}}}function or(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let n in t)try{or(t[n],e)}catch{}const r=_r(t);if(r!==Object.prototype&&r!==Array.prototype&&r!==Map.prototype&&r!==Set.prototype&&r!==Date.prototype){const n=Vr(r);for(let i in n){const s=n[i].get;if(s)try{s.call(t)}catch{}}}}}const Xs=["touchstart","touchmove"];function Ws(t){return Xs.includes(t)}const In=new Set,lr=new Set;function Hs(t,e,r,n={}){function i(s){if(n.capture||xt.call(e,s),!s.cancelBubble)return Er(()=>r?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?_t(()=>{e.addEventListener(t,i,n)}):e.addEventListener(t,i,n),i}function Vs(t,e,r,n,i){var s={capture:n,passive:i},a=Hs(t,e,r,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Mr(()=>{e.removeEventListener(t,a,s)})}function Zt(t){for(var e=0;e<t.length;e++)In.add(t[e]);for(var r of lr)r(t)}let Br=null;function xt(t){var e=this,r=e.ownerDocument,n=t.type,i=t.composedPath?.()||[],s=i[0]||t.target;Br=t;var a=0,l=Br===t&&t.__root;if(l){var o=i.indexOf(l);if(o!==-1&&(e===document||e===window)){t.__root=e;return}var c=i.indexOf(e);if(c===-1)return;o<=c&&(a=o)}if(s=i[a]||t.target,s!==e){Hr(t,"currentTarget",{configurable:!0,get(){return s||r}});var f=I,u=O;ee(null),Se(null);try{for(var d,h=[];s!==null;){var g=s.assignedSlot||s.parentNode||s.host||null;try{var m=s["__"+n];m!=null&&(!s.disabled||t.target===s)&&m.call(s,t)}catch(p){d?h.push(p):d=p}if(t.cancelBubble||g===e||g===null)break;s=g}if(d){for(let p of h)queueMicrotask(()=>{throw p});throw d}}finally{t.__root=e,delete t.currentTarget,ee(f),Se(u)}}}function Pn(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function jt(t,e){var r=O;r.nodes===null&&(r.nodes={start:t,end:e,a:null,t:null})}function R(t,e){var r=(e&ps)!==0,n=(e&gs)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=Pn(s?t:"<!>"+t),r||(i=Ge(i)));var a=n||dn?document.importNode(i,!0):i.cloneNode(!0);if(r){var l=Ge(a),o=a.lastChild;jt(l,o)}else jt(a,a);return a}}function Gr(){var t=document.createDocumentFragment(),e=document.createComment(""),r=je();return t.append(e,r),jt(e,r),t}function T(t,e){t!==null&&t.before(e)}function j(t,e){var r=e==null?"":typeof e=="object"?e+"":e;r!==(t.__t??=t.nodeValue)&&(t.__t=r,t.nodeValue=r+"")}function Ks(t,e){return Js(t,e)}const nt=new Map;function Js(t,{target:e,anchor:r,props:n={},events:i,context:s,intro:a=!0}){$s();var l=new Set,o=u=>{for(var d=0;d<u.length;d++){var h=u[d];if(!l.has(h)){l.add(h);var g=Ws(h);e.addEventListener(h,xt,{passive:g});var m=nt.get(h);m===void 0?(document.addEventListener(h,xt,{passive:g}),nt.set(h,1)):nt.set(h,m+1)}}};o(Xt(In)),lr.add(o);var c=void 0,f=Ns(()=>{var u=r??e.appendChild(je());return Cs(u,{pending:()=>{}},d=>{if(s){et({});var h=B;h.c=s}i&&(n.$$events=i),c=t(d,n)||{},s&&tt()}),()=>{for(var d of l){e.removeEventListener(d,xt);var h=nt.get(d);--h===0?(document.removeEventListener(d,xt),nt.delete(d)):nt.set(d,h)}lr.delete(o),u!==r&&u.parentNode?.removeChild(u)}});return Zs.set(c,f),c}let Zs=new WeakMap;class $n{anchor;#e=new Map;#t=new Map;#n=new Map;#r=new Set;#l=!0;constructor(e,r=!0){this.anchor=e,this.#l=r}#i=()=>{var e=G;if(this.#e.has(e)){var r=this.#e.get(e),n=this.#t.get(r);if(n)kr(n),this.#r.delete(r);else{var i=this.#n.get(r);i&&(this.#t.set(r,i.effect),this.#n.delete(r),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),n=i.effect)}for(const[s,a]of this.#e){if(this.#e.delete(s),s===e)break;const l=this.#n.get(a);l&&(te(l.effect),this.#n.delete(a))}for(const[s,a]of this.#t){if(s===r||this.#r.has(s))continue;const l=()=>{if(Array.from(this.#e.values()).includes(s)){var c=document.createDocumentFragment();En(a,c),c.append(je()),this.#n.set(s,{effect:a,fragment:c})}else te(a);this.#r.delete(s),this.#t.delete(s)};this.#l||!n?(this.#r.add(s),Xe(a,l,!1)):l()}}};#s=e=>{this.#e.delete(e);const r=Array.from(this.#e.values());for(const[n,i]of this.#n)r.includes(n)||(te(i.effect),this.#n.delete(n))};ensure(e,r){var n=G,i=pn();if(r&&!this.#t.has(e)&&!this.#n.has(e))if(i){var s=document.createDocumentFragment(),a=je();s.append(a),this.#n.set(e,{effect:ce(()=>r(a)),fragment:s})}else this.#t.set(e,ce(()=>r(this.anchor)));if(this.#e.set(n,e),i){for(const[l,o]of this.#t)l===e?n.skipped_effects.delete(o):n.skipped_effects.add(o);for(const[l,o]of this.#n)l===e?n.skipped_effects.delete(o.effect):n.skipped_effects.add(o.effect);n.oncommit(this.#i),n.ondiscard(this.#s)}else this.#i()}}function de(t,e,r=!1){var n=new $n(t),i=r?Ve:0;function s(a,l){n.ensure(a,l)}Jt(()=>{var a=!1;e((l,o=!0)=>{a=!0,s(o,l)}),a||s(!1,null)},i)}function qt(t,e){return e}function Qs(t,e,r){for(var n=[],i=e.length,s,a=e.length,l=0;l<i;l++){let u=e[l];Xe(u,()=>{if(s){if(s.pending.delete(u),s.done.add(u),s.pending.size===0){var d=t.outrogroups;cr(Xt(s.done)),d.delete(s),d.size===0&&(t.outrogroups=null)}}else a-=1},!1)}if(a===0){var o=n.length===0&&r!==null;if(o){var c=r,f=c.parentNode;Rs(f),f.append(c),t.items.clear()}cr(e,!o)}else s={pending:new Set(e),done:new Set},(t.outrogroups??=new Set).add(s)}function cr(t,e=!0){for(var r=0;r<t.length;r++)te(t[r],e)}var zr;function Dt(t,e,r,n,i,s=null){var a=t,l=new Map,o=(e&en)!==0;if(o){var c=t;a=c.appendChild(je())}var f=null,u=Sr(()=>{var b=r();return Wr(b)?b:b==null?[]:Xt(b)}),d,h=!0;function g(){p.fallback=f,ei(p,d,a,e,n),f!==null&&(d.length===0?(f.f&ke)===0?kr(f):(f.f^=ke,Et(f,null,a)):Xe(f,()=>{f=null}))}var m=Jt(()=>{d=v(u);for(var b=d.length,D=new Set,x=G,k=pn(),M=0;M<b;M+=1){var _=d[M],y=n(_,M),S=h?null:l.get(y);S?(S.v&&dt(S.v,_),S.i&&dt(S.i,M),k&&x.skipped_effects.delete(S.e)):(S=ti(l,h?a:zr??=je(),_,y,M,i,e,r),h||(S.e.f|=ke),l.set(y,S)),D.add(y)}if(b===0&&s&&!f&&(h?f=ce(()=>s(a)):(f=ce(()=>s(zr??=je())),f.f|=ke)),!h)if(k){for(const[P,A]of l)D.has(P)||x.skipped_effects.add(A.e);x.oncommit(g),x.ondiscard(()=>{})}else g();v(u)}),p={effect:m,items:l,outrogroups:null,fallback:f};h=!1}function ei(t,e,r,n,i){var s=(n&ls)!==0,a=e.length,l=t.items,o=t.effect.first,c,f=null,u,d=[],h=[],g,m,p,b;if(s)for(b=0;b<a;b+=1)g=e[b],m=i(g,b),p=l.get(m).e,(p.f&ke)===0&&(p.nodes?.a?.measure(),(u??=new Set).add(p));for(b=0;b<a;b+=1){if(g=e[b],m=i(g,b),p=l.get(m).e,t.outrogroups!==null)for(const A of t.outrogroups)A.pending.delete(p),A.done.delete(p);if((p.f&ke)!==0)if(p.f^=ke,p===o)Et(p,null,r);else{var D=f?f.next:o;p===t.effect.last&&(t.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),Fe(t,f,p),Fe(t,p,D),Et(p,D,r),f=p,d=[],h=[],o=f.next;continue}if((p.f&ie)!==0&&(kr(p),s&&(p.nodes?.a?.unfix(),(u??=new Set).delete(p))),p!==o){if(c!==void 0&&c.has(p)){if(d.length<h.length){var x=h[0],k;f=x.prev;var M=d[0],_=d[d.length-1];for(k=0;k<d.length;k+=1)Et(d[k],x,r);for(k=0;k<h.length;k+=1)c.delete(h[k]);Fe(t,M.prev,_.next),Fe(t,f,M),Fe(t,_,x),o=x,f=_,b-=1,d=[],h=[]}else c.delete(p),Et(p,o,r),Fe(t,p.prev,p.next),Fe(t,p,f===null?t.effect.first:f.next),Fe(t,f,p),f=p;continue}for(d=[],h=[];o!==null&&o!==p;)(c??=new Set).add(o),h.push(o),o=o.next;if(o===null)continue}(p.f&ke)===0&&d.push(p),f=p,o=p.next}if(t.outrogroups!==null){for(const A of t.outrogroups)A.pending.size===0&&(cr(Xt(A.done)),t.outrogroups?.delete(A));t.outrogroups.size===0&&(t.outrogroups=null)}if(o!==null||c!==void 0){var y=[];if(c!==void 0)for(p of c)(p.f&ie)===0&&y.push(p);for(;o!==null;)(o.f&ie)===0&&o!==t.fallback&&y.push(o),o=o.next;var S=y.length;if(S>0){var P=(n&en)!==0&&a===0?r:null;if(s){for(b=0;b<S;b+=1)y[b].nodes?.a?.measure();for(b=0;b<S;b+=1)y[b].nodes?.a?.fix()}Qs(t,y,P)}}s&&_t(()=>{if(u!==void 0)for(p of u)p.nodes?.a?.apply()})}function ti(t,e,r,n,i,s,a,l){var o=(a&as)!==0?(a&cs)===0?se(r,!1,!1):Ze(r):null,c=(a&os)!==0?Ze(i):null;return{v:o,i:c,e:ce(()=>(s(e,o??r,c??i,l),()=>{t.delete(n)}))}}function Et(t,e,r){if(t.nodes)for(var n=t.nodes.start,i=t.nodes.end,s=e&&(e.f&ke)===0?e.nodes.start:r;n!==null;){var a=Pt(n);if(s.before(n),n===i)return;n=a}}function Fe(t,e,r){e===null?t.effect.first=r:e.next=r,r===null?t.effect.last=e:r.prev=e}function ri(t,e,r=!1,n=!1,i=!1){var s=t,a="";X(()=>{var l=O;if(a!==(a=e()??"")&&(l.nodes!==null&&(wn(l.nodes.start,l.nodes.end),l.nodes=null),a!=="")){var o=a+"";r?o=`<svg>${o}</svg>`:n&&(o=`<math>${o}</math>`);var c=Pn(o);if((r||n)&&(c=Ge(c)),jt(Ge(c),c.lastChild),r||n)for(;Ge(c);)s.before(Ge(c));else s.before(c)}})}function ni(t,e,...r){var n=new $n(t);Jt(()=>{const i=e()??null;n.ensure(i,i&&(s=>i(s,...r)))},Ve)}function Rn(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(r=Rn(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function si(){for(var t,e,r=0,n="",i=arguments.length;r<i;r++)(t=arguments[r])&&(e=Rn(t))&&(n&&(n+=" "),n+=e);return n}function ii(t){return typeof t=="object"?si(t):t??""}const Yr=[...` 	
\r\f \v\uFEFF`];function ai(t,e,r){var n=t==null?"":""+t;if(e&&(n=n?n+" "+e:e),r){for(var i in r)if(r[i])n=n?n+" "+i:i;else if(n.length)for(var s=i.length,a=0;(a=n.indexOf(i,a))>=0;){var l=a+s;(a===0||Yr.includes(n[a-1]))&&(l===n.length||Yr.includes(n[l]))?n=(a===0?"":n.substring(0,a))+n.substring(l+1):a=l}}return n===""?null:n}function oi(t,e){return t==null?null:String(t)}function he(t,e,r,n,i,s){var a=t.__className;if(a!==r||a===void 0){var l=ai(r,n,s);l==null?t.removeAttribute("class"):t.className=l,t.__className=r}else if(s&&i!==s)for(var o in s){var c=!!s[o];(i==null||c!==!!i[o])&&t.classList.toggle(o,c)}return s}function li(t,e,r,n){var i=t.__style;if(i!==e){var s=oi(e);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}return n}const ci=Symbol("is custom element"),fi=Symbol("is html");function ui(t,e){var r=Ln(t);r.value===(r.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function Ie(t,e,r,n){var i=Ln(t);i[e]!==(i[e]=r)&&(e==="loading"&&(t[Vn]=r),r==null?t.removeAttribute(e):typeof r!="string"&&di(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function Ln(t){return t.__attributes??={[ci]:t.nodeName.includes("-"),[fi]:t.namespaceURI===_s}}var jr=new Map;function di(t){var e=t.getAttribute("is")||t.nodeName,r=jr.get(e);if(r)return r;jr.set(e,r=[]);for(var n,i=t,s=Element.prototype;s!==i;){n=Vr(i);for(var a in n)n[a].set&&r.push(a);i=_r(i)}return r}function qr(t,e){return t===e||t?.[Ue]===e}function Ut(t={},e,r,n){return Fs(()=>{var i,s;return Kt(()=>{i=s,s=[],N(()=>{t!==r(...s)&&(e(t,...s),i&&qr(r(...i),t)&&e(null,...i))})}),()=>{_t(()=>{s&&qr(r(...s),t)&&e(null,...s)})}}),t}function Qt(t=!1){const e=B,r=e.l.u;if(!r)return;let n=()=>Us(e.s);if(t){let i=0,s={};const a=Vt(()=>{let l=!1;const o=e.s;for(const c in o)o[c]!==s[c]&&(s[c]=o[c],l=!0);return l&&i++,i});n=()=>v(a)}r.b.length&&Os(()=>{Ur(e,n),Bt(r.b)}),ar(()=>{const i=N(()=>r.m.map(Xn));return()=>{for(const s of i)typeof s=="function"&&s()}}),r.a.length&&ar(()=>{Ur(e,n),Bt(r.a)})}function Ur(t,e){if(t.l.s)for(const r of t.l.s)v(r);e()}function Ar(t,e,r){if(t==null)return e(void 0),r&&r(void 0),Ae;const n=N(()=>t.subscribe(e,r));return n.unsubscribe?()=>n.unsubscribe():n}const st=[];function hi(t,e){return{subscribe:Re(t,e).subscribe}}function Re(t,e=Ae){let r=null;const n=new Set;function i(l){if(rn(t,l)&&(t=l,r)){const o=!st.length;for(const c of n)c[1](),st.push(c,t);if(o){for(let c=0;c<st.length;c+=2)st[c][0](st[c+1]);st.length=0}}}function s(l){i(l(t))}function a(l,o=Ae){const c=[l,o];return n.add(c),n.size===1&&(r=e(i,s)||Ae),l(t),()=>{n.delete(c),n.size===0&&r&&(r(),r=null)}}return{set:i,update:s,subscribe:a}}function Dr(t,e,r){const n=!Array.isArray(t),i=n?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return hi(r,(a,l)=>{let o=!1;const c=[];let f=0,u=Ae;const d=()=>{if(f)return;u();const g=e(n?c[0]:c,a,l);s?a(g):u=typeof g=="function"?g:Ae},h=i.map((g,m)=>Ar(g,p=>{c[m]=p,f&=~(1<<m),o&&d()},()=>{f|=1<<m}));return o=!0,d(),function(){Bt(h),u(),o=!1}})}function $t(t){let e;return Ar(t,r=>e=r)(),e}let Ot=!1,fr=Symbol();function W(t,e,r){const n=r[e]??={store:null,source:se(void 0),unsubscribe:Ae};if(n.store!==t&&!(fr in r))if(n.unsubscribe(),n.store=t??null,t==null)n.source.v=void 0,n.unsubscribe=Ae;else{var i=!0;n.unsubscribe=Ar(t,s=>{i?n.source.v=s:F(n.source,s)}),i=!1}return t&&fr in r?$t(t):v(n.source)}function Rt(){const t={};function e(){Mr(()=>{for(var r in t)t[r].unsubscribe();Hr(t,fr,{enumerable:!1,value:!0})})}return[t,e]}function vi(t){var e=Ot;try{return Ot=!1,[t(),Ot]}finally{Ot=e}}function be(t,e,r,n){var i=!gt||(r&us)!==0,s=(r&hs)!==0,a=(r&vs)!==0,l=n,o=!0,c=()=>(o&&(o=!1,l=a?N(n):n),l),f;if(s){var u=Ue in t||Hn in t;f=lt(t,e)?.set??(u&&e in t?x=>t[e]=x:void 0)}var d,h=!1;s?[d,h]=vi(()=>t[e]):d=t[e],d===void 0&&n!==void 0&&(d=c(),f&&(i&&ts(),f(d)));var g;if(i?g=()=>{var x=t[e];return x===void 0?c():(o=!0,x)}:g=()=>{var x=t[e];return x!==void 0&&(l=void 0),x===void 0?l:x},i&&(r&ds)===0)return g;if(f){var m=t.$$legacy;return(function(x,k){return arguments.length>0?((!i||!k||m||h)&&f(k?g():x),x):g()})}var p=!1,b=((r&fs)!==0?Vt:Sr)(()=>(p=!1,g()));s&&v(b);var D=O;return(function(x,k){if(arguments.length>0){const M=k?v(b):i&&s?ot(x):x;return F(b,M),p=!0,l!==void 0&&(l=M),x}return rt&&p||(D.f&De)!==0?b.v:v(b)})}function Tr(t){B===null&&Qr(),gt&&B.l!==null?pi(B).m.push(t):ar(()=>{const e=N(t);if(typeof e=="function")return e})}function On(t){B===null&&Qr(),Tr(()=>()=>N(t))}function pi(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}const gi="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(gi);ws();class _i{propagator=null;config;currentSeed;isInitialized=!1;wasmModule=null;currentBackend="cpu";gpuAvailable=!1;constructor(e,r){this.config=e,this.currentSeed=r}async initialize(e="cpu"){try{const n="/autoverse/pkg/flow_lenia.js";this.wasmModule=await import(n),await this.wasmModule.default(),this.gpuAvailable=await this.checkWebGPU();const i=e==="gpu"&&this.gpuAvailable?"gpu":"cpu";await this.createPropagator(i),this.isInitialized=!0}catch(r){throw new Error(`Failed to initialize WASM: ${r}`)}}async checkWebGPU(){if(typeof navigator>"u"||!("gpu"in navigator))return!1;try{return await navigator.gpu.requestAdapter()!==null}catch{return!1}}async createPropagator(e){if(!this.wasmModule)throw new Error("WASM module not loaded");const r=JSON.stringify(this.config),n=JSON.stringify(this.currentSeed);e==="gpu"&&this.gpuAvailable?(this.propagator=await new this.wasmModule.WasmGpuPropagator(r,n),this.currentBackend="gpu"):(this.propagator=new this.wasmModule.WasmPropagator(r,n),this.currentBackend="cpu")}async switchBackend(e){if(!this.isInitialized)throw new Error("Simulation not initialized");return e==="gpu"&&!this.gpuAvailable?!1:(e===this.currentBackend||await this.createPropagator(e),!0)}isGpuAvailable(){return this.gpuAvailable}getBackend(){return this.currentBackend}async step(){this.ensureInitialized(),this.currentBackend==="gpu"?await this.propagator.step():this.propagator.step()}async run(e){this.ensureInitialized(),this.currentBackend==="gpu"?await this.propagator.run(BigInt(e)):this.propagator.run(BigInt(e))}getState(){return this.ensureInitialized(),this.propagator.getState()}reset(e){this.ensureInitialized(),e&&(this.currentSeed=e),this.propagator.reset(JSON.stringify(this.currentSeed))}totalMass(){return this.ensureInitialized(),this.propagator.totalMass()}getTime(){return this.ensureInitialized(),this.propagator.getTime()}getStep(){return this.ensureInitialized(),this.propagator.getStep()}getWidth(){return this.config.width}getHeight(){return this.config.height}getConfig(){return{...this.config}}extractRegion(e,r,n,i){this.ensureInitialized();const s=this.getState(),a=[];for(let l=0;l<s.channels.length;l++){const o=[];for(let c=0;c<i;c++)for(let f=0;f<n;f++){const u=(e+f)%s.width,h=(r+c)%s.height*s.width+u;o.push(s.channels[l][h])}a.push(o)}return{width:n,height:i,channels:a,sourceX:e,sourceY:r}}placeRegion(e,r,n){this.ensureInitialized();const i=this.getState(),s=new Map;for(let o=0;o<i.channels.length;o++)for(let c=0;c<i.height;c++)for(let f=0;f<i.width;f++){const u=c*i.width+f,d=i.channels[o][u];d>.001&&s.set(`${f},${c},${o}`,d)}for(let o=0;o<e.channels.length;o++)for(let c=0;c<e.height;c++)for(let f=0;f<e.width;f++){const u=(r+f)%this.config.width,d=(n+c)%this.config.height,h=c*e.width+f,g=e.channels[o][h];g>.001&&s.set(`${u},${d},${o}`,g)}const a=[];for(const[o,c]of s){const[f,u,d]=o.split(",").map(Number);a.push([f,u,d,c])}const l={pattern:{type:"Custom",values:a}};this.reset(l)}drawAt(e,r,n,i,s=0){this.ensureInitialized();const a=this.getState(),l=[];for(let c=0;c<a.channels.length;c++)for(let f=0;f<a.height;f++)for(let u=0;u<a.width;u++){const d=f*a.width+u;let h=a.channels[c][d];if(c===s){const g=u-e,m=f-r,p=Math.sqrt(g*g+m*m);if(p<=n){const b=1-p/n;h=Math.min(1,h+i*b*b)}}h>.001&&l.push([u,f,c,h])}const o={pattern:{type:"Custom",values:l}};this.reset(o)}eraseAt(e,r,n,i=0){this.ensureInitialized();const s=this.getState(),a=[];for(let o=0;o<s.channels.length;o++)for(let c=0;c<s.height;c++)for(let f=0;f<s.width;f++){const u=c*s.width+f;let d=s.channels[o][u];if(o===i){const h=f-e,g=c-r,m=Math.sqrt(h*h+g*g);if(m<=n){const p=1-m/n;d=Math.max(0,d*(1-p*p))}}d>.001&&a.push([f,c,o,d])}const l={pattern:{type:"Custom",values:a}};this.reset(l)}ensureInitialized(){if(!this.isInitialized||!this.propagator)throw new Error("Simulation not initialized. Call initialize() first.")}}const ur={width:128,height:128,channels:1,dt:.1,kernel_radius:13,kernels:[{radius:1,rings:[{amplitude:1,distance:.5,width:.15}],weight:1,mu:.15,sigma:.015,source_channel:0,target_channel:0}],flow:{beta_a:1,n:2,distribution_size:1}},mi={pattern:{type:"GaussianBlob",center:[.5,.5],radius:.1,amplitude:1,channel:0}},bi={initialized:!1,playing:!1,step:0,time:0,totalMass:0,fps:0,frameTime:0,backend:"cpu",gpuAvailable:!1,config:ur,state:null},Z=Re(bi),Nn=Re([]);function U(t,e="info"){Nn.update(r=>[...r.slice(-100),{message:t,level:e,timestamp:Date.now()}])}let z=null,Nt=null,Ct=0,Ft=0,dr=0,Fn=1;function hr(){return z}function wi(t){Fn=Math.max(1,Math.min(10,t))}async function yi(){z=new _i(ur,mi),await z.initialize();const t=z.getState();Z.update(e=>({...e,initialized:!0,step:z.getStep(),time:z.getTime(),totalMass:z.totalMass(),backend:z.getBackend(),gpuAvailable:z.isGpuAvailable(),config:ur,state:t}))}function Si(){!z||$t(Z).playing||(Z.update(e=>({...e,playing:!0})),Ct=performance.now(),dr=Ct,Ft=0,Gn(Ct),U("Simulation started","info"))}function xi(){Z.update(t=>({...t,playing:!1})),Nt!==null&&(cancelAnimationFrame(Nt),Nt=null),U("Simulation paused","info")}async function Ei(){z&&(await z.step(),Ir())}function Bn(t){z&&(z.reset(t),Ir(),U("Simulation reset","info"))}async function Mi(t){if(!z)return!1;const e=await z.switchBackend(t);return e?(Z.update(r=>({...r,backend:t})),U(`Switched to ${t.toUpperCase()} backend`,"success")):U(`Failed to switch to ${t} backend`,"error"),e}async function Gn(t){if(!$t(Z).playing||!z)return;const r=t-Ct;Ct=t,await z.run(Fn),Ir(),Ft++,t-dr>=1e3&&(Z.update(n=>({...n,fps:Ft,frameTime:r})),Ft=0,dr=t),Nt=requestAnimationFrame(n=>Gn(n))}function Ir(){if(!z)return;const t=z.getState();Z.update(e=>({...e,step:z.getStep(),time:z.getTime(),totalMass:z.totalMass(),state:t}))}const Ci=Dr(Z,t=>t.time.toFixed(2)),ki=Dr(Z,t=>t.totalMass.toLocaleString(void 0,{maximumFractionDigits:0})),Ai=Dr(Z,t=>t.step.toString().padStart(8,"0")),Di={mode:"view",brushSize:5,brushIntensity:.8,colorScheme:"theme",visualizationMode:"mass",showGrid:!1,showScanlines:!0,showSelection:!0,zoom:1,panX:0,panY:0},bt=Re(Di);function Ti(t){bt.update(e=>({...e,mode:t}))}function Ii(t){bt.update(e=>({...e,brushSize:Math.max(1,Math.min(50,t))}))}function Pi(t){bt.update(e=>({...e,brushIntensity:Math.max(0,Math.min(1,t))}))}const Tt=[{id:"void",name:"VOID",colors:{primary:"#a855f7",primaryDim:"#6b21a8",primaryGlow:"rgba(168, 85, 247, 0.4)",secondary:"#3b82f6",secondaryDim:"#1e40af",secondaryGlow:"rgba(59, 130, 246, 0.4)",tertiary:"#ec4899",tertiaryDim:"#9d174d",tertiaryGlow:"rgba(236, 72, 153, 0.4)",success:"#a855f7",warning:"#f59e0b",danger:"#ef4444"}},{id:"neon-tokyo",name:"NEON TOKYO",colors:{primary:"#ff2d95",primaryDim:"#9d1a5a",primaryGlow:"rgba(255, 45, 149, 0.4)",secondary:"#00f0ff",secondaryDim:"#0891b2",secondaryGlow:"rgba(0, 240, 255, 0.4)",tertiary:"#ffee00",tertiaryDim:"#a38a00",tertiaryGlow:"rgba(255, 238, 0, 0.4)",success:"#00f0ff",warning:"#ffee00",danger:"#ff2d95"}},{id:"synthwave",name:"SYNTHWAVE",colors:{primary:"#f472b6",primaryDim:"#a21caf",primaryGlow:"rgba(244, 114, 182, 0.4)",secondary:"#818cf8",secondaryDim:"#4338ca",secondaryGlow:"rgba(129, 140, 248, 0.4)",tertiary:"#22d3ee",tertiaryDim:"#0e7490",tertiaryGlow:"rgba(34, 211, 238, 0.4)",success:"#22d3ee",warning:"#fbbf24",danger:"#f43f5e"}},{id:"bloodmoon",name:"BLOODMOON",colors:{primary:"#dc2626",primaryDim:"#7f1d1d",primaryGlow:"rgba(220, 38, 38, 0.4)",secondary:"#f97316",secondaryDim:"#9a3412",secondaryGlow:"rgba(249, 115, 22, 0.4)",tertiary:"#fbbf24",tertiaryDim:"#92400e",tertiaryGlow:"rgba(251, 191, 36, 0.4)",success:"#f97316",warning:"#fbbf24",danger:"#dc2626"}},{id:"toxic",name:"TOXIC",colors:{primary:"#84cc16",primaryDim:"#3f6212",primaryGlow:"rgba(132, 204, 22, 0.5)",secondary:"#facc15",secondaryDim:"#854d0e",secondaryGlow:"rgba(250, 204, 21, 0.4)",tertiary:"#22c55e",tertiaryDim:"#166534",tertiaryGlow:"rgba(34, 197, 94, 0.4)",success:"#22c55e",warning:"#facc15",danger:"#ef4444"}},{id:"ice",name:"ICE",colors:{primary:"#38bdf8",primaryDim:"#0369a1",primaryGlow:"rgba(56, 189, 248, 0.4)",secondary:"#e0f2fe",secondaryDim:"#7dd3fc",secondaryGlow:"rgba(224, 242, 254, 0.3)",tertiary:"#a5b4fc",tertiaryDim:"#4f46e5",tertiaryGlow:"rgba(165, 180, 252, 0.4)",success:"#38bdf8",warning:"#fcd34d",danger:"#f87171"}},{id:"hacker",name:"HACKER",colors:{primary:"#22c55e",primaryDim:"#166534",primaryGlow:"rgba(34, 197, 94, 0.5)",secondary:"#4ade80",secondaryDim:"#15803d",secondaryGlow:"rgba(74, 222, 128, 0.4)",tertiary:"#86efac",tertiaryDim:"#22c55e",tertiaryGlow:"rgba(134, 239, 172, 0.3)",success:"#22c55e",warning:"#fbbf24",danger:"#ef4444"}},{id:"phosphor",name:"PHOSPHOR",colors:{primary:"#fef08a",primaryDim:"#a16207",primaryGlow:"rgba(254, 240, 138, 0.5)",secondary:"#fde047",secondaryDim:"#854d0e",secondaryGlow:"rgba(253, 224, 71, 0.4)",tertiary:"#fbbf24",tertiaryDim:"#92400e",tertiaryGlow:"rgba(251, 191, 36, 0.4)",success:"#a3e635",warning:"#fbbf24",danger:"#f87171"}}],er=Re(Tt[0]);function vr(t){const e=document.documentElement,{colors:r}=t;e.style.setProperty("--color-primary",r.primary),e.style.setProperty("--color-primary-dim",r.primaryDim),e.style.setProperty("--color-primary-glow",r.primaryGlow),e.style.setProperty("--color-secondary",r.secondary),e.style.setProperty("--color-secondary-dim",r.secondaryDim),e.style.setProperty("--color-secondary-glow",r.secondaryGlow),e.style.setProperty("--color-tertiary",r.tertiary),e.style.setProperty("--color-tertiary-dim",r.tertiaryDim),e.style.setProperty("--color-tertiary-glow",r.tertiaryGlow),e.style.setProperty("--color-success",r.success),e.style.setProperty("--color-warning",r.warning),e.style.setProperty("--color-danger",r.danger),er.set(t),localStorage.setItem("autoverse-theme",t.id)}function $i(t){const e=Tt.find(r=>r.id===t);e&&vr(e)}function Ri(){const t=localStorage.getItem("autoverse-theme");if(t){const e=Tt.find(r=>r.id===t);if(e){vr(e);return}}vr(Tt[0])}const pr=Re(null),zn=Re(0);function Li(){zn.update(t=>t+1)}function Oi(t,e){const r=$t(pr);r&&r.startDragFromLibrary(t,e)}const gr=Re(null);var Ni=R("<button></button>"),Fi=R('<header class="header svelte-4b3o1e"><div class="header-left svelte-4b3o1e"><pre class="ascii-logo svelte-4b3o1e"></pre></div> <div class="header-right svelte-4b3o1e"><div class="theme-picker svelte-4b3o1e"><span class="picker-label svelte-4b3o1e">THEME</span> <div class="theme-swatches svelte-4b3o1e"></div></div> <div><span class="backend-label svelte-4b3o1e">COMPUTE</span> <span class="backend-value svelte-4b3o1e"> </span></div></div></header>');function Bi(t,e){et(e,!1);const r=()=>W(er,"$currentScheme",i),n=()=>W(Z,"$simulationStore",i),[i,s]=Rt();Qt();var a=Fi(),l=w(a),o=w(l);o.textContent=`
 ▄▀▄ █ █ ▀█▀ ▄▀▄ █ █ █▀▀ █▀▄ ▄▀▀ █▀▀
 █▀█ █▄█  █  █ █ ▀▄▀ ██▄ █▀▄ ▄██ ██▄`;var c=E(l,2),f=w(c),u=E(w(f),2);Dt(u,5,()=>Tt,qt,(p,b)=>{var D=Ni();let x;D.__click=()=>$i(v(b).id),X(()=>{x=he(D,1,"swatch svelte-4b3o1e",null,x,{active:r().id===v(b).id}),li(D,`--swatch-color: ${v(b).colors.primary??""}`),Ie(D,"title",v(b).name)}),T(p,D)});var d=E(f,2);let h;var g=E(w(d),2),m=w(g);X(p=>{h=he(d,1,"backend-indicator svelte-4b3o1e",null,h,{gpu:n().backend==="gpu"}),j(m,p)},[()=>n().backend.toUpperCase()]),T(t,a),tt(),s()}Zt(["click"]);var Gi=R('<footer class="footer svelte-ww03jg"></footer>');function zi(t){var e=Gi();T(t,e)}var Yi=R("<div> </div>"),ji=R('<div><div class="corner top-left svelte-1gtc57s"></div> <div class="corner top-right svelte-1gtc57s"></div> <div class="corner bottom-left svelte-1gtc57s"></div> <div class="corner bottom-right svelte-1gtc57s"></div> <!> <div><!></div></div>');function qe(t,e){let r=be(e,"borderColor",3,"primary"),n=be(e,"noPadding",3,!1),i=be(e,"class",3,"");const s={primary:"border-primary",secondary:"border-secondary",tertiary:"border-tertiary"};var a=ji(),l=E(w(a),8);{var o=d=>{var h=Yi(),g=w(h);X(()=>{he(h,1,`title ${s[r()]??""}`,"svelte-1gtc57s"),j(g,e.title)}),T(d,h)};de(l,d=>{e.title&&d(o)})}var c=E(l,2);let f;var u=w(c);ni(u,()=>e.children??Ae),X(()=>{he(a,1,`tui-box ${s[r()]??""} ${i()??""}`,"svelte-1gtc57s"),f=he(c,1,"content svelte-1gtc57s",null,f,{"no-padding":n()})}),T(t,a)}var qi=R('<span class="label svelte-1l5vt72"> </span>'),Ui=R("<span> </span>"),Xi=R('<div class="slider-header svelte-1l5vt72"><!> <!></div>'),Wi=R('<div class="slider-container svelte-1l5vt72"><!> <input type="range"/></div>');function tr(t,e){et(e,!0);let r=be(e,"value",15),n=be(e,"min",3,0),i=be(e,"max",3,100),s=be(e,"step",3,1),a=be(e,"showValue",3,!0),l=be(e,"valueFormat",3,g=>String(g)),o=be(e,"color",3,"tertiary");function c(g){const m=g.target;r(parseFloat(m.value)),e.onchange?.(r())}var f=Wi(),u=w(f);{var d=g=>{var m=Xi(),p=w(m);{var b=k=>{var M=qi(),_=w(M);X(()=>j(_,e.label)),T(k,M)};de(p,k=>{e.label&&k(b)})}var D=E(p,2);{var x=k=>{var M=Ui(),_=w(M);X(y=>{he(M,1,`value ${o()??""}`,"svelte-1l5vt72"),j(_,y)},[()=>l()(r())]),T(k,M)};de(D,k=>{a()&&k(x)})}T(g,m)};de(u,g=>{(e.label||a())&&g(d)})}var h=E(u,2);h.__input=c,X(()=>{he(h,1,ii(o()),"svelte-1l5vt72"),Ie(h,"min",n()),Ie(h,"max",i()),Ie(h,"step",s()),ui(h,r())}),T(t,f),tt()}Zt(["input"]);var Hi=R('<span class="icon svelte-oaxjxu">&#9724;</span> <span class="label svelte-oaxjxu">PAUSE</span>',1),Vi=R('<span class="icon svelte-oaxjxu">&#9654;</span> <span class="label svelte-oaxjxu">PLAY</span>',1),Ki=R('<div class="control-grid svelte-oaxjxu"><button><!></button> <button class="control-btn svelte-oaxjxu"><span class="icon svelte-oaxjxu">&#9655;</span> <span class="label svelte-oaxjxu">STEP</span></button> <button class="control-btn svelte-oaxjxu"><span class="icon svelte-oaxjxu">&#8634;</span> <span class="label svelte-oaxjxu">RESET</span></button></div> <div class="speed-control svelte-oaxjxu"><!></div>',1),Ji=R('<button><span class="icon svelte-oaxjxu"><!></span> <span class="label svelte-oaxjxu"> </span></button>'),Zi=R('<div class="brush-settings svelte-oaxjxu"><!> <!></div>'),Qi=R('<div class="tool-grid svelte-oaxjxu"></div> <!>',1),ea=R('<div><span class="log-prefix svelte-oaxjxu">&gt;</span> <span class="log-message svelte-oaxjxu"> </span></div>'),ta=R('<div class="log-container svelte-oaxjxu"></div>'),ra=R('<aside class="left-sidebar svelte-oaxjxu"><!> <!> <!></aside>');function na(t,e){et(e,!0);const r=()=>W(Z,"$simulationStore",s),n=()=>W(bt,"$settings",s),i=()=>W(Nn,"$systemLog",s),[s,a]=Rt();let l=Me(1);function o(m){F(l,m,!0),wi(m)}function c(m){Ti(m)}const f=[{id:"view",label:"VIEW",icon:"&#9673;"},{id:"select",label:"SEL",icon:"&#9633;"},{id:"draw",label:"DRAW",icon:"&#9998;"},{id:"erase",label:"ERASE",icon:"&#9747;"}];var u=ra(),d=w(u);qe(d,{title:"SYS.CONTROL",borderColor:"primary",children:(m,p)=>{var b=Ki(),D=ct(b),x=w(D);let k;x.__click=()=>r().playing?xi():Si();var M=w(x);{var _=L=>{var Y=Hi();T(L,Y)},y=L=>{var Y=Vi();T(L,Y)};de(M,L=>{r().playing?L(_):L(y,!1)})}var S=E(x,2);S.__click=()=>Ei();var P=E(S,2);P.__click=()=>Bn();var A=E(D,2),$=w(A);tr($,{label:"SIM SPEED",min:1,max:10,step:1,color:"primary",valueFormat:L=>`${L}X`,onchange:o,get value(){return v(l)},set value(L){F(l,L,!0)}}),X(()=>k=he(x,1,"control-btn svelte-oaxjxu",null,k,{active:!r().playing})),T(m,b)},$$slots:{default:!0}});var h=E(d,2);qe(h,{title:"TOOL.KIT",borderColor:"tertiary",children:(m,p)=>{var b=Qi(),D=ct(b);Dt(D,21,()=>f,qt,(M,_)=>{var y=Ji();let S;y.__click=()=>c(v(_).id);var P=w(y),A=w(P);ri(A,()=>v(_).icon);var $=E(P,2),L=w($);X(()=>{S=he(y,1,"tool-btn svelte-oaxjxu",null,S,{active:n().mode===v(_).id}),j(L,v(_).label)}),T(M,y)});var x=E(D,2);{var k=M=>{var _=Zi(),y=w(_);tr(y,{label:"BRUSH SIZE",get value(){return n().brushSize},min:1,max:30,step:1,color:"tertiary",valueFormat:A=>`${A}PX`,get onchange(){return Ii}});var S=E(y,2);{var P=A=>{tr(A,{label:"INTENSITY",get value(){return n().brushIntensity},min:0,max:1,step:.05,color:"tertiary",valueFormat:$=>`${Math.round($*100)}%`,get onchange(){return Pi}})};de(S,A=>{n().mode==="draw"&&A(P)})}T(M,_)};de(x,M=>{(n().mode==="draw"||n().mode==="erase")&&M(k)})}T(m,b)},$$slots:{default:!0}});var g=E(h,2);qe(g,{title:"DEBUG.LOG",borderColor:"secondary",class:"debug-log-box",children:(m,p)=>{var b=ta();Dt(b,5,i,qt,(D,x)=>{var k=ea(),M=E(w(k),2),_=w(M);X(()=>{he(k,1,`log-entry ${v(x).level??""}`,"svelte-oaxjxu"),j(_,v(x).message)}),T(D,k)}),T(m,b)},$$slots:{default:!0}}),T(t,u),tt(),a()}Zt(["click"]);const Xr="flow-lenia-presets";class sa{presets=new Map;listeners=new Set;constructor(){this.loadFromStorage()}generateId(){return`preset-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}createThumbnail(e,r=64){const n=document.createElement("canvas");n.width=r,n.height=r;const i=n.getContext("2d"),s=i.createImageData(e.width,e.height),a=e.channels[0];for(let g=0;g<a.length;g++){const m=Math.max(0,Math.min(1,a[g])),p=Math.floor(m*255);s.data[g*4+0]=p,s.data[g*4+1]=p,s.data[g*4+2]=p,s.data[g*4+3]=255}const l=document.createElement("canvas");l.width=e.width,l.height=e.height,l.getContext("2d").putImageData(s,0,0),i.imageSmoothingEnabled=!0,i.fillStyle="#1a1a1a",i.fillRect(0,0,r,r);const c=Math.min(r/e.width,r/e.height),f=e.width*c,u=e.height*c,d=(r-f)/2,h=(r-u)/2;return i.drawImage(l,d,h,f,u),n.toDataURL("image/png")}savePreset(e,r,n){const i={id:this.generateId(),name:e,description:n,thumbnail:this.createThumbnail(r),region:r,createdAt:Date.now()};return this.presets.set(i.id,i),this.persistToStorage(),this.notifyListeners(),i}getPreset(e){return this.presets.get(e)}getAllPresets(){return Array.from(this.presets.values()).sort((e,r)=>r.createdAt-e.createdAt)}deletePreset(e){const r=this.presets.delete(e);return r&&(this.persistToStorage(),this.notifyListeners()),r}renamePreset(e,r){const n=this.presets.get(e);return n?(n.name=r,this.persistToStorage(),this.notifyListeners(),!0):!1}updateDescription(e,r){const n=this.presets.get(e);return n?(n.description=r,this.persistToStorage(),this.notifyListeners(),!0):!1}exportPresets(e){const r=e?e.map(n=>this.presets.get(n)).filter(Boolean):this.getAllPresets();return JSON.stringify(r,null,2)}importPresets(e){try{const r=JSON.parse(e);let n=0;for(const i of r){const s={...i,id:this.generateId(),createdAt:Date.now()};this.presets.set(s.id,s),n++}return this.persistToStorage(),this.notifyListeners(),n}catch{throw new Error("Invalid preset JSON format")}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){const e=this.getAllPresets();for(const r of this.listeners)r(e)}persistToStorage(){try{const e=JSON.stringify(Array.from(this.presets.entries()));localStorage.setItem(Xr,e)}catch(e){console.warn("Failed to persist presets to storage:",e)}}loadFromStorage(){try{const e=localStorage.getItem(Xr);if(e){const r=JSON.parse(e);this.presets=new Map(r)}}catch(e){console.warn("Failed to load presets from storage:",e),this.presets=new Map}}clearAll(){this.presets.clear(),this.persistToStorage(),this.notifyListeners()}}const ia=[{name:"Glider",description:"A simple glider that moves across the grid",seed:{pattern:{type:"GaussianBlob",center:[.5,.5],radius:.1,amplitude:1,channel:0}}},{name:"Ring",description:"A ring pattern that expands",seed:{pattern:{type:"Ring",center:[.5,.5],inner_radius:.05,outer_radius:.1,amplitude:1,channel:0}}},{name:"Dual Blobs",description:"Two interacting blobs",seed:{pattern:{type:"MultiBlob",blobs:[{center:[.35,.5],radius:.08,amplitude:1,channel:0},{center:[.65,.5],radius:.08,amplitude:1,channel:0}]}}},{name:"Random Noise",description:"Random initial conditions",seed:{pattern:{type:"Noise",seed:42,amplitude:.5,channel:0}}}],vt=new sa,Pr=Re(vt.getAllPresets());vt.subscribe(t=>{Pr.set(t)});function aa(t){const e=vt.getAllPresets().find(r=>r.id===t);vt.deletePreset(t),e&&U(`Deleted preset: ${e.name}`,"info")}function oa(){const t=vt.exportPresets();return U(`Exported ${$t(Pr).length} presets`,"success"),t}function la(t){try{const e=vt.importPresets(t);return U(`Imported ${e} presets`,"success"),Li(),e}catch(e){throw U(`Import failed: ${e}`,"error"),e}}function ca(){const t=oa(),e=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download="flow-lenia-presets.json",n.click(),URL.revokeObjectURL(r)}var fa=R('<div class="metric-display svelte-1baw31t"><div class="metric-main svelte-1baw31t"><span class="metric-value svelte-1baw31t"> </span> <span class="metric-unit svelte-1baw31t">STEPS</span></div> <div class="metric-row svelte-1baw31t"><div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">TIME</span> <span class="metric-num svelte-1baw31t"> </span></div> <div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">MASS</span> <span class="metric-num highlight svelte-1baw31t"> </span></div></div> <div class="metric-row svelte-1baw31t"><div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">FPS</span> <span class="metric-num accent svelte-1baw31t"> </span></div> <div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">BACKEND</span> <button> </button></div></div></div>'),ua=R('<div class="config-grid svelte-1baw31t"><div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">mu</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">sigma</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">R</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">dt</span> <span class="cfg-value svelte-1baw31t"> </span></div></div>'),da=R('<button class="builtin-btn svelte-1baw31t"> </button>'),ha=R('<div class="builtin-grid svelte-1baw31t"></div>'),va=R('<img class="svelte-1baw31t"/>'),pa=R('<div class="preset-item svelte-1baw31t" draggable="true" role="button" tabindex="0"><div class="preset-thumbnail svelte-1baw31t"><!></div> <div class="preset-info svelte-1baw31t"><span class="preset-name svelte-1baw31t"> </span> <span class="preset-size svelte-1baw31t"> </span></div> <button class="delete-btn svelte-1baw31t">&#10005;</button></div>'),ga=R('<div class="empty-state svelte-1baw31t">No saved patterns</div>'),_a=R('<div class="patterns-header svelte-1baw31t"><button class="small-btn svelte-1baw31t">IMPORT</button> <button class="small-btn svelte-1baw31t">EXPORT</button></div> <div class="preset-list svelte-1baw31t"></div>',1),ma=R('<aside class="right-sidebar svelte-1baw31t"><!> <!> <!> <!></aside>');function ba(t,e){et(e,!1);const r=()=>W(Z,"$simulationStore",l),n=()=>W(Ai,"$formattedStep",l),i=()=>W(Ci,"$formattedTime",l),s=()=>W(ki,"$formattedMass",l),a=()=>W(Pr,"$presets",l),[l,o]=Rt(),c=se();function f(){const _=r().backend==="cpu"?"gpu":"cpu";Mi(_)}function u(_){const y=hr();if(!y)return;const S=Math.floor((y.getWidth()-_.region.width)/2),P=Math.floor((y.getHeight()-_.region.height)/2);y.placeRegion(_.region,S,P)}function d(_){Bn(_.seed),U(`Loaded pattern: ${_.name}`,"info")}function h(_,y){_.stopPropagation(),aa(y)}function g(){ca()}function m(){const _=document.createElement("input");_.type="file",_.accept=".json",_.onchange=async y=>{const S=y.target.files?.[0];if(!S)return;const P=await S.text();try{la(P)}catch{}},_.click()}function p(_,y){_.dataTransfer.effectAllowed="copy",_.dataTransfer.setData("text/plain",y.id),Oi(y,_)}Be(()=>r(),()=>{F(c,r().config.kernels[0])}),Cr(),Qt();var b=ma(),D=w(b);qe(D,{title:"METRICS",borderColor:"secondary",children:(_,y)=>{var S=fa(),P=w(S),A=w(P),$=w(A),L=E(P,2),Y=w(L),C=E(w(Y),2),q=w(C),ae=E(Y,2),ge=E(w(ae),2),_e=w(ge),Le=E(L,2),Ee=w(Le),wt=E(w(Ee),2),yt=w(wt),ue=E(Ee,2),Oe=E(w(ue),2);let oe;Oe.__click=f;var St=w(Oe);X(Yn=>{j($,n()),j(q,`${i()??""}s`),j(_e,s()),j(yt,(r(),N(()=>r().fps))),oe=he(Oe,1,"backend-btn svelte-1baw31t",null,oe,{gpu:r().backend==="gpu"}),Oe.disabled=(r(),N(()=>!r().gpuAvailable)),j(St,Yn)},[()=>(r(),N(()=>r().backend.toUpperCase()))]),T(_,S)},$$slots:{default:!0}});var x=E(D,2);qe(x,{title:"KERNEL",borderColor:"primary",children:(_,y)=>{var S=ua(),P=w(S),A=E(w(P),2),$=w(A),L=E(P,2),Y=E(w(L),2),C=w(Y),q=E(L,2),ae=E(w(q),2),ge=w(ae),_e=E(q,2),Le=E(w(_e),2),Ee=w(Le);X(()=>{j($,(v(c),N(()=>v(c)?.mu??"—"))),j(C,(v(c),N(()=>v(c)?.sigma??"—"))),j(ge,(r(),N(()=>r().config.kernel_radius))),j(Ee,(r(),N(()=>r().config.dt)))}),T(_,S)},$$slots:{default:!0}});var k=E(x,2);qe(k,{title:"SEEDS",borderColor:"tertiary",children:(_,y)=>{var S=ha();Dt(S,5,()=>ia,qt,(P,A)=>{var $=da();$.__click=()=>d(v(A));var L=w($);X(()=>{Ie($,"title",(v(A),N(()=>v(A).description))),j(L,(v(A),N(()=>v(A).name)))}),T(P,$)}),T(_,S)},$$slots:{default:!0}});var M=E(k,2);qe(M,{title:"SAVED",borderColor:"primary",class:"saved-box",children:(_,y)=>{var S=_a(),P=ct(S),A=w(P);A.__click=m;var $=E(A,2);$.__click=g;var L=E(P,2);Dt(L,5,a,Y=>Y.id,(Y,C)=>{var q=pa();q.__click=()=>u(v(C)),q.__keydown=oe=>oe.key==="Enter"&&u(v(C));var ae=w(q),ge=w(ae);{var _e=oe=>{var St=va();X(()=>{Ie(St,"src",(v(C),N(()=>v(C).thumbnail))),Ie(St,"alt",(v(C),N(()=>v(C).name)))}),T(oe,St)};de(ge,oe=>{v(C),N(()=>v(C).thumbnail)&&oe(_e)})}var Le=E(ae,2),Ee=w(Le),wt=w(Ee),yt=E(Ee,2),ue=w(yt),Oe=E(Le,2);Oe.__click=oe=>h(oe,v(C).id),X(()=>{j(wt,(v(C),N(()=>v(C).name))),j(ue,`${v(C),N(()=>v(C).region.width)??""}x${v(C),N(()=>v(C).region.height)??""}`)}),Vs("dragstart",q,oe=>p(oe,v(C))),T(Y,q)},Y=>{var C=ga();T(Y,C)}),T(_,S)},$$slots:{default:!0}}),T(t,b),tt(),o()}Zt(["click","keydown"]);class wa{canvas;ctx;offscreenCanvas;offscreenCtx;settings;grayscaleMap;thermalMap;viridisMap;themeMap;constructor(e,r){this.canvas=e;const n=e.getContext("2d");if(!n)throw new Error("Failed to get 2D context");this.ctx=n,this.offscreenCanvas=document.createElement("canvas");const i=this.offscreenCanvas.getContext("2d");if(!i)throw new Error("Failed to get offscreen 2D context");this.offscreenCtx=i,this.settings=r,this.grayscaleMap=this.buildGrayscaleMap(),this.thermalMap=this.buildThermalMap(),this.viridisMap=this.buildViridisMap(),this.themeMap=this.viridisMap}setThemeColors(e){this.themeMap=this.buildThemeMap(e)}updateSettings(e){this.settings={...this.settings,...e}}render(e,r,n){const{width:i,height:s,channels:a}=e;(this.offscreenCanvas.width!==i||this.offscreenCanvas.height!==s)&&(this.offscreenCanvas.width=i,this.offscreenCanvas.height=s);const l=this.getColorMap(),o=this.offscreenCtx.createImageData(i,s),c=a[0];for(let f=0;f<c.length;f++){const u=Math.max(0,Math.min(1,c[f])),d=Math.floor(u*255)*4;o.data[f*4+0]=l[d+0],o.data[f*4+1]=l[d+1],o.data[f*4+2]=l[d+2],o.data[f*4+3]=255}this.offscreenCtx.putImageData(o,0,0),this.ctx.imageSmoothingEnabled=!1,this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.offscreenCanvas,0,0,i,s,0,0,this.canvas.width,this.canvas.height),this.settings.showGrid&&this.drawGrid(i,s),n&&this.drawGhostPreview(n,i,s),r&&this.settings.showSelection&&this.drawSelection(r,i,s)}drawGrid(e,r){const n=this.canvas.width/e,i=this.canvas.height/r;if(this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1,n>=4&&i>=4){this.ctx.beginPath();for(let s=0;s<=e;s++){const a=s*n;this.ctx.moveTo(a,0),this.ctx.lineTo(a,this.canvas.height)}for(let s=0;s<=r;s++){const a=s*i;this.ctx.moveTo(0,a),this.ctx.lineTo(this.canvas.width,a)}this.ctx.stroke()}}drawSelection(e,r,n){const i=this.canvas.width/r,s=this.canvas.height/n,a=Math.min(e.startX,e.endX)*i,l=Math.min(e.startY,e.endY)*s,o=Math.abs(e.endX-e.startX)*i,c=Math.abs(e.endY-e.startY)*s;this.ctx.fillStyle="rgba(79, 195, 247, 0.2)",this.ctx.fillRect(a,l,o,c),this.ctx.strokeStyle="#4fc3f7",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.strokeRect(a,l,o,c),this.ctx.setLineDash([]);const f=Math.abs(e.endX-e.startX),u=Math.abs(e.endY-e.startY);f>0&&u>0&&(this.ctx.fillStyle="#4fc3f7",this.ctx.font="12px monospace",this.ctx.fillText(`${f} x ${u}`,a+4,l-4))}drawGhostPreview(e,r,n){const i=this.canvas.width/r,s=this.canvas.height/n,{region:a,x:l,y:o}=e,c=document.createElement("canvas");c.width=a.width,c.height=a.height;const f=c.getContext("2d"),u=f.createImageData(a.width,a.height),d=this.getColorMap();for(let h=0;h<a.channels[0].length;h++){const g=Math.max(0,Math.min(1,a.channels[0][h])),m=Math.floor(g*255)*4;u.data[h*4+0]=d[m+0],u.data[h*4+1]=d[m+1],u.data[h*4+2]=d[m+2],u.data[h*4+3]=g>.01?180:0}f.putImageData(u,0,0),this.ctx.globalAlpha=.7,this.ctx.drawImage(c,0,0,a.width,a.height,l*i,o*s,a.width*i,a.height*s),this.ctx.globalAlpha=1,this.ctx.strokeStyle="#4fc3f7",this.ctx.lineWidth=2,this.ctx.setLineDash([3,3]),this.ctx.strokeRect(l*i,o*s,a.width*i,a.height*s),this.ctx.setLineDash([])}canvasToSim(e,r,n,i){const s=this.canvas.getBoundingClientRect(),a=n/this.canvas.width,l=i/this.canvas.height;return{x:Math.floor((e-s.left)*a),y:Math.floor((r-s.top)*l)}}getColorMap(){switch(this.settings.colorScheme){case"thermal":return this.thermalMap;case"viridis":return this.viridisMap;case"theme":return this.themeMap;default:return this.grayscaleMap}}buildGrayscaleMap(){const e=new Uint8ClampedArray(1024);for(let r=0;r<256;r++)e[r*4+0]=r,e[r*4+1]=r,e[r*4+2]=r,e[r*4+3]=255;return e}buildThermalMap(){const e=new Uint8ClampedArray(1024);for(let r=0;r<256;r++){const n=r/255;let i,s,a;if(n<.2){const l=n/.2;i=0,s=0,a=Math.floor(l*128)}else if(n<.4){const l=(n-.2)/.2;i=0,s=Math.floor(l*255),a=128+Math.floor(l*127)}else if(n<.6){const l=(n-.4)/.2;i=Math.floor(l*255),s=255,a=255-Math.floor(l*255)}else if(n<.8){const l=(n-.6)/.2;i=255,s=255-Math.floor(l*255),a=0}else{const l=(n-.8)/.2;i=255,s=Math.floor(l*255),a=Math.floor(l*255)}e[r*4+0]=i,e[r*4+1]=s,e[r*4+2]=a,e[r*4+3]=255}return e}buildViridisMap(){const e=[[68,1,84],[72,35,116],[64,67,135],[52,94,141],[41,120,142],[32,144,140],[34,167,132],[68,190,112],[121,209,81],[189,222,38],[253,231,36]],r=new Uint8ClampedArray(256*4);for(let n=0;n<256;n++){const s=n/255*(e.length-1),a=Math.floor(s),l=Math.min(a+1,e.length-1),o=s-a;r[n*4+0]=Math.floor(e[a][0]+o*(e[l][0]-e[a][0])),r[n*4+1]=Math.floor(e[a][1]+o*(e[l][1]-e[a][1])),r[n*4+2]=Math.floor(e[a][2]+o*(e[l][2]-e[a][2])),r[n*4+3]=255}return r}getCanvas(){return this.canvas}buildThemeMap(e){const r=o=>{const c=o.replace("#","");return[parseInt(c.slice(0,2),16),parseInt(c.slice(2,4),16),parseInt(c.slice(4,6),16)]},n=r(e.primary),i=r(e.secondary),s=r(e.tertiary),a=[{t:0,color:[5,5,5]},{t:.15,color:[n[0]*.3,n[1]*.3,n[2]*.3]},{t:.35,color:n},{t:.6,color:i},{t:.85,color:s},{t:1,color:[255,255,255]}],l=new Uint8ClampedArray(256*4);for(let o=0;o<256;o++){const c=o/255;let f=a[0],u=a[1];for(let h=1;h<a.length;h++)if(c<=a[h].t){f=a[h-1],u=a[h];break}const d=(c-f.t)/(u.t-f.t);l[o*4+0]=Math.floor(f.color[0]+d*(u.color[0]-f.color[0])),l[o*4+1]=Math.floor(f.color[1]+d*(u.color[1]-f.color[1])),l[o*4+2]=Math.floor(f.color[2]+d*(u.color[2]-f.color[2])),l[o*4+3]=255}return l}}class ya{canvas;simulation;callbacks;mode="view";selection=null;isSelecting=!1;isDrawing=!1;isDragging=!1;draggedCreature=null;ghostPreview=null;brushSize=3;brushIntensity=.5;constructor(e,r,n,i={}){this.canvas=e,this.simulation=r,this.callbacks=i,this.setupEventListeners(),this.setupDragDrop()}setMode(e){switch(this.mode=e,this.selection=null,this.isSelecting=!1,this.isDrawing=!1,e){case"select":this.canvas.style.cursor="crosshair";break;case"draw":this.canvas.style.cursor="cell";break;case"erase":this.canvas.style.cursor="not-allowed";break;default:this.canvas.style.cursor="default"}this.callbacks.onModeChange?.(e)}getMode(){return this.mode}getSelection(){return this.selection}clearSelection(){this.selection=null,this.callbacks.onSelectionChange?.(null)}setBrushSize(e){this.brushSize=Math.max(1,Math.min(20,e))}setBrushIntensity(e){this.brushIntensity=Math.max(0,Math.min(1,e))}getGhostPreview(){return this.ghostPreview}startDragFromLibrary(e,r){this.isDragging=!0,this.draggedCreature={preset:e,offsetX:e.region.width/2,offsetY:e.region.height/2};const n=this.getSimCoords(r);this.ghostPreview={region:e.region,x:n.x-this.draggedCreature.offsetX,y:n.y-this.draggedCreature.offsetY}}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this))}setupDragDrop(){this.canvas.addEventListener("dragover",e=>{if(e.preventDefault(),e.dataTransfer.dropEffect="copy",this.draggedCreature){const r=this.getSimCoords(e);this.ghostPreview={region:this.draggedCreature.preset.region,x:r.x-this.draggedCreature.offsetX,y:r.y-this.draggedCreature.offsetY}}}),this.canvas.addEventListener("drop",e=>{if(e.preventDefault(),this.draggedCreature){const r=this.getSimCoords(e),n=Math.floor(r.x-this.draggedCreature.offsetX),i=Math.floor(r.y-this.draggedCreature.offsetY);this.callbacks.onDrop?.(this.draggedCreature.preset,n,i),this.draggedCreature=null,this.ghostPreview=null,this.isDragging=!1}}),this.canvas.addEventListener("dragleave",()=>{this.ghostPreview=null})}handleMouseDown(e){const r=this.getSimCoords(e);switch(this.mode){case"select":this.isSelecting=!0,this.selection={startX:r.x,startY:r.y,endX:r.x,endY:r.y},this.callbacks.onSelectionChange?.(this.selection);break;case"draw":this.isDrawing=!0,this.callbacks.onDraw?.(r.x,r.y);break;case"erase":this.isDrawing=!0,this.callbacks.onErase?.(r.x,r.y);break}}handleMouseMove(e){const r=this.getSimCoords(e);this.isSelecting&&this.selection&&(this.selection.endX=r.x,this.selection.endY=r.y,this.callbacks.onSelectionChange?.(this.selection)),this.isDrawing&&(this.mode==="draw"?this.callbacks.onDraw?.(r.x,r.y):this.mode==="erase"&&this.callbacks.onErase?.(r.x,r.y)),this.isDragging&&this.draggedCreature&&(this.ghostPreview={region:this.draggedCreature.preset.region,x:r.x-this.draggedCreature.offsetX,y:r.y-this.draggedCreature.offsetY})}handleMouseUp(e){if(this.isSelecting&&this.selection){const r={startX:Math.min(this.selection.startX,this.selection.endX),startY:Math.min(this.selection.startY,this.selection.endY),endX:Math.max(this.selection.startX,this.selection.endX),endY:Math.max(this.selection.startY,this.selection.endY)};r.endX>r.startX&&r.endY>r.startY?(this.selection=r,this.callbacks.onSelectionComplete?.(r)):this.selection=null,this.callbacks.onSelectionChange?.(this.selection)}this.isSelecting=!1,this.isDrawing=!1}handleMouseLeave(e){this.isSelecting&&(this.isSelecting=!1,this.selection=null,this.callbacks.onSelectionChange?.(null)),this.isDrawing=!1,this.ghostPreview=null}handleKeyDown(e){const r=e.target;r.tagName==="INPUT"||r.tagName==="TEXTAREA"||(e.key==="v"||e.key==="Escape"?this.setMode("view"):e.key==="s"?this.setMode("select"):e.key==="d"?this.setMode("draw"):e.key==="e"&&this.setMode("erase"),e.key==="["?(this.setBrushSize(this.brushSize-1),this.callbacks.onBrushSizeChange?.(this.brushSize)):e.key==="]"&&(this.setBrushSize(this.brushSize+1),this.callbacks.onBrushSizeChange?.(this.brushSize)))}getSimCoords(e){const r=this.canvas.getBoundingClientRect(),n=e.clientX-r.left,i=e.clientY-r.top,s=this.simulation.getWidth(),a=this.simulation.getHeight();return{x:Math.floor(n/r.width*s),y:Math.floor(i/r.height*a)}}getBrushSize(){return this.brushSize}getBrushIntensity(){return this.brushIntensity}}var Sa=R('<div class="simulation-view svelte-145nxqv"><div class="canvas-frame svelte-145nxqv"><div class="canvas-header svelte-145nxqv"><span class="dim-label svelte-145nxqv"> </span></div> <div class="canvas-container svelte-145nxqv"><canvas class="svelte-145nxqv"></canvas> <div class="corner-marker top-left svelte-145nxqv"></div> <div class="corner-marker top-right svelte-145nxqv"></div> <div class="corner-marker bottom-left svelte-145nxqv"></div> <div class="corner-marker bottom-right svelte-145nxqv"></div> <div class="canvas-scanlines svelte-145nxqv"></div></div></div></div>');function xa(t,e){et(e,!1);const r=()=>W(bt,"$settings",a),n=()=>W(Z,"$simulationStore",a),i=()=>W(er,"$currentScheme",a),s=()=>W(zn,"$renderTrigger",a),[a,l]=Rt();let o=se(),c=se(),f=se(null),u=se(null);const d=512;Tr(()=>{const M=hr();!M||!v(c)||(gr.set(v(c)),F(f,new wa(v(c),{colorScheme:r().colorScheme,showGrid:r().showGrid,showSelection:r().showSelection,brushSize:r().brushSize,brushIntensity:r().brushIntensity,backend:n().backend})),F(u,new ya(v(c),M,v(f),{onSelectionChange:()=>h(),onSelectionComplete:()=>{},onDrop:(_,y,S)=>{M.placeRegion(_.region,y,S),h()},onDraw:(_,y)=>{M.drawAt(_,y,r().brushSize,r().brushIntensity),h()},onErase:(_,y)=>{M.eraseAt(_,y,r().brushSize),h()},onModeChange:()=>{},onBrushSizeChange:()=>{}})),pr.set(v(u)),h())}),On(()=>{pr.set(null),gr.set(null),F(f,null),F(u,null)});function h(){if(!v(f))return;const M=hr();if(!M)return;const _=M.getState(),y=v(u)?.getSelection(),S=v(u)?.getGhostPreview();v(f).render(_,y,S)}Be(()=>(n(),v(f)),()=>{n().state&&v(f)&&h()}),Be(()=>(v(u),r()),()=>{v(u)&&r().mode&&v(u).setMode(r().mode)}),Be(()=>(v(u),r()),()=>{v(u)&&(v(u).setBrushSize(r().brushSize),v(u).setBrushIntensity(r().brushIntensity))}),Be(()=>(v(f),r()),()=>{v(f)&&r().colorScheme&&(v(f).updateSettings({colorScheme:r().colorScheme}),h())}),Be(()=>(v(f),i()),()=>{v(f)&&i()&&(v(f).setThemeColors({primary:i().colors.primary,secondary:i().colors.secondary,tertiary:i().colors.tertiary}),h())}),Be(()=>(s(),v(f)),()=>{s()&&v(f)&&h()}),Cr(),Qt();var g=Sa(),m=w(g),p=w(m),b=w(p),D=w(b),x=E(p,2),k=w(x);Ie(k,"width",d),Ie(k,"height",d),Ut(k,M=>F(c,M),()=>v(c)),Ut(x,M=>F(o,M),()=>v(o)),X(()=>j(D,`${n(),N(()=>n().config.width)??""}x${n(),N(()=>n().config.height)??""}`)),T(t,g),tt(),l()}var Ea=R('<div class="loading-screen svelte-1n46o8q"><div class="loading-content svelte-1n46o8q"><div class="glitch-text svelte-1n46o8q" data-text="FLOW_LENIA">FLOW_LENIA</div> <div class="loading-status svelte-1n46o8q"><span class="animate-pulse">INITIALIZING SUBSTRATE</span> <span class="animate-blink">_</span></div></div></div>'),Ma=R('<div class="error-screen svelte-1n46o8q"><div class="error-content svelte-1n46o8q"><div class="error-title svelte-1n46o8q">SYSTEM FAILURE</div> <div class="error-message svelte-1n46o8q"> </div> <div class="error-hint svelte-1n46o8q">Ensure WASM is built: <code class="svelte-1n46o8q">wasm-pack build --target web --release</code></div></div></div>'),Ca=R('<div class="scanlines"></div>'),ka=R('<div class="app-container svelte-1n46o8q"><canvas class="glow-layer svelte-1n46o8q"></canvas> <!> <div class="main-content svelte-1n46o8q"><!> <!> <!></div> <!></div> <!> <div class="vignette"></div>',1);function Aa(t,e){et(e,!1);const r=()=>W(gr,"$simulationCanvas",a),n=()=>W(er,"$currentScheme",a),i=()=>W(Z,"$simulationStore",a),s=()=>W(bt,"$settings",a),[a,l]=Rt();let o=se(!1),c=se(null),f=se(),u=se(null),d,h=se(!1),g=se(),m=null,p=null;function b(){const _=r();if(!_||!v(u)||!v(f)){d=requestAnimationFrame(b);return}if(m||(m=document.createElement("canvas"),p=m.getContext("2d",{willReadFrequently:!0})),v(g)){const C=v(g).getBoundingClientRect(),q=v(f).width!==C.width||v(f).height!==C.height,ae=m.width===0||m.height===0;(q||ae)&&(Ne(f,v(f).width=C.width),Ne(f,v(f).height=C.height),m.width=C.width,m.height=C.height)}if(!p||m.width===0)return;const y=v(f).width,S=v(f).height,P=n().colors;p.drawImage(_,0,0,y,S);const A=p.getImageData(0,0,y,S),$=A.data,L=5,Y=255-L;for(let C=0;C<$.length;C+=4){const q=($[C]+$[C+1]+$[C+2])/3,ge=Math.max(0,q-L)/Y,_e=Math.pow(ge,.35);$[C]=255,$[C+1]=255,$[C+2]=255,$[C+3]=_e*255}p.putImageData(A,0,0),v(u).clearRect(0,0,y,S),Ne(u,v(u).fillStyle=P.primary),v(u).fillRect(180,0,80,S),Ne(u,v(u).fillStyle=P.secondary),v(u).fillRect(y-220,0,80,S),Ne(u,v(u).fillStyle=P.tertiary),v(u).fillRect(0,30,y,40),Ne(u,v(u).fillStyle=P.tertiary),v(u).fillRect(0,S-60,y,40),Ne(u,v(u).globalCompositeOperation="destination-in"),v(u).drawImage(m,0,0),Ne(u,v(u).globalCompositeOperation="source-over"),d=requestAnimationFrame(b)}Tr(async()=>{Ri(),U("SYS.BOOT","info"),U("Loading WASM module...","info");try{await yi(),F(o,!0),U("WASM initialized","success"),U(`Backend: ${i().backend.toUpperCase()}`,"info"),U(`Theme: ${n().name}`,"info"),i().gpuAvailable?U("WebGPU available","success"):U("WebGPU not available","warn"),U("SYSTEM READY","success")}catch(_){F(c,String(_)),U(`INIT FAILED: ${_}`,"error")}}),On(()=>{d&&cancelAnimationFrame(d)}),Be(()=>(v(f),v(h)),()=>{v(f)&&!v(h)&&(F(u,v(f).getContext("2d")),F(h,!0),b())}),Cr(),Qt();var D=Gr(),x=ct(D);{var k=_=>{var y=Ea();T(_,y)},M=_=>{var y=Gr(),S=ct(y);{var P=$=>{var L=Ma(),Y=w(L),C=E(w(Y),2),q=w(C);X(()=>j(q,v(c))),T($,L)},A=$=>{var L=ka(),Y=ct(L),C=w(Y);Ut(C,ue=>F(f,ue),()=>v(f));var q=E(C,2);Bi(q,{});var ae=E(q,2),ge=w(ae);na(ge,{});var _e=E(ge,2);xa(_e,{});var Le=E(_e,2);ba(Le,{});var Ee=E(ae,2);zi(Ee),Ut(Y,ue=>F(g,ue),()=>v(g));var wt=E(Y,2);{var yt=ue=>{var Oe=Ca();T(ue,Oe)};de(wt,ue=>{s(),N(()=>s().showScanlines)&&ue(yt)})}T($,L)};de(S,$=>{v(c)?$(P):$(A,!1)},!0)}T(_,y)};de(x,_=>{!v(o)&&!v(c)?_(k):_(M,!1)})}T(t,D),tt(),l()}Ks(Aa,{target:document.getElementById("app")});
