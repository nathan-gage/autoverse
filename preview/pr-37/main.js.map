{
  "version": 3,
  "sources": ["../src/interaction.ts", "../src/presets.ts", "../src/renderer.ts", "../src/simulation.ts", "../src/ui.ts", "../src/main.ts"],
  "sourcesContent": [
    "// Interaction Handler - Mouse events, drag & drop, selection\n\nimport type { Renderer } from \"./renderer\";\nimport type { SimulationManager } from \"./simulation\";\nimport type {\n\tDraggedCreature,\n\tInteractionMode,\n\tPreset,\n\tPresetRegion,\n\tSelectionRect,\n} from \"./types\";\n\nexport interface InteractionCallbacks {\n\tonSelectionChange?: (selection: SelectionRect | null) => void;\n\tonSelectionComplete?: (selection: SelectionRect) => void;\n\tonDrop?: (preset: Preset, x: number, y: number) => void;\n\tonDraw?: (x: number, y: number) => void;\n\tonErase?: (x: number, y: number) => void;\n\tonModeChange?: (mode: InteractionMode) => void;\n\tonBrushSizeChange?: (size: number) => void;\n}\n\nexport class InteractionHandler {\n\tprivate canvas: HTMLCanvasElement;\n\tprivate simulation: SimulationManager;\n\tprivate callbacks: InteractionCallbacks;\n\n\tprivate mode: InteractionMode = \"view\";\n\tprivate selection: SelectionRect | null = null;\n\tprivate isSelecting = false;\n\tprivate isDrawing = false;\n\tprivate isDragging = false;\n\n\tprivate draggedCreature: DraggedCreature | null = null;\n\tprivate ghostPreview: { region: PresetRegion; x: number; y: number } | null = null;\n\n\tprivate brushSize = 3;\n\tprivate brushIntensity = 0.5;\n\n\tconstructor(\n\t\tcanvas: HTMLCanvasElement,\n\t\tsimulation: SimulationManager,\n\t\t_renderer: Renderer,\n\t\tcallbacks: InteractionCallbacks = {},\n\t) {\n\t\tthis.canvas = canvas;\n\t\tthis.simulation = simulation;\n\t\tthis.callbacks = callbacks;\n\n\t\tthis.setupEventListeners();\n\t\tthis.setupDragDrop();\n\t}\n\n\tsetMode(mode: InteractionMode): void {\n\t\tthis.mode = mode;\n\t\tthis.selection = null;\n\t\tthis.isSelecting = false;\n\t\tthis.isDrawing = false;\n\n\t\t// Update cursor\n\t\tswitch (mode) {\n\t\t\tcase \"select\":\n\t\t\t\tthis.canvas.style.cursor = \"crosshair\";\n\t\t\t\tbreak;\n\t\t\tcase \"draw\":\n\t\t\t\tthis.canvas.style.cursor = \"cell\";\n\t\t\t\tbreak;\n\t\t\tcase \"erase\":\n\t\t\t\tthis.canvas.style.cursor = \"not-allowed\";\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.canvas.style.cursor = \"default\";\n\t\t}\n\n\t\tthis.callbacks.onModeChange?.(mode);\n\t}\n\n\tgetMode(): InteractionMode {\n\t\treturn this.mode;\n\t}\n\n\tgetSelection(): SelectionRect | null {\n\t\treturn this.selection;\n\t}\n\n\tclearSelection(): void {\n\t\tthis.selection = null;\n\t\tthis.callbacks.onSelectionChange?.(null);\n\t}\n\n\tsetBrushSize(size: number): void {\n\t\tthis.brushSize = Math.max(1, Math.min(20, size));\n\t}\n\n\tsetBrushIntensity(intensity: number): void {\n\t\tthis.brushIntensity = Math.max(0, Math.min(1, intensity));\n\t}\n\n\tgetGhostPreview(): { region: PresetRegion; x: number; y: number } | null {\n\t\treturn this.ghostPreview;\n\t}\n\n\t// Start dragging a creature from the preset library\n\tstartDragFromLibrary(preset: Preset, event: MouseEvent | DragEvent): void {\n\t\tthis.isDragging = true;\n\t\tthis.draggedCreature = {\n\t\t\tpreset,\n\t\t\toffsetX: preset.region.width / 2,\n\t\t\toffsetY: preset.region.height / 2,\n\t\t};\n\n\t\t// Set up ghost preview\n\t\tconst pos = this.getSimCoords(event);\n\t\tthis.ghostPreview = {\n\t\t\tregion: preset.region,\n\t\t\tx: pos.x - this.draggedCreature.offsetX,\n\t\t\ty: pos.y - this.draggedCreature.offsetY,\n\t\t};\n\t}\n\n\tprivate setupEventListeners(): void {\n\t\tthis.canvas.addEventListener(\"mousedown\", this.handleMouseDown.bind(this));\n\t\tthis.canvas.addEventListener(\"mousemove\", this.handleMouseMove.bind(this));\n\t\tthis.canvas.addEventListener(\"mouseup\", this.handleMouseUp.bind(this));\n\t\tthis.canvas.addEventListener(\"mouseleave\", this.handleMouseLeave.bind(this));\n\n\t\t// Keyboard shortcuts\n\t\tdocument.addEventListener(\"keydown\", this.handleKeyDown.bind(this));\n\t}\n\n\tprivate setupDragDrop(): void {\n\t\tthis.canvas.addEventListener(\"dragover\", (e) => {\n\t\t\te.preventDefault();\n\t\t\te.dataTransfer!.dropEffect = \"copy\";\n\n\t\t\tif (this.draggedCreature) {\n\t\t\t\tconst pos = this.getSimCoords(e);\n\t\t\t\tthis.ghostPreview = {\n\t\t\t\t\tregion: this.draggedCreature.preset.region,\n\t\t\t\t\tx: pos.x - this.draggedCreature.offsetX,\n\t\t\t\t\ty: pos.y - this.draggedCreature.offsetY,\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\n\t\tthis.canvas.addEventListener(\"drop\", (e) => {\n\t\t\te.preventDefault();\n\n\t\t\tif (this.draggedCreature) {\n\t\t\t\tconst pos = this.getSimCoords(e);\n\t\t\t\tconst dropX = Math.floor(pos.x - this.draggedCreature.offsetX);\n\t\t\t\tconst dropY = Math.floor(pos.y - this.draggedCreature.offsetY);\n\n\t\t\t\tthis.callbacks.onDrop?.(this.draggedCreature.preset, dropX, dropY);\n\n\t\t\t\tthis.draggedCreature = null;\n\t\t\t\tthis.ghostPreview = null;\n\t\t\t\tthis.isDragging = false;\n\t\t\t}\n\t\t});\n\n\t\tthis.canvas.addEventListener(\"dragleave\", () => {\n\t\t\tthis.ghostPreview = null;\n\t\t});\n\t}\n\n\tprivate handleMouseDown(e: MouseEvent): void {\n\t\tconst pos = this.getSimCoords(e);\n\n\t\tswitch (this.mode) {\n\t\t\tcase \"select\":\n\t\t\t\tthis.isSelecting = true;\n\t\t\t\tthis.selection = {\n\t\t\t\t\tstartX: pos.x,\n\t\t\t\t\tstartY: pos.y,\n\t\t\t\t\tendX: pos.x,\n\t\t\t\t\tendY: pos.y,\n\t\t\t\t};\n\t\t\t\tthis.callbacks.onSelectionChange?.(this.selection);\n\t\t\t\tbreak;\n\n\t\t\tcase \"draw\":\n\t\t\t\tthis.isDrawing = true;\n\t\t\t\tthis.callbacks.onDraw?.(pos.x, pos.y);\n\t\t\t\tbreak;\n\n\t\t\tcase \"erase\":\n\t\t\t\tthis.isDrawing = true;\n\t\t\t\tthis.callbacks.onErase?.(pos.x, pos.y);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate handleMouseMove(e: MouseEvent): void {\n\t\tconst pos = this.getSimCoords(e);\n\n\t\tif (this.isSelecting && this.selection) {\n\t\t\tthis.selection.endX = pos.x;\n\t\t\tthis.selection.endY = pos.y;\n\t\t\tthis.callbacks.onSelectionChange?.(this.selection);\n\t\t}\n\n\t\tif (this.isDrawing) {\n\t\t\tif (this.mode === \"draw\") {\n\t\t\t\tthis.callbacks.onDraw?.(pos.x, pos.y);\n\t\t\t} else if (this.mode === \"erase\") {\n\t\t\t\tthis.callbacks.onErase?.(pos.x, pos.y);\n\t\t\t}\n\t\t}\n\n\t\t// Update ghost preview during drag\n\t\tif (this.isDragging && this.draggedCreature) {\n\t\t\tthis.ghostPreview = {\n\t\t\t\tregion: this.draggedCreature.preset.region,\n\t\t\t\tx: pos.x - this.draggedCreature.offsetX,\n\t\t\t\ty: pos.y - this.draggedCreature.offsetY,\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate handleMouseUp(_e: MouseEvent): void {\n\t\tif (this.isSelecting && this.selection) {\n\t\t\t// Normalize selection coordinates\n\t\t\tconst normalized: SelectionRect = {\n\t\t\t\tstartX: Math.min(this.selection.startX, this.selection.endX),\n\t\t\t\tstartY: Math.min(this.selection.startY, this.selection.endY),\n\t\t\t\tendX: Math.max(this.selection.startX, this.selection.endX),\n\t\t\t\tendY: Math.max(this.selection.startY, this.selection.endY),\n\t\t\t};\n\n\t\t\t// Only complete if selection has area\n\t\t\tif (normalized.endX > normalized.startX && normalized.endY > normalized.startY) {\n\t\t\t\tthis.selection = normalized;\n\t\t\t\tthis.callbacks.onSelectionComplete?.(normalized);\n\t\t\t} else {\n\t\t\t\tthis.selection = null;\n\t\t\t}\n\n\t\t\tthis.callbacks.onSelectionChange?.(this.selection);\n\t\t}\n\n\t\tthis.isSelecting = false;\n\t\tthis.isDrawing = false;\n\t}\n\n\tprivate handleMouseLeave(_e: MouseEvent): void {\n\t\tif (this.isSelecting) {\n\t\t\tthis.isSelecting = false;\n\t\t\tthis.selection = null;\n\t\t\tthis.callbacks.onSelectionChange?.(null);\n\t\t}\n\t\tthis.isDrawing = false;\n\t\tthis.ghostPreview = null;\n\t}\n\n\tprivate handleKeyDown(e: KeyboardEvent): void {\n\t\t// Skip shortcuts when typing in input fields\n\t\tconst target = e.target as HTMLElement;\n\t\tif (target.tagName === \"INPUT\" || target.tagName === \"TEXTAREA\") {\n\t\t\treturn;\n\t\t}\n\n\t\t// Mode shortcuts\n\t\tif (e.key === \"v\" || e.key === \"Escape\") {\n\t\t\tthis.setMode(\"view\");\n\t\t} else if (e.key === \"s\") {\n\t\t\tthis.setMode(\"select\");\n\t\t} else if (e.key === \"d\") {\n\t\t\tthis.setMode(\"draw\");\n\t\t} else if (e.key === \"e\") {\n\t\t\tthis.setMode(\"erase\");\n\t\t}\n\n\t\t// Brush size adjustment\n\t\tif (e.key === \"[\") {\n\t\t\tthis.setBrushSize(this.brushSize - 1);\n\t\t\tthis.callbacks.onBrushSizeChange?.(this.brushSize);\n\t\t} else if (e.key === \"]\") {\n\t\t\tthis.setBrushSize(this.brushSize + 1);\n\t\t\tthis.callbacks.onBrushSizeChange?.(this.brushSize);\n\t\t}\n\t}\n\n\tprivate getSimCoords(e: MouseEvent | DragEvent): { x: number; y: number } {\n\t\tconst rect = this.canvas.getBoundingClientRect();\n\t\tconst canvasX = e.clientX - rect.left;\n\t\tconst canvasY = e.clientY - rect.top;\n\n\t\tconst simWidth = this.simulation.getWidth();\n\t\tconst simHeight = this.simulation.getHeight();\n\n\t\t// Use rect.width/height (CSS display size) not canvas.width/height (internal size)\n\t\t// to correctly handle CSS-scaled canvases\n\t\treturn {\n\t\t\tx: Math.floor((canvasX / rect.width) * simWidth),\n\t\t\ty: Math.floor((canvasY / rect.height) * simHeight),\n\t\t};\n\t}\n\n\tgetBrushSize(): number {\n\t\treturn this.brushSize;\n\t}\n\n\tgetBrushIntensity(): number {\n\t\treturn this.brushIntensity;\n\t}\n}\n",
    "// Preset Manager - Save, load, and manage creature presets\n\nimport type { Preset, PresetRegion } from \"./types\";\n\nconst STORAGE_KEY = \"flow-lenia-presets\";\n\nexport class PresetManager {\n\tprivate presets: Map<string, Preset> = new Map();\n\tprivate listeners: Set<(presets: Preset[]) => void> = new Set();\n\n\tconstructor() {\n\t\tthis.loadFromStorage();\n\t}\n\n\t// Generate a unique ID\n\tprivate generateId(): string {\n\t\treturn `preset-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n\t}\n\n\t// Create a thumbnail from region data\n\tprivate createThumbnail(region: PresetRegion, size = 64): string {\n\t\tconst canvas = document.createElement(\"canvas\");\n\t\tcanvas.width = size;\n\t\tcanvas.height = size;\n\t\tconst ctx = canvas.getContext(\"2d\")!;\n\n\t\t// Create scaled image\n\t\tconst imageData = ctx.createImageData(region.width, region.height);\n\t\tconst data = region.channels[0];\n\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst value = Math.max(0, Math.min(1, data[i]));\n\t\t\tconst gray = Math.floor(value * 255);\n\t\t\timageData.data[i * 4 + 0] = gray;\n\t\t\timageData.data[i * 4 + 1] = gray;\n\t\t\timageData.data[i * 4 + 2] = gray;\n\t\t\timageData.data[i * 4 + 3] = 255;\n\t\t}\n\n\t\t// Put at full size first\n\t\tconst tempCanvas = document.createElement(\"canvas\");\n\t\ttempCanvas.width = region.width;\n\t\ttempCanvas.height = region.height;\n\t\tconst tempCtx = tempCanvas.getContext(\"2d\")!;\n\t\ttempCtx.putImageData(imageData, 0, 0);\n\n\t\t// Scale down to thumbnail\n\t\tctx.imageSmoothingEnabled = true;\n\t\tctx.fillStyle = \"#1a1a1a\";\n\t\tctx.fillRect(0, 0, size, size);\n\n\t\t// Maintain aspect ratio\n\t\tconst scale = Math.min(size / region.width, size / region.height);\n\t\tconst scaledWidth = region.width * scale;\n\t\tconst scaledHeight = region.height * scale;\n\t\tconst offsetX = (size - scaledWidth) / 2;\n\t\tconst offsetY = (size - scaledHeight) / 2;\n\n\t\tctx.drawImage(tempCanvas, offsetX, offsetY, scaledWidth, scaledHeight);\n\n\t\treturn canvas.toDataURL(\"image/png\");\n\t}\n\n\t// Save a new preset\n\tsavePreset(name: string, region: PresetRegion, description?: string): Preset {\n\t\tconst preset: Preset = {\n\t\t\tid: this.generateId(),\n\t\t\tname,\n\t\t\tdescription,\n\t\t\tthumbnail: this.createThumbnail(region),\n\t\t\tregion,\n\t\t\tcreatedAt: Date.now(),\n\t\t};\n\n\t\tthis.presets.set(preset.id, preset);\n\t\tthis.persistToStorage();\n\t\tthis.notifyListeners();\n\n\t\treturn preset;\n\t}\n\n\t// Get a preset by ID\n\tgetPreset(id: string): Preset | undefined {\n\t\treturn this.presets.get(id);\n\t}\n\n\t// Get all presets\n\tgetAllPresets(): Preset[] {\n\t\treturn Array.from(this.presets.values()).sort((a, b) => b.createdAt - a.createdAt);\n\t}\n\n\t// Delete a preset\n\tdeletePreset(id: string): boolean {\n\t\tconst deleted = this.presets.delete(id);\n\t\tif (deleted) {\n\t\t\tthis.persistToStorage();\n\t\t\tthis.notifyListeners();\n\t\t}\n\t\treturn deleted;\n\t}\n\n\t// Rename a preset\n\trenamePreset(id: string, newName: string): boolean {\n\t\tconst preset = this.presets.get(id);\n\t\tif (preset) {\n\t\t\tpreset.name = newName;\n\t\t\tthis.persistToStorage();\n\t\t\tthis.notifyListeners();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// Update preset description\n\tupdateDescription(id: string, description: string): boolean {\n\t\tconst preset = this.presets.get(id);\n\t\tif (preset) {\n\t\t\tpreset.description = description;\n\t\t\tthis.persistToStorage();\n\t\t\tthis.notifyListeners();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// Export presets to JSON\n\texportPresets(ids?: string[]): string {\n\t\tconst presetsToExport = ids\n\t\t\t? ids.map((id) => this.presets.get(id)).filter(Boolean)\n\t\t\t: this.getAllPresets();\n\n\t\treturn JSON.stringify(presetsToExport, null, 2);\n\t}\n\n\t// Import presets from JSON\n\timportPresets(json: string): number {\n\t\ttry {\n\t\t\tconst imported = JSON.parse(json) as Preset[];\n\t\t\tlet count = 0;\n\n\t\t\tfor (const preset of imported) {\n\t\t\t\t// Generate new ID to avoid conflicts\n\t\t\t\tconst newPreset: Preset = {\n\t\t\t\t\t...preset,\n\t\t\t\t\tid: this.generateId(),\n\t\t\t\t\tcreatedAt: Date.now(),\n\t\t\t\t};\n\t\t\t\tthis.presets.set(newPreset.id, newPreset);\n\t\t\t\tcount++;\n\t\t\t}\n\n\t\t\tthis.persistToStorage();\n\t\t\tthis.notifyListeners();\n\t\t\treturn count;\n\t\t} catch {\n\t\t\tthrow new Error(\"Invalid preset JSON format\");\n\t\t}\n\t}\n\n\t// Subscribe to preset changes\n\tsubscribe(listener: (presets: Preset[]) => void): () => void {\n\t\tthis.listeners.add(listener);\n\t\treturn () => this.listeners.delete(listener);\n\t}\n\n\tprivate notifyListeners(): void {\n\t\tconst presets = this.getAllPresets();\n\t\tfor (const listener of this.listeners) {\n\t\t\tlistener(presets);\n\t\t}\n\t}\n\n\tprivate persistToStorage(): void {\n\t\ttry {\n\t\t\tconst data = JSON.stringify(Array.from(this.presets.entries()));\n\t\t\tlocalStorage.setItem(STORAGE_KEY, data);\n\t\t} catch (e) {\n\t\t\tconsole.warn(\"Failed to persist presets to storage:\", e);\n\t\t}\n\t}\n\n\tprivate loadFromStorage(): void {\n\t\ttry {\n\t\t\tconst data = localStorage.getItem(STORAGE_KEY);\n\t\t\tif (data) {\n\t\t\t\tconst entries = JSON.parse(data) as [string, Preset][];\n\t\t\t\tthis.presets = new Map(entries);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.warn(\"Failed to load presets from storage:\", e);\n\t\t\tthis.presets = new Map();\n\t\t}\n\t}\n\n\t// Clear all presets\n\tclearAll(): void {\n\t\tthis.presets.clear();\n\t\tthis.persistToStorage();\n\t\tthis.notifyListeners();\n\t}\n}\n\n// Built-in preset patterns\nexport const BUILTIN_PRESETS: Array<{ name: string; description: string; seed: object }> = [\n\t{\n\t\tname: \"Glider\",\n\t\tdescription: \"A simple glider that moves across the grid\",\n\t\tseed: {\n\t\t\tpattern: {\n\t\t\t\ttype: \"GaussianBlob\",\n\t\t\t\tcenter: [0.5, 0.5],\n\t\t\t\tradius: 0.1,\n\t\t\t\tamplitude: 1.0,\n\t\t\t\tchannel: 0,\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tname: \"Ring\",\n\t\tdescription: \"A ring pattern that expands\",\n\t\tseed: {\n\t\t\tpattern: {\n\t\t\t\ttype: \"Ring\",\n\t\t\t\tcenter: [0.5, 0.5],\n\t\t\t\tinner_radius: 0.05,\n\t\t\t\touter_radius: 0.1,\n\t\t\t\tamplitude: 1.0,\n\t\t\t\tchannel: 0,\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tname: \"Dual Blobs\",\n\t\tdescription: \"Two interacting blobs\",\n\t\tseed: {\n\t\t\tpattern: {\n\t\t\t\ttype: \"MultiBlob\",\n\t\t\t\tblobs: [\n\t\t\t\t\t{ center: [0.35, 0.5], radius: 0.08, amplitude: 1.0, channel: 0 },\n\t\t\t\t\t{ center: [0.65, 0.5], radius: 0.08, amplitude: 1.0, channel: 0 },\n\t\t\t\t],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tname: \"Random Noise\",\n\t\tdescription: \"Random initial conditions\",\n\t\tseed: {\n\t\t\tpattern: {\n\t\t\t\ttype: \"Noise\",\n\t\t\t\tseed: 42,\n\t\t\t\tamplitude: 0.5,\n\t\t\t\tchannel: 0,\n\t\t\t},\n\t\t},\n\t},\n];\n",
    "// Canvas Renderer with color schemes and overlays\n\nimport type { PresetRegion, SelectionRect, SimulationState, ViewerSettings } from \"./types\";\n\nexport class Renderer {\n\tprivate canvas: HTMLCanvasElement;\n\tprivate ctx: CanvasRenderingContext2D;\n\tprivate offscreenCanvas: HTMLCanvasElement;\n\tprivate offscreenCtx: CanvasRenderingContext2D;\n\tprivate settings: ViewerSettings;\n\n\t// Color map caches\n\tprivate grayscaleMap: Uint8ClampedArray;\n\tprivate thermalMap: Uint8ClampedArray;\n\tprivate viridisMap: Uint8ClampedArray;\n\n\tconstructor(canvas: HTMLCanvasElement, settings: ViewerSettings) {\n\t\tthis.canvas = canvas;\n\t\tconst ctx = canvas.getContext(\"2d\");\n\t\tif (!ctx) throw new Error(\"Failed to get 2D context\");\n\t\tthis.ctx = ctx;\n\n\t\t// Create offscreen canvas for simulation data\n\t\tthis.offscreenCanvas = document.createElement(\"canvas\");\n\t\tconst offCtx = this.offscreenCanvas.getContext(\"2d\");\n\t\tif (!offCtx) throw new Error(\"Failed to get offscreen 2D context\");\n\t\tthis.offscreenCtx = offCtx;\n\n\t\tthis.settings = settings;\n\n\t\t// Pre-compute color maps\n\t\tthis.grayscaleMap = this.buildGrayscaleMap();\n\t\tthis.thermalMap = this.buildThermalMap();\n\t\tthis.viridisMap = this.buildViridisMap();\n\t}\n\n\tupdateSettings(settings: Partial<ViewerSettings>): void {\n\t\tthis.settings = { ...this.settings, ...settings };\n\t}\n\n\trender(\n\t\tstate: SimulationState,\n\t\tselection?: SelectionRect | null,\n\t\tghostPreview?: { region: PresetRegion; x: number; y: number } | null,\n\t): void {\n\t\tconst { width, height, channels } = state;\n\n\t\t// Resize offscreen canvas if needed\n\t\tif (this.offscreenCanvas.width !== width || this.offscreenCanvas.height !== height) {\n\t\t\tthis.offscreenCanvas.width = width;\n\t\t\tthis.offscreenCanvas.height = height;\n\t\t}\n\n\t\t// Get the appropriate color map\n\t\tconst colorMap = this.getColorMap();\n\n\t\t// Render simulation data\n\t\tconst imageData = this.offscreenCtx.createImageData(width, height);\n\t\tconst data = channels[0]; // Primary channel\n\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst value = Math.max(0, Math.min(1, data[i]));\n\t\t\tconst colorIndex = Math.floor(value * 255) * 4;\n\n\t\t\timageData.data[i * 4 + 0] = colorMap[colorIndex + 0];\n\t\t\timageData.data[i * 4 + 1] = colorMap[colorIndex + 1];\n\t\t\timageData.data[i * 4 + 2] = colorMap[colorIndex + 2];\n\t\t\timageData.data[i * 4 + 3] = 255;\n\t\t}\n\n\t\tthis.offscreenCtx.putImageData(imageData, 0, 0);\n\n\t\t// Clear main canvas and draw scaled simulation\n\t\tthis.ctx.imageSmoothingEnabled = false;\n\t\tthis.ctx.fillStyle = \"#000\";\n\t\tthis.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n\t\tthis.ctx.drawImage(\n\t\t\tthis.offscreenCanvas,\n\t\t\t0,\n\t\t\t0,\n\t\t\twidth,\n\t\t\theight,\n\t\t\t0,\n\t\t\t0,\n\t\t\tthis.canvas.width,\n\t\t\tthis.canvas.height,\n\t\t);\n\n\t\t// Draw grid if enabled\n\t\tif (this.settings.showGrid) {\n\t\t\tthis.drawGrid(width, height);\n\t\t}\n\n\t\t// Draw ghost preview of dragged creature\n\t\tif (ghostPreview) {\n\t\t\tthis.drawGhostPreview(ghostPreview, width, height);\n\t\t}\n\n\t\t// Draw selection rectangle\n\t\tif (selection && this.settings.showSelection) {\n\t\t\tthis.drawSelection(selection, width, height);\n\t\t}\n\t}\n\n\tprivate drawGrid(simWidth: number, simHeight: number): void {\n\t\tconst scaleX = this.canvas.width / simWidth;\n\t\tconst scaleY = this.canvas.height / simHeight;\n\n\t\tthis.ctx.strokeStyle = \"rgba(255, 255, 255, 0.1)\";\n\t\tthis.ctx.lineWidth = 1;\n\n\t\t// Only draw grid if cells are large enough\n\t\tif (scaleX >= 4 && scaleY >= 4) {\n\t\t\tthis.ctx.beginPath();\n\t\t\tfor (let x = 0; x <= simWidth; x++) {\n\t\t\t\tconst px = x * scaleX;\n\t\t\t\tthis.ctx.moveTo(px, 0);\n\t\t\t\tthis.ctx.lineTo(px, this.canvas.height);\n\t\t\t}\n\t\t\tfor (let y = 0; y <= simHeight; y++) {\n\t\t\t\tconst py = y * scaleY;\n\t\t\t\tthis.ctx.moveTo(0, py);\n\t\t\t\tthis.ctx.lineTo(this.canvas.width, py);\n\t\t\t}\n\t\t\tthis.ctx.stroke();\n\t\t}\n\t}\n\n\tprivate drawSelection(selection: SelectionRect, simWidth: number, simHeight: number): void {\n\t\tconst scaleX = this.canvas.width / simWidth;\n\t\tconst scaleY = this.canvas.height / simHeight;\n\n\t\tconst x = Math.min(selection.startX, selection.endX) * scaleX;\n\t\tconst y = Math.min(selection.startY, selection.endY) * scaleY;\n\t\tconst w = Math.abs(selection.endX - selection.startX) * scaleX;\n\t\tconst h = Math.abs(selection.endY - selection.startY) * scaleY;\n\n\t\t// Selection fill\n\t\tthis.ctx.fillStyle = \"rgba(79, 195, 247, 0.2)\";\n\t\tthis.ctx.fillRect(x, y, w, h);\n\n\t\t// Selection border\n\t\tthis.ctx.strokeStyle = \"#4fc3f7\";\n\t\tthis.ctx.lineWidth = 2;\n\t\tthis.ctx.setLineDash([5, 5]);\n\t\tthis.ctx.strokeRect(x, y, w, h);\n\t\tthis.ctx.setLineDash([]);\n\n\t\t// Size indicator\n\t\tconst selWidth = Math.abs(selection.endX - selection.startX);\n\t\tconst selHeight = Math.abs(selection.endY - selection.startY);\n\t\tif (selWidth > 0 && selHeight > 0) {\n\t\t\tthis.ctx.fillStyle = \"#4fc3f7\";\n\t\t\tthis.ctx.font = \"12px monospace\";\n\t\t\tthis.ctx.fillText(`${selWidth} x ${selHeight}`, x + 4, y - 4);\n\t\t}\n\t}\n\n\tprivate drawGhostPreview(\n\t\tpreview: { region: PresetRegion; x: number; y: number },\n\t\tsimWidth: number,\n\t\tsimHeight: number,\n\t): void {\n\t\tconst scaleX = this.canvas.width / simWidth;\n\t\tconst scaleY = this.canvas.height / simHeight;\n\t\tconst { region, x, y } = preview;\n\n\t\t// Create temporary image data for the ghost\n\t\tconst ghostCanvas = document.createElement(\"canvas\");\n\t\tghostCanvas.width = region.width;\n\t\tghostCanvas.height = region.height;\n\t\tconst ghostCtx = ghostCanvas.getContext(\"2d\")!;\n\t\tconst imageData = ghostCtx.createImageData(region.width, region.height);\n\t\tconst colorMap = this.getColorMap();\n\n\t\tfor (let i = 0; i < region.channels[0].length; i++) {\n\t\t\tconst value = Math.max(0, Math.min(1, region.channels[0][i]));\n\t\t\tconst colorIndex = Math.floor(value * 255) * 4;\n\n\t\t\timageData.data[i * 4 + 0] = colorMap[colorIndex + 0];\n\t\t\timageData.data[i * 4 + 1] = colorMap[colorIndex + 1];\n\t\t\timageData.data[i * 4 + 2] = colorMap[colorIndex + 2];\n\t\t\timageData.data[i * 4 + 3] = value > 0.01 ? 180 : 0; // Semi-transparent\n\t\t}\n\n\t\tghostCtx.putImageData(imageData, 0, 0);\n\n\t\t// Draw ghost on main canvas\n\t\tthis.ctx.globalAlpha = 0.7;\n\t\tthis.ctx.drawImage(\n\t\t\tghostCanvas,\n\t\t\t0,\n\t\t\t0,\n\t\t\tregion.width,\n\t\t\tregion.height,\n\t\t\tx * scaleX,\n\t\t\ty * scaleY,\n\t\t\tregion.width * scaleX,\n\t\t\tregion.height * scaleY,\n\t\t);\n\t\tthis.ctx.globalAlpha = 1.0;\n\n\t\t// Draw border around ghost\n\t\tthis.ctx.strokeStyle = \"#4fc3f7\";\n\t\tthis.ctx.lineWidth = 2;\n\t\tthis.ctx.setLineDash([3, 3]);\n\t\tthis.ctx.strokeRect(x * scaleX, y * scaleY, region.width * scaleX, region.height * scaleY);\n\t\tthis.ctx.setLineDash([]);\n\t}\n\n\t// Convert canvas coordinates to simulation coordinates\n\tcanvasToSim(\n\t\tcanvasX: number,\n\t\tcanvasY: number,\n\t\tsimWidth: number,\n\t\tsimHeight: number,\n\t): { x: number; y: number } {\n\t\tconst rect = this.canvas.getBoundingClientRect();\n\t\tconst scaleX = simWidth / this.canvas.width;\n\t\tconst scaleY = simHeight / this.canvas.height;\n\n\t\treturn {\n\t\t\tx: Math.floor((canvasX - rect.left) * scaleX),\n\t\t\ty: Math.floor((canvasY - rect.top) * scaleY),\n\t\t};\n\t}\n\n\tprivate getColorMap(): Uint8ClampedArray {\n\t\tswitch (this.settings.colorScheme) {\n\t\t\tcase \"thermal\":\n\t\t\t\treturn this.thermalMap;\n\t\t\tcase \"viridis\":\n\t\t\t\treturn this.viridisMap;\n\t\t\tdefault:\n\t\t\t\treturn this.grayscaleMap;\n\t\t}\n\t}\n\n\tprivate buildGrayscaleMap(): Uint8ClampedArray {\n\t\tconst map = new Uint8ClampedArray(256 * 4);\n\t\tfor (let i = 0; i < 256; i++) {\n\t\t\tmap[i * 4 + 0] = i;\n\t\t\tmap[i * 4 + 1] = i;\n\t\t\tmap[i * 4 + 2] = i;\n\t\t\tmap[i * 4 + 3] = 255;\n\t\t}\n\t\treturn map;\n\t}\n\n\tprivate buildThermalMap(): Uint8ClampedArray {\n\t\tconst map = new Uint8ClampedArray(256 * 4);\n\t\tfor (let i = 0; i < 256; i++) {\n\t\t\tconst t = i / 255;\n\t\t\t// Black -> Blue -> Cyan -> Yellow -> Red -> White\n\t\t\tlet r: number, g: number, b: number;\n\t\t\tif (t < 0.2) {\n\t\t\t\tconst s = t / 0.2;\n\t\t\t\tr = 0;\n\t\t\t\tg = 0;\n\t\t\t\tb = Math.floor(s * 128);\n\t\t\t} else if (t < 0.4) {\n\t\t\t\tconst s = (t - 0.2) / 0.2;\n\t\t\t\tr = 0;\n\t\t\t\tg = Math.floor(s * 255);\n\t\t\t\tb = 128 + Math.floor(s * 127);\n\t\t\t} else if (t < 0.6) {\n\t\t\t\tconst s = (t - 0.4) / 0.2;\n\t\t\t\tr = Math.floor(s * 255);\n\t\t\t\tg = 255;\n\t\t\t\tb = 255 - Math.floor(s * 255);\n\t\t\t} else if (t < 0.8) {\n\t\t\t\tconst s = (t - 0.6) / 0.2;\n\t\t\t\tr = 255;\n\t\t\t\tg = 255 - Math.floor(s * 255);\n\t\t\t\tb = 0;\n\t\t\t} else {\n\t\t\t\tconst s = (t - 0.8) / 0.2;\n\t\t\t\tr = 255;\n\t\t\t\tg = Math.floor(s * 255);\n\t\t\t\tb = Math.floor(s * 255);\n\t\t\t}\n\t\t\tmap[i * 4 + 0] = r;\n\t\t\tmap[i * 4 + 1] = g;\n\t\t\tmap[i * 4 + 2] = b;\n\t\t\tmap[i * 4 + 3] = 255;\n\t\t}\n\t\treturn map;\n\t}\n\n\tprivate buildViridisMap(): Uint8ClampedArray {\n\t\t// Simplified viridis colormap\n\t\tconst viridisColors = [\n\t\t\t[68, 1, 84],\n\t\t\t[72, 35, 116],\n\t\t\t[64, 67, 135],\n\t\t\t[52, 94, 141],\n\t\t\t[41, 120, 142],\n\t\t\t[32, 144, 140],\n\t\t\t[34, 167, 132],\n\t\t\t[68, 190, 112],\n\t\t\t[121, 209, 81],\n\t\t\t[189, 222, 38],\n\t\t\t[253, 231, 36],\n\t\t];\n\n\t\tconst map = new Uint8ClampedArray(256 * 4);\n\t\tfor (let i = 0; i < 256; i++) {\n\t\t\tconst t = i / 255;\n\t\t\tconst idx = t * (viridisColors.length - 1);\n\t\t\tconst low = Math.floor(idx);\n\t\t\tconst high = Math.min(low + 1, viridisColors.length - 1);\n\t\t\tconst frac = idx - low;\n\n\t\t\tmap[i * 4 + 0] = Math.floor(\n\t\t\t\tviridisColors[low][0] + frac * (viridisColors[high][0] - viridisColors[low][0]),\n\t\t\t);\n\t\t\tmap[i * 4 + 1] = Math.floor(\n\t\t\t\tviridisColors[low][1] + frac * (viridisColors[high][1] - viridisColors[low][1]),\n\t\t\t);\n\t\t\tmap[i * 4 + 2] = Math.floor(\n\t\t\t\tviridisColors[low][2] + frac * (viridisColors[high][2] - viridisColors[low][2]),\n\t\t\t);\n\t\t\tmap[i * 4 + 3] = 255;\n\t\t}\n\t\treturn map;\n\t}\n\n\tgetCanvas(): HTMLCanvasElement {\n\t\treturn this.canvas;\n\t}\n}\n",
    "// Simulation Manager - WASM wrapper with enhanced state management\n\nimport type { BackendType, PresetRegion, Seed, SimulationConfig, SimulationState } from \"./types\";\n\n// WASM module types\ninterface WasmModule {\n\tdefault: () => Promise<void>;\n\tWasmPropagator: new (configJson: string, seedJson: string) => WasmPropagator;\n\tWasmGpuPropagator: new (configJson: string, seedJson: string) => Promise<WasmGpuPropagator>;\n}\n\ninterface WasmPropagator {\n\tstep(): void;\n\trun(steps: bigint): void;\n\tgetState(): SimulationState;\n\tgetStats(): unknown;\n\treset(seedJson: string): void;\n\ttotalMass(): number;\n\tgetTime(): number;\n\tgetStep(): number;\n\tgetWidth(): number;\n\tgetHeight(): number;\n}\n\ninterface WasmGpuPropagator {\n\tstep(): Promise<void>;\n\trun(steps: bigint): Promise<void>;\n\tgetState(): SimulationState;\n\tgetStats(): unknown;\n\treset(seedJson: string): void;\n\ttotalMass(): number;\n\tgetTime(): number;\n\tgetStep(): number;\n\tgetWidth(): number;\n\tgetHeight(): number;\n}\n\ntype Propagator = WasmPropagator | WasmGpuPropagator;\n\nexport class SimulationManager {\n\tprivate propagator: Propagator | null = null;\n\tprivate config: SimulationConfig;\n\tprivate currentSeed: Seed;\n\tprivate isInitialized = false;\n\tprivate wasmModule: WasmModule | null = null;\n\tprivate currentBackend: BackendType = \"cpu\";\n\tprivate gpuAvailable = false;\n\n\tconstructor(config: SimulationConfig, seed: Seed) {\n\t\tthis.config = config;\n\t\tthis.currentSeed = seed;\n\t}\n\n\tasync initialize(backend: BackendType = \"cpu\"): Promise<void> {\n\t\ttry {\n\t\t\t// Use relative path so it works regardless of deployment location\n\t\t\tconst wasmUrl = new URL(\"./pkg/flow_lenia.js\", import.meta.url).href;\n\t\t\tthis.wasmModule = (await import(/* webpackIgnore: true */ wasmUrl)) as WasmModule;\n\t\t\tawait this.wasmModule.default();\n\n\t\t\t// Check WebGPU availability\n\t\t\tthis.gpuAvailable = await this.checkWebGPU();\n\n\t\t\t// Create propagator with requested backend (fallback to CPU if GPU unavailable)\n\t\t\tconst useBackend = backend === \"gpu\" && this.gpuAvailable ? \"gpu\" : \"cpu\";\n\t\t\tawait this.createPropagator(useBackend);\n\n\t\t\tthis.isInitialized = true;\n\t\t} catch (error) {\n\t\t\tthrow new Error(`Failed to initialize WASM: ${error}`);\n\t\t}\n\t}\n\n\tprivate async checkWebGPU(): Promise<boolean> {\n\t\tif (typeof navigator === \"undefined\" || !(\"gpu\" in navigator)) {\n\t\t\treturn false;\n\t\t}\n\t\ttry {\n\t\t\tconst adapter = await navigator.gpu.requestAdapter();\n\t\t\treturn adapter !== null;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprivate async createPropagator(backend: BackendType): Promise<void> {\n\t\tif (!this.wasmModule) {\n\t\t\tthrow new Error(\"WASM module not loaded\");\n\t\t}\n\n\t\tconst configJson = JSON.stringify(this.config);\n\t\tconst seedJson = JSON.stringify(this.currentSeed);\n\n\t\tif (backend === \"gpu\" && this.gpuAvailable) {\n\t\t\t// GPU propagator constructor returns a Promise\n\t\t\tthis.propagator = await new this.wasmModule.WasmGpuPropagator(configJson, seedJson);\n\t\t\tthis.currentBackend = \"gpu\";\n\t\t} else {\n\t\t\tthis.propagator = new this.wasmModule.WasmPropagator(configJson, seedJson);\n\t\t\tthis.currentBackend = \"cpu\";\n\t\t}\n\t}\n\n\tasync switchBackend(backend: BackendType): Promise<boolean> {\n\t\tif (!this.isInitialized) {\n\t\t\tthrow new Error(\"Simulation not initialized\");\n\t\t}\n\n\t\tif (backend === \"gpu\" && !this.gpuAvailable) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (backend === this.currentBackend) {\n\t\t\treturn true;\n\t\t}\n\n\t\tawait this.createPropagator(backend);\n\t\treturn true;\n\t}\n\n\tisGpuAvailable(): boolean {\n\t\treturn this.gpuAvailable;\n\t}\n\n\tgetBackend(): BackendType {\n\t\treturn this.currentBackend;\n\t}\n\n\tasync step(): Promise<void> {\n\t\tthis.ensureInitialized();\n\t\tif (this.currentBackend === \"gpu\") {\n\t\t\tawait (this.propagator as WasmGpuPropagator).step();\n\t\t} else {\n\t\t\t(this.propagator as WasmPropagator).step();\n\t\t}\n\t}\n\n\tasync run(steps: number): Promise<void> {\n\t\tthis.ensureInitialized();\n\t\tif (this.currentBackend === \"gpu\") {\n\t\t\tawait (this.propagator as WasmGpuPropagator).run(BigInt(steps));\n\t\t} else {\n\t\t\t(this.propagator as WasmPropagator).run(BigInt(steps));\n\t\t}\n\t}\n\n\tgetState(): SimulationState {\n\t\tthis.ensureInitialized();\n\t\treturn this.propagator!.getState();\n\t}\n\n\treset(seed?: Seed): void {\n\t\tthis.ensureInitialized();\n\t\tif (seed) {\n\t\t\tthis.currentSeed = seed;\n\t\t}\n\t\tthis.propagator!.reset(JSON.stringify(this.currentSeed));\n\t}\n\n\ttotalMass(): number {\n\t\tthis.ensureInitialized();\n\t\treturn this.propagator!.totalMass();\n\t}\n\n\tgetTime(): number {\n\t\tthis.ensureInitialized();\n\t\treturn this.propagator!.getTime();\n\t}\n\n\tgetStep(): number {\n\t\tthis.ensureInitialized();\n\t\treturn this.propagator!.getStep();\n\t}\n\n\tgetWidth(): number {\n\t\treturn this.config.width;\n\t}\n\n\tgetHeight(): number {\n\t\treturn this.config.height;\n\t}\n\n\tgetConfig(): SimulationConfig {\n\t\treturn { ...this.config };\n\t}\n\n\t// Extract a region from the current state\n\textractRegion(x: number, y: number, width: number, height: number): PresetRegion {\n\t\tthis.ensureInitialized();\n\t\tconst state = this.getState();\n\t\tconst channels: number[][] = [];\n\n\t\tfor (let ch = 0; ch < state.channels.length; ch++) {\n\t\t\tconst regionData: number[] = [];\n\t\t\tfor (let dy = 0; dy < height; dy++) {\n\t\t\t\tfor (let dx = 0; dx < width; dx++) {\n\t\t\t\t\tconst srcX = (x + dx) % state.width;\n\t\t\t\t\tconst srcY = (y + dy) % state.height;\n\t\t\t\t\tconst idx = srcY * state.width + srcX;\n\t\t\t\t\tregionData.push(state.channels[ch][idx]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tchannels.push(regionData);\n\t\t}\n\n\t\treturn {\n\t\t\twidth,\n\t\t\theight,\n\t\t\tchannels,\n\t\t\tsourceX: x,\n\t\t\tsourceY: y,\n\t\t};\n\t}\n\n\t// Place a region into the simulation (requires custom seed)\n\tplaceRegion(region: PresetRegion, targetX: number, targetY: number): void {\n\t\tthis.ensureInitialized();\n\t\tconst state = this.getState();\n\n\t\t// Build custom pattern from current state + placed region\n\t\t// Use Map for efficient lookups: key = \"x,y,ch\"\n\t\tconst valueMap = new Map<string, number>();\n\n\t\t// First, add all existing values\n\t\tfor (let ch = 0; ch < state.channels.length; ch++) {\n\t\t\tfor (let y = 0; y < state.height; y++) {\n\t\t\t\tfor (let x = 0; x < state.width; x++) {\n\t\t\t\t\tconst idx = y * state.width + x;\n\t\t\t\t\tconst value = state.channels[ch][idx];\n\t\t\t\t\tif (value > 0.001) {\n\t\t\t\t\t\tvalueMap.set(`${x},${y},${ch}`, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Then overlay the region (overwrites existing values at same location)\n\t\tfor (let ch = 0; ch < region.channels.length; ch++) {\n\t\t\tfor (let dy = 0; dy < region.height; dy++) {\n\t\t\t\tfor (let dx = 0; dx < region.width; dx++) {\n\t\t\t\t\tconst x = (targetX + dx) % this.config.width;\n\t\t\t\t\tconst y = (targetY + dy) % this.config.height;\n\t\t\t\t\tconst idx = dy * region.width + dx;\n\t\t\t\t\tconst value = region.channels[ch][idx];\n\n\t\t\t\t\tif (value > 0.001) {\n\t\t\t\t\t\tvalueMap.set(`${x},${y},${ch}`, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Convert map to tuple array: [x, y, channel, value]\n\t\tconst values: Array<[number, number, number, number]> = [];\n\t\tfor (const [key, value] of valueMap) {\n\t\t\tconst [x, y, ch] = key.split(\",\").map(Number);\n\t\t\tvalues.push([x, y, ch, value]);\n\t\t}\n\n\t\t// Reset with custom pattern\n\t\tconst customSeed: Seed = {\n\t\t\tpattern: {\n\t\t\t\ttype: \"Custom\",\n\t\t\t\tvalues,\n\t\t\t},\n\t\t};\n\n\t\tthis.reset(customSeed);\n\t}\n\n\t// Draw at a specific location\n\tdrawAt(x: number, y: number, radius: number, intensity: number, channel = 0): void {\n\t\tthis.ensureInitialized();\n\t\tconst state = this.getState();\n\t\tconst values: Array<[number, number, number, number]> = [];\n\n\t\t// Copy existing state with brush contribution\n\t\tfor (let ch = 0; ch < state.channels.length; ch++) {\n\t\t\tfor (let py = 0; py < state.height; py++) {\n\t\t\t\tfor (let px = 0; px < state.width; px++) {\n\t\t\t\t\tconst idx = py * state.width + px;\n\t\t\t\t\tlet value = state.channels[ch][idx];\n\n\t\t\t\t\t// Add brush contribution\n\t\t\t\t\tif (ch === channel) {\n\t\t\t\t\t\tconst dx = px - x;\n\t\t\t\t\t\tconst dy = py - y;\n\t\t\t\t\t\tconst dist = Math.sqrt(dx * dx + dy * dy);\n\t\t\t\t\t\tif (dist <= radius) {\n\t\t\t\t\t\t\tconst falloff = 1 - dist / radius;\n\t\t\t\t\t\t\tvalue = Math.min(1, value + intensity * falloff * falloff);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value > 0.001) {\n\t\t\t\t\t\tvalues.push([px, py, ch, value]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst customSeed: Seed = {\n\t\t\tpattern: {\n\t\t\t\ttype: \"Custom\",\n\t\t\t\tvalues,\n\t\t\t},\n\t\t};\n\n\t\tthis.reset(customSeed);\n\t}\n\n\t// Erase at a specific location\n\teraseAt(x: number, y: number, radius: number, channel = 0): void {\n\t\tthis.ensureInitialized();\n\t\tconst state = this.getState();\n\t\tconst values: Array<[number, number, number, number]> = [];\n\n\t\t// Copy existing state, erasing within radius\n\t\tfor (let ch = 0; ch < state.channels.length; ch++) {\n\t\t\tfor (let py = 0; py < state.height; py++) {\n\t\t\t\tfor (let px = 0; px < state.width; px++) {\n\t\t\t\t\tconst idx = py * state.width + px;\n\t\t\t\t\tlet value = state.channels[ch][idx];\n\n\t\t\t\t\t// Erase within radius\n\t\t\t\t\tif (ch === channel) {\n\t\t\t\t\t\tconst dx = px - x;\n\t\t\t\t\t\tconst dy = py - y;\n\t\t\t\t\t\tconst dist = Math.sqrt(dx * dx + dy * dy);\n\t\t\t\t\t\tif (dist <= radius) {\n\t\t\t\t\t\t\tconst falloff = 1 - dist / radius;\n\t\t\t\t\t\t\tvalue = Math.max(0, value * (1 - falloff * falloff));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value > 0.001) {\n\t\t\t\t\t\tvalues.push([px, py, ch, value]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst customSeed: Seed = {\n\t\t\tpattern: {\n\t\t\t\ttype: \"Custom\",\n\t\t\t\tvalues,\n\t\t\t},\n\t\t};\n\n\t\tthis.reset(customSeed);\n\t}\n\n\tprivate ensureInitialized(): void {\n\t\tif (!this.isInitialized || !this.propagator) {\n\t\t\tthrow new Error(\"Simulation not initialized. Call initialize() first.\");\n\t\t}\n\t}\n}\n",
    "// UI Components - Controls, panels, and preset library\n\nimport { BUILTIN_PRESETS } from \"./presets\";\nimport type { BackendType, InteractionMode, Preset, Seed, ViewerSettings } from \"./types\";\n\n// Escape HTML to prevent XSS attacks from imported presets\nfunction escapeHtml(str: string): string {\n\treturn str\n\t\t.replace(/&/g, \"&amp;\")\n\t\t.replace(/</g, \"&lt;\")\n\t\t.replace(/>/g, \"&gt;\")\n\t\t.replace(/\"/g, \"&quot;\")\n\t\t.replace(/'/g, \"&#039;\");\n}\n\nexport interface UICallbacks {\n\tonPlay: () => void;\n\tonPause: () => void;\n\tonStep: () => void;\n\tonReset: (seed?: Seed) => void;\n\tonSpeedChange: (stepsPerFrame: number) => void;\n\tonModeChange: (mode: InteractionMode) => void;\n\tonSettingsChange: (settings: Partial<ViewerSettings>) => void;\n\tonSaveSelection: (name: string) => void;\n\tonPresetSelect: (preset: Preset) => void;\n\tonPresetDelete: (id: string) => void;\n\tonPresetDragStart: (preset: Preset, event: DragEvent) => void;\n\tonExportPresets: () => void;\n\tonImportPresets: (json: string) => void;\n\tonBrushSizeChange: (size: number) => void;\n\tonBrushIntensityChange: (intensity: number) => void;\n\tonBackendChange: (backend: BackendType) => void;\n}\n\nexport class UI {\n\tprivate container: HTMLElement;\n\tprivate callbacks: UICallbacks;\n\tprivate isPlaying = false;\n\tprivate stepsPerFrame = 1;\n\tprivate hasSelection = false;\n\n\tconstructor(container: HTMLElement, callbacks: UICallbacks) {\n\t\tthis.container = container;\n\t\tthis.callbacks = callbacks;\n\t\tthis.buildUI();\n\t}\n\n\tprivate buildUI(): void {\n\t\tthis.container.innerHTML = `\n      <div class=\"viewer-layout\">\n        <aside class=\"sidebar left-sidebar\">\n          <div class=\"panel\">\n            <h3>Playback</h3>\n            <div class=\"button-group\">\n              <button id=\"playBtn\" class=\"btn btn-primary\" title=\"Play (Space)\">\n                <span class=\"icon\">‚ñ∂</span> Play\n              </button>\n              <button id=\"pauseBtn\" class=\"btn\" disabled title=\"Pause (Space)\">\n                <span class=\"icon\">‚è∏</span> Pause\n              </button>\n            </div>\n            <div class=\"button-group\">\n              <button id=\"stepBtn\" class=\"btn\" title=\"Step (.)\">\n                <span class=\"icon\">‚è≠</span> Step\n              </button>\n              <button id=\"resetBtn\" class=\"btn\" title=\"Reset (R)\">\n                <span class=\"icon\">‚Ü∫</span> Reset\n              </button>\n            </div>\n            <div class=\"speed-control\">\n              <label>Speed: <span id=\"speedValue\">1</span> steps/frame</label>\n              <div class=\"button-group\">\n                <button id=\"slowDownBtn\" class=\"btn btn-sm\">‚àí</button>\n                <button id=\"speedUpBtn\" class=\"btn btn-sm\">+</button>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"panel\">\n            <h3>Tools</h3>\n            <div class=\"tool-buttons\">\n              <button id=\"viewModeBtn\" class=\"btn tool-btn active\" title=\"View Mode (V)\">\n                <span class=\"icon\">üëÅ</span> View\n              </button>\n              <button id=\"selectModeBtn\" class=\"btn tool-btn\" title=\"Select Mode (S)\">\n                <span class=\"icon\">‚¨ö</span> Select\n              </button>\n              <button id=\"drawModeBtn\" class=\"btn tool-btn\" title=\"Draw Mode (D)\">\n                <span class=\"icon\">‚úé</span> Draw\n              </button>\n              <button id=\"eraseModeBtn\" class=\"btn tool-btn\" title=\"Erase Mode (E)\">\n                <span class=\"icon\">‚å´</span> Erase\n              </button>\n            </div>\n            <div id=\"brushSettings\" class=\"brush-settings hidden\">\n              <label>Brush Size: <span id=\"brushSizeValue\">3</span></label>\n              <input type=\"range\" id=\"brushSizeSlider\" min=\"1\" max=\"20\" value=\"3\">\n              <label>Intensity: <span id=\"brushIntensityValue\">50</span>%</label>\n              <input type=\"range\" id=\"brushIntensitySlider\" min=\"0\" max=\"100\" value=\"50\">\n            </div>\n          </div>\n\n          <div class=\"panel\">\n            <h3>Display</h3>\n            <div class=\"setting-row\">\n              <label>Color Scheme</label>\n              <select id=\"colorScheme\">\n                <option value=\"grayscale\">Grayscale</option>\n                <option value=\"thermal\">Thermal</option>\n                <option value=\"viridis\">Viridis</option>\n              </select>\n            </div>\n            <div class=\"setting-row\">\n              <label>\n                <input type=\"checkbox\" id=\"showGrid\"> Show Grid\n              </label>\n            </div>\n          </div>\n        </aside>\n\n        <main class=\"canvas-container\">\n          <canvas id=\"simulationCanvas\" width=\"512\" height=\"512\"></canvas>\n          <div class=\"stats-bar\">\n            <span>Step: <strong id=\"stepCount\">0</strong></span>\n            <span>Time: <strong id=\"simTime\">0.00</strong></span>\n            <span>Mass: <strong id=\"totalMass\">0.00</strong></span>\n            <span>FPS: <strong id=\"fpsDisplay\">0</strong></span>\n            <div class=\"backend-toggle\">\n              <span class=\"backend-label cpu active\" id=\"cpuLabel\">CPU</span>\n              <label class=\"toggle-switch\">\n                <input type=\"checkbox\" id=\"backendToggle\" disabled>\n                <span class=\"toggle-slider\"></span>\n              </label>\n              <span class=\"backend-label gpu\" id=\"gpuLabel\">GPU</span>\n            </div>\n          </div>\n        </main>\n\n        <aside class=\"sidebar right-sidebar\">\n          <div class=\"panel\">\n            <h3>Selection</h3>\n            <div id=\"selectionInfo\" class=\"selection-info\">\n              <p class=\"muted\">Use Select tool to capture regions</p>\n            </div>\n            <div id=\"saveSelectionForm\" class=\"save-form hidden\">\n              <input type=\"text\" id=\"presetName\" placeholder=\"Preset name...\" maxlength=\"30\">\n              <button id=\"savePresetBtn\" class=\"btn btn-primary\" disabled>Save as Preset</button>\n            </div>\n          </div>\n\n          <div class=\"panel\">\n            <h3>Presets</h3>\n            <div class=\"preset-actions\">\n              <button id=\"importPresetsBtn\" class=\"btn btn-sm\">Import</button>\n              <button id=\"exportPresetsBtn\" class=\"btn btn-sm\">Export</button>\n            </div>\n            <div id=\"presetLibrary\" class=\"preset-library\">\n              <!-- Presets will be rendered here -->\n            </div>\n            <input type=\"file\" id=\"importFileInput\" accept=\".json\" hidden>\n          </div>\n\n          <div class=\"panel\">\n            <h3>Built-in Patterns</h3>\n            <div id=\"builtinPatterns\" class=\"builtin-patterns\">\n              <!-- Built-in patterns will be rendered here -->\n            </div>\n          </div>\n        </aside>\n      </div>\n    `;\n\n\t\tthis.setupEventListeners();\n\t\tthis.renderBuiltinPatterns();\n\t}\n\n\tprivate setupEventListeners(): void {\n\t\t// Playback controls\n\t\tconst playBtn = this.get<HTMLButtonElement>(\"playBtn\");\n\t\tconst pauseBtn = this.get<HTMLButtonElement>(\"pauseBtn\");\n\t\tconst stepBtn = this.get<HTMLButtonElement>(\"stepBtn\");\n\t\tconst resetBtn = this.get<HTMLButtonElement>(\"resetBtn\");\n\t\tconst speedUpBtn = this.get<HTMLButtonElement>(\"speedUpBtn\");\n\t\tconst slowDownBtn = this.get<HTMLButtonElement>(\"slowDownBtn\");\n\n\t\tplayBtn.addEventListener(\"click\", () => {\n\t\t\tthis.callbacks.onPlay();\n\t\t\tthis.setPlaying(true);\n\t\t});\n\n\t\tpauseBtn.addEventListener(\"click\", () => {\n\t\t\tthis.callbacks.onPause();\n\t\t\tthis.setPlaying(false);\n\t\t});\n\n\t\tstepBtn.addEventListener(\"click\", () => this.callbacks.onStep());\n\t\tresetBtn.addEventListener(\"click\", () => this.callbacks.onReset());\n\n\t\tspeedUpBtn.addEventListener(\"click\", () => {\n\t\t\tthis.stepsPerFrame = Math.min(this.stepsPerFrame * 2, 64);\n\t\t\tthis.updateSpeedDisplay();\n\t\t\tthis.callbacks.onSpeedChange(this.stepsPerFrame);\n\t\t});\n\n\t\tslowDownBtn.addEventListener(\"click\", () => {\n\t\t\tthis.stepsPerFrame = Math.max(Math.floor(this.stepsPerFrame / 2), 1);\n\t\t\tthis.updateSpeedDisplay();\n\t\t\tthis.callbacks.onSpeedChange(this.stepsPerFrame);\n\t\t});\n\n\t\t// Tool modes\n\t\tconst viewBtn = this.get<HTMLButtonElement>(\"viewModeBtn\");\n\t\tconst selectBtn = this.get<HTMLButtonElement>(\"selectModeBtn\");\n\t\tconst drawBtn = this.get<HTMLButtonElement>(\"drawModeBtn\");\n\t\tconst eraseBtn = this.get<HTMLButtonElement>(\"eraseModeBtn\");\n\n\t\tviewBtn.addEventListener(\"click\", () => this.setMode(\"view\"));\n\t\tselectBtn.addEventListener(\"click\", () => this.setMode(\"select\"));\n\t\tdrawBtn.addEventListener(\"click\", () => this.setMode(\"draw\"));\n\t\teraseBtn.addEventListener(\"click\", () => this.setMode(\"erase\"));\n\n\t\t// Brush settings\n\t\tconst brushSizeSlider = this.get<HTMLInputElement>(\"brushSizeSlider\");\n\t\tconst brushIntensitySlider = this.get<HTMLInputElement>(\"brushIntensitySlider\");\n\n\t\tbrushSizeSlider.addEventListener(\"input\", () => {\n\t\t\tconst size = parseInt(brushSizeSlider.value, 10);\n\t\t\tthis.get(\"brushSizeValue\").textContent = size.toString();\n\t\t\tthis.callbacks.onBrushSizeChange(size);\n\t\t});\n\n\t\tbrushIntensitySlider.addEventListener(\"input\", () => {\n\t\t\tconst intensity = parseInt(brushIntensitySlider.value, 10);\n\t\t\tthis.get(\"brushIntensityValue\").textContent = intensity.toString();\n\t\t\tthis.callbacks.onBrushIntensityChange(intensity / 100);\n\t\t});\n\n\t\t// Display settings\n\t\tconst colorScheme = this.get<HTMLSelectElement>(\"colorScheme\");\n\t\tconst showGrid = this.get<HTMLInputElement>(\"showGrid\");\n\n\t\tcolorScheme.addEventListener(\"change\", () => {\n\t\t\tthis.callbacks.onSettingsChange({\n\t\t\t\tcolorScheme: colorScheme.value as ViewerSettings[\"colorScheme\"],\n\t\t\t});\n\t\t});\n\n\t\tshowGrid.addEventListener(\"change\", () => {\n\t\t\tthis.callbacks.onSettingsChange({ showGrid: showGrid.checked });\n\t\t});\n\n\t\t// Save preset\n\t\tconst presetName = this.get<HTMLInputElement>(\"presetName\");\n\t\tconst savePresetBtn = this.get<HTMLButtonElement>(\"savePresetBtn\");\n\n\t\tpresetName.addEventListener(\"input\", () => {\n\t\t\tsavePresetBtn.disabled = !presetName.value.trim() || !this.hasSelection;\n\t\t});\n\n\t\tsavePresetBtn.addEventListener(\"click\", () => {\n\t\t\tconst name = presetName.value.trim();\n\t\t\tif (name) {\n\t\t\t\tthis.callbacks.onSaveSelection(name);\n\t\t\t\tpresetName.value = \"\";\n\t\t\t\tsavePresetBtn.disabled = true;\n\t\t\t}\n\t\t});\n\n\t\t// Import/Export\n\t\tconst importBtn = this.get<HTMLButtonElement>(\"importPresetsBtn\");\n\t\tconst exportBtn = this.get<HTMLButtonElement>(\"exportPresetsBtn\");\n\t\tconst importInput = this.get<HTMLInputElement>(\"importFileInput\");\n\n\t\timportBtn.addEventListener(\"click\", () => importInput.click());\n\n\t\timportInput.addEventListener(\"change\", () => {\n\t\t\tconst file = importInput.files?.[0];\n\t\t\tif (file) {\n\t\t\t\tconst reader = new FileReader();\n\t\t\t\treader.onload = () => {\n\t\t\t\t\tthis.callbacks.onImportPresets(reader.result as string);\n\t\t\t\t};\n\t\t\t\treader.readAsText(file);\n\t\t\t\timportInput.value = \"\";\n\t\t\t}\n\t\t});\n\n\t\texportBtn.addEventListener(\"click\", () => this.callbacks.onExportPresets());\n\n\t\t// Backend toggle\n\t\tconst backendToggle = this.get<HTMLInputElement>(\"backendToggle\");\n\t\tbackendToggle.addEventListener(\"change\", () => {\n\t\t\tconst backend = backendToggle.checked ? \"gpu\" : \"cpu\";\n\t\t\tthis.callbacks.onBackendChange(backend);\n\t\t});\n\n\t\t// Keyboard shortcuts\n\t\tdocument.addEventListener(\"keydown\", (e) => {\n\t\t\t// Ignore if typing in input\n\t\t\tif ((e.target as HTMLElement).tagName === \"INPUT\") return;\n\n\t\t\tif (e.key === \" \") {\n\t\t\t\te.preventDefault();\n\t\t\t\tif (this.isPlaying) {\n\t\t\t\t\tthis.callbacks.onPause();\n\t\t\t\t\tthis.setPlaying(false);\n\t\t\t\t} else {\n\t\t\t\t\tthis.callbacks.onPlay();\n\t\t\t\t\tthis.setPlaying(true);\n\t\t\t\t}\n\t\t\t} else if (e.key === \".\") {\n\t\t\t\tthis.callbacks.onStep();\n\t\t\t} else if (e.key === \"r\" || e.key === \"R\") {\n\t\t\t\tthis.callbacks.onReset();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate renderBuiltinPatterns(): void {\n\t\tconst container = this.get(\"builtinPatterns\");\n\t\tcontainer.innerHTML = BUILTIN_PRESETS.map(\n\t\t\t(pattern) => `\n      <div class=\"builtin-pattern\" data-name=\"${pattern.name}\">\n        <span class=\"pattern-name\">${pattern.name}</span>\n        <span class=\"pattern-desc\">${pattern.description}</span>\n      </div>\n    `,\n\t\t).join(\"\");\n\n\t\tcontainer.querySelectorAll(\".builtin-pattern\").forEach((el) => {\n\t\t\tel.addEventListener(\"click\", () => {\n\t\t\t\tconst name = el.getAttribute(\"data-name\")!;\n\t\t\t\tconst pattern = BUILTIN_PRESETS.find((p) => p.name === name);\n\t\t\t\tif (pattern) {\n\t\t\t\t\tthis.callbacks.onReset(pattern.seed as Seed);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t// Update UI display only, without triggering callback (used when syncing from InteractionHandler)\n\tupdateModeDisplay(mode: InteractionMode): void {\n\t\tconst buttons = {\n\t\t\tview: this.get(\"viewModeBtn\"),\n\t\t\tselect: this.get(\"selectModeBtn\"),\n\t\t\tdraw: this.get(\"drawModeBtn\"),\n\t\t\terase: this.get(\"eraseModeBtn\"),\n\t\t};\n\n\t\tfor (const [m, btn] of Object.entries(buttons)) {\n\t\t\tbtn.classList.toggle(\"active\", m === mode);\n\t\t}\n\n\t\t// Show/hide brush settings\n\t\tconst brushSettings = this.get(\"brushSettings\");\n\t\tbrushSettings.classList.toggle(\"hidden\", mode !== \"draw\" && mode !== \"erase\");\n\t}\n\n\t// Called by UI button clicks - updates display and notifies main\n\tsetMode(mode: InteractionMode): void {\n\t\tthis.updateModeDisplay(mode);\n\t\tthis.callbacks.onModeChange(mode);\n\t}\n\n\tsetPlaying(playing: boolean): void {\n\t\tthis.isPlaying = playing;\n\t\tconst playBtn = this.get<HTMLButtonElement>(\"playBtn\");\n\t\tconst pauseBtn = this.get<HTMLButtonElement>(\"pauseBtn\");\n\n\t\tplayBtn.disabled = playing;\n\t\tpauseBtn.disabled = !playing;\n\t}\n\n\tupdateStats(step: number, time: number, mass: number, fps: number): void {\n\t\tthis.get(\"stepCount\").textContent = step.toString();\n\t\tthis.get(\"simTime\").textContent = time.toFixed(2);\n\t\tthis.get(\"totalMass\").textContent = mass.toFixed(2);\n\t\tthis.get(\"fpsDisplay\").textContent = fps.toString();\n\t}\n\n\tupdateSelection(hasSelection: boolean, width?: number, height?: number): void {\n\t\tthis.hasSelection = hasSelection;\n\t\tconst info = this.get(\"selectionInfo\");\n\t\tconst form = this.get(\"saveSelectionForm\");\n\t\tconst saveBtn = this.get<HTMLButtonElement>(\"savePresetBtn\");\n\t\tconst nameInput = this.get<HTMLInputElement>(\"presetName\");\n\n\t\tif (hasSelection && width && height) {\n\t\t\tinfo.innerHTML = `<p>Selection: <strong>${width} x ${height}</strong> cells</p>`;\n\t\t\tform.classList.remove(\"hidden\");\n\t\t\tsaveBtn.disabled = !nameInput.value.trim();\n\t\t} else {\n\t\t\tinfo.innerHTML = `<p class=\"muted\">Use Select tool to capture regions</p>`;\n\t\t\tform.classList.add(\"hidden\");\n\t\t}\n\t}\n\n\trenderPresets(presets: Preset[]): void {\n\t\tconst library = this.get(\"presetLibrary\");\n\n\t\tif (presets.length === 0) {\n\t\t\tlibrary.innerHTML = '<p class=\"muted\">No saved presets</p>';\n\t\t\treturn;\n\t\t}\n\n\t\tlibrary.innerHTML = presets\n\t\t\t.map(\n\t\t\t\t(preset) => `\n      <div class=\"preset-item\" data-id=\"${escapeHtml(preset.id)}\" draggable=\"true\">\n        <img src=\"${escapeHtml(preset.thumbnail)}\" alt=\"${escapeHtml(preset.name)}\" class=\"preset-thumbnail\">\n        <div class=\"preset-info\">\n          <span class=\"preset-name\">${escapeHtml(preset.name)}</span>\n          <span class=\"preset-size\">${preset.region.width}x${preset.region.height}</span>\n        </div>\n        <button class=\"btn btn-sm btn-danger delete-preset\" title=\"Delete\">√ó</button>\n      </div>\n    `,\n\t\t\t)\n\t\t\t.join(\"\");\n\n\t\t// Set up event listeners\n\t\tlibrary.querySelectorAll(\".preset-item\").forEach((el) => {\n\t\t\tconst id = el.getAttribute(\"data-id\")!;\n\t\t\tconst preset = presets.find((p) => p.id === id)!;\n\n\t\t\t// Click to select/place\n\t\t\tel.addEventListener(\"click\", (e) => {\n\t\t\t\tif (!(e.target as HTMLElement).classList.contains(\"delete-preset\")) {\n\t\t\t\t\tthis.callbacks.onPresetSelect(preset);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Drag to place\n\t\t\tel.addEventListener(\"dragstart\", (e) => {\n\t\t\t\tthis.callbacks.onPresetDragStart(preset, e as DragEvent);\n\t\t\t});\n\n\t\t\t// Delete button\n\t\t\tel.querySelector(\".delete-preset\")?.addEventListener(\"click\", (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tif (confirm(`Delete preset \"${preset.name}\"?`)) {\n\t\t\t\t\tthis.callbacks.onPresetDelete(id);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate updateSpeedDisplay(): void {\n\t\tthis.get(\"speedValue\").textContent = this.stepsPerFrame.toString();\n\t}\n\n\tprivate get<T extends HTMLElement = HTMLElement>(id: string): T {\n\t\tconst el = document.getElementById(id);\n\t\tif (!el) throw new Error(`Element #${id} not found`);\n\t\treturn el as T;\n\t}\n\n\tgetCanvas(): HTMLCanvasElement {\n\t\treturn this.get<HTMLCanvasElement>(\"simulationCanvas\");\n\t}\n\n\tsetGpuAvailable(available: boolean): void {\n\t\tconst toggle = this.get<HTMLInputElement>(\"backendToggle\");\n\t\tconst gpuLabel = this.get(\"gpuLabel\");\n\n\t\ttoggle.disabled = !available;\n\t\tgpuLabel.classList.toggle(\"unavailable\", !available);\n\t\tgpuLabel.title = available ? \"GPU backend\" : \"GPU not available\";\n\t}\n\n\tupdateBackend(backend: BackendType): void {\n\t\tconst toggle = this.get<HTMLInputElement>(\"backendToggle\");\n\t\tconst cpuLabel = this.get(\"cpuLabel\");\n\t\tconst gpuLabel = this.get(\"gpuLabel\");\n\n\t\ttoggle.checked = backend === \"gpu\";\n\t\tcpuLabel.classList.toggle(\"active\", backend === \"cpu\");\n\t\tgpuLabel.classList.toggle(\"active\", backend === \"gpu\");\n\t}\n\n\tupdateBrushSize(size: number): void {\n\t\tconst slider = this.get<HTMLInputElement>(\"brushSizeSlider\");\n\t\tconst label = this.get(\"brushSizeValue\");\n\t\tslider.value = size.toString();\n\t\tlabel.textContent = size.toString();\n\t}\n}\n",
    "// Flow Lenia Interactive Web Viewer - Main Entry Point\n\nimport { InteractionHandler } from \"./interaction\";\nimport { PresetManager } from \"./presets\";\nimport { Renderer } from \"./renderer\";\nimport { SimulationManager } from \"./simulation\";\nimport type {\n\tBackendType,\n\tInteractionMode,\n\tPreset,\n\tSeed,\n\tSimulationConfig,\n\tViewerSettings,\n} from \"./types\";\nimport { UI } from \"./ui\";\n\n// Default configuration\nconst DEFAULT_CONFIG: SimulationConfig = {\n\twidth: 128,\n\theight: 128,\n\tchannels: 1,\n\tdt: 0.05,\n\tkernel_radius: 13,\n\tkernels: [\n\t\t{\n\t\t\tradius: 1.0,\n\t\t\trings: [{ amplitude: 1.0, distance: 0.5, width: 0.15 }],\n\t\t\tweight: 1.0,\n\t\t\tmu: 0.15,\n\t\t\tsigma: 0.015,\n\t\t\tsource_channel: 0,\n\t\t\ttarget_channel: 0,\n\t\t},\n\t],\n\tflow: {\n\t\tbeta_a: 2.0,\n\t\tn: 4.0,\n\t\tdistribution_size: 0.5,\n\t},\n};\n\nconst DEFAULT_SEED: Seed = {\n\tpattern: {\n\t\ttype: \"GaussianBlob\",\n\t\tcenter: [0.5, 0.5],\n\t\tradius: 0.1,\n\t\tamplitude: 1.0,\n\t\tchannel: 0,\n\t},\n};\n\nclass FlowLeniaViewer {\n\tprivate simulation: SimulationManager;\n\tprivate renderer!: Renderer;\n\tprivate interaction!: InteractionHandler;\n\tprivate presetManager: PresetManager;\n\tprivate ui!: UI;\n\n\tprivate settings: ViewerSettings = {\n\t\tcolorScheme: \"grayscale\",\n\t\tshowGrid: false,\n\t\tshowSelection: true,\n\t\tbrushSize: 3,\n\t\tbrushIntensity: 0.5,\n\t\tbackend: \"cpu\",\n\t};\n\n\tprivate isPlaying = false;\n\tprivate stepsPerFrame = 1;\n\tprivate animationFrameId: number | null = null;\n\tprivate frameCount = 0;\n\tprivate fpsUpdateTime = 0;\n\tprivate currentFps = 0;\n\n\tconstructor() {\n\t\tthis.simulation = new SimulationManager(DEFAULT_CONFIG, DEFAULT_SEED);\n\t\tthis.presetManager = new PresetManager();\n\t}\n\n\tasync initialize(): Promise<void> {\n\t\tconst container = document.getElementById(\"app\");\n\t\tif (!container) throw new Error(\"App container not found\");\n\n\t\t// Show loading state\n\t\tcontainer.innerHTML = '<div class=\"loading\">Loading WebAssembly module...</div>';\n\n\t\ttry {\n\t\t\t// Initialize WASM\n\t\t\tawait this.simulation.initialize();\n\n\t\t\t// Build UI\n\t\t\tthis.ui = new UI(container, {\n\t\t\t\tonPlay: () => this.play(),\n\t\t\t\tonPause: () => this.pause(),\n\t\t\t\tonStep: () => this.step(),\n\t\t\t\tonReset: (seed) => this.reset(seed),\n\t\t\t\tonSpeedChange: (speed) => {\n\t\t\t\t\tthis.stepsPerFrame = speed;\n\t\t\t\t},\n\t\t\t\tonModeChange: (mode) => this.setMode(mode),\n\t\t\t\tonSettingsChange: (settings) => this.updateSettings(settings),\n\t\t\t\tonSaveSelection: (name) => this.saveSelection(name),\n\t\t\t\tonPresetSelect: (preset) => this.selectPreset(preset),\n\t\t\t\tonPresetDelete: (id) => this.deletePreset(id),\n\t\t\t\tonPresetDragStart: (preset, event) => this.startPresetDrag(preset, event),\n\t\t\t\tonExportPresets: () => this.exportPresets(),\n\t\t\t\tonImportPresets: (json) => this.importPresets(json),\n\t\t\t\tonBrushSizeChange: (size) => {\n\t\t\t\t\tthis.settings.brushSize = size;\n\t\t\t\t\tthis.interaction.setBrushSize(size);\n\t\t\t\t},\n\t\t\t\tonBrushIntensityChange: (intensity) => {\n\t\t\t\t\tthis.settings.brushIntensity = intensity;\n\t\t\t\t\tthis.interaction.setBrushIntensity(intensity);\n\t\t\t\t},\n\t\t\t\tonBackendChange: (backend) => this.switchBackend(backend),\n\t\t\t});\n\n\t\t\t// Initialize renderer\n\t\t\tconst canvas = this.ui.getCanvas();\n\t\t\tthis.renderer = new Renderer(canvas, this.settings);\n\n\t\t\t// Initialize interaction handler\n\t\t\tthis.interaction = new InteractionHandler(canvas, this.simulation, this.renderer, {\n\t\t\t\tonSelectionChange: (selection) => {\n\t\t\t\t\tif (selection) {\n\t\t\t\t\t\tconst width = Math.abs(selection.endX - selection.startX);\n\t\t\t\t\t\tconst height = Math.abs(selection.endY - selection.startY);\n\t\t\t\t\t\tthis.ui.updateSelection(width > 0 && height > 0, width, height);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.ui.updateSelection(false);\n\t\t\t\t\t}\n\t\t\t\t\t// Re-render to show selection rectangle\n\t\t\t\t\tthis.render();\n\t\t\t\t},\n\t\t\t\tonSelectionComplete: (_selection) => {\n\t\t\t\t\t// Selection is complete, user can now save it\n\t\t\t\t},\n\t\t\t\tonDrop: (preset, x, y) => {\n\t\t\t\t\tthis.simulation.placeRegion(preset.region, x, y);\n\t\t\t\t\tthis.render();\n\t\t\t\t},\n\t\t\t\tonDraw: (x, y) => {\n\t\t\t\t\tthis.simulation.drawAt(x, y, this.settings.brushSize, this.settings.brushIntensity);\n\t\t\t\t\tthis.render();\n\t\t\t\t},\n\t\t\t\tonErase: (x, y) => {\n\t\t\t\t\tthis.simulation.eraseAt(x, y, this.settings.brushSize);\n\t\t\t\t\tthis.render();\n\t\t\t\t},\n\t\t\t\tonModeChange: (mode) => {\n\t\t\t\t\t// Sync UI buttons when mode changes via keyboard shortcuts\n\t\t\t\t\t// Use updateModeDisplay to avoid triggering callback loop\n\t\t\t\t\tthis.ui.updateModeDisplay(mode);\n\t\t\t\t},\n\t\t\t\tonBrushSizeChange: (size) => {\n\t\t\t\t\t// Sync UI slider when brush size changes via keyboard shortcuts\n\t\t\t\t\tthis.settings.brushSize = size;\n\t\t\t\t\tthis.ui.updateBrushSize(size);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\t// Subscribe to preset changes\n\t\t\tthis.presetManager.subscribe((presets) => {\n\t\t\t\tthis.ui.renderPresets(presets);\n\t\t\t});\n\n\t\t\t// Set up backend toggle based on GPU availability\n\t\t\tthis.ui.setGpuAvailable(this.simulation.isGpuAvailable());\n\t\t\tthis.ui.updateBackend(this.simulation.getBackend());\n\t\t\tthis.settings.backend = this.simulation.getBackend();\n\n\t\t\t// Initial render\n\t\t\tthis.ui.renderPresets(this.presetManager.getAllPresets());\n\t\t\tthis.render();\n\t\t\tthis.updateStats();\n\n\t\t\tconsole.log(\"Flow Lenia Viewer initialized successfully\");\n\t\t} catch (error) {\n\t\t\tcontainer.innerHTML = `\n        <div class=\"error\">\n          <h2>Initialization Error</h2>\n          <p>${error}</p>\n          <p>Make sure WASM is built: <code>wasm-pack build --target web --release</code></p>\n        </div>\n      `;\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate play(): void {\n\t\tif (this.isPlaying) return;\n\t\tthis.isPlaying = true;\n\t\tthis.fpsUpdateTime = performance.now();\n\t\tthis.frameCount = 0;\n\t\tthis.animate(this.fpsUpdateTime);\n\t}\n\n\tprivate pause(): void {\n\t\tthis.isPlaying = false;\n\t\tif (this.animationFrameId !== null) {\n\t\t\tcancelAnimationFrame(this.animationFrameId);\n\t\t\tthis.animationFrameId = null;\n\t\t}\n\t}\n\n\tprivate async step(): Promise<void> {\n\t\tawait this.simulation.step();\n\t\tthis.render();\n\t\tthis.updateStats();\n\t}\n\n\tprivate reset(seed?: Seed): void {\n\t\tthis.simulation.reset(seed);\n\t\tthis.render();\n\t\tthis.updateStats();\n\t}\n\n\tprivate async animate(currentTime: number): Promise<void> {\n\t\tif (!this.isPlaying) return;\n\n\t\tawait this.simulation.run(this.stepsPerFrame);\n\t\tthis.render();\n\t\tthis.updateStats();\n\n\t\t// FPS calculation\n\t\tthis.frameCount++;\n\t\tif (currentTime - this.fpsUpdateTime >= 1000) {\n\t\t\tthis.currentFps = this.frameCount;\n\t\t\tthis.frameCount = 0;\n\t\t\tthis.fpsUpdateTime = currentTime;\n\t\t}\n\n\t\tthis.animationFrameId = requestAnimationFrame((t) => this.animate(t));\n\t}\n\n\tprivate render(): void {\n\t\tconst state = this.simulation.getState();\n\t\tconst selection = this.interaction.getSelection();\n\t\tconst ghostPreview = this.interaction.getGhostPreview();\n\t\tthis.renderer.render(state, selection, ghostPreview);\n\t}\n\n\tprivate updateStats(): void {\n\t\tthis.ui.updateStats(\n\t\t\tthis.simulation.getStep(),\n\t\t\tthis.simulation.getTime(),\n\t\t\tthis.simulation.totalMass(),\n\t\t\tthis.currentFps,\n\t\t);\n\t}\n\n\tprivate setMode(mode: InteractionMode): void {\n\t\tthis.interaction.setMode(mode);\n\t\tif (mode !== \"select\") {\n\t\t\tthis.interaction.clearSelection();\n\t\t\tthis.ui.updateSelection(false);\n\t\t}\n\t}\n\n\tprivate updateSettings(settings: Partial<ViewerSettings>): void {\n\t\tthis.settings = { ...this.settings, ...settings };\n\t\tthis.renderer.updateSettings(settings);\n\t\tthis.render();\n\t}\n\n\tprivate async switchBackend(backend: BackendType): Promise<void> {\n\t\tconst success = await this.simulation.switchBackend(backend);\n\t\tif (success) {\n\t\t\tthis.settings.backend = backend;\n\t\t\tthis.ui.updateBackend(backend);\n\t\t\tconsole.log(`Switched to ${backend.toUpperCase()} backend`);\n\t\t} else {\n\t\t\t// Revert toggle if switch failed\n\t\t\tthis.ui.updateBackend(this.simulation.getBackend());\n\t\t\tconsole.warn(`Failed to switch to ${backend} backend`);\n\t\t}\n\t}\n\n\tprivate saveSelection(name: string): void {\n\t\tconst selection = this.interaction.getSelection();\n\t\tif (!selection) return;\n\n\t\tconst x = Math.min(selection.startX, selection.endX);\n\t\tconst y = Math.min(selection.startY, selection.endY);\n\t\tconst width = Math.abs(selection.endX - selection.startX);\n\t\tconst height = Math.abs(selection.endY - selection.startY);\n\n\t\tif (width <= 0 || height <= 0) return;\n\n\t\tconst region = this.simulation.extractRegion(x, y, width, height);\n\t\tthis.presetManager.savePreset(name, region);\n\n\t\t// Clear selection after saving\n\t\tthis.interaction.clearSelection();\n\t\tthis.ui.updateSelection(false);\n\t}\n\n\tprivate selectPreset(preset: Preset): void {\n\t\t// Place preset at center of simulation\n\t\tconst centerX = Math.floor((this.simulation.getWidth() - preset.region.width) / 2);\n\t\tconst centerY = Math.floor((this.simulation.getHeight() - preset.region.height) / 2);\n\t\tthis.simulation.placeRegion(preset.region, centerX, centerY);\n\t\tthis.render();\n\t}\n\n\tprivate deletePreset(id: string): void {\n\t\tthis.presetManager.deletePreset(id);\n\t}\n\n\tprivate startPresetDrag(preset: Preset, event: DragEvent): void {\n\t\tevent.dataTransfer!.effectAllowed = \"copy\";\n\t\tevent.dataTransfer!.setData(\"text/plain\", preset.id);\n\t\tthis.interaction.startDragFromLibrary(preset, event);\n\t}\n\n\tprivate exportPresets(): void {\n\t\tconst json = this.presetManager.exportPresets();\n\t\tconst blob = new Blob([json], { type: \"application/json\" });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement(\"a\");\n\t\ta.href = url;\n\t\ta.download = \"flow-lenia-presets.json\";\n\t\ta.click();\n\t\tURL.revokeObjectURL(url);\n\t}\n\n\tprivate importPresets(json: string): void {\n\t\ttry {\n\t\t\tconst count = this.presetManager.importPresets(json);\n\t\t\talert(`Imported ${count} preset(s)`);\n\t\t} catch (error) {\n\t\t\talert(`Failed to import presets: ${error}`);\n\t\t}\n\t}\n}\n\n// Start the application\nconst viewer = new FlowLeniaViewer();\nviewer.initialize().catch(console.error);\n"
  ],
  "mappings": "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",
  "debugId": "D48C031AC06269AA64756E2164756E21",
  "names": []
}