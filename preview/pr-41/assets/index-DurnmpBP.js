(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();const pn=!1;var kn=Array.isArray,$i=Array.prototype.indexOf,Ws=Array.from,Dr=Object.defineProperty,Zt=Object.getOwnPropertyDescriptor,Or=Object.getOwnPropertyDescriptors,Ii=Object.prototype,Ai=Array.prototype,$n=Object.getPrototypeOf,pr=Object.isExtensible;const it=()=>{};function Pi(e){return e()}function zs(e){for(var t=0;t<e.length;t++)e[t]()}function Lr(){var e,t,s=new Promise((n,r)=>{e=n,t=r});return{promise:s,resolve:e,reject:t}}const ve=2,In=4,Hs=8,Di=1<<24,ut=16,ft=32,Ft=64,Vs=128,qe=512,ce=1024,Ce=2048,je=4096,Pe=8192,ot=16384,An=32768,Dt=65536,gr=1<<17,Rr=1<<18,rs=1<<19,Nr=1<<20,at=1<<25,Ot=32768,gn=1<<21,Pn=1<<22,yt=1<<23,lt=Symbol("$state"),Oi=Symbol("legacy props"),Li=Symbol(""),Kt=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Fr(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Ri(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ni(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Fi(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Gi(e){throw new Error("https://svelte.dev/e/effect_orphan")}function zi(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Bi(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Yi(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ui(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Xi(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function qi(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const ji=1,Wi=2,Gr=4,Hi=8,Vi=16,Ki=1,Ji=2,Zi=4,Qi=8,eo=16,to=1,so=2,pe=Symbol(),no="http://www.w3.org/1999/xhtml";function ro(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function ao(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function zr(e){return e===this.v}function Br(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Yr(e){return!Br(e,this.v)}let as=!1,io=!1;function oo(){as=!0}let ee=null;function Qt(e){ee=e}function vt(e,t=!1,s){ee={p:ee,i:!1,c:null,e:null,s:e,x:null,l:as&&!t?{s:null,u:null,$:[]}:null}}function dt(e){var t=ee,s=t.e;if(s!==null){t.e=null;for(var n of s)ra(n)}return t.i=!0,ee=t.p,{}}function Es(){return!as||ee!==null&&ee.l===null}let kt=[];function Ur(){var e=kt;kt=[],zs(e)}function is(e){if(kt.length===0&&!ds){var t=kt;queueMicrotask(()=>{t===kt&&Ur()})}kt.push(e)}function lo(){for(;kt.length>0;)Ur()}function Xr(e){var t=q;if(t===null)return Y.f|=yt,e;if((t.f&An)===0){if((t.f&Vs)===0)throw e;t.b.error(e)}else es(e,t)}function es(e,t){for(;t!==null;){if((t.f&Vs)!==0)try{t.b.error(e);return}catch(s){e=s}t=t.parent}throw e}const Ds=new Set;let U=null,vs=null,Fe=null,Le=[],Ks=null,_n=!1,ds=!1;class Je{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#s=0;#l=null;#a=new Set;#r=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(t){Le=[],vs=null,this.apply();var s={parent:null,effect:null,effects:[],render_effects:[]};for(const n of t)this.#i(n,s);this.is_fork||this.#u(),this.is_deferred()?(this.#o(s.effects),this.#o(s.render_effects)):(vs=this,U=null,_r(s.render_effects),_r(s.effects),vs=null,this.#l?.resolve()),Fe=null}#i(t,s){t.f^=ce;for(var n=t.first;n!==null;){var r=n.f,a=(r&(ft|Ft))!==0,i=a&&(r&ce)!==0,o=i||(r&Pe)!==0||this.skipped_effects.has(n);if((n.f&Vs)!==0&&n.b?.is_pending()&&(s={parent:s,effect:n,effects:[],render_effects:[]}),!o&&n.fn!==null){a?n.f^=ce:(r&In)!==0?s.effects.push(n):os(n)&&((n.f&ut)!==0&&this.#a.add(n),ts(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)c===s.effect&&(this.#o(s.effects),this.#o(s.render_effects),s=s.parent),n=c.next,c=c.parent}}#o(t){for(const s of t)(s.f&Ce)!==0?this.#a.add(s):(s.f&je)!==0&&this.#r.add(s),this.#c(s.deps),fe(s,ce)}#c(t){if(t!==null)for(const s of t)(s.f&ve)===0||(s.f&Ot)===0||(s.f^=Ot,this.#c(s.deps))}capture(t,s){this.previous.has(t)||this.previous.set(t,s),(t.f&yt)===0&&(this.current.set(t,t.v),Fe?.set(t,t.v))}activate(){U=this,this.apply()}deactivate(){U===this&&(U=null,Fe=null)}flush(){if(this.activate(),Le.length>0){if(qr(),U!==null&&U!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const t of this.#t)t(this);this.#t.clear()}#u(){if(this.#s===0){for(const t of this.#e)t();this.#e.clear()}this.#n===0&&this.#f()}#f(){if(Ds.size>1){this.previous.clear();var t=Fe,s=!0,n={parent:null,effect:null,effects:[],render_effects:[]};for(const a of Ds){if(a===this){s=!1;continue}const i=[];for(const[l,c]of this.current){if(a.current.has(l))if(s&&c!==a.current.get(l))a.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...a.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Le;Le=[];const l=new Set,c=new Map;for(const u of i)jr(u,o,l,c);if(Le.length>0){U=a,a.apply();for(const u of Le)a.#i(u,n);a.deactivate()}Le=r}}U=null,Fe=t}this.committed=!0,Ds.delete(this)}increment(t){this.#n+=1,t&&(this.#s+=1)}decrement(t){this.#n-=1,t&&(this.#s-=1),this.revive()}revive(){for(const t of this.#a)this.#r.delete(t),fe(t,Ce),Lt(t);for(const t of this.#r)fe(t,je),Lt(t);this.flush()}oncommit(t){this.#e.add(t)}ondiscard(t){this.#t.add(t)}settled(){return(this.#l??=Lr()).promise}static ensure(){if(U===null){const t=U=new Je;Ds.add(U),ds||Je.enqueue(()=>{U===t&&t.flush()})}return U}static enqueue(t){is(t)}apply(){}}function co(e){var t=ds;ds=!0;try{for(var s;;){if(lo(),Le.length===0&&(U?.flush(),Le.length===0))return Ks=null,s;qr()}}finally{ds=t}}function qr(){var e=At;_n=!0;var t=null;try{var s=0;for(Ys(!0);Le.length>0;){var n=Je.ensure();if(s++>1e3){var r,a;uo()}n.process(Le),xt.clear()}}finally{_n=!1,Ys(e),Ks=null}}function uo(){try{zi()}catch(e){es(e,Ks)}}let st=null;function _r(e){var t=e.length;if(t!==0){for(var s=0;s<t;){var n=e[s++];if((n.f&(ot|Pe))===0&&os(n)&&(st=new Set,ts(n),n.deps===null&&n.first===null&&n.nodes===null&&(n.teardown===null&&n.ac===null?ca(n):n.fn=null),st?.size>0)){xt.clear();for(const r of st){if((r.f&(ot|Pe))!==0)continue;const a=[r];let i=r.parent;for(;i!==null;)st.has(i)&&(st.delete(i),a.push(i)),i=i.parent;for(let o=a.length-1;o>=0;o--){const l=a[o];(l.f&(ot|Pe))===0&&ts(l)}}st.clear()}}st=null}}function jr(e,t,s,n){if(!s.has(e)&&(s.add(e),e.reactions!==null))for(const r of e.reactions){const a=r.f;(a&ve)!==0?jr(r,t,s,n):(a&(Pn|ut))!==0&&(a&Ce)===0&&Wr(r,t,n)&&(fe(r,Ce),Lt(r))}}function Wr(e,t,s){const n=s.get(e);if(n!==void 0)return n;if(e.deps!==null)for(const r of e.deps){if(t.includes(r))return!0;if((r.f&ve)!==0&&Wr(r,t,s))return s.set(r,!0),!0}return s.set(e,!1),!1}function Lt(e){for(var t=Ks=e;t.parent!==null;){t=t.parent;var s=t.f;if(_n&&t===q&&(s&ut)!==0&&(s&Rr)===0)return;if((s&(Ft|ft))!==0){if((s&ce)===0)return;t.f^=ce}}Le.push(t)}function fo(e){let t=0,s=Rt(0),n;return()=>{ms()&&(f(s),Cs(()=>(t===0&&(n=F(()=>e(()=>hs(s)))),t+=1,()=>{is(()=>{t-=1,t===0&&(n?.(),n=void 0,hs(s))})})))}}var vo=Dt|rs|Vs;function ho(e,t,s){new po(e,t,s)}class po{parent;#e=!1;#t;#n=null;#s;#l;#a;#r=null;#i=null;#o=null;#c=null;#u=null;#f=0;#v=0;#h=!1;#d=null;#b=fo(()=>(this.#d=Rt(this.#f),()=>{this.#d=null}));constructor(t,s,n){this.#t=t,this.#s=s,this.#l=n,this.parent=q.b,this.#e=!!this.#s.pending,this.#a=en(()=>{q.b=this;{var r=this.#_();try{this.#r=Re(()=>n(r))}catch(a){this.error(a)}this.#v>0?this.#g():this.#e=!1}return()=>{this.#u?.remove()}},vo)}#w(){try{this.#r=Re(()=>this.#l(this.#t))}catch(t){this.error(t)}this.#e=!1}#y(){const t=this.#s.pending;t&&(this.#i=Re(()=>t(this.#t)),Je.enqueue(()=>{var s=this.#_();this.#r=this.#p(()=>(Je.ensure(),Re(()=>this.#l(s)))),this.#v>0?this.#g():(It(this.#i,()=>{this.#i=null}),this.#e=!1)}))}#_(){var t=this.#t;return this.#e&&(this.#u=St(),this.#t.before(this.#u),t=this.#u),t}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#s.pending}#p(t){var s=q,n=Y,r=ee;Qe(this.#a),Me(this.#a),Qt(this.#a.ctx);try{return t()}catch(a){return Xr(a),null}finally{Qe(s),Me(n),Qt(r)}}#g(){const t=this.#s.pending;this.#r!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#u),va(this.#r,this.#c)),this.#i===null&&(this.#i=Re(()=>t(this.#t)))}#m(t){if(!this.has_pending_snippet()){this.parent&&this.parent.#m(t);return}this.#v+=t,this.#v===0&&(this.#e=!1,this.#i&&It(this.#i,()=>{this.#i=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(t){this.#m(t),this.#f+=t,this.#d&&Nt(this.#d,this.#f)}get_effect_pending(){return this.#b(),f(this.#d)}error(t){var s=this.#s.onerror;let n=this.#s.failed;if(this.#h||!s&&!n)throw t;this.#r&&(Te(this.#r),this.#r=null),this.#i&&(Te(this.#i),this.#i=null),this.#o&&(Te(this.#o),this.#o=null);var r=!1,a=!1;const i=()=>{if(r){ao();return}r=!0,a&&qi(),Je.ensure(),this.#f=0,this.#o!==null&&It(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#r=this.#p(()=>(this.#h=!1,Re(()=>this.#l(this.#t)))),this.#v>0?this.#g():this.#e=!1};var o=Y;try{Me(null),a=!0,s?.(t,i),a=!1}catch(l){es(l,this.#a&&this.#a.parent)}finally{Me(o)}n&&is(()=>{this.#o=this.#p(()=>{Je.ensure(),this.#h=!0;try{return Re(()=>{n(this.#t,()=>t,()=>i)})}catch(l){return es(l,this.#a.parent),null}finally{this.#h=!1}})})}}function go(e,t,s,n){const r=Es()?Ms:Dn;if(s.length===0&&e.length===0){n(t.map(r));return}var a=U,i=q,o=_o();function l(){Promise.all(s.map(c=>mo(c))).then(c=>{o();try{n([...t.map(r),...c])}catch(u){(i.f&ot)===0&&es(u,i)}a?.deactivate(),Bs()}).catch(c=>{es(c,i)})}e.length>0?Promise.all(e).then(()=>{o();try{return l()}finally{a?.deactivate(),Bs()}}):l()}function _o(){var e=q,t=Y,s=ee,n=U;return function(a=!0){Qe(e),Me(t),Qt(s),a&&n?.activate()}}function Bs(){Qe(null),Me(null),Qt(null)}function Ms(e){var t=ve|Ce,s=Y!==null&&(Y.f&ve)!==0?Y:null;return q!==null&&(q.f|=rs),{ctx:ee,deps:null,effects:null,equals:zr,f:t,fn:e,reactions:null,rv:0,v:pe,wv:0,parent:s??q,ac:null}}function mo(e,t){let s=q;s===null&&Ri();var n=s.b,r=void 0,a=Rt(pe),i=!Y,o=new Map;return Io(()=>{var l=Lr();r=l.promise;try{Promise.resolve(e()).then(l.resolve,l.reject).then(()=>{c===U&&c.committed&&c.deactivate(),Bs()})}catch(d){l.reject(d),Bs()}var c=U;if(i){var u=!n.is_pending();n.update_pending_count(1),c.increment(u),o.get(c)?.reject(Kt),o.delete(c),o.set(c,l)}const g=(d,p=void 0)=>{if(c.activate(),p)p!==Kt&&(a.f|=yt,Nt(a,p));else{(a.f&yt)!==0&&(a.f^=yt),Nt(a,d);for(const[b,E]of o){if(o.delete(b),b===c)break;E.reject(Kt)}}i&&(n.update_pending_count(-1),c.decrement(u))};l.promise.then(g,d=>g(null,d||"unknown"))}),Zs(()=>{for(const l of o.values())l.reject(Kt)}),new Promise(l=>{function c(u){function g(){u===r?l(a):c(r)}u.then(g,g)}c(r)})}function bo(e){const t=Ms(e);return da(t),t}function Dn(e){const t=Ms(e);return t.equals=Yr,t}function Hr(e){var t=e.effects;if(t!==null){e.effects=null;for(var s=0;s<t.length;s+=1)Te(t[s])}}function wo(e){for(var t=e.parent;t!==null;){if((t.f&ve)===0)return(t.f&ot)===0?t:null;t=t.parent}return null}function On(e){var t,s=q;Qe(wo(e));try{e.f&=~Ot,Hr(e),t=_a(e)}finally{Qe(s)}return t}function Vr(e){var t=On(e);if(e.equals(t)||(U?.is_fork||(e.v=t),e.wv=pa()),!Gt)if(Fe!==null)(ms()||U?.is_fork)&&Fe.set(e,t);else{var s=(e.f&qe)===0?je:ce;fe(e,s)}}let mn=new Set;const xt=new Map;let Kr=!1;function Rt(e,t){var s={f:0,v:e,reactions:null,equals:zr,rv:0,wv:0};return s}function Se(e,t){const s=Rt(e);return da(s),s}function oe(e,t=!1,s=!0){const n=Rt(e);return t||(n.equals=Yr),as&&s&&ee!==null&&ee.l!==null&&(ee.l.s??=[]).push(n),n}function yo(e,t){return z(e,F(()=>f(e))),t}function z(e,t,s=!1){Y!==null&&(!Ze||(Y.f&gr)!==0)&&Es()&&(Y.f&(ve|ut|Pn|gr))!==0&&!ct?.includes(e)&&Xi();let n=s?Jt(t):t;return Nt(e,n)}function Nt(e,t){if(!e.equals(t)){var s=e.v;Gt?xt.set(e,t):xt.set(e,s),e.v=t;var n=Je.ensure();n.capture(e,s),(e.f&ve)!==0&&((e.f&Ce)!==0&&On(e),fe(e,(e.f&qe)!==0?ce:je)),e.wv=pa(),Jr(e,Ce),Es()&&q!==null&&(q.f&ce)!==0&&(q.f&(ft|Ft))===0&&(Oe===null?Oo([e]):Oe.push(e)),!n.is_fork&&mn.size>0&&!Kr&&xo()}return t}function xo(){Kr=!1;var e=At;Ys(!0);const t=Array.from(mn);try{for(const s of t)(s.f&ce)!==0&&fe(s,je),os(s)&&ts(s)}finally{Ys(e)}mn.clear()}function hs(e){z(e,e.v+1)}function Jr(e,t){var s=e.reactions;if(s!==null)for(var n=Es(),r=s.length,a=0;a<r;a++){var i=s[a],o=i.f;if(!(!n&&i===q)){var l=(o&Ce)===0;if(l&&fe(i,t),(o&ve)!==0){var c=i;Fe?.delete(c),(o&Ot)===0&&(o&qe&&(i.f|=Ot),Jr(c,je))}else l&&((o&ut)!==0&&st!==null&&st.add(i),Lt(i))}}}function Jt(e){if(typeof e!="object"||e===null||lt in e)return e;const t=$n(e);if(t!==Ii&&t!==Ai)return e;var s=new Map,n=kn(e),r=Se(0),a=Pt,i=o=>{if(Pt===a)return o();var l=Y,c=Pt;Me(null),xr(a);var u=o();return Me(l),xr(c),u};return n&&s.set("length",Se(e.length)),new Proxy(e,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Yi();var u=s.get(l);return u===void 0?u=i(()=>{var g=Se(c.value);return s.set(l,g),g}):z(u,c.value,!0),!0},deleteProperty(o,l){var c=s.get(l);if(c===void 0){if(l in o){const u=i(()=>Se(pe));s.set(l,u),hs(r)}}else z(c,pe),hs(r);return!0},get(o,l,c){if(l===lt)return e;var u=s.get(l),g=l in o;if(u===void 0&&(!g||Zt(o,l)?.writable)&&(u=i(()=>{var p=Jt(g?o[l]:pe),b=Se(p);return b}),s.set(l,u)),u!==void 0){var d=f(u);return d===pe?void 0:d}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var u=s.get(l);u&&(c.value=f(u))}else if(c===void 0){var g=s.get(l),d=g?.v;if(g!==void 0&&d!==pe)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return c},has(o,l){if(l===lt)return!0;var c=s.get(l),u=c!==void 0&&c.v!==pe||Reflect.has(o,l);if(c!==void 0||q!==null&&(!u||Zt(o,l)?.writable)){c===void 0&&(c=i(()=>{var d=u?Jt(o[l]):pe,p=Se(d);return p}),s.set(l,c));var g=f(c);if(g===pe)return!1}return u},set(o,l,c,u){var g=s.get(l),d=l in o;if(n&&l==="length")for(var p=c;p<g.v;p+=1){var b=s.get(p+"");b!==void 0?z(b,pe):p in o&&(b=i(()=>Se(pe)),s.set(p+"",b))}if(g===void 0)(!d||Zt(o,l)?.writable)&&(g=i(()=>Se(void 0)),z(g,Jt(c)),s.set(l,g));else{d=g.v!==pe;var E=i(()=>Jt(c));z(g,E)}var _=Reflect.getOwnPropertyDescriptor(o,l);if(_?.set&&_.set.call(u,c),!d){if(n&&typeof l=="string"){var w=s.get("length"),P=Number(l);Number.isInteger(P)&&P>=w.v&&z(w,P+1)}hs(r)}return!0},ownKeys(o){f(r);var l=Reflect.ownKeys(o).filter(g=>{var d=s.get(g);return d===void 0||d.v!==pe});for(var[c,u]of s)u.v!==pe&&!(c in o)&&l.push(c);return l},setPrototypeOf(){Ui()}})}function mr(e){try{if(e!==null&&typeof e=="object"&&lt in e)return e[lt]}catch{}return e}function So(e,t){return Object.is(mr(e),mr(t))}var br,Zr,Qr,ea;function Eo(){if(br===void 0){br=window,Zr=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,s=Text.prototype;Qr=Zt(t,"firstChild").get,ea=Zt(t,"nextSibling").get,pr(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),pr(s)&&(s.__t=void 0)}}function St(e=""){return document.createTextNode(e)}function bt(e){return Qr.call(e)}function Ts(e){return ea.call(e)}function v(e,t){return bt(e)}function Ee(e,t=!1){{var s=bt(e);return s instanceof Comment&&s.data===""?Ts(s):s}}function h(e,t=1,s=!1){let n=e;for(;t--;)n=Ts(n);return n}function Mo(e){e.textContent=""}function ta(){return!1}let wr=!1;function To(){wr||(wr=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const t of e.target.elements)t.__on_r?.()})},{capture:!0}))}function Js(e){var t=Y,s=q;Me(null),Qe(null);try{return e()}finally{Me(t),Qe(s)}}function sa(e,t,s,n=s){e.addEventListener(t,()=>Js(s));const r=e.__on_r;r?e.__on_r=()=>{r(),n(!0)}:e.__on_r=()=>n(!0),To()}function na(e){q===null&&(Y===null&&Gi(),Fi()),Gt&&Ni()}function Co(e,t){var s=t.last;s===null?t.last=t.first=e:(s.next=e,e.prev=s,t.last=e)}function et(e,t,s){var n=q;n!==null&&(n.f&Pe)!==0&&(e|=Pe);var r={ctx:ee,deps:null,nodes:null,f:e|Ce|qe,first:null,fn:t,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,wv:0,ac:null};if(s)try{ts(r),r.f|=An}catch(o){throw Te(r),o}else t!==null&&Lt(r);var a=r;if(s&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&(a.f&rs)===0&&(a=a.first,(e&ut)!==0&&(e&Dt)!==0&&a!==null&&(a.f|=Dt)),a!==null&&(a.parent=n,n!==null&&Co(a,n),Y!==null&&(Y.f&ve)!==0&&(e&Ft)===0)){var i=Y;(i.effects??=[]).push(a)}return r}function ms(){return Y!==null&&!Ze}function Zs(e){const t=et(Hs,null,!1);return fe(t,ce),t.teardown=e,t}function bs(e){na();var t=q.f,s=!Y&&(t&ft)!==0&&(t&An)===0;if(s){var n=ee;(n.e??=[]).push(e)}else return ra(e)}function ra(e){return et(In|Nr,e,!1)}function ko(e){return na(),et(Hs|Nr,e,!0)}function $o(e){Je.ensure();const t=et(Ft|rs,e,!0);return(s={})=>new Promise(n=>{s.outro?It(t,()=>{Te(t),n(void 0)}):(Te(t),n(void 0))})}function aa(e){return et(In,e,!1)}function nt(e,t){var s=ee,n={effect:null,ran:!1,deps:e};s.l.$.push(n),n.effect=Cs(()=>{e(),!n.ran&&(n.ran=!0,F(t))})}function Qs(){var e=ee;Cs(()=>{for(var t of e.l.$){t.deps();var s=t.effect;(s.f&ce)!==0&&fe(s,je),os(s)&&ts(s),t.ran=!1}})}function Io(e){return et(Pn|rs,e,!0)}function Cs(e,t=0){return et(Hs|t,e,!0)}function G(e,t=[],s=[],n=[]){go(n,t,s,r=>{et(Hs,()=>e(...r.map(f)),!0)})}function en(e,t=0){var s=et(ut|t,e,!0);return s}function Re(e){return et(ft|rs,e,!0)}function ia(e){var t=e.teardown;if(t!==null){const s=Gt,n=Y;yr(!0),Me(null);try{t.call(null)}finally{yr(s),Me(n)}}}function oa(e,t=!1){var s=e.first;for(e.first=e.last=null;s!==null;){const r=s.ac;r!==null&&Js(()=>{r.abort(Kt)});var n=s.next;(s.f&Ft)!==0?s.parent=null:Te(s,t),s=n}}function Ao(e){for(var t=e.first;t!==null;){var s=t.next;(t.f&ft)===0&&Te(t),t=s}}function Te(e,t=!0){var s=!1;(t||(e.f&Rr)!==0)&&e.nodes!==null&&e.nodes.end!==null&&(la(e.nodes.start,e.nodes.end),s=!0),oa(e,t&&!s),Us(e,0),fe(e,ot);var n=e.nodes&&e.nodes.t;if(n!==null)for(const a of n)a.stop();ia(e);var r=e.parent;r!==null&&r.first!==null&&ca(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes=e.ac=null}function la(e,t){for(;e!==null;){var s=e===t?null:Ts(e);e.remove(),e=s}}function ca(e){var t=e.parent,s=e.prev,n=e.next;s!==null&&(s.next=n),n!==null&&(n.prev=s),t!==null&&(t.first===e&&(t.first=n),t.last===e&&(t.last=s))}function It(e,t,s=!0){var n=[];ua(e,n,!0);var r=()=>{s&&Te(e),t&&t()},a=n.length;if(a>0){var i=()=>--a||r();for(var o of n)o.out(i)}else r()}function ua(e,t,s){if((e.f&Pe)===0){e.f^=Pe;var n=e.nodes&&e.nodes.t;if(n!==null)for(const o of n)(o.is_global||s)&&t.push(o);for(var r=e.first;r!==null;){var a=r.next,i=(r.f&Dt)!==0||(r.f&ft)!==0&&(e.f&ut)!==0;ua(r,t,i?s:!1),r=a}}}function Ln(e){fa(e,!0)}function fa(e,t){if((e.f&Pe)!==0){e.f^=Pe,(e.f&ce)===0&&(fe(e,Ce),Lt(e));for(var s=e.first;s!==null;){var n=s.next,r=(s.f&Dt)!==0||(s.f&ft)!==0;fa(s,r?t:!1),s=n}var a=e.nodes&&e.nodes.t;if(a!==null)for(const i of a)(i.is_global||t)&&i.in()}}function va(e,t){if(e.nodes)for(var s=e.nodes.start,n=e.nodes.end;s!==null;){var r=s===n?null:Ts(s);t.append(s),s=r}}let Vt=null;function Po(e){var t=Vt;try{if(Vt=new Set,F(e),t!==null)for(var s of Vt)t.add(s);return Vt}finally{Vt=t}}function Do(e){for(var t of Po(e))Nt(t,t.v)}let At=!1;function Ys(e){At=e}let Gt=!1;function yr(e){Gt=e}let Y=null,Ze=!1;function Me(e){Y=e}let q=null;function Qe(e){q=e}let ct=null;function da(e){Y!==null&&(ct===null?ct=[e]:ct.push(e))}let be=null,Ae=0,Oe=null;function Oo(e){Oe=e}let ha=1,ws=0,Pt=ws;function xr(e){Pt=e}function pa(){return++ha}function os(e){var t=e.f;if((t&Ce)!==0)return!0;if(t&ve&&(e.f&=~Ot),(t&je)!==0){var s=e.deps;if(s!==null)for(var n=s.length,r=0;r<n;r++){var a=s[r];if(os(a)&&Vr(a),a.wv>e.wv)return!0}(t&qe)!==0&&Fe===null&&fe(e,ce)}return!1}function ga(e,t,s=!0){var n=e.reactions;if(n!==null&&!ct?.includes(e))for(var r=0;r<n.length;r++){var a=n[r];(a.f&ve)!==0?ga(a,t,!1):t===a&&(s?fe(a,Ce):(a.f&ce)!==0&&fe(a,je),Lt(a))}}function _a(e){var t=be,s=Ae,n=Oe,r=Y,a=ct,i=ee,o=Ze,l=Pt,c=e.f;be=null,Ae=0,Oe=null,Y=(c&(ft|Ft))===0?e:null,ct=null,Qt(e.ctx),Ze=!1,Pt=++ws,e.ac!==null&&(Js(()=>{e.ac.abort(Kt)}),e.ac=null);try{e.f|=gn;var u=e.fn,g=u(),d=e.deps;if(be!==null){var p;if(Us(e,Ae),d!==null&&Ae>0)for(d.length=Ae+be.length,p=0;p<be.length;p++)d[Ae+p]=be[p];else e.deps=d=be;if(ms()&&(e.f&qe)!==0)for(p=Ae;p<d.length;p++)(d[p].reactions??=[]).push(e)}else d!==null&&Ae<d.length&&(Us(e,Ae),d.length=Ae);if(Es()&&Oe!==null&&!Ze&&d!==null&&(e.f&(ve|je|Ce))===0)for(p=0;p<Oe.length;p++)ga(Oe[p],e);return r!==null&&r!==e&&(ws++,Oe!==null&&(n===null?n=Oe:n.push(...Oe))),(e.f&yt)!==0&&(e.f^=yt),g}catch(b){return Xr(b)}finally{e.f^=gn,be=t,Ae=s,Oe=n,Y=r,ct=a,Qt(i),Ze=o,Pt=l}}function Lo(e,t){let s=t.reactions;if(s!==null){var n=$i.call(s,e);if(n!==-1){var r=s.length-1;r===0?s=t.reactions=null:(s[n]=s[r],s.pop())}}s===null&&(t.f&ve)!==0&&(be===null||!be.includes(t))&&(fe(t,je),(t.f&qe)!==0&&(t.f^=qe,t.f&=~Ot),Hr(t),Us(t,0))}function Us(e,t){var s=e.deps;if(s!==null)for(var n=t;n<s.length;n++)Lo(e,s[n])}function ts(e){var t=e.f;if((t&ot)===0){fe(e,ce);var s=q,n=At;q=e,At=!0;try{(t&(ut|Di))!==0?Ao(e):oa(e),ia(e);var r=_a(e);e.teardown=typeof r=="function"?r:null,e.wv=ha;var a;pn&&io&&(e.f&Ce)!==0&&e.deps}finally{At=n,q=s}}}async function Ro(){await Promise.resolve(),co()}function f(e){var t=e.f,s=(t&ve)!==0;if(Vt?.add(e),Y!==null&&!Ze){var n=q!==null&&(q.f&ot)!==0;if(!n&&!ct?.includes(e)){var r=Y.deps;if((Y.f&gn)!==0)e.rv<ws&&(e.rv=ws,be===null&&r!==null&&r[Ae]===e?Ae++:be===null?be=[e]:be.includes(e)||be.push(e));else{(Y.deps??=[]).push(e);var a=e.reactions;a===null?e.reactions=[Y]:a.includes(Y)||a.push(Y)}}}if(Gt){if(xt.has(e))return xt.get(e);if(s){var i=e,o=i.v;return((i.f&ce)===0&&i.reactions!==null||ba(i))&&(o=On(i)),xt.set(i,o),o}}else s&&(!Fe?.has(e)||U?.is_fork&&!ms())&&(i=e,os(i)&&Vr(i),At&&ms()&&(i.f&qe)===0&&ma(i));if(Fe?.has(e))return Fe.get(e);if((e.f&yt)!==0)throw e.v;return e.v}function ma(e){if(e.deps!==null){e.f^=qe;for(const t of e.deps)(t.reactions??=[]).push(e),(t.f&ve)!==0&&(t.f&qe)===0&&ma(t)}}function ba(e){if(e.v===pe)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(xt.has(t)||(t.f&ve)!==0&&ba(t))return!0;return!1}function F(e){var t=Ze;try{return Ze=!0,e()}finally{Ze=t}}const No=-7169;function fe(e,t){e.f=e.f&No|t}function Fo(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(lt in e)bn(e);else if(!Array.isArray(e))for(let t in e){const s=e[t];typeof s=="object"&&s&&lt in s&&bn(s)}}}function bn(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let n in e)try{bn(e[n],t)}catch{}const s=$n(e);if(s!==Object.prototype&&s!==Array.prototype&&s!==Map.prototype&&s!==Set.prototype&&s!==Date.prototype){const n=Or(s);for(let r in n){const a=n[r].get;if(a)try{a.call(e)}catch{}}}}}const Go=["touchstart","touchmove"];function zo(e){return Go.includes(e)}const wa=new Set,wn=new Set;function Bo(e,t,s,n={}){function r(a){if(n.capture||us.call(t,a),!a.cancelBubble)return Js(()=>s?.call(this,a))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?is(()=>{t.addEventListener(e,r,n)}):t.addEventListener(e,r,n),r}function ya(e,t,s,n,r){var a={capture:n,passive:r},i=Bo(e,t,s,a);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&Zs(()=>{t.removeEventListener(e,i,a)})}function ls(e){for(var t=0;t<e.length;t++)wa.add(e[t]);for(var s of wn)s(e)}let Sr=null;function us(e){var t=this,s=t.ownerDocument,n=e.type,r=e.composedPath?.()||[],a=r[0]||e.target;Sr=e;var i=0,o=Sr===e&&e.__root;if(o){var l=r.indexOf(o);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var c=r.indexOf(t);if(c===-1)return;l<=c&&(i=l)}if(a=r[i]||e.target,a!==t){Dr(e,"currentTarget",{configurable:!0,get(){return a||s}});var u=Y,g=q;Me(null),Qe(null);try{for(var d,p=[];a!==null;){var b=a.assignedSlot||a.parentNode||a.host||null;try{var E=a["__"+n];E!=null&&(!a.disabled||e.target===a)&&E.call(a,e)}catch(_){d?p.push(_):d=_}if(e.cancelBubble||b===t||b===null)break;a=b}if(d){for(let _ of p)queueMicrotask(()=>{throw _});throw d}}finally{e.__root=t,delete e.currentTarget,Me(u),Qe(g)}}}function xa(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function Xs(e,t){var s=q;s.nodes===null&&(s.nodes={start:e,end:t,a:null,t:null})}function C(e,t){var s=(t&to)!==0,n=(t&so)!==0,r,a=!e.startsWith("<!>");return()=>{r===void 0&&(r=xa(a?e:"<!>"+e),s||(r=bt(r)));var i=n||Zr?document.importNode(r,!0):r.cloneNode(!0);if(s){var o=bt(i),l=i.lastChild;Xs(o,l)}else Xs(i,i);return i}}function qs(){var e=document.createDocumentFragment(),t=document.createComment(""),s=St();return e.append(t,s),Xs(t,s),e}function T(e,t){e!==null&&e.before(t)}function D(e,t){var s=t==null?"":typeof t=="object"?t+"":t;s!==(e.__t??=e.nodeValue)&&(e.__t=s,e.nodeValue=s+"")}function Yo(e,t){return Uo(e,t)}const Wt=new Map;function Uo(e,{target:t,anchor:s,props:n={},events:r,context:a,intro:i=!0}){Eo();var o=new Set,l=g=>{for(var d=0;d<g.length;d++){var p=g[d];if(!o.has(p)){o.add(p);var b=zo(p);t.addEventListener(p,us,{passive:b});var E=Wt.get(p);E===void 0?(document.addEventListener(p,us,{passive:b}),Wt.set(p,1)):Wt.set(p,E+1)}}};l(Ws(wa)),wn.add(l);var c=void 0,u=$o(()=>{var g=s??t.appendChild(St());return ho(g,{pending:()=>{}},d=>{if(a){vt({});var p=ee;p.c=a}r&&(n.$$events=r),c=e(d,n)||{},a&&dt()}),()=>{for(var d of o){t.removeEventListener(d,us);var p=Wt.get(d);--p===0?(document.removeEventListener(d,us),Wt.delete(d)):Wt.set(d,p)}wn.delete(l),g!==s&&g.parentNode?.removeChild(g)}});return Xo.set(c,u),c}let Xo=new WeakMap;class Sa{anchor;#e=new Map;#t=new Map;#n=new Map;#s=new Set;#l=!0;constructor(t,s=!0){this.anchor=t,this.#l=s}#a=()=>{var t=U;if(this.#e.has(t)){var s=this.#e.get(t),n=this.#t.get(s);if(n)Ln(n),this.#s.delete(s);else{var r=this.#n.get(s);r&&(this.#t.set(s,r.effect),this.#n.delete(s),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),n=r.effect)}for(const[a,i]of this.#e){if(this.#e.delete(a),a===t)break;const o=this.#n.get(i);o&&(Te(o.effect),this.#n.delete(i))}for(const[a,i]of this.#t){if(a===s||this.#s.has(a))continue;const o=()=>{if(Array.from(this.#e.values()).includes(a)){var c=document.createDocumentFragment();va(i,c),c.append(St()),this.#n.set(a,{effect:i,fragment:c})}else Te(i);this.#s.delete(a),this.#t.delete(a)};this.#l||!n?(this.#s.add(a),It(i,o,!1)):o()}}};#r=t=>{this.#e.delete(t);const s=Array.from(this.#e.values());for(const[n,r]of this.#n)s.includes(n)||(Te(r.effect),this.#n.delete(n))};ensure(t,s){var n=U,r=ta();if(s&&!this.#t.has(t)&&!this.#n.has(t))if(r){var a=document.createDocumentFragment(),i=St();a.append(i),this.#n.set(t,{effect:Re(()=>s(i)),fragment:a})}else this.#t.set(t,Re(()=>s(this.anchor)));if(this.#e.set(n,t),r){for(const[o,l]of this.#t)o===t?n.skipped_effects.delete(l):n.skipped_effects.add(l);for(const[o,l]of this.#n)o===t?n.skipped_effects.delete(l.effect):n.skipped_effects.add(l.effect);n.oncommit(this.#a),n.ondiscard(this.#r)}else this.#a()}}function Q(e,t,s=!1){var n=new Sa(e),r=s?Dt:0;function a(i,o){n.ensure(i,o)}en(()=>{var i=!1;t((o,l=!0)=>{i=!0,a(l,o)}),i||a(!1,null)},r)}function rt(e,t){return t}function qo(e,t,s){for(var n=[],r=t.length,a,i=t.length,o=0;o<r;o++){let g=t[o];It(g,()=>{if(a){if(a.pending.delete(g),a.done.add(g),a.pending.size===0){var d=e.outrogroups;yn(Ws(a.done)),d.delete(a),d.size===0&&(e.outrogroups=null)}}else i-=1},!1)}if(i===0){var l=n.length===0&&s!==null;if(l){var c=s,u=c.parentNode;Mo(u),u.append(c),e.items.clear()}yn(t,!l)}else a={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(a)}function yn(e,t=!0){for(var s=0;s<e.length;s++)Te(e[s],t)}var Er;function Ue(e,t,s,n,r,a=null){var i=e,o=new Map,l=(t&Gr)!==0;if(l){var c=e;i=c.appendChild(St())}var u=null,g=Dn(()=>{var w=s();return kn(w)?w:w==null?[]:Ws(w)}),d,p=!0;function b(){_.fallback=u,jo(_,d,i,t,n),u!==null&&(d.length===0?(u.f&at)===0?Ln(u):(u.f^=at,fs(u,null,i)):It(u,()=>{u=null}))}var E=en(()=>{d=f(g);for(var w=d.length,P=new Set,k=U,S=ta(),M=0;M<w;M+=1){var I=d[M],y=n(I,M),$=p?null:o.get(y);$?($.v&&Nt($.v,I),$.i&&Nt($.i,M),S&&k.skipped_effects.delete($.e)):($=Wo(o,p?i:Er??=St(),I,y,M,r,t,s),p||($.e.f|=at),o.set(y,$)),P.add(y)}if(w===0&&a&&!u&&(p?u=Re(()=>a(i)):(u=Re(()=>a(Er??=St())),u.f|=at)),!p)if(S){for(const[R,O]of o)P.has(R)||k.skipped_effects.add(O.e);k.oncommit(b),k.ondiscard(()=>{})}else b();f(g)}),_={effect:E,items:o,outrogroups:null,fallback:u};p=!1}function jo(e,t,s,n,r){var a=(n&Hi)!==0,i=t.length,o=e.items,l=e.effect.first,c,u=null,g,d=[],p=[],b,E,_,w;if(a)for(w=0;w<i;w+=1)b=t[w],E=r(b,w),_=o.get(E).e,(_.f&at)===0&&(_.nodes?.a?.measure(),(g??=new Set).add(_));for(w=0;w<i;w+=1){if(b=t[w],E=r(b,w),_=o.get(E).e,e.outrogroups!==null)for(const O of e.outrogroups)O.pending.delete(_),O.done.delete(_);if((_.f&at)!==0)if(_.f^=at,_===l)fs(_,null,s);else{var P=u?u.next:l;_===e.effect.last&&(e.effect.last=_.prev),_.prev&&(_.prev.next=_.next),_.next&&(_.next.prev=_.prev),mt(e,u,_),mt(e,_,P),fs(_,P,s),u=_,d=[],p=[],l=u.next;continue}if((_.f&Pe)!==0&&(Ln(_),a&&(_.nodes?.a?.unfix(),(g??=new Set).delete(_))),_!==l){if(c!==void 0&&c.has(_)){if(d.length<p.length){var k=p[0],S;u=k.prev;var M=d[0],I=d[d.length-1];for(S=0;S<d.length;S+=1)fs(d[S],k,s);for(S=0;S<p.length;S+=1)c.delete(p[S]);mt(e,M.prev,I.next),mt(e,u,M),mt(e,I,k),l=k,u=I,w-=1,d=[],p=[]}else c.delete(_),fs(_,l,s),mt(e,_.prev,_.next),mt(e,_,u===null?e.effect.first:u.next),mt(e,u,_),u=_;continue}for(d=[],p=[];l!==null&&l!==_;)(c??=new Set).add(l),p.push(l),l=l.next;if(l===null)continue}(_.f&at)===0&&d.push(_),u=_,l=_.next}if(e.outrogroups!==null){for(const O of e.outrogroups)O.pending.size===0&&(yn(Ws(O.done)),e.outrogroups?.delete(O));e.outrogroups.size===0&&(e.outrogroups=null)}if(l!==null||c!==void 0){var y=[];if(c!==void 0)for(_ of c)(_.f&Pe)===0&&y.push(_);for(;l!==null;)(l.f&Pe)===0&&l!==e.fallback&&y.push(l),l=l.next;var $=y.length;if($>0){var R=(n&Gr)!==0&&i===0?s:null;if(a){for(w=0;w<$;w+=1)y[w].nodes?.a?.measure();for(w=0;w<$;w+=1)y[w].nodes?.a?.fix()}qo(e,y,R)}}a&&is(()=>{if(g!==void 0)for(_ of g)_.nodes?.a?.apply()})}function Wo(e,t,s,n,r,a,i,o){var l=(i&ji)!==0?(i&Vi)===0?oe(s,!1,!1):Rt(s):null,c=(i&Wi)!==0?Rt(r):null;return{v:l,i:c,e:Re(()=>(a(t,l??s,c??r,o),()=>{e.delete(n)}))}}function fs(e,t,s){if(e.nodes)for(var n=e.nodes.start,r=e.nodes.end,a=t&&(t.f&at)===0?t.nodes.start:s;n!==null;){var i=Ts(n);if(a.before(n),n===r)return;n=i}}function mt(e,t,s){t===null?e.effect.first=s:t.next=s,s===null?e.effect.last=t:s.prev=t}function Ho(e,t,s=!1,n=!1,r=!1){var a=e,i="";G(()=>{var o=q;if(i!==(i=t()??"")&&(o.nodes!==null&&(la(o.nodes.start,o.nodes.end),o.nodes=null),i!=="")){var l=i+"";s?l=`<svg>${l}</svg>`:n&&(l=`<math>${l}</math>`);var c=xa(l);if((s||n)&&(c=bt(c)),Xs(bt(c),c.lastChild),s||n)for(;bt(c);)a.before(bt(c));else a.before(c)}})}function Vo(e,t,...s){var n=new Sa(e);en(()=>{const r=t()??null;n.ensure(r,r&&(a=>r(a,...s)))},Dt)}function Ea(e){var t,s,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(s=Ea(e[t]))&&(n&&(n+=" "),n+=s)}else for(s in e)e[s]&&(n&&(n+=" "),n+=s);return n}function Ko(){for(var e,t,s=0,n="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=Ea(e))&&(n&&(n+=" "),n+=t);return n}function Jo(e){return typeof e=="object"?Ko(e):e??""}const Mr=[...` 	
\r\fÂ \v\uFEFF`];function Zo(e,t,s){var n=e==null?"":""+e;if(t&&(n=n?n+" "+t:t),s){for(var r in s)if(s[r])n=n?n+" "+r:r;else if(n.length)for(var a=r.length,i=0;(i=n.indexOf(r,i))>=0;){var o=i+a;(i===0||Mr.includes(n[i-1]))&&(o===n.length||Mr.includes(n[o]))?n=(i===0?"":n.substring(0,i))+n.substring(o+1):i=o}}return n===""?null:n}function Qo(e,t){return e==null?null:String(e)}function re(e,t,s,n,r,a){var i=e.__className;if(i!==s||i===void 0){var o=Zo(s,n,a);o==null?e.removeAttribute("class"):e.className=o,e.__className=s}else if(a&&r!==a)for(var l in a){var c=!!a[l];(r==null||c!==!!r[l])&&e.classList.toggle(l,c)}return a}function ys(e,t,s,n){var r=e.__style;if(r!==t){var a=Qo(t);a==null?e.removeAttribute("style"):e.style.cssText=a,e.__style=t}return n}function Ma(e,t,s=!1){if(e.multiple){if(t==null)return;if(!kn(t))return ro();for(var n of e.options)n.selected=t.includes(ps(n));return}for(n of e.options){var r=ps(n);if(So(r,t)){n.selected=!0;return}}(!s||t!==void 0)&&(e.selectedIndex=-1)}function el(e){var t=new MutationObserver(()=>{Ma(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Zs(()=>{t.disconnect()})}function Ta(e,t,s=t){var n=new WeakSet,r=!0;sa(e,"change",a=>{var i=a?"[selected]":":checked",o;if(e.multiple)o=[].map.call(e.querySelectorAll(i),ps);else{var l=e.querySelector(i)??e.querySelector("option:not([disabled])");o=l&&ps(l)}s(o),U!==null&&n.add(U)}),aa(()=>{var a=t();if(e===document.activeElement){var i=vs??U;if(n.has(i))return}if(Ma(e,a,r),r&&a===void 0){var o=e.querySelector(":checked");o!==null&&(a=ps(o),s(a))}e.__value=a,r=!1}),el(e)}function ps(e){return"__value"in e?e.__value:e.value}const tl=Symbol("is custom element"),sl=Symbol("is html");function xn(e,t){var s=Ca(e);s.value===(s.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function Ge(e,t,s,n){var r=Ca(e);r[t]!==(r[t]=s)&&(t==="loading"&&(e[Li]=s),s==null?e.removeAttribute(t):typeof s!="string"&&nl(e).includes(t)?e[t]=s:e.setAttribute(t,s))}function Ca(e){return e.__attributes??={[tl]:e.nodeName.includes("-"),[sl]:e.namespaceURI===no}}var Tr=new Map;function nl(e){var t=e.getAttribute("is")||e.nodeName,s=Tr.get(t);if(s)return s;Tr.set(t,s=[]);for(var n,r=e,a=Element.prototype;a!==r;){n=Or(r);for(var i in n)n[i].set&&s.push(i);r=$n(r)}return s}function $t(e,t,s=t){var n=new WeakSet;sa(e,"input",async r=>{var a=r?e.defaultValue:e.value;if(a=fn(e)?vn(a):a,s(a),U!==null&&n.add(U),await Ro(),a!==(a=t())){var i=e.selectionStart,o=e.selectionEnd,l=e.value.length;if(e.value=a??"",o!==null){var c=e.value.length;i===o&&o===l&&c>l?(e.selectionStart=c,e.selectionEnd=c):(e.selectionStart=i,e.selectionEnd=Math.min(o,c))}}}),F(t)==null&&e.value&&(s(fn(e)?vn(e.value):e.value),U!==null&&n.add(U)),Cs(()=>{var r=t();if(e===document.activeElement){var a=vs??U;if(n.has(a))return}fn(e)&&r===vn(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function fn(e){var t=e.type;return t==="number"||t==="range"}function vn(e){return e===""?null:+e}function Cr(e,t){return e===t||e?.[lt]===t}function ss(e={},t,s,n){return aa(()=>{var r,a;return Cs(()=>{r=a,a=[],F(()=>{e!==s(...a)&&(t(e,...a),r&&Cr(s(...r),e)&&t(null,...r))})}),()=>{is(()=>{a&&Cr(s(...a),e)&&t(null,...a)})}}),e}function ks(e=!1){const t=ee,s=t.l.u;if(!s)return;let n=()=>Fo(t.s);if(e){let r=0,a={};const i=Ms(()=>{let o=!1;const l=t.s;for(const c in l)l[c]!==a[c]&&(a[c]=l[c],o=!0);return o&&r++,r});n=()=>f(i)}s.b.length&&ko(()=>{kr(t,n),zs(s.b)}),bs(()=>{const r=F(()=>s.m.map(Pi));return()=>{for(const a of r)typeof a=="function"&&a()}}),s.a.length&&bs(()=>{kr(t,n),zs(s.a)})}function kr(e,t){if(e.l.s)for(const s of e.l.s)f(s);t()}function Rn(e,t,s){if(e==null)return t(void 0),s&&s(void 0),it;const n=F(()=>e.subscribe(t,s));return n.unsubscribe?()=>n.unsubscribe():n}const Ht=[];function rl(e,t){return{subscribe:We(e,t).subscribe}}function We(e,t=it){let s=null;const n=new Set;function r(o){if(Br(e,o)&&(e=o,s)){const l=!Ht.length;for(const c of n)c[1](),Ht.push(c,e);if(l){for(let c=0;c<Ht.length;c+=2)Ht[c][0](Ht[c+1]);Ht.length=0}}}function a(o){r(o(e))}function i(o,l=it){const c=[o,l];return n.add(c),n.size===1&&(s=t(r,a)||it),o(e),()=>{n.delete(c),n.size===0&&s&&(s(),s=null)}}return{set:r,update:a,subscribe:i}}function zt(e,t,s){const n=!Array.isArray(e),r=n?[e]:e;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=t.length<2;return rl(s,(i,o)=>{let l=!1;const c=[];let u=0,g=it;const d=()=>{if(u)return;g();const b=t(n?c[0]:c,i,o);a?i(b):g=typeof b=="function"?b:it},p=r.map((b,E)=>Rn(b,_=>{c[E]=_,u&=~(1<<E),l&&d()},()=>{u|=1<<E}));return l=!0,d(),function(){zs(p),g(),l=!1}})}function tt(e){let t;return Rn(e,s=>t=s)(),t}let Os=!1,Sn=Symbol();function H(e,t,s){const n=s[t]??={store:null,source:oe(void 0),unsubscribe:it};if(n.store!==e&&!(Sn in s))if(n.unsubscribe(),n.store=e??null,e==null)n.source.v=void 0,n.unsubscribe=it;else{var r=!0;n.unsubscribe=Rn(e,a=>{r?n.source.v=a:z(n.source,a)}),r=!1}return e&&Sn in s?tt(e):f(n.source)}function Bt(){const e={};function t(){Zs(()=>{for(var s in e)e[s].unsubscribe();Dr(e,Sn,{enumerable:!1,value:!0})})}return[e,t]}function al(e){var t=Os;try{return Os=!1,[e(),Os]}finally{Os=t}}function Ke(e,t,s,n){var r=!as||(s&Ji)!==0,a=(s&Qi)!==0,i=(s&eo)!==0,o=n,l=!0,c=()=>(l&&(l=!1,o=i?F(n):n),o),u;if(a){var g=lt in e||Oi in e;u=Zt(e,t)?.set??(g&&t in e?k=>e[t]=k:void 0)}var d,p=!1;a?[d,p]=al(()=>e[t]):d=e[t],d===void 0&&n!==void 0&&(d=c(),u&&(r&&Bi(),u(d)));var b;if(r?b=()=>{var k=e[t];return k===void 0?c():(l=!0,k)}:b=()=>{var k=e[t];return k!==void 0&&(o=void 0),k===void 0?o:k},r&&(s&Zi)===0)return b;if(u){var E=e.$$legacy;return(function(k,S){return arguments.length>0?((!r||!S||E||p)&&u(S?b():k),k):b()})}var _=!1,w=((s&Ki)!==0?Ms:Dn)(()=>(_=!1,b()));a&&f(w);var P=q;return(function(k,S){if(arguments.length>0){const M=S?f(w):r&&a?Jt(k):k;return z(w,M),_=!0,o!==void 0&&(o=M),k}return Gt&&_||(P.f&ot)!==0?w.v:f(w)})}function tn(e){ee===null&&Fr(),as&&ee.l!==null?il(ee).m.push(e):bs(()=>{const t=F(e);if(typeof t=="function")return t})}function ka(e){ee===null&&Fr(),tn(()=>()=>F(e))}function il(e){var t=e.l;return t.u??={a:[],b:[],m:[]}}const ol="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(ol);oo();class ll{propagator=null;config;currentSeed;isInitialized=!1;wasmModule=null;currentBackend="cpu";gpuAvailable=!1;constructor(t,s){this.config=t,this.currentSeed=s}async initialize(t="cpu"){try{const n="/autoverse/preview/pr-41/pkg/flow_lenia.js";this.wasmModule=await import(n),await this.wasmModule.default(),this.gpuAvailable=await this.checkWebGPU();const r=t==="gpu"&&this.gpuAvailable?"gpu":"cpu";await this.createPropagator(r),this.isInitialized=!0}catch(s){throw new Error(`Failed to initialize WASM: ${s}`)}}async checkWebGPU(){if(typeof navigator>"u"||!("gpu"in navigator))return!1;try{return await navigator.gpu.requestAdapter()!==null}catch{return!1}}async createPropagator(t){if(!this.wasmModule)throw new Error("WASM module not loaded");const s=JSON.stringify(this.config),n=JSON.stringify(this.currentSeed);t==="gpu"&&this.gpuAvailable?(this.propagator=await new this.wasmModule.WasmGpuPropagator(s,n),this.currentBackend="gpu"):(this.propagator=new this.wasmModule.WasmPropagator(s,n),this.currentBackend="cpu")}async switchBackend(t){if(!this.isInitialized)throw new Error("Simulation not initialized");return t==="gpu"&&!this.gpuAvailable?!1:(t===this.currentBackend||await this.createPropagator(t),!0)}isGpuAvailable(){return this.gpuAvailable}getBackend(){return this.currentBackend}async step(){this.ensureInitialized(),this.currentBackend==="gpu"?await this.propagator.step():this.propagator.step()}async run(t){this.ensureInitialized(),this.currentBackend==="gpu"?await this.propagator.run(BigInt(t)):this.propagator.run(BigInt(t))}getState(){return this.ensureInitialized(),this.propagator.getState()}reset(t){this.ensureInitialized(),t&&(this.currentSeed=t),this.propagator.reset(JSON.stringify(this.currentSeed))}totalMass(){return this.ensureInitialized(),this.propagator.totalMass()}getTime(){return this.ensureInitialized(),this.propagator.getTime()}getStep(){return this.ensureInitialized(),this.propagator.getStep()}getWidth(){return this.config.width}getHeight(){return this.config.height}getConfig(){return{...this.config}}extractRegion(t,s,n,r){this.ensureInitialized();const a=this.getState(),i=[];for(let o=0;o<a.channels.length;o++){const l=[];for(let c=0;c<r;c++)for(let u=0;u<n;u++){const g=(t+u)%a.width,p=(s+c)%a.height*a.width+g;l.push(a.channels[o][p])}i.push(l)}return{width:n,height:r,channels:i,sourceX:t,sourceY:s}}placeRegion(t,s,n){this.ensureInitialized();const r=this.getState(),a=new Map;for(let l=0;l<r.channels.length;l++)for(let c=0;c<r.height;c++)for(let u=0;u<r.width;u++){const g=c*r.width+u,d=r.channels[l][g];d>.001&&a.set(`${u},${c},${l}`,d)}for(let l=0;l<t.channels.length;l++)for(let c=0;c<t.height;c++)for(let u=0;u<t.width;u++){const g=(s+u)%this.config.width,d=(n+c)%this.config.height,p=c*t.width+u,b=t.channels[l][p];b>.001&&a.set(`${g},${d},${l}`,b)}const i=[];for(const[l,c]of a){const[u,g,d]=l.split(",").map(Number);i.push([u,g,d,c])}const o={pattern:{type:"Custom",values:i}};this.reset(o)}drawAt(t,s,n,r,a=0){this.ensureInitialized();const i=this.getState(),o=[];for(let c=0;c<i.channels.length;c++)for(let u=0;u<i.height;u++)for(let g=0;g<i.width;g++){const d=u*i.width+g;let p=i.channels[c][d];if(c===a){const b=g-t,E=u-s,_=Math.sqrt(b*b+E*E);if(_<=n){const w=1-_/n;p=Math.min(1,p+r*w*w)}}p>.001&&o.push([g,u,c,p])}const l={pattern:{type:"Custom",values:o}};this.reset(l)}eraseAt(t,s,n,r=0){this.ensureInitialized();const a=this.getState(),i=[];for(let l=0;l<a.channels.length;l++)for(let c=0;c<a.height;c++)for(let u=0;u<a.width;u++){const g=c*a.width+u;let d=a.channels[l][g];if(l===r){const p=u-t,b=c-s,E=Math.sqrt(p*p+b*b);if(E<=n){const _=1-E/n;d=Math.max(0,d*(1-_*_))}}d>.001&&i.push([u,c,l,d])}const o={pattern:{type:"Custom",values:i}};this.reset(o)}ensureInitialized(){if(!this.isInitialized||!this.propagator)throw new Error("Simulation not initialized. Call initialize() first.")}}const En={width:128,height:128,channels:1,dt:.1,kernel_radius:13,kernels:[{radius:1,rings:[{amplitude:1,distance:.5,width:.15}],weight:1,mu:.15,sigma:.015,source_channel:0,target_channel:0}],flow:{beta_a:1,n:2,distribution_size:1}},cl={pattern:{type:"GaussianBlob",center:[.5,.5],radius:.1,amplitude:1,channel:0}},ul={initialized:!1,playing:!1,step:0,time:0,totalMass:0,fps:0,frameTime:0,backend:"cpu",gpuAvailable:!1,config:En,state:null},le=We(ul),$a=We([]);function X(e,t="info"){$a.update(s=>[...s.slice(-100),{message:e,level:t,timestamp:Date.now()}])}let te=null,Ls=null,gs=0,Rs=0,Mn=0,Ia=60,Ns=0;function js(){return te}function Aa(e){Ia=Math.max(1,Math.min(480,e)),Ns=0}function fl(e){Aa(60*Math.max(1,Math.min(10,e)))}async function vl(){te=new ll(En,cl),await te.initialize();const e=te.getState();le.update(t=>({...t,initialized:!0,step:te.getStep(),time:te.getTime(),totalMass:te.totalMass(),backend:te.getBackend(),gpuAvailable:te.isGpuAvailable(),config:En,state:e}))}function Pa(){!te||tt(le).playing||(le.update(t=>({...t,playing:!0})),gs=performance.now(),Mn=gs,Rs=0,La(gs),X("Simulation started","info"))}function Nn(){le.update(e=>({...e,playing:!1})),Ls!==null&&(cancelAnimationFrame(Ls),Ls=null),X("Simulation paused","info")}async function Da(){te&&(await te.step(),Fn())}function xs(e){te&&(te.reset(e),Fn(),X("Simulation reset","info"))}async function Oa(e){if(!te)return!1;const t=await te.switchBackend(e);return t?(le.update(s=>({...s,backend:e})),X(`Switched to ${e.toUpperCase()} backend`,"success")):X(`Failed to switch to ${e} backend`,"error"),t}async function La(e){if(!tt(le).playing||!te)return;let s=e-gs;gs=e;const n=250;s>n&&(s=n,Ns=0);const r=Ia*s/1e3+Ns,a=Math.floor(r);Ns=r-a,a>0&&await te.run(a),Fn(),Rs++,e-Mn>=1e3&&(le.update(i=>({...i,fps:Rs,frameTime:s})),Rs=0,Mn=e),Ls=requestAnimationFrame(i=>La(i))}function Fn(){if(!te)return;const e=te.getState();le.update(t=>({...t,step:te.getStep(),time:te.getTime(),totalMass:te.totalMass(),state:e}))}const dl=zt(le,e=>e.time.toFixed(2)),Ra=zt(le,e=>e.totalMass.toLocaleString(void 0,{maximumFractionDigits:0})),Na=zt(le,e=>e.step.toString().padStart(8,"0")),hl={mode:"view",brushSize:5,brushIntensity:.8,colorScheme:"theme",visualizationMode:"mass",showGrid:!1,showScanlines:!0,showSelection:!0,zoom:1,panX:0,panY:0},ht=We(hl);function Fa(e){ht.update(t=>({...t,mode:e}))}function Ga(e){ht.update(t=>({...t,brushSize:Math.max(1,Math.min(50,e))}))}function za(e){ht.update(t=>({...t,brushIntensity:Math.max(0,Math.min(1,e))}))}function pl(e){ht.update(t=>({...t,colorScheme:e}))}function gl(){ht.update(e=>({...e,showScanlines:!e.showScanlines}))}const Ss=[{id:"void",name:"VOID",colors:{primary:"#a855f7",primaryDim:"#6b21a8",primaryGlow:"rgba(168, 85, 247, 0.4)",secondary:"#3b82f6",secondaryDim:"#1e40af",secondaryGlow:"rgba(59, 130, 246, 0.4)",tertiary:"#ec4899",tertiaryDim:"#9d174d",tertiaryGlow:"rgba(236, 72, 153, 0.4)",success:"#a855f7",warning:"#f59e0b",danger:"#ef4444"}},{id:"neon-tokyo",name:"NEON TOKYO",colors:{primary:"#ff2d95",primaryDim:"#9d1a5a",primaryGlow:"rgba(255, 45, 149, 0.4)",secondary:"#00f0ff",secondaryDim:"#0891b2",secondaryGlow:"rgba(0, 240, 255, 0.4)",tertiary:"#ffee00",tertiaryDim:"#a38a00",tertiaryGlow:"rgba(255, 238, 0, 0.4)",success:"#00f0ff",warning:"#ffee00",danger:"#ff2d95"}},{id:"synthwave",name:"SYNTHWAVE",colors:{primary:"#f472b6",primaryDim:"#a21caf",primaryGlow:"rgba(244, 114, 182, 0.4)",secondary:"#818cf8",secondaryDim:"#4338ca",secondaryGlow:"rgba(129, 140, 248, 0.4)",tertiary:"#22d3ee",tertiaryDim:"#0e7490",tertiaryGlow:"rgba(34, 211, 238, 0.4)",success:"#22d3ee",warning:"#fbbf24",danger:"#f43f5e"}},{id:"bloodmoon",name:"BLOODMOON",colors:{primary:"#dc2626",primaryDim:"#7f1d1d",primaryGlow:"rgba(220, 38, 38, 0.4)",secondary:"#f97316",secondaryDim:"#9a3412",secondaryGlow:"rgba(249, 115, 22, 0.4)",tertiary:"#fbbf24",tertiaryDim:"#92400e",tertiaryGlow:"rgba(251, 191, 36, 0.4)",success:"#f97316",warning:"#fbbf24",danger:"#dc2626"}},{id:"toxic",name:"TOXIC",colors:{primary:"#84cc16",primaryDim:"#3f6212",primaryGlow:"rgba(132, 204, 22, 0.5)",secondary:"#facc15",secondaryDim:"#854d0e",secondaryGlow:"rgba(250, 204, 21, 0.4)",tertiary:"#22c55e",tertiaryDim:"#166534",tertiaryGlow:"rgba(34, 197, 94, 0.4)",success:"#22c55e",warning:"#facc15",danger:"#ef4444"}},{id:"ice",name:"ICE",colors:{primary:"#38bdf8",primaryDim:"#0369a1",primaryGlow:"rgba(56, 189, 248, 0.4)",secondary:"#e0f2fe",secondaryDim:"#7dd3fc",secondaryGlow:"rgba(224, 242, 254, 0.3)",tertiary:"#a5b4fc",tertiaryDim:"#4f46e5",tertiaryGlow:"rgba(165, 180, 252, 0.4)",success:"#38bdf8",warning:"#fcd34d",danger:"#f87171"}},{id:"hacker",name:"HACKER",colors:{primary:"#22c55e",primaryDim:"#166534",primaryGlow:"rgba(34, 197, 94, 0.5)",secondary:"#4ade80",secondaryDim:"#15803d",secondaryGlow:"rgba(74, 222, 128, 0.4)",tertiary:"#86efac",tertiaryDim:"#22c55e",tertiaryGlow:"rgba(134, 239, 172, 0.3)",success:"#22c55e",warning:"#fbbf24",danger:"#ef4444"}},{id:"phosphor",name:"PHOSPHOR",colors:{primary:"#fef08a",primaryDim:"#a16207",primaryGlow:"rgba(254, 240, 138, 0.5)",secondary:"#fde047",secondaryDim:"#854d0e",secondaryGlow:"rgba(253, 224, 71, 0.4)",tertiary:"#fbbf24",tertiaryDim:"#92400e",tertiaryGlow:"rgba(251, 191, 36, 0.4)",success:"#a3e635",warning:"#fbbf24",danger:"#f87171"}}],sn=We(Ss[0]);function Tn(e){const t=document.documentElement,{colors:s}=e;t.style.setProperty("--color-primary",s.primary),t.style.setProperty("--color-primary-dim",s.primaryDim),t.style.setProperty("--color-primary-glow",s.primaryGlow),t.style.setProperty("--color-secondary",s.secondary),t.style.setProperty("--color-secondary-dim",s.secondaryDim),t.style.setProperty("--color-secondary-glow",s.secondaryGlow),t.style.setProperty("--color-tertiary",s.tertiary),t.style.setProperty("--color-tertiary-dim",s.tertiaryDim),t.style.setProperty("--color-tertiary-glow",s.tertiaryGlow),t.style.setProperty("--color-success",s.success),t.style.setProperty("--color-warning",s.warning),t.style.setProperty("--color-danger",s.danger),sn.set(e),localStorage.setItem("autoverse-theme",e.id)}function _l(e){const t=Ss.find(s=>s.id===e);t&&Tn(t)}function ml(){const e=localStorage.getItem("autoverse-theme");if(e){const t=Ss.find(s=>s.id===e);if(t){Tn(t);return}}Tn(Ss[0])}const $r=900,De=["controls","display","presets","patterns","evolve"];function bl(){const{subscribe:e,set:t,update:s}=We({isMobile:typeof window<"u"&&window.innerWidth<=$r,activeTab:"controls",swipeOffset:0,isSwiping:!1});return{subscribe:e,set:t,update:s,checkViewport:()=>{if(typeof window>"u")return;const n=window.innerWidth<=$r;s(r=>({...r,isMobile:n}))},setTab:n=>{s(r=>({...r,activeTab:n,swipeOffset:0}))},nextTab:()=>{s(n=>{const r=De.indexOf(n.activeTab),a=Math.min(r+1,De.length-1);return{...n,activeTab:De[a],swipeOffset:0}})},prevTab:()=>{s(n=>{const r=De.indexOf(n.activeTab),a=Math.max(r-1,0);return{...n,activeTab:De[a],swipeOffset:0}})},startSwipe:()=>{s(n=>({...n,isSwiping:!0}))},updateSwipe:n=>{s(r=>({...r,swipeOffset:n}))},endSwipe:n=>{const r=tt({subscribe:e}),a=n*.2,i=r.swipeOffset;if(Math.abs(i)>a)if(i>0){const o=De.indexOf(r.activeTab);if(o>0){t({...r,activeTab:De[o-1],swipeOffset:0,isSwiping:!1});return}}else{const o=De.indexOf(r.activeTab);if(o<De.length-1){t({...r,activeTab:De[o+1],swipeOffset:0,isSwiping:!1});return}}s(o=>({...o,swipeOffset:0,isSwiping:!1}))}}}const Ne=bl(),wl=zt(Ne,e=>De.indexOf(e.activeTab)),dn=De;var yl=C("<button></button>"),xl=C('<header class="header svelte-4b3o1e"><div class="header-left svelte-4b3o1e"><pre class="ascii-logo svelte-4b3o1e"></pre></div> <div class="header-right svelte-4b3o1e"><div class="theme-picker svelte-4b3o1e"><span class="picker-label svelte-4b3o1e">THEME</span> <div class="theme-swatches svelte-4b3o1e"></div></div> <div><span class="backend-label svelte-4b3o1e">COMPUTE</span> <span class="backend-value svelte-4b3o1e"> </span></div></div></header>');function Sl(e,t){vt(t,!1);const s=()=>H(sn,"$currentScheme",r),n=()=>H(le,"$simulationStore",r),[r,a]=Bt();ks();var i=xl(),o=v(i),l=v(o);l.textContent=`
 âââ â â âââ âââ â â âââ âââ âââ âââ
 âââ âââ  â  â â âââ âââ âââ âââ âââ`;var c=h(o,2),u=v(c),g=h(v(u),2);Ue(g,5,()=>Ss,rt,(_,w)=>{var P=yl();let k;P.__click=()=>_l(f(w).id),G(()=>{k=re(P,1,"swatch svelte-4b3o1e",null,k,{active:s().id===f(w).id}),ys(P,`--swatch-color: ${f(w).colors.primary??""}`),Ge(P,"title",f(w).name)}),T(_,P)});var d=h(u,2);let p;var b=h(v(d),2),E=v(b);G(_=>{p=re(d,1,"backend-indicator svelte-4b3o1e",null,p,{gpu:n().backend==="gpu"}),D(E,_)},[()=>n().backend.toUpperCase()]),T(e,i),dt(),a()}ls(["click"]);var El=C('<footer class="footer svelte-ww03jg"></footer>');function Ml(e){var t=El();T(e,t)}var Tl=C("<div> </div>"),Cl=C('<div><div class="corner top-left svelte-1gtc57s"></div> <div class="corner top-right svelte-1gtc57s"></div> <div class="corner bottom-left svelte-1gtc57s"></div> <div class="corner bottom-right svelte-1gtc57s"></div> <!> <div><!></div></div>');function wt(e,t){let s=Ke(t,"borderColor",3,"primary"),n=Ke(t,"noPadding",3,!1),r=Ke(t,"class",3,"");const a={primary:"border-primary",secondary:"border-secondary",tertiary:"border-tertiary"};var i=Cl(),o=h(v(i),8);{var l=d=>{var p=Tl(),b=v(p);G(()=>{re(p,1,`title ${a[s()]??""}`,"svelte-1gtc57s"),D(b,t.title)}),T(d,p)};Q(o,d=>{t.title&&d(l)})}var c=h(o,2);let u;var g=v(c);Vo(g,()=>t.children??it),G(()=>{re(i,1,`tui-box ${a[s()]??""} ${r()??""}`,"svelte-1gtc57s"),u=re(c,1,"content svelte-1gtc57s",null,u,{"no-padding":n()})}),T(e,i)}var kl=C('<span class="label svelte-1l5vt72"> </span>'),$l=C("<span> </span>"),Il=C('<div class="slider-header svelte-1l5vt72"><!> <!></div>'),Al=C('<div class="slider-container svelte-1l5vt72"><!> <input type="range"/></div>');function hn(e,t){vt(t,!0);let s=Ke(t,"value",15),n=Ke(t,"min",3,0),r=Ke(t,"max",3,100),a=Ke(t,"step",3,1),i=Ke(t,"showValue",3,!0),o=Ke(t,"valueFormat",3,b=>String(b)),l=Ke(t,"color",3,"tertiary");function c(b){const E=b.target;s(parseFloat(E.value)),t.onchange?.(s())}var u=Al(),g=v(u);{var d=b=>{var E=Il(),_=v(E);{var w=S=>{var M=kl(),I=v(M);G(()=>D(I,t.label)),T(S,M)};Q(_,S=>{t.label&&S(w)})}var P=h(_,2);{var k=S=>{var M=$l(),I=v(M);G(y=>{re(M,1,`value ${l()??""}`,"svelte-1l5vt72"),D(I,y)},[()=>o()(s())]),T(S,M)};Q(P,S=>{i()&&S(k)})}T(b,E)};Q(g,b=>{(t.label||i())&&b(d)})}var p=h(g,2);p.__input=c,G(()=>{re(p,1,Jo(l()),"svelte-1l5vt72"),Ge(p,"min",n()),Ge(p,"max",r()),Ge(p,"step",a()),xn(p,s())}),T(e,u),dt()}ls(["input"]);var Pl=C('<span class="icon svelte-oaxjxu">&#9724;</span> <span class="label svelte-oaxjxu">PAUSE</span>',1),Dl=C('<span class="icon svelte-oaxjxu">&#9654;</span> <span class="label svelte-oaxjxu">PLAY</span>',1),Ol=C('<div class="control-grid svelte-oaxjxu"><button><!></button> <button class="control-btn svelte-oaxjxu"><span class="icon svelte-oaxjxu">&#9655;</span> <span class="label svelte-oaxjxu">STEP</span></button> <button class="control-btn svelte-oaxjxu"><span class="icon svelte-oaxjxu">&#8634;</span> <span class="label svelte-oaxjxu">RESET</span></button></div> <div class="speed-control svelte-oaxjxu"><!></div>',1),Ll=C('<button><span class="icon svelte-oaxjxu"><!></span> <span class="label svelte-oaxjxu"> </span></button>'),Rl=C('<div class="brush-settings svelte-oaxjxu"><!> <!></div>'),Nl=C('<div class="tool-grid svelte-oaxjxu"></div> <!>',1),Fl=C('<div><span class="log-prefix svelte-oaxjxu">&gt;</span> <span class="log-message svelte-oaxjxu"> </span></div>'),Gl=C('<div class="log-container svelte-oaxjxu"></div>'),zl=C('<aside class="left-sidebar svelte-oaxjxu"><!> <!> <!></aside>');function Bl(e,t){vt(t,!0);const s=()=>H(le,"$simulationStore",a),n=()=>H(ht,"$settings",a),r=()=>H($a,"$systemLog",a),[a,i]=Bt();let o=Se(60);function l(E){z(o,E,!0),Aa(E)}function c(E){Fa(E)}const u=[{id:"view",label:"VIEW",icon:"&#9673;"},{id:"select",label:"SEL",icon:"&#9633;"},{id:"draw",label:"DRAW",icon:"&#9998;"},{id:"erase",label:"ERASE",icon:"&#9747;"}];var g=zl(),d=v(g);wt(d,{title:"SYS.CONTROL",borderColor:"primary",children:(E,_)=>{var w=Ol(),P=Ee(w),k=v(P);let S;k.__click=()=>s().playing?Nn():Pa();var M=v(k);{var I=B=>{var se=Pl();T(B,se)},y=B=>{var se=Dl();T(B,se)};Q(M,B=>{s().playing?B(I):B(y,!1)})}var $=h(k,2);$.__click=()=>Da();var R=h($,2);R.__click=()=>xs();var O=h(P,2),j=v(O);hn(j,{label:"SIM SPEED",min:15,max:480,step:15,color:"primary",valueFormat:B=>`${B} steps/s`,onchange:l,get value(){return f(o)},set value(B){z(o,B,!0)}}),G(()=>S=re(k,1,"control-btn svelte-oaxjxu",null,S,{active:!s().playing})),T(E,w)},$$slots:{default:!0}});var p=h(d,2);wt(p,{title:"TOOL.KIT",borderColor:"tertiary",children:(E,_)=>{var w=Nl(),P=Ee(w);Ue(P,21,()=>u,rt,(M,I)=>{var y=Ll();let $;y.__click=()=>c(f(I).id);var R=v(y),O=v(R);Ho(O,()=>f(I).icon);var j=h(R,2),B=v(j);G(()=>{$=re(y,1,"tool-btn svelte-oaxjxu",null,$,{active:n().mode===f(I).id}),D(B,f(I).label)}),T(M,y)});var k=h(P,2);{var S=M=>{var I=Rl(),y=v(I);hn(y,{label:"BRUSH SIZE",get value(){return n().brushSize},min:1,max:30,step:1,color:"tertiary",valueFormat:O=>`${O}PX`,get onchange(){return Ga}});var $=h(y,2);{var R=O=>{hn(O,{label:"INTENSITY",get value(){return n().brushIntensity},min:0,max:1,step:.05,color:"tertiary",valueFormat:j=>`${Math.round(j*100)}%`,get onchange(){return za}})};Q($,O=>{n().mode==="draw"&&O(R)})}T(M,I)};Q(k,M=>{(n().mode==="draw"||n().mode==="erase")&&M(S)})}T(E,w)},$$slots:{default:!0}});var b=h(p,2);wt(b,{title:"DEBUG.LOG",borderColor:"secondary",class:"debug-log-box",children:(E,_)=>{var w=Gl();Ue(w,5,r,rt,(P,k)=>{var S=Fl(),M=h(v(S),2),I=v(M);G(()=>{re(S,1,`log-entry ${f(k).level??""}`,"svelte-oaxjxu"),D(I,f(k).message)}),T(P,S)}),T(E,w)},$$slots:{default:!0}}),T(e,g),dt(),i()}ls(["click"]);const Yl={initialized:!1,running:!1,progress:null,result:null,bestState:null,error:null},ue=We(Yl);zt(ue,e=>e.running);zt(ue,e=>e.progress);zt(ue,e=>e.bestState);let _s=null,Xe=null,Fs=null;function Gs(e){if(e===null)return null;if(typeof e=="string")try{return JSON.parse(e)}catch{return null}return e}async function Ba(){if(_s){ue.update(e=>({...e,initialized:!0}));return}try{_s=await import("/autoverse/preview/pr-41/pkg/flow_lenia.js"),await _s.default(),ue.update(s=>({...s,initialized:!0})),X("Evolution engine initialized","success")}catch(e){throw X(`Failed to initialize evolution: ${e}`,"error"),e}}function Ya(){return{base_config:tt(le).config,algorithm:{type:"GeneticAlgorithm",config:{mutation_rate:.15,crossover_rate:.7,mutation_strength:.1,elitism:2,selection:{method:"Tournament",size:3}}},fitness:{metrics:[{metric:"Persistence",weight:1},{metric:"Compactness",weight:.5},{metric:"Locomotion",weight:.3}],aggregation:"WeightedSum"},population:{size:20,max_generations:50,target_fitness:.95,stagnation_limit:15},evaluation:{steps:200,sample_interval:10,warmup_steps:20},constraints:{radius:{min:.05,max:.25},amplitude:{min:.5,max:2},x:{min:.3,max:.7},y:{min:.3,max:.7}},archive:{enabled:!0,max_size:50,diversity_threshold:.1}}}async function Ua(e){if(!_s)throw new Error("Evolution module not initialized");Nn(),Gn();try{Xe&&Xe.free(),Xe=new _s.WasmEvolutionEngine(JSON.stringify(e)),ue.update(t=>({...t,running:!0,progress:null,result:null,error:null})),X(`Evolution started: pop=${e.population.size}, gens=${e.population.max_generations}`,"info"),Xa()}catch(t){throw ue.update(s=>({...s,error:String(t)})),X(`Evolution error: ${t}`,"error"),t}}function Xa(){if(!(!tt(ue).running||!Xe))try{const t=Xe.step(),s=Gs(t),n=Xe.getBestCandidateState(),r=Gs(n);if(ue.update(a=>({...a,progress:s,bestState:r??a.bestState})),Xe.isComplete()){const a=Xe.getResult(),i=Gs(a);ue.update(o=>({...o,running:!1,result:i})),i&&X(`Evolution complete: fitness=${i.stats.best_fitness.toFixed(3)}, reason=${i.stats.stop_reason}`,"success");return}Fs=window.setTimeout(()=>Xa(),0)}catch(t){ue.update(s=>({...s,running:!1,error:String(t)})),X(`Evolution error: ${t}`,"error")}}function Gn(){Fs!==null&&(clearTimeout(Fs),Fs=null);const e=tt(ue);if(Xe&&e.running){Xe.cancel();try{const t=Xe.getResult(),s=Gs(t);ue.update(n=>({...n,result:s}))}catch{}X("Evolution cancelled","warn")}ue.update(t=>({...t,running:!1}))}function qa(){const e=tt(ue);if(!e.bestState){X("No evolved pattern to load","warn");return}const{width:t,height:s,channels:n}=e.bestState;if(!n||n.length===0){X("No channel data in evolved pattern","warn");return}const r=n[0],a=[];for(let i=0;i<s;i++)for(let o=0;o<t;o++){const l=i*t+o,c=r[l];c>.001&&a.push([o,i,0,c])}xs({pattern:{type:"Custom",values:a}}),X("Loaded evolved pattern into simulation","success")}var Ul=C('<div class="progress-display svelte-auxm5"><div class="progress-row svelte-auxm5"><span class="label svelte-auxm5">GEN</span> <span class="value svelte-auxm5"> </span></div> <div class="progress-row svelte-auxm5"><span class="label svelte-auxm5">FIT</span> <span class="value highlight svelte-auxm5"> </span></div> <div class="progress-bar svelte-auxm5"><div class="progress-fill svelte-auxm5"></div></div></div>'),Xl=C('<div class="result-display svelte-auxm5"><div class="result-row svelte-auxm5"><span class="label svelte-auxm5">RESULT</span> <span class="value success svelte-auxm5"> </span></div> <div class="result-reason svelte-auxm5"> </div></div>'),ql=C('<div class="idle-status svelte-auxm5">READY</div>'),jl=C('<button class="evo-btn danger svelte-auxm5">STOP</button>'),Wl=C('<button class="evo-btn secondary svelte-auxm5">LOAD</button>'),Hl=C('<button class="evo-btn primary svelte-auxm5">EVOLVE</button> <!>',1),Vl=C('<div class="evolution-panel svelte-auxm5"><div class="preview-container svelte-auxm5"><canvas width="64" height="64" class="preview-canvas svelte-auxm5"></canvas> <span class="preview-label svelte-auxm5">BEST</span></div> <!> <div class="controls svelte-auxm5"><!></div> <details class="settings svelte-auxm5"><summary class="svelte-auxm5">SETTINGS</summary> <div class="settings-grid svelte-auxm5"><label class="svelte-auxm5"><span class="svelte-auxm5">POP</span> <input type="number" min="4" max="50" step="2" class="svelte-auxm5"/></label> <label class="svelte-auxm5"><span class="svelte-auxm5">GENS</span> <input type="number" min="10" max="200" step="10" class="svelte-auxm5"/></label> <label class="svelte-auxm5"><span class="svelte-auxm5">MUT%</span> <input type="number" min="1" max="50" step="1" class="svelte-auxm5"/></label> <label class="svelte-auxm5"><span class="svelte-auxm5">STEPS</span> <input type="number" min="50" max="500" step="50" class="svelte-auxm5"/></label></div> <label class="goal-select svelte-auxm5"><span class="svelte-auxm5">GOAL</span> <select class="svelte-auxm5"><option>Survival</option><option>Glider</option><option>Oscillator</option><option>Complex</option></select></label></details></div>');function Kl(e,t){vt(t,!1);const s=()=>H(ue,"$evolutionStore",n),[n,r]=Bt();let a=oe(),i=oe(null),o=oe(20),l=oe(50),c=.95,u=oe(15),g=oe(200),d=oe("survival");function p(S){if(!f(i)||!f(a))return;const{width:M,height:I,channels:y}=S;if(!y||y.length===0)return;const $=y[0];if(!$||$.length===0)return;const R=f(a).width,O=f(a).height,j=f(i).createImageData(M,I);for(let J=0;J<$.length;J++){const L=Math.floor(Math.min(1,Math.max(0,$[J]))*255);j.data[J*4]=L,j.data[J*4+1]=L,j.data[J*4+2]=L,j.data[J*4+3]=255}const B=new OffscreenCanvas(M,I),se=B.getContext("2d");se&&(se.putImageData(j,0,0),yo(i,f(i).imageSmoothingEnabled=!1),f(i).clearRect(0,0,R,O),f(i).drawImage(B,0,0,R,O))}function b(S){switch(S){case"glider":return[{metric:"Persistence",weight:1},{metric:"Locomotion",weight:1.5},{metric:"Compactness",weight:.5}];case"oscillator":return[{metric:"Persistence",weight:1},{metric:"Stability",weight:.8},{metric:"Compactness",weight:.5}];case"complex":return[{metric:"Persistence",weight:1},{metric:"Complexity",weight:1.2},{metric:"MassConcentration",weight:.3}];default:return[{metric:"Persistence",weight:1},{metric:"Compactness",weight:.5},{metric:"Stability",weight:.3}]}}function E(){return{...Ya(),population:{size:f(o),max_generations:f(l),target_fitness:c,stagnation_limit:Math.max(5,Math.floor(f(l)/3))},algorithm:{type:"GeneticAlgorithm",config:{mutation_rate:f(u)/100,crossover_rate:.7,mutation_strength:.1,elitism:Math.max(1,Math.floor(f(o)/10)),selection:{method:"Tournament",size:3}}},evaluation:{steps:f(g),sample_interval:Math.max(1,Math.floor(f(g)/20)),warmup_steps:Math.floor(f(g)/10)},fitness:{metrics:b(f(d)),aggregation:"WeightedSum"}}}async function _(){const S=E();try{await Ua(S)}catch(M){X(`Failed to start evolution: ${M}`,"error")}}function w(){Gn()}function P(){qa()}function k(S){switch(S){case"TargetReached":return"TARGET HIT";case"MaxGenerations":return"MAX GENS";case"Stagnation":return"STAGNANT";case"Cancelled":return"CANCELLED";default:return S}}tn(async()=>{if(z(i,f(a)?.getContext("2d")??null),!s().initialized)try{await Ba()}catch{}}),nt(()=>(f(i),s()),()=>{f(i)&&s().bestState&&p(s().bestState)}),Qs(),ks(),wt(e,{title:"EVOLVE",borderColor:"tertiary",children:(S,M)=>{var I=Vl(),y=v(I),$=v(y);ss($,W=>z(a,W),()=>f(a));var R=h(y,2);{var O=W=>{var ye=Ul(),Ve=v(ye),Mt=h(v(Ve),2),Tt=v(Mt),me=h(Ve,2),Be=h(v(me),2),Xt=v(Be),qt=h(me,2),jt=v(qt);G(_t=>{D(Tt,`${s(),F(()=>s().progress.generation)??""}/${f(l)??""}`),D(Xt,_t),ys(jt,`width: ${s(),f(l),F(()=>s().progress.generation/f(l)*100)??""}%`)},[()=>(s(),F(()=>s().progress.best_fitness.toFixed(3)))]),T(W,ye)},j=W=>{var ye=qs(),Ve=Ee(ye);{var Mt=me=>{var Be=Xl(),Xt=v(Be),qt=h(v(Xt),2),jt=v(qt),_t=h(Xt,2),Is=v(_t);G((rn,As)=>{D(jt,rn),D(Is,As)},[()=>(s(),F(()=>s().result.stats.best_fitness.toFixed(3))),()=>(s(),F(()=>k(s().result.stats.stop_reason)))]),T(me,Be)},Tt=me=>{var Be=ql();T(me,Be)};Q(Ve,me=>{s(),F(()=>s().result)?me(Mt):me(Tt,!1)},!0)}T(W,ye)};Q(R,W=>{s(),F(()=>s().running&&s().progress)?W(O):W(j,!1)})}var B=h(R,2),se=v(B);{var J=W=>{var ye=jl();ye.__click=w,T(W,ye)},L=W=>{var ye=Hl(),Ve=Ee(ye);Ve.__click=_;var Mt=h(Ve,2);{var Tt=me=>{var Be=Wl();Be.__click=P,T(me,Be)};Q(Mt,me=>{s(),F(()=>s().bestState)&&me(Tt)})}G(()=>Ve.disabled=(s(),F(()=>!s().initialized))),T(W,ye)};Q(se,W=>{s(),F(()=>s().running)?W(J):W(L,!1)})}var ne=h(B,2),ie=h(v(ne),2),ge=v(ie),we=h(v(ge),2),_e=h(ge,2),ke=h(v(_e),2),$e=h(_e,2),Et=h(v($e),2),pt=h($e,2),He=h(v(pt),2),de=h(ie,2),ze=h(v(de),2);G(()=>{f(d),Do(()=>{})});var gt=v(ze);gt.value=gt.__value="survival";var Yt=h(gt);Yt.value=Yt.__value="glider";var Ut=h(Yt);Ut.value=Ut.__value="oscillator";var $s=h(Ut);$s.value=$s.__value="complex",$t(we,()=>f(o),W=>z(o,W)),$t(ke,()=>f(l),W=>z(l,W)),$t(Et,()=>f(u),W=>z(u,W)),$t(He,()=>f(g),W=>z(g,W)),Ta(ze,()=>f(d),W=>z(d,W)),T(S,I)},$$slots:{default:!0}}),dt(),r()}ls(["click"]);const Ir="flow-lenia-presets";class Jl{presets=new Map;listeners=new Set;constructor(){this.loadFromStorage()}generateId(){return`preset-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}createThumbnail(t,s=64){const n=document.createElement("canvas");n.width=s,n.height=s;const r=n.getContext("2d"),a=r.createImageData(t.width,t.height),i=t.channels[0];for(let b=0;b<i.length;b++){const E=Math.max(0,Math.min(1,i[b])),_=Math.floor(E*255);a.data[b*4+0]=_,a.data[b*4+1]=_,a.data[b*4+2]=_,a.data[b*4+3]=255}const o=document.createElement("canvas");o.width=t.width,o.height=t.height,o.getContext("2d").putImageData(a,0,0),r.imageSmoothingEnabled=!0,r.fillStyle="#1a1a1a",r.fillRect(0,0,s,s);const c=Math.min(s/t.width,s/t.height),u=t.width*c,g=t.height*c,d=(s-u)/2,p=(s-g)/2;return r.drawImage(o,d,p,u,g),n.toDataURL("image/png")}savePreset(t,s,n){const r={id:this.generateId(),name:t,description:n,thumbnail:this.createThumbnail(s),region:s,createdAt:Date.now()};return this.presets.set(r.id,r),this.persistToStorage(),this.notifyListeners(),r}getPreset(t){return this.presets.get(t)}getAllPresets(){return Array.from(this.presets.values()).sort((t,s)=>s.createdAt-t.createdAt)}deletePreset(t){const s=this.presets.delete(t);return s&&(this.persistToStorage(),this.notifyListeners()),s}renamePreset(t,s){const n=this.presets.get(t);return n?(n.name=s,this.persistToStorage(),this.notifyListeners(),!0):!1}updateDescription(t,s){const n=this.presets.get(t);return n?(n.description=s,this.persistToStorage(),this.notifyListeners(),!0):!1}exportPresets(t){const s=t?t.map(n=>this.presets.get(n)).filter(Boolean):this.getAllPresets();return JSON.stringify(s,null,2)}importPresets(t){try{const s=JSON.parse(t);let n=0;for(const r of s){const a={...r,id:this.generateId(),createdAt:Date.now()};this.presets.set(a.id,a),n++}return this.persistToStorage(),this.notifyListeners(),n}catch{throw new Error("Invalid preset JSON format")}}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(){const t=this.getAllPresets();for(const s of this.listeners)s(t)}persistToStorage(){try{const t=JSON.stringify(Array.from(this.presets.entries()));localStorage.setItem(Ir,t)}catch(t){console.warn("Failed to persist presets to storage:",t)}}loadFromStorage(){try{const t=localStorage.getItem(Ir);if(t){const s=JSON.parse(t);this.presets=new Map(s)}}catch(t){console.warn("Failed to load presets from storage:",t),this.presets=new Map}}clearAll(){this.presets.clear(),this.persistToStorage(),this.notifyListeners()}}const ja=[{name:"Glider",description:"A simple glider that moves across the grid",seed:{pattern:{type:"GaussianBlob",center:[.5,.5],radius:.1,amplitude:1,channel:0}}},{name:"Ring",description:"A ring pattern that expands",seed:{pattern:{type:"Ring",center:[.5,.5],inner_radius:.05,outer_radius:.1,amplitude:1,channel:0}}},{name:"Dual Blobs",description:"Two interacting blobs",seed:{pattern:{type:"MultiBlob",blobs:[{center:[.35,.5],radius:.08,amplitude:1,channel:0},{center:[.65,.5],radius:.08,amplitude:1,channel:0}]}}},{name:"Random Noise",description:"Random initial conditions",seed:{pattern:{type:"Noise",seed:42,amplitude:.5,channel:0}}}],Cn=We(null),Wa=We(0);function Zl(){Wa.update(e=>e+1)}function Ql(e,t){const s=tt(Cn);s&&s.startDragFromLibrary(e,t)}const Ar=We(null),ns=new Jl,nn=We(ns.getAllPresets());ns.subscribe(e=>{nn.set(e)});function Ha(e){const t=ns.getAllPresets().find(s=>s.id===e);ns.deletePreset(e),t&&X(`Deleted preset: ${t.name}`,"info")}function ec(){const e=ns.exportPresets();return X(`Exported ${tt(nn).length} presets`,"success"),e}function Va(e){try{const t=ns.importPresets(e);return X(`Imported ${t} presets`,"success"),Zl(),t}catch(t){throw X(`Import failed: ${t}`,"error"),t}}function Ka(){const e=ec(),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download="flow-lenia-presets.json",n.click(),URL.revokeObjectURL(s)}var tc=C('<div class="metric-display svelte-1baw31t"><div class="metric-main svelte-1baw31t"><span class="metric-value svelte-1baw31t"> </span> <span class="metric-unit svelte-1baw31t">STEPS</span></div> <div class="metric-row svelte-1baw31t"><div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">TIME</span> <span class="metric-num svelte-1baw31t"> </span></div> <div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">MASS</span> <span class="metric-num highlight svelte-1baw31t"> </span></div></div> <div class="metric-row svelte-1baw31t"><div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">FPS</span> <span class="metric-num accent svelte-1baw31t"> </span></div> <div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">BACKEND</span> <button> </button></div></div></div>'),sc=C('<div class="config-grid svelte-1baw31t"><div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">mu</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">sigma</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">R</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">dt</span> <span class="cfg-value svelte-1baw31t"> </span></div></div>'),nc=C('<button class="builtin-btn svelte-1baw31t"> </button>'),rc=C('<div class="builtin-grid svelte-1baw31t"></div>'),ac=C('<img class="svelte-1baw31t"/>'),ic=C('<div class="preset-item svelte-1baw31t" draggable="true" role="button" tabindex="0"><div class="preset-thumbnail svelte-1baw31t"><!></div> <div class="preset-info svelte-1baw31t"><span class="preset-name svelte-1baw31t"> </span> <span class="preset-size svelte-1baw31t"> </span></div> <button class="delete-btn svelte-1baw31t">&#10005;</button></div>'),oc=C('<div class="empty-state svelte-1baw31t">No saved patterns</div>'),lc=C('<div class="patterns-header svelte-1baw31t"><button class="small-btn svelte-1baw31t">IMPORT</button> <button class="small-btn svelte-1baw31t">EXPORT</button></div> <div class="preset-list svelte-1baw31t"></div>',1),cc=C('<aside class="right-sidebar svelte-1baw31t"><!> <!> <!> <!> <!></aside>');function uc(e,t){vt(t,!1);const s=()=>H(le,"$simulationStore",o),n=()=>H(Na,"$formattedStep",o),r=()=>H(dl,"$formattedTime",o),a=()=>H(Ra,"$formattedMass",o),i=()=>H(nn,"$presets",o),[o,l]=Bt(),c=oe();function u(){const y=s().backend==="cpu"?"gpu":"cpu";Oa(y)}function g(y){const $=js();if(!$)return;const R=Math.floor(($.getWidth()-y.region.width)/2),O=Math.floor(($.getHeight()-y.region.height)/2);$.placeRegion(y.region,R,O)}function d(y){xs(y.seed),X(`Loaded pattern: ${y.name}`,"info")}function p(y,$){y.stopPropagation(),Ha($)}function b(){Ka()}function E(){const y=document.createElement("input");y.type="file",y.accept=".json",y.onchange=async $=>{const R=$.target.files?.[0];if(!R)return;const O=await R.text();try{Va(O)}catch{}},y.click()}function _(y,$){y.dataTransfer.effectAllowed="copy",y.dataTransfer.setData("text/plain",$.id),Ql($,y)}nt(()=>s(),()=>{z(c,s().config.kernels[0])}),Qs(),ks();var w=cc(),P=v(w);Kl(P,{});var k=h(P,2);wt(k,{title:"METRICS",borderColor:"secondary",children:(y,$)=>{var R=tc(),O=v(R),j=v(O),B=v(j),se=h(O,2),J=v(se),L=h(v(J),2),ne=v(L),ie=h(J,2),ge=h(v(ie),2),we=v(ge),_e=h(se,2),ke=v(_e),$e=h(v(ke),2),Et=v($e),pt=h(ke,2),He=h(v(pt),2);let de;He.__click=u;var ze=v(He);G(gt=>{D(B,n()),D(ne,`${r()??""}s`),D(we,a()),D(Et,(s(),F(()=>s().fps))),de=re(He,1,"backend-btn svelte-1baw31t",null,de,{gpu:s().backend==="gpu"}),He.disabled=(s(),F(()=>!s().gpuAvailable)),D(ze,gt)},[()=>(s(),F(()=>s().backend.toUpperCase()))]),T(y,R)},$$slots:{default:!0}});var S=h(k,2);wt(S,{title:"KERNEL",borderColor:"primary",children:(y,$)=>{var R=sc(),O=v(R),j=h(v(O),2),B=v(j),se=h(O,2),J=h(v(se),2),L=v(J),ne=h(se,2),ie=h(v(ne),2),ge=v(ie),we=h(ne,2),_e=h(v(we),2),ke=v(_e);G(()=>{D(B,(f(c),F(()=>f(c)?.mu??"â"))),D(L,(f(c),F(()=>f(c)?.sigma??"â"))),D(ge,(s(),F(()=>s().config.kernel_radius))),D(ke,(s(),F(()=>s().config.dt)))}),T(y,R)},$$slots:{default:!0}});var M=h(S,2);wt(M,{title:"SEEDS",borderColor:"tertiary",children:(y,$)=>{var R=rc();Ue(R,5,()=>ja,rt,(O,j)=>{var B=nc();B.__click=()=>d(f(j));var se=v(B);G(()=>{Ge(B,"title",(f(j),F(()=>f(j).description))),D(se,(f(j),F(()=>f(j).name)))}),T(O,B)}),T(y,R)},$$slots:{default:!0}});var I=h(M,2);wt(I,{title:"SAVED",borderColor:"primary",class:"saved-box",children:(y,$)=>{var R=lc(),O=Ee(R),j=v(O);j.__click=E;var B=h(j,2);B.__click=b;var se=h(O,2);Ue(se,5,i,J=>J.id,(J,L)=>{var ne=ic();ne.__click=()=>g(f(L)),ne.__keydown=de=>de.key==="Enter"&&g(f(L));var ie=v(ne),ge=v(ie);{var we=de=>{var ze=ac();G(()=>{Ge(ze,"src",(f(L),F(()=>f(L).thumbnail))),Ge(ze,"alt",(f(L),F(()=>f(L).name)))}),T(de,ze)};Q(ge,de=>{f(L),F(()=>f(L).thumbnail)&&de(we)})}var _e=h(ie,2),ke=v(_e),$e=v(ke),Et=h(ke,2),pt=v(Et),He=h(_e,2);He.__click=de=>p(de,f(L).id),G(()=>{D($e,(f(L),F(()=>f(L).name))),D(pt,`${f(L),F(()=>f(L).region.width)??""}x${f(L),F(()=>f(L).region.height)??""}`)}),ya("dragstart",ne,de=>_(de,f(L))),T(J,ne)},J=>{var L=oc();T(J,L)}),T(y,R)},$$slots:{default:!0}}),T(e,w),dt(),l()}ls(["click","keydown"]);class fc{canvas;ctx;offscreenCanvas;offscreenCtx;settings;grayscaleMap;thermalMap;viridisMap;themeMap;constructor(t,s){this.canvas=t;const n=t.getContext("2d");if(!n)throw new Error("Failed to get 2D context");this.ctx=n,this.offscreenCanvas=document.createElement("canvas");const r=this.offscreenCanvas.getContext("2d");if(!r)throw new Error("Failed to get offscreen 2D context");this.offscreenCtx=r,this.settings=s,this.grayscaleMap=this.buildGrayscaleMap(),this.thermalMap=this.buildThermalMap(),this.viridisMap=this.buildViridisMap(),this.themeMap=this.viridisMap}setThemeColors(t){this.themeMap=this.buildThemeMap(t)}updateSettings(t){this.settings={...this.settings,...t}}render(t,s,n){const{width:r,height:a,channels:i}=t;(this.offscreenCanvas.width!==r||this.offscreenCanvas.height!==a)&&(this.offscreenCanvas.width=r,this.offscreenCanvas.height=a);const o=this.getColorMap(),l=this.offscreenCtx.createImageData(r,a),c=i[0];for(let u=0;u<c.length;u++){const g=Math.max(0,Math.min(1,c[u])),d=Math.floor(g*255)*4;l.data[u*4+0]=o[d+0],l.data[u*4+1]=o[d+1],l.data[u*4+2]=o[d+2],l.data[u*4+3]=255}this.offscreenCtx.putImageData(l,0,0),this.ctx.imageSmoothingEnabled=!1,this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.offscreenCanvas,0,0,r,a,0,0,this.canvas.width,this.canvas.height),this.settings.showGrid&&this.drawGrid(r,a),n&&this.drawGhostPreview(n,r,a),s&&this.settings.showSelection&&this.drawSelection(s,r,a)}drawGrid(t,s){const n=this.canvas.width/t,r=this.canvas.height/s;if(this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1,n>=4&&r>=4){this.ctx.beginPath();for(let a=0;a<=t;a++){const i=a*n;this.ctx.moveTo(i,0),this.ctx.lineTo(i,this.canvas.height)}for(let a=0;a<=s;a++){const i=a*r;this.ctx.moveTo(0,i),this.ctx.lineTo(this.canvas.width,i)}this.ctx.stroke()}}drawSelection(t,s,n){const r=this.canvas.width/s,a=this.canvas.height/n,i=Math.min(t.startX,t.endX)*r,o=Math.min(t.startY,t.endY)*a,l=Math.abs(t.endX-t.startX)*r,c=Math.abs(t.endY-t.startY)*a;this.ctx.fillStyle="rgba(79, 195, 247, 0.2)",this.ctx.fillRect(i,o,l,c),this.ctx.strokeStyle="#4fc3f7",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.strokeRect(i,o,l,c),this.ctx.setLineDash([]);const u=Math.abs(t.endX-t.startX),g=Math.abs(t.endY-t.startY);u>0&&g>0&&(this.ctx.fillStyle="#4fc3f7",this.ctx.font="12px monospace",this.ctx.fillText(`${u} x ${g}`,i+4,o-4))}drawGhostPreview(t,s,n){const r=this.canvas.width/s,a=this.canvas.height/n,{region:i,x:o,y:l}=t,c=document.createElement("canvas");c.width=i.width,c.height=i.height;const u=c.getContext("2d"),g=u.createImageData(i.width,i.height),d=this.getColorMap();for(let p=0;p<i.channels[0].length;p++){const b=Math.max(0,Math.min(1,i.channels[0][p])),E=Math.floor(b*255)*4;g.data[p*4+0]=d[E+0],g.data[p*4+1]=d[E+1],g.data[p*4+2]=d[E+2],g.data[p*4+3]=b>.01?180:0}u.putImageData(g,0,0),this.ctx.globalAlpha=.7,this.ctx.drawImage(c,0,0,i.width,i.height,o*r,l*a,i.width*r,i.height*a),this.ctx.globalAlpha=1,this.ctx.strokeStyle="#4fc3f7",this.ctx.lineWidth=2,this.ctx.setLineDash([3,3]),this.ctx.strokeRect(o*r,l*a,i.width*r,i.height*a),this.ctx.setLineDash([])}canvasToSim(t,s,n,r){const a=this.canvas.getBoundingClientRect(),i=n/this.canvas.width,o=r/this.canvas.height;return{x:Math.floor((t-a.left)*i),y:Math.floor((s-a.top)*o)}}getColorMap(){switch(this.settings.colorScheme){case"thermal":return this.thermalMap;case"viridis":return this.viridisMap;case"theme":return this.themeMap;default:return this.grayscaleMap}}buildGrayscaleMap(){const t=new Uint8ClampedArray(1024);for(let s=0;s<256;s++)t[s*4+0]=s,t[s*4+1]=s,t[s*4+2]=s,t[s*4+3]=255;return t}buildThermalMap(){const t=new Uint8ClampedArray(1024);for(let s=0;s<256;s++){const n=s/255;let r,a,i;if(n<.2){const o=n/.2;r=0,a=0,i=Math.floor(o*128)}else if(n<.4){const o=(n-.2)/.2;r=0,a=Math.floor(o*255),i=128+Math.floor(o*127)}else if(n<.6){const o=(n-.4)/.2;r=Math.floor(o*255),a=255,i=255-Math.floor(o*255)}else if(n<.8){const o=(n-.6)/.2;r=255,a=255-Math.floor(o*255),i=0}else{const o=(n-.8)/.2;r=255,a=Math.floor(o*255),i=Math.floor(o*255)}t[s*4+0]=r,t[s*4+1]=a,t[s*4+2]=i,t[s*4+3]=255}return t}buildViridisMap(){const t=[[68,1,84],[72,35,116],[64,67,135],[52,94,141],[41,120,142],[32,144,140],[34,167,132],[68,190,112],[121,209,81],[189,222,38],[253,231,36]],s=new Uint8ClampedArray(256*4);for(let n=0;n<256;n++){const a=n/255*(t.length-1),i=Math.floor(a),o=Math.min(i+1,t.length-1),l=a-i;s[n*4+0]=Math.floor(t[i][0]+l*(t[o][0]-t[i][0])),s[n*4+1]=Math.floor(t[i][1]+l*(t[o][1]-t[i][1])),s[n*4+2]=Math.floor(t[i][2]+l*(t[o][2]-t[i][2])),s[n*4+3]=255}return s}getCanvas(){return this.canvas}buildThemeMap(t){const s=l=>{const c=l.replace("#","");return[parseInt(c.slice(0,2),16),parseInt(c.slice(2,4),16),parseInt(c.slice(4,6),16)]},n=s(t.primary),r=s(t.secondary),a=s(t.tertiary),i=[{t:0,color:[5,5,5]},{t:.15,color:[n[0]*.3,n[1]*.3,n[2]*.3]},{t:.35,color:n},{t:.6,color:r},{t:.85,color:a},{t:1,color:[255,255,255]}],o=new Uint8ClampedArray(256*4);for(let l=0;l<256;l++){const c=l/255;let u=i[0],g=i[1];for(let p=1;p<i.length;p++)if(c<=i[p].t){u=i[p-1],g=i[p];break}const d=(c-u.t)/(g.t-u.t);o[l*4+0]=Math.floor(u.color[0]+d*(g.color[0]-u.color[0])),o[l*4+1]=Math.floor(u.color[1]+d*(g.color[1]-u.color[1])),o[l*4+2]=Math.floor(u.color[2]+d*(g.color[2]-u.color[2])),o[l*4+3]=255}return o}}class vc{canvas;simulation;callbacks;mode="view";selection=null;isSelecting=!1;isDrawing=!1;isDragging=!1;draggedCreature=null;ghostPreview=null;brushSize=3;brushIntensity=.5;constructor(t,s,n,r={}){this.canvas=t,this.simulation=s,this.callbacks=r,this.setupEventListeners(),this.setupDragDrop()}setMode(t){switch(this.mode=t,this.selection=null,this.isSelecting=!1,this.isDrawing=!1,t){case"select":this.canvas.style.cursor="crosshair";break;case"draw":this.canvas.style.cursor="cell";break;case"erase":this.canvas.style.cursor="not-allowed";break;default:this.canvas.style.cursor="default"}this.callbacks.onModeChange?.(t)}getMode(){return this.mode}getSelection(){return this.selection}clearSelection(){this.selection=null,this.callbacks.onSelectionChange?.(null)}setBrushSize(t){this.brushSize=Math.max(1,Math.min(20,t))}setBrushIntensity(t){this.brushIntensity=Math.max(0,Math.min(1,t))}getGhostPreview(){return this.ghostPreview}startDragFromLibrary(t,s){this.isDragging=!0,this.draggedCreature={preset:t,offsetX:t.region.width/2,offsetY:t.region.height/2};const n=this.getSimCoords(s);this.ghostPreview={region:t.region,x:n.x-this.draggedCreature.offsetX,y:n.y-this.draggedCreature.offsetY}}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.canvas.addEventListener("touchcancel",this.handleTouchEnd.bind(this),{passive:!1}),document.addEventListener("keydown",this.handleKeyDown.bind(this))}setupDragDrop(){this.canvas.addEventListener("dragover",t=>{if(t.preventDefault(),t.dataTransfer.dropEffect="copy",this.draggedCreature){const s=this.getSimCoords(t);this.ghostPreview={region:this.draggedCreature.preset.region,x:s.x-this.draggedCreature.offsetX,y:s.y-this.draggedCreature.offsetY}}}),this.canvas.addEventListener("drop",t=>{if(t.preventDefault(),this.draggedCreature){const s=this.getSimCoords(t),n=Math.floor(s.x-this.draggedCreature.offsetX),r=Math.floor(s.y-this.draggedCreature.offsetY);this.callbacks.onDrop?.(this.draggedCreature.preset,n,r),this.draggedCreature=null,this.ghostPreview=null,this.isDragging=!1}}),this.canvas.addEventListener("dragleave",()=>{this.ghostPreview=null})}handleMouseDown(t){const s=this.getSimCoords(t);switch(this.mode){case"select":this.isSelecting=!0,this.selection={startX:s.x,startY:s.y,endX:s.x,endY:s.y},this.callbacks.onSelectionChange?.(this.selection);break;case"draw":this.isDrawing=!0,this.callbacks.onDraw?.(s.x,s.y);break;case"erase":this.isDrawing=!0,this.callbacks.onErase?.(s.x,s.y);break}}handleMouseMove(t){const s=this.getSimCoords(t);this.isSelecting&&this.selection&&(this.selection.endX=s.x,this.selection.endY=s.y,this.callbacks.onSelectionChange?.(this.selection)),this.isDrawing&&(this.mode==="draw"?this.callbacks.onDraw?.(s.x,s.y):this.mode==="erase"&&this.callbacks.onErase?.(s.x,s.y)),this.isDragging&&this.draggedCreature&&(this.ghostPreview={region:this.draggedCreature.preset.region,x:s.x-this.draggedCreature.offsetX,y:s.y-this.draggedCreature.offsetY})}handleMouseUp(t){if(this.isSelecting&&this.selection){const s={startX:Math.min(this.selection.startX,this.selection.endX),startY:Math.min(this.selection.startY,this.selection.endY),endX:Math.max(this.selection.startX,this.selection.endX),endY:Math.max(this.selection.startY,this.selection.endY)};s.endX>s.startX&&s.endY>s.startY?(this.selection=s,this.callbacks.onSelectionComplete?.(s)):this.selection=null,this.callbacks.onSelectionChange?.(this.selection)}this.isSelecting=!1,this.isDrawing=!1}handleMouseLeave(t){this.isSelecting&&(this.isSelecting=!1,this.selection=null,this.callbacks.onSelectionChange?.(null)),this.isDrawing=!1,this.ghostPreview=null}handleTouchStart(t){if(t.touches.length!==1)return;this.mode!=="view"&&t.preventDefault();const s=t.touches[0],n=this.getTouchSimCoords(s);switch(this.mode){case"select":this.isSelecting=!0,this.selection={startX:n.x,startY:n.y,endX:n.x,endY:n.y},this.callbacks.onSelectionChange?.(this.selection);break;case"draw":this.isDrawing=!0,this.callbacks.onDraw?.(n.x,n.y);break;case"erase":this.isDrawing=!0,this.callbacks.onErase?.(n.x,n.y);break}}handleTouchMove(t){if(t.touches.length!==1)return;this.mode!=="view"&&(this.isDrawing||this.isSelecting)&&t.preventDefault();const s=t.touches[0],n=this.getTouchSimCoords(s);this.isSelecting&&this.selection&&(this.selection.endX=n.x,this.selection.endY=n.y,this.callbacks.onSelectionChange?.(this.selection)),this.isDrawing&&(this.mode==="draw"?this.callbacks.onDraw?.(n.x,n.y):this.mode==="erase"&&this.callbacks.onErase?.(n.x,n.y))}handleTouchEnd(t){if(this.mode!=="view"&&(this.isDrawing||this.isSelecting)&&t.preventDefault(),this.isSelecting&&this.selection){const s={startX:Math.min(this.selection.startX,this.selection.endX),startY:Math.min(this.selection.startY,this.selection.endY),endX:Math.max(this.selection.startX,this.selection.endX),endY:Math.max(this.selection.startY,this.selection.endY)};s.endX>s.startX&&s.endY>s.startY?(this.selection=s,this.callbacks.onSelectionComplete?.(s)):this.selection=null,this.callbacks.onSelectionChange?.(this.selection)}this.isSelecting=!1,this.isDrawing=!1}getTouchSimCoords(t){const s=this.canvas.getBoundingClientRect(),n=t.clientX-s.left,r=t.clientY-s.top,a=this.simulation.getWidth(),i=this.simulation.getHeight();return{x:Math.floor(n/s.width*a),y:Math.floor(r/s.height*i)}}handleKeyDown(t){const s=t.target;s.tagName==="INPUT"||s.tagName==="TEXTAREA"||(t.key==="v"||t.key==="Escape"?this.setMode("view"):t.key==="s"?this.setMode("select"):t.key==="d"?this.setMode("draw"):t.key==="e"&&this.setMode("erase"),t.key==="["?(this.setBrushSize(this.brushSize-1),this.callbacks.onBrushSizeChange?.(this.brushSize)):t.key==="]"&&(this.setBrushSize(this.brushSize+1),this.callbacks.onBrushSizeChange?.(this.brushSize)))}getSimCoords(t){const s=this.canvas.getBoundingClientRect(),n=t.clientX-s.left,r=t.clientY-s.top,a=this.simulation.getWidth(),i=this.simulation.getHeight();return{x:Math.floor(n/s.width*a),y:Math.floor(r/s.height*i)}}getBrushSize(){return this.brushSize}getBrushIntensity(){return this.brushIntensity}}var dc=C('<div class="simulation-view svelte-145nxqv"><div class="canvas-frame svelte-145nxqv"><div class="canvas-header svelte-145nxqv"><span class="dim-label svelte-145nxqv"> </span></div> <div class="canvas-container svelte-145nxqv"><canvas class="svelte-145nxqv"></canvas> <div class="corner-marker top-left svelte-145nxqv"></div> <div class="corner-marker top-right svelte-145nxqv"></div> <div class="corner-marker bottom-left svelte-145nxqv"></div> <div class="corner-marker bottom-right svelte-145nxqv"></div> <div class="canvas-scanlines svelte-145nxqv"></div></div></div></div>');function Pr(e,t){vt(t,!1);const s=()=>H(ht,"$settings",i),n=()=>H(le,"$simulationStore",i),r=()=>H(sn,"$currentScheme",i),a=()=>H(Wa,"$renderTrigger",i),[i,o]=Bt();let l=oe(),c=oe(),u=oe(null),g=oe(null);const d=512;tn(()=>{const M=js();!M||!f(c)||(Ar.set(f(c)),z(u,new fc(f(c),{colorScheme:s().colorScheme,showGrid:s().showGrid,showSelection:s().showSelection,brushSize:s().brushSize,brushIntensity:s().brushIntensity,backend:n().backend})),z(g,new vc(f(c),M,f(u),{onSelectionChange:()=>p(),onSelectionComplete:()=>{},onDrop:(I,y,$)=>{M.placeRegion(I.region,y,$),p()},onDraw:(I,y)=>{M.drawAt(I,y,s().brushSize,s().brushIntensity),p()},onErase:(I,y)=>{M.eraseAt(I,y,s().brushSize),p()},onModeChange:()=>{},onBrushSizeChange:()=>{}})),Cn.set(f(g)),p())}),ka(()=>{Cn.set(null),Ar.set(null),z(u,null),z(g,null)});function p(){if(!f(u))return;const M=js();if(!M)return;const I=M.getState(),y=f(g)?.getSelection(),$=f(g)?.getGhostPreview();f(u).render(I,y,$)}nt(()=>(n(),f(u)),()=>{n().state&&f(u)&&p()}),nt(()=>(f(g),s()),()=>{f(g)&&s().mode&&f(g).setMode(s().mode)}),nt(()=>(f(g),s()),()=>{f(g)&&(f(g).setBrushSize(s().brushSize),f(g).setBrushIntensity(s().brushIntensity))}),nt(()=>(f(u),s()),()=>{f(u)&&s().colorScheme&&(f(u).updateSettings({colorScheme:s().colorScheme}),p())}),nt(()=>(f(u),r()),()=>{f(u)&&r()&&(f(u).setThemeColors({primary:r().colors.primary,secondary:r().colors.secondary,tertiary:r().colors.tertiary}),p())}),nt(()=>(a(),f(u)),()=>{a()&&f(u)&&p()}),Qs(),ks();var b=dc(),E=v(b),_=v(E),w=v(_),P=v(w),k=h(_,2),S=v(k);Ge(S,"width",d),Ge(S,"height",d),ss(S,M=>z(c,M),()=>f(c)),ss(k,M=>z(l,M),()=>f(l)),G(()=>D(P,`${n(),F(()=>n().config.width)??""}x${n(),F(()=>n().config.height)??""}`)),T(e,b),dt(),o()}var hc=C("<button> </button>"),pc=C('<span class="icon svelte-xicwp9">â¸</span>'),gc=C('<span class="icon svelte-xicwp9">â¶</span>'),_c=C('<button><span class="icon svelte-xicwp9"> </span> <span class="label svelte-xicwp9"> </span></button>'),mc=C('<div class="brush-row svelte-xicwp9"><label class="svelte-xicwp9">INTENSITY</label> <input type="range" min="0" max="100" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div>'),bc=C('<div class="brush-settings svelte-xicwp9"><div class="brush-row svelte-xicwp9"><label class="svelte-xicwp9">SIZE</label> <input type="range" min="1" max="30" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <!></div>'),wc=C("<button> </button>"),yc=C('<img class="svelte-xicwp9"/>'),xc=C('<div class="preset-placeholder svelte-xicwp9"></div>'),Sc=C('<div class="preset-item svelte-xicwp9" role="button" tabindex="0"><!> <span class="preset-name svelte-xicwp9"> </span> <span class="preset-size svelte-xicwp9"> </span></div>'),Ec=C('<div class="empty-state svelte-xicwp9">No saved patterns</div>'),Mc=C('<button class="builtin-btn svelte-xicwp9"><span class="builtin-name svelte-xicwp9"> </span> <span class="builtin-desc svelte-xicwp9"> </span></button>'),Tc=C('<div class="evo-progress svelte-xicwp9"><span class="evo-label svelte-xicwp9">GEN</span> <span class="evo-value svelte-xicwp9"> </span></div> <div class="evo-progress svelte-xicwp9"><span class="evo-label svelte-xicwp9">FIT</span> <span class="evo-value highlight svelte-xicwp9"> </span></div> <div class="evo-bar svelte-xicwp9"><div class="evo-bar-fill svelte-xicwp9"></div></div>',1),Cc=C('<div class="evo-progress svelte-xicwp9"><span class="evo-label svelte-xicwp9">RESULT</span> <span class="evo-value success svelte-xicwp9"> </span></div> <div class="evo-reason svelte-xicwp9"> </div>',1),kc=C('<span class="evo-ready svelte-xicwp9">READY</span>'),$c=C('<button class="evo-btn danger svelte-xicwp9">STOP</button>'),Ic=C('<button class="evo-btn secondary svelte-xicwp9">LOAD</button>'),Ac=C('<button class="evo-btn primary svelte-xicwp9">EVOLVE</button> <!>',1),Pc=C("<button></button>"),Dc=C('<div class="bottom-sheet svelte-xicwp9"><div class="mobile-stats svelte-xicwp9"><div class="stats-group svelte-xicwp9"><span>STEP: <strong class="svelte-xicwp9"> </strong></span> <span>MASS: <strong class="svelte-xicwp9"> </strong></span> <span>FPS: <strong class="svelte-xicwp9"> </strong></span></div> <div class="backend-toggle svelte-xicwp9"><span>CPU</span> <button aria-label="Toggle between CPU and GPU backend"><span class="toggle-knob svelte-xicwp9"></span></button> <span>GPU</span></div></div> <div class="tabs svelte-xicwp9"></div> <div class="panels-container svelte-xicwp9"><div><div class="panel svelte-xicwp9"><div class="playback-controls svelte-xicwp9"><button><!></button> <button class="ctrl-btn svelte-xicwp9"><span class="icon svelte-xicwp9">â­</span></button> <button class="ctrl-btn svelte-xicwp9"><span class="icon svelte-xicwp9">âº</span></button> <div class="speed-control svelte-xicwp9"><button class="speed-btn svelte-xicwp9">â</button> <strong> </strong> <button class="speed-btn svelte-xicwp9">+</button></div></div> <div class="tools-grid svelte-xicwp9"></div> <!></div> <div class="panel svelte-xicwp9"><div class="display-section svelte-xicwp9"><label class="section-label svelte-xicwp9">COLOR SCHEME</label> <div class="scheme-grid svelte-xicwp9"></div></div> <div class="display-section svelte-xicwp9"><label class="section-label svelte-xicwp9">EFFECTS</label> <div class="toggle-row svelte-xicwp9"><span>CRT Scanlines</span> <button aria-label="Toggle CRT scanlines effect"><span class="toggle-knob svelte-xicwp9"></span></button></div></div></div> <div class="panel svelte-xicwp9"><div class="preset-actions svelte-xicwp9"><button class="action-btn svelte-xicwp9">IMPORT</button> <button class="action-btn svelte-xicwp9">EXPORT</button></div> <div class="preset-grid svelte-xicwp9"></div></div> <div class="panel svelte-xicwp9"><div class="builtin-grid svelte-xicwp9"></div></div> <div class="panel evolve-panel svelte-xicwp9"><div class="evo-header svelte-xicwp9"><canvas width="48" height="48" class="evo-preview svelte-xicwp9"></canvas> <div class="evo-status svelte-xicwp9"><!></div></div> <div class="evo-controls svelte-xicwp9"><!></div> <div class="evo-settings svelte-xicwp9"><div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">POP</label> <input type="range" min="10" max="50" step="5" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">GENS</label> <input type="range" min="20" max="100" step="10" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">MUT%</label> <input type="range" min="5" max="30" step="5" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">GOAL</label> <select class="svelte-xicwp9"><option>Survival</option><option>Glider</option><option>Oscillator</option><option>Complex</option></select></div></div></div></div></div> <div class="swipe-indicator svelte-xicwp9"></div></div>');function Oc(e,t){vt(t,!0);const s=()=>H(ue,"$evolutionStore",u),n=()=>H(Ne,"$mobileStore",u),r=()=>H(wl,"$currentTabIndex",u),a=()=>H(Na,"$formattedStep",u),i=()=>H(Ra,"$formattedMass",u),o=()=>H(le,"$simulationStore",u),l=()=>H(ht,"$settings",u),c=()=>H(nn,"$presets",u),[u,g]=Bt();let d,p=0,b=0,E=Se(1),_=Se(20),w=Se(50),P=Se(15),k=Se("survival"),S,M=null;bs(()=>{S&&!M&&(M=S.getContext("2d"))}),bs(()=>{M&&s().bestState&&I(s().bestState)});function I(m){if(!M||!S)return;const{width:x,height:A,channels:N}=m;if(!N||N.length===0)return;const V=N[0];if(!V||V.length===0)return;const K=S.width,ae=S.height,he=M.createImageData(x,A);for(let Z=0;Z<V.length;Z++){const Ie=Math.floor(Math.min(1,Math.max(0,V[Z]))*255);he.data[Z*4]=Ie,he.data[Z*4+1]=Ie,he.data[Z*4+2]=Ie,he.data[Z*4+3]=255}const xe=new OffscreenCanvas(x,A),Ye=xe.getContext("2d");Ye&&(Ye.putImageData(he,0,0),M.imageSmoothingEnabled=!1,M.clearRect(0,0,K,ae),M.drawImage(xe,0,0,K,ae))}function y(m){switch(m){case"glider":return[{metric:"Persistence",weight:1},{metric:"Locomotion",weight:1.5},{metric:"Compactness",weight:.5}];case"oscillator":return[{metric:"Persistence",weight:1},{metric:"Stability",weight:.8},{metric:"Compactness",weight:.5}];case"complex":return[{metric:"Persistence",weight:1},{metric:"Complexity",weight:1.2},{metric:"MassConcentration",weight:.3}];default:return[{metric:"Persistence",weight:1},{metric:"Compactness",weight:.5},{metric:"Stability",weight:.3}]}}function $(){return{...Ya(),population:{size:f(_),max_generations:f(w),target_fitness:.95,stagnation_limit:Math.max(5,Math.floor(f(w)/3))},algorithm:{type:"GeneticAlgorithm",config:{mutation_rate:f(P)/100,crossover_rate:.7,mutation_strength:.1,elitism:Math.max(1,Math.floor(f(_)/10)),selection:{method:"Tournament",size:3}}},fitness:{metrics:y(f(k)),aggregation:"WeightedSum"}}}async function R(){if(!s().initialized)try{await Ba()}catch{return}const m=$();try{await Ua(m)}catch(x){X(`Failed to start evolution: ${x}`,"error")}}function O(){Gn()}function j(){qa()}function B(m){switch(m){case"TargetReached":return"TARGET";case"MaxGenerations":return"MAX GENS";case"Stagnation":return"STAGNANT";case"Cancelled":return"CANCELLED";default:return m}}function se(m){const x=m.touches[0];p=x.clientX,b=x.clientX,Ne.startSwipe()}function J(m){if(!n().isSwiping)return;b=m.touches[0].clientX;const A=b-p,N=r();N===0&&A>0||N===dn.length-1&&A<0?Ne.updateSwipe(A*.3):Ne.updateSwipe(A)}function L(){!n().isSwiping||!d||Ne.endSwipe(d.clientWidth)}function ne(m){Ne.setTab(m)}function ie(m){z(E,Math.max(1,Math.min(10,f(E)+m)),!0),fl(f(E))}const ge=[{id:"view",label:"VIEW",icon:"â"},{id:"select",label:"SEL",icon:"â¡"},{id:"draw",label:"DRAW",icon:"â"},{id:"erase",label:"ERASE",icon:"â"}],we=[{id:"theme",label:"THEME"},{id:"grayscale",label:"GRAY"},{id:"thermal",label:"THERMAL"},{id:"viridis",label:"VIRIDIS"}];function _e(m){const x=js();if(!x)return;const A=Math.floor((x.getWidth()-m.region.width)/2),N=Math.floor((x.getHeight()-m.region.height)/2);x.placeRegion(m.region,A,N)}function ke(m){xs(m.seed),X(`Loaded: ${m.name}`,"info")}let $e=null;function Et(m){$e=setTimeout(()=>{confirm(`Delete "${m.name}"?`)&&Ha(m.id)},500)}function pt(){$e&&(clearTimeout($e),$e=null)}function He(){const m=document.createElement("input");m.type="file",m.accept=".json",m.onchange=async x=>{const A=x.target.files?.[0];if(!A)return;const N=await A.text();try{Va(N)}catch{}},m.click()}let de=bo(()=>{const m=-r()*100,x=d?n().swipeOffset/d.clientWidth*100:0;return`translateX(${m+x}%)`});var ze=Dc(),gt=v(ze),Yt=v(gt),Ut=v(Yt),$s=h(v(Ut)),W=v($s),ye=h(Ut,2),Ve=h(v(ye)),Mt=v(Ve),Tt=h(ye,2),me=h(v(Tt)),Be=v(me),Xt=h(Yt,2),qt=v(Xt);let jt;var _t=h(qt,2);let Is;_t.__click=()=>Oa(o().backend==="cpu"?"gpu":"cpu");var rn=h(_t,2);let As;var zn=h(gt,2);Ue(zn,21,()=>dn,rt,(m,x)=>{var A=hc();let N;A.__click=()=>ne(f(x));var V=v(A);G(K=>{N=re(A,1,"tab svelte-xicwp9",null,N,{active:n().activeTab===f(x)}),D(V,K)},[()=>f(x).toUpperCase()]),T(m,A)});var Ct=h(zn,2);Ct.__touchstart=se,Ct.__touchmove=J,Ct.__touchend=L;var an=v(Ct);let Bn;var Yn=v(an),Un=v(Yn),Ps=v(Un);let Xn;Ps.__click=()=>o().playing?Nn():Pa();var Ja=v(Ps);{var Za=m=>{var x=pc();T(m,x)},Qa=m=>{var x=gc();T(m,x)};Q(Ja,m=>{o().playing?m(Za):m(Qa,!1)})}var qn=h(Ps,2);qn.__click=()=>Da();var jn=h(qn,2);jn.__click=()=>xs();var ei=h(jn,2),Wn=v(ei);Wn.__click=()=>ie(-1);var Hn=h(Wn,2),ti=v(Hn),si=h(Hn,2);si.__click=()=>ie(1);var Vn=h(Un,2);Ue(Vn,21,()=>ge,rt,(m,x)=>{var A=_c();let N;A.__click=()=>Fa(f(x).id);var V=v(A),K=v(V),ae=h(V,2),he=v(ae);G(()=>{N=re(A,1,"tool-btn svelte-xicwp9",null,N,{active:l().mode===f(x).id}),D(K,f(x).icon),D(he,f(x).label)}),T(m,A)});var ni=h(Vn,2);{var ri=m=>{var x=bc(),A=v(x),N=h(v(A),2);N.__input=xe=>Ga(parseInt(xe.currentTarget.value));var V=h(N,2),K=v(V),ae=h(A,2);{var he=xe=>{var Ye=mc(),Z=h(v(Ye),2);Z.__input=cs=>za(parseInt(cs.currentTarget.value)/100);var Ie=h(Z,2),un=v(Ie);G((cs,ki)=>{xn(Z,cs),D(un,`${ki??""}%`)},[()=>Math.round(l().brushIntensity*100),()=>Math.round(l().brushIntensity*100)]),T(xe,Ye)};Q(ae,xe=>{l().mode==="draw"&&xe(he)})}G(()=>{xn(N,l().brushSize),D(K,l().brushSize)}),T(m,x)};Q(ni,m=>{(l().mode==="draw"||l().mode==="erase")&&m(ri)})}var Kn=h(Yn,2),Jn=v(Kn),ai=h(v(Jn),2);Ue(ai,21,()=>we,rt,(m,x)=>{var A=wc();let N;A.__click=()=>pl(f(x).id);var V=v(A);G(()=>{N=re(A,1,"scheme-btn svelte-xicwp9",null,N,{active:l().colorScheme===f(x).id}),D(V,f(x).label)}),T(m,A)});var ii=h(Jn,2),oi=h(v(ii),2),Zn=h(v(oi),2);let Qn;Zn.__click=function(...m){gl?.apply(this,m)};var er=h(Kn,2),tr=v(er),sr=v(tr);sr.__click=He;var li=h(sr,2);li.__click=function(...m){Ka?.apply(this,m)};var ci=h(tr,2);Ue(ci,5,c,m=>m.id,(m,x)=>{var A=Sc();A.__click=()=>_e(f(x)),A.__keydown=Z=>Z.key==="Enter"&&_e(f(x)),A.__touchstart=()=>Et(f(x)),A.__touchend=pt,A.__touchmove=pt;var N=v(A);{var V=Z=>{var Ie=yc();G(()=>{Ge(Ie,"src",f(x).thumbnail),Ge(Ie,"alt",f(x).name)}),T(Z,Ie)},K=Z=>{var Ie=xc();T(Z,Ie)};Q(N,Z=>{f(x).thumbnail?Z(V):Z(K,!1)})}var ae=h(N,2),he=v(ae),xe=h(ae,2),Ye=v(xe);G(()=>{D(he,f(x).name),D(Ye,`${f(x).region.width??""}Ã${f(x).region.height??""}`)}),T(m,A)},m=>{var x=Ec();T(m,x)});var nr=h(er,2),ui=v(nr);Ue(ui,21,()=>ja,rt,(m,x)=>{var A=Mc();A.__click=()=>ke(f(x));var N=v(A),V=v(N),K=h(N,2),ae=v(K);G(()=>{D(V,f(x).name),D(ae,f(x).description)}),T(m,A)});var fi=h(nr,2),rr=v(fi),ar=v(rr);ss(ar,m=>S=m,()=>S);var vi=h(ar,2),di=v(vi);{var hi=m=>{var x=Tc(),A=Ee(x),N=h(v(A),2),V=v(N),K=h(A,2),ae=h(v(K),2),he=v(ae),xe=h(K,2),Ye=v(xe);G(Z=>{D(V,`${s().progress.generation??""}/${f(w)??""}`),D(he,Z),ys(Ye,`width: ${s().progress.generation/f(w)*100}%`)},[()=>s().progress.best_fitness.toFixed(3)]),T(m,x)},pi=m=>{var x=qs(),A=Ee(x);{var N=K=>{var ae=Cc(),he=Ee(ae),xe=h(v(he),2),Ye=v(xe),Z=h(he,2),Ie=v(Z);G((un,cs)=>{D(Ye,un),D(Ie,cs)},[()=>s().result.stats.best_fitness.toFixed(3),()=>B(s().result.stats.stop_reason)]),T(K,ae)},V=K=>{var ae=kc();T(K,ae)};Q(A,K=>{s().result?K(N):K(V,!1)},!0)}T(m,x)};Q(di,m=>{s().running&&s().progress?m(hi):m(pi,!1)})}var ir=h(rr,2),gi=v(ir);{var _i=m=>{var x=$c();x.__click=O,T(m,x)},mi=m=>{var x=Ac(),A=Ee(x);A.__click=R;var N=h(A,2);{var V=K=>{var ae=Ic();ae.__click=j,T(K,ae)};Q(N,K=>{s().bestState&&K(V)})}T(m,x)};Q(gi,m=>{s().running?m(_i):m(mi,!1)})}var bi=h(ir,2),or=v(bi),lr=h(v(or),2),wi=h(lr,2),yi=v(wi),cr=h(or,2),ur=h(v(cr),2),xi=h(ur,2),Si=v(xi),fr=h(cr,2),vr=h(v(fr),2),Ei=h(vr,2),Mi=v(Ei),Ti=h(fr,2),dr=h(v(Ti),2),on=v(dr);on.value=on.__value="survival";var ln=h(on);ln.value=ln.__value="glider";var cn=h(ln);cn.value=cn.__value="oscillator";var hr=h(cn);hr.value=hr.__value="complex",ss(Ct,m=>d=m,()=>d);var Ci=h(Ct,2);Ue(Ci,21,()=>dn,rt,(m,x,A)=>{var N=Pc();let V;N.__click=()=>Ne.setTab(f(x)),G(()=>{V=re(N,1,"dot svelte-xicwp9",null,V,{active:r()===A}),Ge(N,"aria-label",`Go to ${f(x)??""} panel`)}),T(m,N)}),G(()=>{D(W,a()),D(Mt,i()),D(Be,o().fps),jt=re(qt,1,"backend-label svelte-xicwp9",null,jt,{active:o().backend==="cpu"}),Is=re(_t,1,"toggle-btn svelte-xicwp9",null,Is,{gpu:o().backend==="gpu"}),_t.disabled=!o().gpuAvailable,As=re(rn,1,"backend-label svelte-xicwp9",null,As,{active:o().backend==="gpu",unavailable:!o().gpuAvailable}),Bn=re(an,1,"panels-wrapper svelte-xicwp9",null,Bn,{swiping:n().isSwiping}),ys(an,`transform: ${f(de)??""}`),Xn=re(Ps,1,"play-btn svelte-xicwp9",null,Xn,{active:o().playing}),D(ti,`${f(E)??""}X`),Qn=re(Zn,1,"toggle-btn small svelte-xicwp9",null,Qn,{on:l().showScanlines}),D(yi,f(_)),D(Si,f(w)),D(Mi,f(P))}),ya("touchcancel",Ct,L),$t(lr,()=>f(_),m=>z(_,m)),$t(ur,()=>f(w),m=>z(w,m)),$t(vr,()=>f(P),m=>z(P,m)),Ta(dr,()=>f(k),m=>z(k,m)),T(e,ze),dt(),g()}ls(["click","touchstart","touchmove","touchend","input","keydown"]);var Lc=C('<div class="loading-screen svelte-1n46o8q"><div class="loading-content svelte-1n46o8q"><div class="glitch-text svelte-1n46o8q" data-text="FLOW_LENIA">FLOW_LENIA</div> <div class="loading-status svelte-1n46o8q"><span class="animate-pulse">INITIALIZING SUBSTRATE</span> <span class="animate-blink">_</span></div></div></div>'),Rc=C('<div class="error-screen svelte-1n46o8q"><div class="error-content svelte-1n46o8q"><div class="error-title svelte-1n46o8q">SYSTEM FAILURE</div> <div class="error-message svelte-1n46o8q"> </div> <div class="error-hint svelte-1n46o8q">Ensure WASM is built: <code class="svelte-1n46o8q">wasm-pack build --target web --release</code></div></div></div>'),Nc=C('<div class="mobile-header svelte-1n46o8q"><span class="mobile-title svelte-1n46o8q">FLOW_LENIA</span></div> <div class="mobile-canvas-container svelte-1n46o8q"><!></div> <!>',1),Fc=C('<!> <div class="main-content svelte-1n46o8q"><!> <!> <!></div> <!>',1),Gc=C('<div class="scanlines"></div>'),zc=C('<div><!></div> <!> <div class="vignette"></div>',1);function Bc(e,t){vt(t,!1);const s=()=>H(le,"$simulationStore",i),n=()=>H(sn,"$currentScheme",i),r=()=>H(Ne,"$mobileStore",i),a=()=>H(ht,"$settings",i),[i,o]=Bt();let l=oe(!1),c=oe(null),u=oe(),g=oe("");function d(w,P){const k=parseInt(w.slice(1,3),16),S=parseInt(w.slice(3,5),16),M=parseInt(w.slice(5,7),16);return`rgba(${k}, ${S}, ${M}, ${P})`}tn(async()=>{ml(),Ne.checkViewport(),window.addEventListener("resize",Ne.checkViewport),X("SYS.BOOT","info"),X("Loading WASM module...","info");try{await vl(),z(l,!0),X("WASM initialized","success"),X(`Backend: ${s().backend.toUpperCase()}`,"info"),X(`Theme: ${n().name}`,"info"),s().gpuAvailable?X("WebGPU available","success"):X("WebGPU not available","warn"),X("SYSTEM READY","success")}catch(w){z(c,String(w)),X(`INIT FAILED: ${w}`,"error")}}),ka(()=>{window.removeEventListener("resize",Ne.checkViewport)}),nt(()=>(s(),n()),()=>{const{width:w,height:P}=s().config,k=Math.max(1,w*P),S=s().totalMass/k,I=.15+Math.min(1,Math.max(0,S))*.45,y=n().colors;z(g,[`--color-primary-glow: ${d(y.primary,I)}`,`--color-secondary-glow: ${d(y.secondary,I)}`,`--color-tertiary-glow: ${d(y.tertiary,I)}`].join("; "))}),Qs(),ks();var p=qs(),b=Ee(p);{var E=w=>{var P=Lc();T(w,P)},_=w=>{var P=qs(),k=Ee(P);{var S=I=>{var y=Rc(),$=v(y),R=h(v($),2),O=v(R);G(()=>D(O,f(c))),T(I,y)},M=I=>{var y=zc(),$=Ee(y);let R;var O=v($);{var j=L=>{var ne=Nc(),ie=h(Ee(ne),2),ge=v(ie);Pr(ge,{});var we=h(ie,2);Oc(we,{}),T(L,ne)},B=L=>{var ne=Fc(),ie=Ee(ne);Sl(ie,{});var ge=h(ie,2),we=v(ge);Bl(we,{});var _e=h(we,2);Pr(_e,{});var ke=h(_e,2);uc(ke,{});var $e=h(ge,2);Ml($e),T(L,ne)};Q(O,L=>{r(),F(()=>r().isMobile)?L(j):L(B,!1)})}ss($,L=>z(u,L),()=>f(u));var se=h($,2);{var J=L=>{var ne=Gc();T(L,ne)};Q(se,L=>{a(),F(()=>a().showScanlines)&&L(J)})}G(()=>{R=re($,1,"app-container svelte-1n46o8q",null,R,{"mobile-layout":r().isMobile}),ys($,f(g))}),T(I,y)};Q(k,I=>{f(c)?I(S):I(M,!1)},!0)}T(w,P)};Q(b,w=>{!f(l)&&!f(c)?w(E):w(_,!1)})}T(e,p),dt(),o()}Yo(Bc,{target:document.getElementById("app")});
