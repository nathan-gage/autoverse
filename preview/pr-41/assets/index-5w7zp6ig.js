(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();const dn=!1;var Tn=Array.isArray,ki=Array.prototype.indexOf,qs=Array.from,Pr=Object.defineProperty,Zt=Object.getOwnPropertyDescriptor,Dr=Object.getOwnPropertyDescriptors,Ci=Object.prototype,$i=Array.prototype,kn=Object.getPrototypeOf,hr=Object.isExtensible;const at=()=>{};function Ii(t){return t()}function Fs(t){for(var e=0;e<t.length;e++)t[e]()}function Lr(){var t,e,s=new Promise((n,r)=>{t=n,e=r});return{promise:s,resolve:t,reject:e}}const fe=2,Cn=4,js=8,Ai=1<<24,ct=16,ut=32,Ft=64,Ws=128,Xe=512,ce=1024,ke=2048,qe=4096,Pe=8192,it=16384,$n=32768,Dt=65536,pr=1<<17,Or=1<<18,rs=1<<19,Rr=1<<20,rt=1<<25,Lt=32768,hn=1<<21,In=1<<22,yt=1<<23,ot=Symbol("$state"),Pi=Symbol("legacy props"),Di=Symbol(""),Kt=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Nr(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Li(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Oi(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ri(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ni(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Fi(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Gi(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function zi(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Bi(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Yi(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Ui(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Xi=1,qi=2,Fr=4,ji=8,Wi=16,Hi=1,Vi=2,Ki=4,Ji=8,Zi=16,Qi=1,eo=2,he=Symbol(),to="http://www.w3.org/1999/xhtml";function so(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function no(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Gr(t){return t===this.v}function zr(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Br(t){return!zr(t,this.v)}let as=!1,ro=!1;function ao(){as=!0}let ee=null;function Qt(t){ee=t}function ft(t,e=!1,s){ee={p:ee,i:!1,c:null,e:null,s:t,x:null,l:as&&!e?{s:null,u:null,$:[]}:null}}function vt(t){var e=ee,s=e.e;if(s!==null){e.e=null;for(var n of s)na(n)}return e.i=!0,ee=e.p,{}}function Ss(){return!as||ee!==null&&ee.l===null}let Ct=[];function Yr(){var t=Ct;Ct=[],Fs(t)}function is(t){if(Ct.length===0&&!ds){var e=Ct;queueMicrotask(()=>{e===Ct&&Yr()})}Ct.push(t)}function io(){for(;Ct.length>0;)Yr()}function Ur(t){var e=q;if(e===null)return Y.f|=yt,t;if((e.f&$n)===0){if((e.f&Ws)===0)throw t;e.b.error(t)}else es(t,e)}function es(t,e){for(;e!==null;){if((e.f&Ws)!==0)try{e.b.error(t);return}catch(s){t=s}e=e.parent}throw t}const Ps=new Set;let U=null,vs=null,Fe=null,Oe=[],Hs=null,pn=!1,ds=!1;class Ke{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#s=0;#l=null;#a=new Set;#r=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(e){Oe=[],vs=null,this.apply();var s={parent:null,effect:null,effects:[],render_effects:[]};for(const n of e)this.#i(n,s);this.is_fork||this.#u(),this.is_deferred()?(this.#o(s.effects),this.#o(s.render_effects)):(vs=this,U=null,gr(s.render_effects),gr(s.effects),vs=null,this.#l?.resolve()),Fe=null}#i(e,s){e.f^=ce;for(var n=e.first;n!==null;){var r=n.f,a=(r&(ut|Ft))!==0,i=a&&(r&ce)!==0,o=i||(r&Pe)!==0||this.skipped_effects.has(n);if((n.f&Ws)!==0&&n.b?.is_pending()&&(s={parent:s,effect:n,effects:[],render_effects:[]}),!o&&n.fn!==null){a?n.f^=ce:(r&Cn)!==0?s.effects.push(n):os(n)&&((n.f&ct)!==0&&this.#a.add(n),ts(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)c===s.effect&&(this.#o(s.effects),this.#o(s.render_effects),s=s.parent),n=c.next,c=c.parent}}#o(e){for(const s of e)(s.f&ke)!==0?this.#a.add(s):(s.f&qe)!==0&&this.#r.add(s),this.#c(s.deps),ue(s,ce)}#c(e){if(e!==null)for(const s of e)(s.f&fe)===0||(s.f&Lt)===0||(s.f^=Lt,this.#c(s.deps))}capture(e,s){this.previous.has(e)||this.previous.set(e,s),(e.f&yt)===0&&(this.current.set(e,e.v),Fe?.set(e,e.v))}activate(){U=this,this.apply()}deactivate(){U===this&&(U=null,Fe=null)}flush(){if(this.activate(),Oe.length>0){if(Xr(),U!==null&&U!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#u(){if(this.#s===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#f()}#f(){if(Ps.size>1){this.previous.clear();var e=Fe,s=!0,n={parent:null,effect:null,effects:[],render_effects:[]};for(const a of Ps){if(a===this){s=!1;continue}const i=[];for(const[l,c]of this.current){if(a.current.has(l))if(s&&c!==a.current.get(l))a.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...a.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Oe;Oe=[];const l=new Set,c=new Map;for(const u of i)qr(u,o,l,c);if(Oe.length>0){U=a,a.apply();for(const u of Oe)a.#i(u,n);a.deactivate()}Oe=r}}U=null,Fe=e}this.committed=!0,Ps.delete(this)}increment(e){this.#n+=1,e&&(this.#s+=1)}decrement(e){this.#n-=1,e&&(this.#s-=1),this.revive()}revive(){for(const e of this.#a)this.#r.delete(e),ue(e,ke),Ot(e);for(const e of this.#r)ue(e,qe),Ot(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Lr()).promise}static ensure(){if(U===null){const e=U=new Ke;Ps.add(U),ds||Ke.enqueue(()=>{U===e&&e.flush()})}return U}static enqueue(e){is(e)}apply(){}}function oo(t){var e=ds;ds=!0;try{for(var s;;){if(io(),Oe.length===0&&(U?.flush(),Oe.length===0))return Hs=null,s;Xr()}}finally{ds=e}}function Xr(){var t=At;pn=!0;var e=null;try{var s=0;for(zs(!0);Oe.length>0;){var n=Ke.ensure();if(s++>1e3){var r,a;lo()}n.process(Oe),xt.clear()}}finally{pn=!1,zs(t),Hs=null}}function lo(){try{Fi()}catch(t){es(t,Hs)}}let tt=null;function gr(t){var e=t.length;if(e!==0){for(var s=0;s<e;){var n=t[s++];if((n.f&(it|Pe))===0&&os(n)&&(tt=new Set,ts(n),n.deps===null&&n.first===null&&n.nodes===null&&(n.teardown===null&&n.ac===null?la(n):n.fn=null),tt?.size>0)){xt.clear();for(const r of tt){if((r.f&(it|Pe))!==0)continue;const a=[r];let i=r.parent;for(;i!==null;)tt.has(i)&&(tt.delete(i),a.push(i)),i=i.parent;for(let o=a.length-1;o>=0;o--){const l=a[o];(l.f&(it|Pe))===0&&ts(l)}}tt.clear()}}tt=null}}function qr(t,e,s,n){if(!s.has(t)&&(s.add(t),t.reactions!==null))for(const r of t.reactions){const a=r.f;(a&fe)!==0?qr(r,e,s,n):(a&(In|ct))!==0&&(a&ke)===0&&jr(r,e,n)&&(ue(r,ke),Ot(r))}}function jr(t,e,s){const n=s.get(t);if(n!==void 0)return n;if(t.deps!==null)for(const r of t.deps){if(e.includes(r))return!0;if((r.f&fe)!==0&&jr(r,e,s))return s.set(r,!0),!0}return s.set(t,!1),!1}function Ot(t){for(var e=Hs=t;e.parent!==null;){e=e.parent;var s=e.f;if(pn&&e===q&&(s&ct)!==0&&(s&Or)===0)return;if((s&(Ft|ut))!==0){if((s&ce)===0)return;e.f^=ce}}Oe.push(e)}function co(t){let e=0,s=Rt(0),n;return()=>{_s()&&(f(s),Ts(()=>(e===0&&(n=F(()=>t(()=>hs(s)))),e+=1,()=>{is(()=>{e-=1,e===0&&(n?.(),n=void 0,hs(s))})})))}}var uo=Dt|rs|Ws;function fo(t,e,s){new vo(t,e,s)}class vo{parent;#e=!1;#t;#n=null;#s;#l;#a;#r=null;#i=null;#o=null;#c=null;#u=null;#f=0;#v=0;#h=!1;#d=null;#b=co(()=>(this.#d=Rt(this.#f),()=>{this.#d=null}));constructor(e,s,n){this.#t=e,this.#s=s,this.#l=n,this.parent=q.b,this.#e=!!this.#s.pending,this.#a=Zs(()=>{q.b=this;{var r=this.#_();try{this.#r=Re(()=>n(r))}catch(a){this.error(a)}this.#v>0?this.#g():this.#e=!1}return()=>{this.#u?.remove()}},uo)}#w(){try{this.#r=Re(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#y(){const e=this.#s.pending;e&&(this.#i=Re(()=>e(this.#t)),Ke.enqueue(()=>{var s=this.#_();this.#r=this.#p(()=>(Ke.ensure(),Re(()=>this.#l(s)))),this.#v>0?this.#g():(It(this.#i,()=>{this.#i=null}),this.#e=!1)}))}#_(){var e=this.#t;return this.#e&&(this.#u=St(),this.#t.before(this.#u),e=this.#u),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#s.pending}#p(e){var s=q,n=Y,r=ee;Ze(this.#a),Me(this.#a),Qt(this.#a.ctx);try{return e()}catch(a){return Ur(a),null}finally{Ze(s),Me(n),Qt(r)}}#g(){const e=this.#s.pending;this.#r!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#u),fa(this.#r,this.#c)),this.#i===null&&(this.#i=Re(()=>e(this.#t)))}#m(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#m(e);return}this.#v+=e,this.#v===0&&(this.#e=!1,this.#i&&It(this.#i,()=>{this.#i=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(e){this.#m(e),this.#f+=e,this.#d&&Nt(this.#d,this.#f)}get_effect_pending(){return this.#b(),f(this.#d)}error(e){var s=this.#s.onerror;let n=this.#s.failed;if(this.#h||!s&&!n)throw e;this.#r&&(Te(this.#r),this.#r=null),this.#i&&(Te(this.#i),this.#i=null),this.#o&&(Te(this.#o),this.#o=null);var r=!1,a=!1;const i=()=>{if(r){no();return}r=!0,a&&Ui(),Ke.ensure(),this.#f=0,this.#o!==null&&It(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#r=this.#p(()=>(this.#h=!1,Re(()=>this.#l(this.#t)))),this.#v>0?this.#g():this.#e=!1};var o=Y;try{Me(null),a=!0,s?.(e,i),a=!1}catch(l){es(l,this.#a&&this.#a.parent)}finally{Me(o)}n&&is(()=>{this.#o=this.#p(()=>{Ke.ensure(),this.#h=!0;try{return Re(()=>{n(this.#t,()=>e,()=>i)})}catch(l){return es(l,this.#a.parent),null}finally{this.#h=!1}})})}}function ho(t,e,s,n){const r=Ss()?Es:An;if(s.length===0&&t.length===0){n(e.map(r));return}var a=U,i=q,o=po();function l(){Promise.all(s.map(c=>go(c))).then(c=>{o();try{n([...e.map(r),...c])}catch(u){(i.f&it)===0&&es(u,i)}a?.deactivate(),Gs()}).catch(c=>{es(c,i)})}t.length>0?Promise.all(t).then(()=>{o();try{return l()}finally{a?.deactivate(),Gs()}}):l()}function po(){var t=q,e=Y,s=ee,n=U;return function(a=!0){Ze(t),Me(e),Qt(s),a&&n?.activate()}}function Gs(){Ze(null),Me(null),Qt(null)}function Es(t){var e=fe|ke,s=Y!==null&&(Y.f&fe)!==0?Y:null;return q!==null&&(q.f|=rs),{ctx:ee,deps:null,effects:null,equals:Gr,f:e,fn:t,reactions:null,rv:0,v:he,wv:0,parent:s??q,ac:null}}function go(t,e){let s=q;s===null&&Li();var n=s.b,r=void 0,a=Rt(he),i=!Y,o=new Map;return Co(()=>{var l=Lr();r=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject).then(()=>{c===U&&c.committed&&c.deactivate(),Gs()})}catch(d){l.reject(d),Gs()}var c=U;if(i){var u=!n.is_pending();n.update_pending_count(1),c.increment(u),o.get(c)?.reject(Kt),o.delete(c),o.set(c,l)}const g=(d,p=void 0)=>{if(c.activate(),p)p!==Kt&&(a.f|=yt,Nt(a,p));else{(a.f&yt)!==0&&(a.f^=yt),Nt(a,d);for(const[b,E]of o){if(o.delete(b),b===c)break;E.reject(Kt)}}i&&(n.update_pending_count(-1),c.decrement(u))};l.promise.then(g,d=>g(null,d||"unknown"))}),Ks(()=>{for(const l of o.values())l.reject(Kt)}),new Promise(l=>{function c(u){function g(){u===r?l(a):c(r)}u.then(g,g)}c(r)})}function _o(t){const e=Es(t);return va(e),e}function An(t){const e=Es(t);return e.equals=Br,e}function Wr(t){var e=t.effects;if(e!==null){t.effects=null;for(var s=0;s<e.length;s+=1)Te(e[s])}}function mo(t){for(var e=t.parent;e!==null;){if((e.f&fe)===0)return(e.f&it)===0?e:null;e=e.parent}return null}function Pn(t){var e,s=q;Ze(mo(t));try{t.f&=~Lt,Wr(t),e=ga(t)}finally{Ze(s)}return e}function Hr(t){var e=Pn(t);if(t.equals(e)||(U?.is_fork||(t.v=e),t.wv=ha()),!Gt)if(Fe!==null)(_s()||U?.is_fork)&&Fe.set(t,e);else{var s=(t.f&Xe)===0?qe:ce;ue(t,s)}}let gn=new Set;const xt=new Map;let Vr=!1;function Rt(t,e){var s={f:0,v:t,reactions:null,equals:Gr,rv:0,wv:0};return s}function Se(t,e){const s=Rt(t);return va(s),s}function oe(t,e=!1,s=!0){const n=Rt(t);return e||(n.equals=Br),as&&s&&ee!==null&&ee.l!==null&&(ee.l.s??=[]).push(n),n}function bo(t,e){return z(t,F(()=>f(t))),e}function z(t,e,s=!1){Y!==null&&(!Je||(Y.f&pr)!==0)&&Ss()&&(Y.f&(fe|ct|In|pr))!==0&&!lt?.includes(t)&&Yi();let n=s?Jt(e):e;return Nt(t,n)}function Nt(t,e){if(!t.equals(e)){var s=t.v;Gt?xt.set(t,e):xt.set(t,s),t.v=e;var n=Ke.ensure();n.capture(t,s),(t.f&fe)!==0&&((t.f&ke)!==0&&Pn(t),ue(t,(t.f&Xe)!==0?ce:qe)),t.wv=ha(),Kr(t,ke),Ss()&&q!==null&&(q.f&ce)!==0&&(q.f&(ut|Ft))===0&&(Le===null?Po([t]):Le.push(t)),!n.is_fork&&gn.size>0&&!Vr&&wo()}return e}function wo(){Vr=!1;var t=At;zs(!0);const e=Array.from(gn);try{for(const s of e)(s.f&ce)!==0&&ue(s,qe),os(s)&&ts(s)}finally{zs(t)}gn.clear()}function hs(t){z(t,t.v+1)}function Kr(t,e){var s=t.reactions;if(s!==null)for(var n=Ss(),r=s.length,a=0;a<r;a++){var i=s[a],o=i.f;if(!(!n&&i===q)){var l=(o&ke)===0;if(l&&ue(i,e),(o&fe)!==0){var c=i;Fe?.delete(c),(o&Lt)===0&&(o&Xe&&(i.f|=Lt),Kr(c,qe))}else l&&((o&ct)!==0&&tt!==null&&tt.add(i),Ot(i))}}}function Jt(t){if(typeof t!="object"||t===null||ot in t)return t;const e=kn(t);if(e!==Ci&&e!==$i)return t;var s=new Map,n=Tn(t),r=Se(0),a=Pt,i=o=>{if(Pt===a)return o();var l=Y,c=Pt;Me(null),yr(a);var u=o();return Me(l),yr(c),u};return n&&s.set("length",Se(t.length)),new Proxy(t,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&zi();var u=s.get(l);return u===void 0?u=i(()=>{var g=Se(c.value);return s.set(l,g),g}):z(u,c.value,!0),!0},deleteProperty(o,l){var c=s.get(l);if(c===void 0){if(l in o){const u=i(()=>Se(he));s.set(l,u),hs(r)}}else z(c,he),hs(r);return!0},get(o,l,c){if(l===ot)return t;var u=s.get(l),g=l in o;if(u===void 0&&(!g||Zt(o,l)?.writable)&&(u=i(()=>{var p=Jt(g?o[l]:he),b=Se(p);return b}),s.set(l,u)),u!==void 0){var d=f(u);return d===he?void 0:d}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var u=s.get(l);u&&(c.value=f(u))}else if(c===void 0){var g=s.get(l),d=g?.v;if(g!==void 0&&d!==he)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return c},has(o,l){if(l===ot)return!0;var c=s.get(l),u=c!==void 0&&c.v!==he||Reflect.has(o,l);if(c!==void 0||q!==null&&(!u||Zt(o,l)?.writable)){c===void 0&&(c=i(()=>{var d=u?Jt(o[l]):he,p=Se(d);return p}),s.set(l,c));var g=f(c);if(g===he)return!1}return u},set(o,l,c,u){var g=s.get(l),d=l in o;if(n&&l==="length")for(var p=c;p<g.v;p+=1){var b=s.get(p+"");b!==void 0?z(b,he):p in o&&(b=i(()=>Se(he)),s.set(p+"",b))}if(g===void 0)(!d||Zt(o,l)?.writable)&&(g=i(()=>Se(void 0)),z(g,Jt(c)),s.set(l,g));else{d=g.v!==he;var E=i(()=>Jt(c));z(g,E)}var _=Reflect.getOwnPropertyDescriptor(o,l);if(_?.set&&_.set.call(u,c),!d){if(n&&typeof l=="string"){var w=s.get("length"),P=Number(l);Number.isInteger(P)&&P>=w.v&&z(w,P+1)}hs(r)}return!0},ownKeys(o){f(r);var l=Reflect.ownKeys(o).filter(g=>{var d=s.get(g);return d===void 0||d.v!==he});for(var[c,u]of s)u.v!==he&&!(c in o)&&l.push(c);return l},setPrototypeOf(){Bi()}})}function _r(t){try{if(t!==null&&typeof t=="object"&&ot in t)return t[ot]}catch{}return t}function yo(t,e){return Object.is(_r(t),_r(e))}var mr,Jr,Zr,Qr;function xo(){if(mr===void 0){mr=window,Jr=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,s=Text.prototype;Zr=Zt(e,"firstChild").get,Qr=Zt(e,"nextSibling").get,hr(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),hr(s)&&(s.__t=void 0)}}function St(t=""){return document.createTextNode(t)}function mt(t){return Zr.call(t)}function Ms(t){return Qr.call(t)}function v(t,e){return mt(t)}function Ee(t,e=!1){{var s=mt(t);return s instanceof Comment&&s.data===""?Ms(s):s}}function h(t,e=1,s=!1){let n=t;for(;e--;)n=Ms(n);return n}function So(t){t.textContent=""}function ea(){return!1}let br=!1;function Eo(){br||(br=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function Vs(t){var e=Y,s=q;Me(null),Ze(null);try{return t()}finally{Me(e),Ze(s)}}function ta(t,e,s,n=s){t.addEventListener(e,()=>Vs(s));const r=t.__on_r;r?t.__on_r=()=>{r(),n(!0)}:t.__on_r=()=>n(!0),Eo()}function sa(t){q===null&&(Y===null&&Ni(),Ri()),Gt&&Oi()}function Mo(t,e){var s=e.last;s===null?e.last=e.first=t:(s.next=t,t.prev=s,e.last=t)}function Qe(t,e,s){var n=q;n!==null&&(n.f&Pe)!==0&&(t|=Pe);var r={ctx:ee,deps:null,nodes:null,f:t|ke|Xe,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,wv:0,ac:null};if(s)try{ts(r),r.f|=$n}catch(o){throw Te(r),o}else e!==null&&Ot(r);var a=r;if(s&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&(a.f&rs)===0&&(a=a.first,(t&ct)!==0&&(t&Dt)!==0&&a!==null&&(a.f|=Dt)),a!==null&&(a.parent=n,n!==null&&Mo(a,n),Y!==null&&(Y.f&fe)!==0&&(t&Ft)===0)){var i=Y;(i.effects??=[]).push(a)}return r}function _s(){return Y!==null&&!Je}function Ks(t){const e=Qe(js,null,!1);return ue(e,ce),e.teardown=t,e}function ms(t){sa();var e=q.f,s=!Y&&(e&ut)!==0&&(e&$n)===0;if(s){var n=ee;(n.e??=[]).push(t)}else return na(t)}function na(t){return Qe(Cn|Rr,t,!1)}function To(t){return sa(),Qe(js|Rr,t,!0)}function ko(t){Ke.ensure();const e=Qe(Ft|rs,t,!0);return(s={})=>new Promise(n=>{s.outro?It(e,()=>{Te(e),n(void 0)}):(Te(e),n(void 0))})}function ra(t){return Qe(Cn,t,!1)}function st(t,e){var s=ee,n={effect:null,ran:!1,deps:t};s.l.$.push(n),n.effect=Ts(()=>{t(),!n.ran&&(n.ran=!0,F(e))})}function Js(){var t=ee;Ts(()=>{for(var e of t.l.$){e.deps();var s=e.effect;(s.f&ce)!==0&&ue(s,qe),os(s)&&ts(s),e.ran=!1}})}function Co(t){return Qe(In|rs,t,!0)}function Ts(t,e=0){return Qe(js|e,t,!0)}function G(t,e=[],s=[],n=[]){ho(n,e,s,r=>{Qe(js,()=>t(...r.map(f)),!0)})}function Zs(t,e=0){var s=Qe(ct|e,t,!0);return s}function Re(t){return Qe(ut|rs,t,!0)}function aa(t){var e=t.teardown;if(e!==null){const s=Gt,n=Y;wr(!0),Me(null);try{e.call(null)}finally{wr(s),Me(n)}}}function ia(t,e=!1){var s=t.first;for(t.first=t.last=null;s!==null;){const r=s.ac;r!==null&&Vs(()=>{r.abort(Kt)});var n=s.next;(s.f&Ft)!==0?s.parent=null:Te(s,e),s=n}}function $o(t){for(var e=t.first;e!==null;){var s=e.next;(e.f&ut)===0&&Te(e),e=s}}function Te(t,e=!0){var s=!1;(e||(t.f&Or)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(oa(t.nodes.start,t.nodes.end),s=!0),ia(t,e&&!s),Bs(t,0),ue(t,it);var n=t.nodes&&t.nodes.t;if(n!==null)for(const a of n)a.stop();aa(t);var r=t.parent;r!==null&&r.first!==null&&la(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function oa(t,e){for(;t!==null;){var s=t===e?null:Ms(t);t.remove(),t=s}}function la(t){var e=t.parent,s=t.prev,n=t.next;s!==null&&(s.next=n),n!==null&&(n.prev=s),e!==null&&(e.first===t&&(e.first=n),e.last===t&&(e.last=s))}function It(t,e,s=!0){var n=[];ca(t,n,!0);var r=()=>{s&&Te(t),e&&e()},a=n.length;if(a>0){var i=()=>--a||r();for(var o of n)o.out(i)}else r()}function ca(t,e,s){if((t.f&Pe)===0){t.f^=Pe;var n=t.nodes&&t.nodes.t;if(n!==null)for(const o of n)(o.is_global||s)&&e.push(o);for(var r=t.first;r!==null;){var a=r.next,i=(r.f&Dt)!==0||(r.f&ut)!==0&&(t.f&ct)!==0;ca(r,e,i?s:!1),r=a}}}function Dn(t){ua(t,!0)}function ua(t,e){if((t.f&Pe)!==0){t.f^=Pe,(t.f&ce)===0&&(ue(t,ke),Ot(t));for(var s=t.first;s!==null;){var n=s.next,r=(s.f&Dt)!==0||(s.f&ut)!==0;ua(s,r?e:!1),s=n}var a=t.nodes&&t.nodes.t;if(a!==null)for(const i of a)(i.is_global||e)&&i.in()}}function fa(t,e){if(t.nodes)for(var s=t.nodes.start,n=t.nodes.end;s!==null;){var r=s===n?null:Ms(s);e.append(s),s=r}}let Vt=null;function Io(t){var e=Vt;try{if(Vt=new Set,F(t),e!==null)for(var s of Vt)e.add(s);return Vt}finally{Vt=e}}function Ao(t){for(var e of Io(t))Nt(e,e.v)}let At=!1;function zs(t){At=t}let Gt=!1;function wr(t){Gt=t}let Y=null,Je=!1;function Me(t){Y=t}let q=null;function Ze(t){q=t}let lt=null;function va(t){Y!==null&&(lt===null?lt=[t]:lt.push(t))}let be=null,Ae=0,Le=null;function Po(t){Le=t}let da=1,bs=0,Pt=bs;function yr(t){Pt=t}function ha(){return++da}function os(t){var e=t.f;if((e&ke)!==0)return!0;if(e&fe&&(t.f&=~Lt),(e&qe)!==0){var s=t.deps;if(s!==null)for(var n=s.length,r=0;r<n;r++){var a=s[r];if(os(a)&&Hr(a),a.wv>t.wv)return!0}(e&Xe)!==0&&Fe===null&&ue(t,ce)}return!1}function pa(t,e,s=!0){var n=t.reactions;if(n!==null&&!lt?.includes(t))for(var r=0;r<n.length;r++){var a=n[r];(a.f&fe)!==0?pa(a,e,!1):e===a&&(s?ue(a,ke):(a.f&ce)!==0&&ue(a,qe),Ot(a))}}function ga(t){var e=be,s=Ae,n=Le,r=Y,a=lt,i=ee,o=Je,l=Pt,c=t.f;be=null,Ae=0,Le=null,Y=(c&(ut|Ft))===0?t:null,lt=null,Qt(t.ctx),Je=!1,Pt=++bs,t.ac!==null&&(Vs(()=>{t.ac.abort(Kt)}),t.ac=null);try{t.f|=hn;var u=t.fn,g=u(),d=t.deps;if(be!==null){var p;if(Bs(t,Ae),d!==null&&Ae>0)for(d.length=Ae+be.length,p=0;p<be.length;p++)d[Ae+p]=be[p];else t.deps=d=be;if(_s()&&(t.f&Xe)!==0)for(p=Ae;p<d.length;p++)(d[p].reactions??=[]).push(t)}else d!==null&&Ae<d.length&&(Bs(t,Ae),d.length=Ae);if(Ss()&&Le!==null&&!Je&&d!==null&&(t.f&(fe|qe|ke))===0)for(p=0;p<Le.length;p++)pa(Le[p],t);return r!==null&&r!==t&&(bs++,Le!==null&&(n===null?n=Le:n.push(...Le))),(t.f&yt)!==0&&(t.f^=yt),g}catch(b){return Ur(b)}finally{t.f^=hn,be=e,Ae=s,Le=n,Y=r,lt=a,Qt(i),Je=o,Pt=l}}function Do(t,e){let s=e.reactions;if(s!==null){var n=ki.call(s,t);if(n!==-1){var r=s.length-1;r===0?s=e.reactions=null:(s[n]=s[r],s.pop())}}s===null&&(e.f&fe)!==0&&(be===null||!be.includes(e))&&(ue(e,qe),(e.f&Xe)!==0&&(e.f^=Xe,e.f&=~Lt),Wr(e),Bs(e,0))}function Bs(t,e){var s=t.deps;if(s!==null)for(var n=e;n<s.length;n++)Do(t,s[n])}function ts(t){var e=t.f;if((e&it)===0){ue(t,ce);var s=q,n=At;q=t,At=!0;try{(e&(ct|Ai))!==0?$o(t):ia(t),aa(t);var r=ga(t);t.teardown=typeof r=="function"?r:null,t.wv=da;var a;dn&&ro&&(t.f&ke)!==0&&t.deps}finally{At=n,q=s}}}async function Lo(){await Promise.resolve(),oo()}function f(t){var e=t.f,s=(e&fe)!==0;if(Vt?.add(t),Y!==null&&!Je){var n=q!==null&&(q.f&it)!==0;if(!n&&!lt?.includes(t)){var r=Y.deps;if((Y.f&hn)!==0)t.rv<bs&&(t.rv=bs,be===null&&r!==null&&r[Ae]===t?Ae++:be===null?be=[t]:be.includes(t)||be.push(t));else{(Y.deps??=[]).push(t);var a=t.reactions;a===null?t.reactions=[Y]:a.includes(Y)||a.push(Y)}}}if(Gt){if(xt.has(t))return xt.get(t);if(s){var i=t,o=i.v;return((i.f&ce)===0&&i.reactions!==null||ma(i))&&(o=Pn(i)),xt.set(i,o),o}}else s&&(!Fe?.has(t)||U?.is_fork&&!_s())&&(i=t,os(i)&&Hr(i),At&&_s()&&(i.f&Xe)===0&&_a(i));if(Fe?.has(t))return Fe.get(t);if((t.f&yt)!==0)throw t.v;return t.v}function _a(t){if(t.deps!==null){t.f^=Xe;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&fe)!==0&&(e.f&Xe)===0&&_a(e)}}function ma(t){if(t.v===he)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(xt.has(e)||(e.f&fe)!==0&&ma(e))return!0;return!1}function F(t){var e=Je;try{return Je=!0,t()}finally{Je=e}}const Oo=-7169;function ue(t,e){t.f=t.f&Oo|e}function Ro(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(ot in t)_n(t);else if(!Array.isArray(t))for(let e in t){const s=t[e];typeof s=="object"&&s&&ot in s&&_n(s)}}}function _n(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let n in t)try{_n(t[n],e)}catch{}const s=kn(t);if(s!==Object.prototype&&s!==Array.prototype&&s!==Map.prototype&&s!==Set.prototype&&s!==Date.prototype){const n=Dr(s);for(let r in n){const a=n[r].get;if(a)try{a.call(t)}catch{}}}}}const No=["touchstart","touchmove"];function Fo(t){return No.includes(t)}const ba=new Set,mn=new Set;function Go(t,e,s,n={}){function r(a){if(n.capture||us.call(e,a),!a.cancelBubble)return Vs(()=>s?.call(this,a))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?is(()=>{e.addEventListener(t,r,n)}):e.addEventListener(t,r,n),r}function wa(t,e,s,n,r){var a={capture:n,passive:r},i=Go(t,e,s,a);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Ks(()=>{e.removeEventListener(t,i,a)})}function ls(t){for(var e=0;e<t.length;e++)ba.add(t[e]);for(var s of mn)s(t)}let xr=null;function us(t){var e=this,s=e.ownerDocument,n=t.type,r=t.composedPath?.()||[],a=r[0]||t.target;xr=t;var i=0,o=xr===t&&t.__root;if(o){var l=r.indexOf(o);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=r.indexOf(e);if(c===-1)return;l<=c&&(i=l)}if(a=r[i]||t.target,a!==e){Pr(t,"currentTarget",{configurable:!0,get(){return a||s}});var u=Y,g=q;Me(null),Ze(null);try{for(var d,p=[];a!==null;){var b=a.assignedSlot||a.parentNode||a.host||null;try{var E=a["__"+n];E!=null&&(!a.disabled||t.target===a)&&E.call(a,t)}catch(_){d?p.push(_):d=_}if(t.cancelBubble||b===e||b===null)break;a=b}if(d){for(let _ of p)queueMicrotask(()=>{throw _});throw d}}finally{t.__root=e,delete t.currentTarget,Me(u),Ze(g)}}}function ya(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Ys(t,e){var s=q;s.nodes===null&&(s.nodes={start:t,end:e,a:null,t:null})}function k(t,e){var s=(e&Qi)!==0,n=(e&eo)!==0,r,a=!t.startsWith("<!>");return()=>{r===void 0&&(r=ya(a?t:"<!>"+t),s||(r=mt(r)));var i=n||Jr?document.importNode(r,!0):r.cloneNode(!0);if(s){var o=mt(i),l=i.lastChild;Ys(o,l)}else Ys(i,i);return i}}function Us(){var t=document.createDocumentFragment(),e=document.createComment(""),s=St();return t.append(e,s),Ys(e,s),t}function T(t,e){t!==null&&t.before(e)}function D(t,e){var s=e==null?"":typeof e=="object"?e+"":e;s!==(t.__t??=t.nodeValue)&&(t.__t=s,t.nodeValue=s+"")}function zo(t,e){return Bo(t,e)}const Wt=new Map;function Bo(t,{target:e,anchor:s,props:n={},events:r,context:a,intro:i=!0}){xo();var o=new Set,l=g=>{for(var d=0;d<g.length;d++){var p=g[d];if(!o.has(p)){o.add(p);var b=Fo(p);e.addEventListener(p,us,{passive:b});var E=Wt.get(p);E===void 0?(document.addEventListener(p,us,{passive:b}),Wt.set(p,1)):Wt.set(p,E+1)}}};l(qs(ba)),mn.add(l);var c=void 0,u=ko(()=>{var g=s??e.appendChild(St());return fo(g,{pending:()=>{}},d=>{if(a){ft({});var p=ee;p.c=a}r&&(n.$$events=r),c=t(d,n)||{},a&&vt()}),()=>{for(var d of o){e.removeEventListener(d,us);var p=Wt.get(d);--p===0?(document.removeEventListener(d,us),Wt.delete(d)):Wt.set(d,p)}mn.delete(l),g!==s&&g.parentNode?.removeChild(g)}});return Yo.set(c,u),c}let Yo=new WeakMap;class xa{anchor;#e=new Map;#t=new Map;#n=new Map;#s=new Set;#l=!0;constructor(e,s=!0){this.anchor=e,this.#l=s}#a=()=>{var e=U;if(this.#e.has(e)){var s=this.#e.get(e),n=this.#t.get(s);if(n)Dn(n),this.#s.delete(s);else{var r=this.#n.get(s);r&&(this.#t.set(s,r.effect),this.#n.delete(s),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),n=r.effect)}for(const[a,i]of this.#e){if(this.#e.delete(a),a===e)break;const o=this.#n.get(i);o&&(Te(o.effect),this.#n.delete(i))}for(const[a,i]of this.#t){if(a===s||this.#s.has(a))continue;const o=()=>{if(Array.from(this.#e.values()).includes(a)){var c=document.createDocumentFragment();fa(i,c),c.append(St()),this.#n.set(a,{effect:i,fragment:c})}else Te(i);this.#s.delete(a),this.#t.delete(a)};this.#l||!n?(this.#s.add(a),It(i,o,!1)):o()}}};#r=e=>{this.#e.delete(e);const s=Array.from(this.#e.values());for(const[n,r]of this.#n)s.includes(n)||(Te(r.effect),this.#n.delete(n))};ensure(e,s){var n=U,r=ea();if(s&&!this.#t.has(e)&&!this.#n.has(e))if(r){var a=document.createDocumentFragment(),i=St();a.append(i),this.#n.set(e,{effect:Re(()=>s(i)),fragment:a})}else this.#t.set(e,Re(()=>s(this.anchor)));if(this.#e.set(n,e),r){for(const[o,l]of this.#t)o===e?n.skipped_effects.delete(l):n.skipped_effects.add(l);for(const[o,l]of this.#n)o===e?n.skipped_effects.delete(l.effect):n.skipped_effects.add(l.effect);n.oncommit(this.#a),n.ondiscard(this.#r)}else this.#a()}}function Q(t,e,s=!1){var n=new xa(t),r=s?Dt:0;function a(i,o){n.ensure(i,o)}Zs(()=>{var i=!1;e((o,l=!0)=>{i=!0,a(l,o)}),i||a(!1,null)},r)}function nt(t,e){return e}function Uo(t,e,s){for(var n=[],r=e.length,a,i=e.length,o=0;o<r;o++){let g=e[o];It(g,()=>{if(a){if(a.pending.delete(g),a.done.add(g),a.pending.size===0){var d=t.outrogroups;bn(qs(a.done)),d.delete(a),d.size===0&&(t.outrogroups=null)}}else i-=1},!1)}if(i===0){var l=n.length===0&&s!==null;if(l){var c=s,u=c.parentNode;So(u),u.append(c),t.items.clear()}bn(e,!l)}else a={pending:new Set(e),done:new Set},(t.outrogroups??=new Set).add(a)}function bn(t,e=!0){for(var s=0;s<t.length;s++)Te(t[s],e)}var Sr;function Ue(t,e,s,n,r,a=null){var i=t,o=new Map,l=(e&Fr)!==0;if(l){var c=t;i=c.appendChild(St())}var u=null,g=An(()=>{var w=s();return Tn(w)?w:w==null?[]:qs(w)}),d,p=!0;function b(){_.fallback=u,Xo(_,d,i,e,n),u!==null&&(d.length===0?(u.f&rt)===0?Dn(u):(u.f^=rt,fs(u,null,i)):It(u,()=>{u=null}))}var E=Zs(()=>{d=f(g);for(var w=d.length,P=new Set,C=U,S=ea(),M=0;M<w;M+=1){var I=d[M],y=n(I,M),$=p?null:o.get(y);$?($.v&&Nt($.v,I),$.i&&Nt($.i,M),S&&C.skipped_effects.delete($.e)):($=qo(o,p?i:Sr??=St(),I,y,M,r,e,s),p||($.e.f|=rt),o.set(y,$)),P.add(y)}if(w===0&&a&&!u&&(p?u=Re(()=>a(i)):(u=Re(()=>a(Sr??=St())),u.f|=rt)),!p)if(S){for(const[R,L]of o)P.has(R)||C.skipped_effects.add(L.e);C.oncommit(b),C.ondiscard(()=>{})}else b();f(g)}),_={effect:E,items:o,outrogroups:null,fallback:u};p=!1}function Xo(t,e,s,n,r){var a=(n&ji)!==0,i=e.length,o=t.items,l=t.effect.first,c,u=null,g,d=[],p=[],b,E,_,w;if(a)for(w=0;w<i;w+=1)b=e[w],E=r(b,w),_=o.get(E).e,(_.f&rt)===0&&(_.nodes?.a?.measure(),(g??=new Set).add(_));for(w=0;w<i;w+=1){if(b=e[w],E=r(b,w),_=o.get(E).e,t.outrogroups!==null)for(const L of t.outrogroups)L.pending.delete(_),L.done.delete(_);if((_.f&rt)!==0)if(_.f^=rt,_===l)fs(_,null,s);else{var P=u?u.next:l;_===t.effect.last&&(t.effect.last=_.prev),_.prev&&(_.prev.next=_.next),_.next&&(_.next.prev=_.prev),_t(t,u,_),_t(t,_,P),fs(_,P,s),u=_,d=[],p=[],l=u.next;continue}if((_.f&Pe)!==0&&(Dn(_),a&&(_.nodes?.a?.unfix(),(g??=new Set).delete(_))),_!==l){if(c!==void 0&&c.has(_)){if(d.length<p.length){var C=p[0],S;u=C.prev;var M=d[0],I=d[d.length-1];for(S=0;S<d.length;S+=1)fs(d[S],C,s);for(S=0;S<p.length;S+=1)c.delete(p[S]);_t(t,M.prev,I.next),_t(t,u,M),_t(t,I,C),l=C,u=I,w-=1,d=[],p=[]}else c.delete(_),fs(_,l,s),_t(t,_.prev,_.next),_t(t,_,u===null?t.effect.first:u.next),_t(t,u,_),u=_;continue}for(d=[],p=[];l!==null&&l!==_;)(c??=new Set).add(l),p.push(l),l=l.next;if(l===null)continue}(_.f&rt)===0&&d.push(_),u=_,l=_.next}if(t.outrogroups!==null){for(const L of t.outrogroups)L.pending.size===0&&(bn(qs(L.done)),t.outrogroups?.delete(L));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||c!==void 0){var y=[];if(c!==void 0)for(_ of c)(_.f&Pe)===0&&y.push(_);for(;l!==null;)(l.f&Pe)===0&&l!==t.fallback&&y.push(l),l=l.next;var $=y.length;if($>0){var R=(n&Fr)!==0&&i===0?s:null;if(a){for(w=0;w<$;w+=1)y[w].nodes?.a?.measure();for(w=0;w<$;w+=1)y[w].nodes?.a?.fix()}Uo(t,y,R)}}a&&is(()=>{if(g!==void 0)for(_ of g)_.nodes?.a?.apply()})}function qo(t,e,s,n,r,a,i,o){var l=(i&Xi)!==0?(i&Wi)===0?oe(s,!1,!1):Rt(s):null,c=(i&qi)!==0?Rt(r):null;return{v:l,i:c,e:Re(()=>(a(e,l??s,c??r,o),()=>{t.delete(n)}))}}function fs(t,e,s){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end,a=e&&(e.f&rt)===0?e.nodes.start:s;n!==null;){var i=Ms(n);if(a.before(n),n===r)return;n=i}}function _t(t,e,s){e===null?t.effect.first=s:e.next=s,s===null?t.effect.last=e:s.prev=e}function jo(t,e,s=!1,n=!1,r=!1){var a=t,i="";G(()=>{var o=q;if(i!==(i=e()??"")&&(o.nodes!==null&&(oa(o.nodes.start,o.nodes.end),o.nodes=null),i!=="")){var l=i+"";s?l=`<svg>${l}</svg>`:n&&(l=`<math>${l}</math>`);var c=ya(l);if((s||n)&&(c=mt(c)),Ys(mt(c),c.lastChild),s||n)for(;mt(c);)a.before(mt(c));else a.before(c)}})}function Wo(t,e,...s){var n=new xa(t);Zs(()=>{const r=e()??null;n.ensure(r,r&&(a=>r(a,...s)))},Dt)}function Sa(t){var e,s,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(s=Sa(t[e]))&&(n&&(n+=" "),n+=s)}else for(s in t)t[s]&&(n&&(n+=" "),n+=s);return n}function Ho(){for(var t,e,s=0,n="",r=arguments.length;s<r;s++)(t=arguments[s])&&(e=Sa(t))&&(n&&(n+=" "),n+=e);return n}function Vo(t){return typeof t=="object"?Ho(t):t??""}const Er=[...` 	
\r\fÂ \v\uFEFF`];function Ko(t,e,s){var n=t==null?"":""+t;if(e&&(n=n?n+" "+e:e),s){for(var r in s)if(s[r])n=n?n+" "+r:r;else if(n.length)for(var a=r.length,i=0;(i=n.indexOf(r,i))>=0;){var o=i+a;(i===0||Er.includes(n[i-1]))&&(o===n.length||Er.includes(n[o]))?n=(i===0?"":n.substring(0,i))+n.substring(o+1):i=o}}return n===""?null:n}function Jo(t,e){return t==null?null:String(t)}function re(t,e,s,n,r,a){var i=t.__className;if(i!==s||i===void 0){var o=Ko(s,n,a);o==null?t.removeAttribute("class"):t.className=o,t.__className=s}else if(a&&r!==a)for(var l in a){var c=!!a[l];(r==null||c!==!!r[l])&&t.classList.toggle(l,c)}return a}function ws(t,e,s,n){var r=t.__style;if(r!==e){var a=Jo(e);a==null?t.removeAttribute("style"):t.style.cssText=a,t.__style=e}return n}function Ea(t,e,s=!1){if(t.multiple){if(e==null)return;if(!Tn(e))return so();for(var n of t.options)n.selected=e.includes(ps(n));return}for(n of t.options){var r=ps(n);if(yo(r,e)){n.selected=!0;return}}(!s||e!==void 0)&&(t.selectedIndex=-1)}function Zo(t){var e=new MutationObserver(()=>{Ea(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ks(()=>{e.disconnect()})}function Ma(t,e,s=e){var n=new WeakSet,r=!0;ta(t,"change",a=>{var i=a?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(i),ps);else{var l=t.querySelector(i)??t.querySelector("option:not([disabled])");o=l&&ps(l)}s(o),U!==null&&n.add(U)}),ra(()=>{var a=e();if(t===document.activeElement){var i=vs??U;if(n.has(i))return}if(Ea(t,a,r),r&&a===void 0){var o=t.querySelector(":checked");o!==null&&(a=ps(o),s(a))}t.__value=a,r=!1}),Zo(t)}function ps(t){return"__value"in t?t.__value:t.value}const Qo=Symbol("is custom element"),el=Symbol("is html");function wn(t,e){var s=Ta(t);s.value===(s.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function Ge(t,e,s,n){var r=Ta(t);r[e]!==(r[e]=s)&&(e==="loading"&&(t[Di]=s),s==null?t.removeAttribute(e):typeof s!="string"&&tl(t).includes(e)?t[e]=s:t.setAttribute(e,s))}function Ta(t){return t.__attributes??={[Qo]:t.nodeName.includes("-"),[el]:t.namespaceURI===to}}var Mr=new Map;function tl(t){var e=t.getAttribute("is")||t.nodeName,s=Mr.get(e);if(s)return s;Mr.set(e,s=[]);for(var n,r=t,a=Element.prototype;a!==r;){n=Dr(r);for(var i in n)n[i].set&&s.push(i);r=kn(r)}return s}function $t(t,e,s=e){var n=new WeakSet;ta(t,"input",async r=>{var a=r?t.defaultValue:t.value;if(a=cn(t)?un(a):a,s(a),U!==null&&n.add(U),await Lo(),a!==(a=e())){var i=t.selectionStart,o=t.selectionEnd,l=t.value.length;if(t.value=a??"",o!==null){var c=t.value.length;i===o&&o===l&&c>l?(t.selectionStart=c,t.selectionEnd=c):(t.selectionStart=i,t.selectionEnd=Math.min(o,c))}}}),F(e)==null&&t.value&&(s(cn(t)?un(t.value):t.value),U!==null&&n.add(U)),Ts(()=>{var r=e();if(t===document.activeElement){var a=vs??U;if(n.has(a))return}cn(t)&&r===un(t.value)||t.type==="date"&&!r&&!t.value||r!==t.value&&(t.value=r??"")})}function cn(t){var e=t.type;return e==="number"||e==="range"}function un(t){return t===""?null:+t}function Tr(t,e){return t===e||t?.[ot]===e}function ss(t={},e,s,n){return ra(()=>{var r,a;return Ts(()=>{r=a,a=[],F(()=>{t!==s(...a)&&(e(t,...a),r&&Tr(s(...r),t)&&e(null,...r))})}),()=>{is(()=>{a&&Tr(s(...a),t)&&e(null,...a)})}}),t}function ks(t=!1){const e=ee,s=e.l.u;if(!s)return;let n=()=>Ro(e.s);if(t){let r=0,a={};const i=Es(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==a[c]&&(a[c]=l[c],o=!0);return o&&r++,r});n=()=>f(i)}s.b.length&&To(()=>{kr(e,n),Fs(s.b)}),ms(()=>{const r=F(()=>s.m.map(Ii));return()=>{for(const a of r)typeof a=="function"&&a()}}),s.a.length&&ms(()=>{kr(e,n),Fs(s.a)})}function kr(t,e){if(t.l.s)for(const s of t.l.s)f(s);e()}function Ln(t,e,s){if(t==null)return e(void 0),s&&s(void 0),at;const n=F(()=>t.subscribe(e,s));return n.unsubscribe?()=>n.unsubscribe():n}const Ht=[];function sl(t,e){return{subscribe:je(t,e).subscribe}}function je(t,e=at){let s=null;const n=new Set;function r(o){if(zr(t,o)&&(t=o,s)){const l=!Ht.length;for(const c of n)c[1](),Ht.push(c,t);if(l){for(let c=0;c<Ht.length;c+=2)Ht[c][0](Ht[c+1]);Ht.length=0}}}function a(o){r(o(t))}function i(o,l=at){const c=[o,l];return n.add(c),n.size===1&&(s=e(r,a)||at),o(t),()=>{n.delete(c),n.size===0&&s&&(s(),s=null)}}return{set:r,update:a,subscribe:i}}function zt(t,e,s){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return sl(s,(i,o)=>{let l=!1;const c=[];let u=0,g=at;const d=()=>{if(u)return;g();const b=e(n?c[0]:c,i,o);a?i(b):g=typeof b=="function"?b:at},p=r.map((b,E)=>Ln(b,_=>{c[E]=_,u&=~(1<<E),l&&d()},()=>{u|=1<<E}));return l=!0,d(),function(){Fs(p),g(),l=!1}})}function et(t){let e;return Ln(t,s=>e=s)(),e}let Ds=!1,yn=Symbol();function H(t,e,s){const n=s[e]??={store:null,source:oe(void 0),unsubscribe:at};if(n.store!==t&&!(yn in s))if(n.unsubscribe(),n.store=t??null,t==null)n.source.v=void 0,n.unsubscribe=at;else{var r=!0;n.unsubscribe=Ln(t,a=>{r?n.source.v=a:z(n.source,a)}),r=!1}return t&&yn in s?et(t):f(n.source)}function Bt(){const t={};function e(){Ks(()=>{for(var s in t)t[s].unsubscribe();Pr(t,yn,{enumerable:!1,value:!0})})}return[t,e]}function nl(t){var e=Ds;try{return Ds=!1,[t(),Ds]}finally{Ds=e}}function Ve(t,e,s,n){var r=!as||(s&Vi)!==0,a=(s&Ji)!==0,i=(s&Zi)!==0,o=n,l=!0,c=()=>(l&&(l=!1,o=i?F(n):n),o),u;if(a){var g=ot in t||Pi in t;u=Zt(t,e)?.set??(g&&e in t?C=>t[e]=C:void 0)}var d,p=!1;a?[d,p]=nl(()=>t[e]):d=t[e],d===void 0&&n!==void 0&&(d=c(),u&&(r&&Gi(),u(d)));var b;if(r?b=()=>{var C=t[e];return C===void 0?c():(l=!0,C)}:b=()=>{var C=t[e];return C!==void 0&&(o=void 0),C===void 0?o:C},r&&(s&Ki)===0)return b;if(u){var E=t.$$legacy;return(function(C,S){return arguments.length>0?((!r||!S||E||p)&&u(S?b():C),C):b()})}var _=!1,w=((s&Hi)!==0?Es:An)(()=>(_=!1,b()));a&&f(w);var P=q;return(function(C,S){if(arguments.length>0){const M=S?f(w):r&&a?Jt(C):C;return z(w,M),_=!0,o!==void 0&&(o=M),C}return Gt&&_||(P.f&it)!==0?w.v:f(w)})}function Qs(t){ee===null&&Nr(),as&&ee.l!==null?rl(ee).m.push(t):ms(()=>{const e=F(t);if(typeof e=="function")return e})}function ka(t){ee===null&&Nr(),Qs(()=>()=>F(t))}function rl(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}const al="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(al);ao();class il{propagator=null;config;currentSeed;isInitialized=!1;wasmModule=null;currentBackend="cpu";gpuAvailable=!1;constructor(e,s){this.config=e,this.currentSeed=s}async initialize(e="cpu"){try{const n="/autoverse/preview/pr-41/pkg/flow_lenia.js";this.wasmModule=await import(n),await this.wasmModule.default(),this.gpuAvailable=await this.checkWebGPU();const r=e==="gpu"&&this.gpuAvailable?"gpu":"cpu";await this.createPropagator(r),this.isInitialized=!0}catch(s){throw new Error(`Failed to initialize WASM: ${s}`)}}async checkWebGPU(){if(typeof navigator>"u"||!("gpu"in navigator))return!1;try{return await navigator.gpu.requestAdapter()!==null}catch{return!1}}async createPropagator(e){if(!this.wasmModule)throw new Error("WASM module not loaded");const s=JSON.stringify(this.config),n=JSON.stringify(this.currentSeed);e==="gpu"&&this.gpuAvailable?(this.propagator=await new this.wasmModule.WasmGpuPropagator(s,n),this.currentBackend="gpu"):(this.propagator=new this.wasmModule.WasmPropagator(s,n),this.currentBackend="cpu")}async switchBackend(e){if(!this.isInitialized)throw new Error("Simulation not initialized");return e==="gpu"&&!this.gpuAvailable?!1:(e===this.currentBackend||await this.createPropagator(e),!0)}isGpuAvailable(){return this.gpuAvailable}getBackend(){return this.currentBackend}async step(){this.ensureInitialized(),this.currentBackend==="gpu"?await this.propagator.step():this.propagator.step()}async run(e){this.ensureInitialized(),this.currentBackend==="gpu"?await this.propagator.run(BigInt(e)):this.propagator.run(BigInt(e))}getState(){return this.ensureInitialized(),this.propagator.getState()}reset(e){this.ensureInitialized(),e&&(this.currentSeed=e),this.propagator.reset(JSON.stringify(this.currentSeed))}totalMass(){return this.ensureInitialized(),this.propagator.totalMass()}getTime(){return this.ensureInitialized(),this.propagator.getTime()}getStep(){return this.ensureInitialized(),this.propagator.getStep()}getWidth(){return this.config.width}getHeight(){return this.config.height}getConfig(){return{...this.config}}extractRegion(e,s,n,r){this.ensureInitialized();const a=this.getState(),i=[];for(let o=0;o<a.channels.length;o++){const l=[];for(let c=0;c<r;c++)for(let u=0;u<n;u++){const g=(e+u)%a.width,p=(s+c)%a.height*a.width+g;l.push(a.channels[o][p])}i.push(l)}return{width:n,height:r,channels:i,sourceX:e,sourceY:s}}placeRegion(e,s,n){this.ensureInitialized();const r=this.getState(),a=new Map;for(let l=0;l<r.channels.length;l++)for(let c=0;c<r.height;c++)for(let u=0;u<r.width;u++){const g=c*r.width+u,d=r.channels[l][g];d>.001&&a.set(`${u},${c},${l}`,d)}for(let l=0;l<e.channels.length;l++)for(let c=0;c<e.height;c++)for(let u=0;u<e.width;u++){const g=(s+u)%this.config.width,d=(n+c)%this.config.height,p=c*e.width+u,b=e.channels[l][p];b>.001&&a.set(`${g},${d},${l}`,b)}const i=[];for(const[l,c]of a){const[u,g,d]=l.split(",").map(Number);i.push([u,g,d,c])}const o={pattern:{type:"Custom",values:i}};this.reset(o)}drawAt(e,s,n,r,a=0){this.ensureInitialized();const i=this.getState(),o=[];for(let c=0;c<i.channels.length;c++)for(let u=0;u<i.height;u++)for(let g=0;g<i.width;g++){const d=u*i.width+g;let p=i.channels[c][d];if(c===a){const b=g-e,E=u-s,_=Math.sqrt(b*b+E*E);if(_<=n){const w=1-_/n;p=Math.min(1,p+r*w*w)}}p>.001&&o.push([g,u,c,p])}const l={pattern:{type:"Custom",values:o}};this.reset(l)}eraseAt(e,s,n,r=0){this.ensureInitialized();const a=this.getState(),i=[];for(let l=0;l<a.channels.length;l++)for(let c=0;c<a.height;c++)for(let u=0;u<a.width;u++){const g=c*a.width+u;let d=a.channels[l][g];if(l===r){const p=u-e,b=c-s,E=Math.sqrt(p*p+b*b);if(E<=n){const _=1-E/n;d=Math.max(0,d*(1-_*_))}}d>.001&&i.push([u,c,l,d])}const o={pattern:{type:"Custom",values:i}};this.reset(o)}ensureInitialized(){if(!this.isInitialized||!this.propagator)throw new Error("Simulation not initialized. Call initialize() first.")}}const xn={width:128,height:128,channels:1,dt:.1,kernel_radius:13,kernels:[{radius:1,rings:[{amplitude:1,distance:.5,width:.15}],weight:1,mu:.15,sigma:.015,source_channel:0,target_channel:0}],flow:{beta_a:1,n:2,distribution_size:1}},ol={pattern:{type:"GaussianBlob",center:[.5,.5],radius:.1,amplitude:1,channel:0}},ll={initialized:!1,playing:!1,step:0,time:0,totalMass:0,fps:0,frameTime:0,backend:"cpu",gpuAvailable:!1,config:xn,state:null},le=je(ll),Ca=je([]);function X(t,e="info"){Ca.update(s=>[...s.slice(-100),{message:t,level:e,timestamp:Date.now()}])}let te=null,Os=null,gs=0,Rs=0,Sn=0,$a=60,Ns=0;function Xs(){return te}function Ia(t){$a=Math.max(1,Math.min(480,t)),Ns=0}function cl(t){Ia(60*Math.max(1,Math.min(10,t)))}async function ul(){te=new il(xn,ol),await te.initialize();const t=te.getState();le.update(e=>({...e,initialized:!0,step:te.getStep(),time:te.getTime(),totalMass:te.totalMass(),backend:te.getBackend(),gpuAvailable:te.isGpuAvailable(),config:xn,state:t}))}function Aa(){!te||et(le).playing||(le.update(e=>({...e,playing:!0})),gs=performance.now(),Sn=gs,Rs=0,La(gs),X("Simulation started","info"))}function On(){le.update(t=>({...t,playing:!1})),Os!==null&&(cancelAnimationFrame(Os),Os=null),X("Simulation paused","info")}async function Pa(){te&&(await te.step(),Rn())}function ys(t){te&&(te.reset(t),Rn(),X("Simulation reset","info"))}async function Da(t){if(!te)return!1;const e=await te.switchBackend(t);return e?(le.update(s=>({...s,backend:t})),X(`Switched to ${t.toUpperCase()} backend`,"success")):X(`Failed to switch to ${t} backend`,"error"),e}async function La(t){if(!et(le).playing||!te)return;let s=t-gs;gs=t;const n=250;s>n&&(s=n,Ns=0);const r=$a*s/1e3+Ns,a=Math.floor(r);Ns=r-a,a>0&&await te.run(a),Rn(),Rs++,t-Sn>=1e3&&(le.update(i=>({...i,fps:Rs,frameTime:s})),Rs=0,Sn=t),Os=requestAnimationFrame(i=>La(i))}function Rn(){if(!te)return;const t=te.getState();le.update(e=>({...e,step:te.getStep(),time:te.getTime(),totalMass:te.totalMass(),state:t}))}const fl=zt(le,t=>t.time.toFixed(2)),Oa=zt(le,t=>t.totalMass.toLocaleString(void 0,{maximumFractionDigits:0})),Ra=zt(le,t=>t.step.toString().padStart(8,"0")),vl={mode:"view",brushSize:5,brushIntensity:.8,colorScheme:"theme",visualizationMode:"mass",showGrid:!1,showScanlines:!0,showSelection:!0,zoom:1,panX:0,panY:0},dt=je(vl);function Na(t){dt.update(e=>({...e,mode:t}))}function Fa(t){dt.update(e=>({...e,brushSize:Math.max(1,Math.min(50,t))}))}function Ga(t){dt.update(e=>({...e,brushIntensity:Math.max(0,Math.min(1,t))}))}function dl(t){dt.update(e=>({...e,colorScheme:t}))}function hl(){dt.update(t=>({...t,showScanlines:!t.showScanlines}))}const xs=[{id:"void",name:"VOID",colors:{primary:"#a855f7",primaryDim:"#6b21a8",primaryGlow:"rgba(168, 85, 247, 0.4)",secondary:"#3b82f6",secondaryDim:"#1e40af",secondaryGlow:"rgba(59, 130, 246, 0.4)",tertiary:"#ec4899",tertiaryDim:"#9d174d",tertiaryGlow:"rgba(236, 72, 153, 0.4)",success:"#a855f7",warning:"#f59e0b",danger:"#ef4444"}},{id:"neon-tokyo",name:"NEON TOKYO",colors:{primary:"#ff2d95",primaryDim:"#9d1a5a",primaryGlow:"rgba(255, 45, 149, 0.4)",secondary:"#00f0ff",secondaryDim:"#0891b2",secondaryGlow:"rgba(0, 240, 255, 0.4)",tertiary:"#ffee00",tertiaryDim:"#a38a00",tertiaryGlow:"rgba(255, 238, 0, 0.4)",success:"#00f0ff",warning:"#ffee00",danger:"#ff2d95"}},{id:"synthwave",name:"SYNTHWAVE",colors:{primary:"#f472b6",primaryDim:"#a21caf",primaryGlow:"rgba(244, 114, 182, 0.4)",secondary:"#818cf8",secondaryDim:"#4338ca",secondaryGlow:"rgba(129, 140, 248, 0.4)",tertiary:"#22d3ee",tertiaryDim:"#0e7490",tertiaryGlow:"rgba(34, 211, 238, 0.4)",success:"#22d3ee",warning:"#fbbf24",danger:"#f43f5e"}},{id:"bloodmoon",name:"BLOODMOON",colors:{primary:"#dc2626",primaryDim:"#7f1d1d",primaryGlow:"rgba(220, 38, 38, 0.4)",secondary:"#f97316",secondaryDim:"#9a3412",secondaryGlow:"rgba(249, 115, 22, 0.4)",tertiary:"#fbbf24",tertiaryDim:"#92400e",tertiaryGlow:"rgba(251, 191, 36, 0.4)",success:"#f97316",warning:"#fbbf24",danger:"#dc2626"}},{id:"toxic",name:"TOXIC",colors:{primary:"#84cc16",primaryDim:"#3f6212",primaryGlow:"rgba(132, 204, 22, 0.5)",secondary:"#facc15",secondaryDim:"#854d0e",secondaryGlow:"rgba(250, 204, 21, 0.4)",tertiary:"#22c55e",tertiaryDim:"#166534",tertiaryGlow:"rgba(34, 197, 94, 0.4)",success:"#22c55e",warning:"#facc15",danger:"#ef4444"}},{id:"ice",name:"ICE",colors:{primary:"#38bdf8",primaryDim:"#0369a1",primaryGlow:"rgba(56, 189, 248, 0.4)",secondary:"#e0f2fe",secondaryDim:"#7dd3fc",secondaryGlow:"rgba(224, 242, 254, 0.3)",tertiary:"#a5b4fc",tertiaryDim:"#4f46e5",tertiaryGlow:"rgba(165, 180, 252, 0.4)",success:"#38bdf8",warning:"#fcd34d",danger:"#f87171"}},{id:"hacker",name:"HACKER",colors:{primary:"#22c55e",primaryDim:"#166534",primaryGlow:"rgba(34, 197, 94, 0.5)",secondary:"#4ade80",secondaryDim:"#15803d",secondaryGlow:"rgba(74, 222, 128, 0.4)",tertiary:"#86efac",tertiaryDim:"#22c55e",tertiaryGlow:"rgba(134, 239, 172, 0.3)",success:"#22c55e",warning:"#fbbf24",danger:"#ef4444"}},{id:"phosphor",name:"PHOSPHOR",colors:{primary:"#fef08a",primaryDim:"#a16207",primaryGlow:"rgba(254, 240, 138, 0.5)",secondary:"#fde047",secondaryDim:"#854d0e",secondaryGlow:"rgba(253, 224, 71, 0.4)",tertiary:"#fbbf24",tertiaryDim:"#92400e",tertiaryGlow:"rgba(251, 191, 36, 0.4)",success:"#a3e635",warning:"#fbbf24",danger:"#f87171"}}],en=je(xs[0]);function En(t){const e=document.documentElement,{colors:s}=t;e.style.setProperty("--color-primary",s.primary),e.style.setProperty("--color-primary-dim",s.primaryDim),e.style.setProperty("--color-primary-glow",s.primaryGlow),e.style.setProperty("--color-secondary",s.secondary),e.style.setProperty("--color-secondary-dim",s.secondaryDim),e.style.setProperty("--color-secondary-glow",s.secondaryGlow),e.style.setProperty("--color-tertiary",s.tertiary),e.style.setProperty("--color-tertiary-dim",s.tertiaryDim),e.style.setProperty("--color-tertiary-glow",s.tertiaryGlow),e.style.setProperty("--color-success",s.success),e.style.setProperty("--color-warning",s.warning),e.style.setProperty("--color-danger",s.danger),en.set(t),localStorage.setItem("autoverse-theme",t.id)}function pl(t){const e=xs.find(s=>s.id===t);e&&En(e)}function gl(){const t=localStorage.getItem("autoverse-theme");if(t){const e=xs.find(s=>s.id===t);if(e){En(e);return}}En(xs[0])}const Cr=900,De=["controls","display","presets","patterns","evolve"];function _l(){const{subscribe:t,set:e,update:s}=je({isMobile:typeof window<"u"&&window.innerWidth<=Cr,activeTab:"controls",swipeOffset:0,isSwiping:!1});return{subscribe:t,set:e,update:s,checkViewport:()=>{if(typeof window>"u")return;const n=window.innerWidth<=Cr;s(r=>({...r,isMobile:n}))},setTab:n=>{s(r=>({...r,activeTab:n,swipeOffset:0}))},nextTab:()=>{s(n=>{const r=De.indexOf(n.activeTab),a=Math.min(r+1,De.length-1);return{...n,activeTab:De[a],swipeOffset:0}})},prevTab:()=>{s(n=>{const r=De.indexOf(n.activeTab),a=Math.max(r-1,0);return{...n,activeTab:De[a],swipeOffset:0}})},startSwipe:()=>{s(n=>({...n,isSwiping:!0}))},updateSwipe:n=>{s(r=>({...r,swipeOffset:n}))},endSwipe:n=>{const r=et({subscribe:t}),a=n*.2,i=r.swipeOffset;if(Math.abs(i)>a)if(i>0){const o=De.indexOf(r.activeTab);if(o>0){e({...r,activeTab:De[o-1],swipeOffset:0,isSwiping:!1});return}}else{const o=De.indexOf(r.activeTab);if(o<De.length-1){e({...r,activeTab:De[o+1],swipeOffset:0,isSwiping:!1});return}}s(o=>({...o,swipeOffset:0,isSwiping:!1}))}}}const Ne=_l(),ml=zt(Ne,t=>De.indexOf(t.activeTab)),fn=De;var bl=k("<button></button>"),wl=k('<header class="header svelte-4b3o1e"><div class="header-left svelte-4b3o1e"><pre class="ascii-logo svelte-4b3o1e"></pre></div> <div class="header-right svelte-4b3o1e"><div class="theme-picker svelte-4b3o1e"><span class="picker-label svelte-4b3o1e">THEME</span> <div class="theme-swatches svelte-4b3o1e"></div></div> <div><span class="backend-label svelte-4b3o1e">COMPUTE</span> <span class="backend-value svelte-4b3o1e"> </span></div></div></header>');function yl(t,e){ft(e,!1);const s=()=>H(en,"$currentScheme",r),n=()=>H(le,"$simulationStore",r),[r,a]=Bt();ks();var i=wl(),o=v(i),l=v(o);l.textContent=`
 âââ â â âââ âââ â â âââ âââ âââ âââ
 âââ âââ  â  â â âââ âââ âââ âââ âââ`;var c=h(o,2),u=v(c),g=h(v(u),2);Ue(g,5,()=>xs,nt,(_,w)=>{var P=bl();let C;P.__click=()=>pl(f(w).id),G(()=>{C=re(P,1,"swatch svelte-4b3o1e",null,C,{active:s().id===f(w).id}),ws(P,`--swatch-color: ${f(w).colors.primary??""}`),Ge(P,"title",f(w).name)}),T(_,P)});var d=h(u,2);let p;var b=h(v(d),2),E=v(b);G(_=>{p=re(d,1,"backend-indicator svelte-4b3o1e",null,p,{gpu:n().backend==="gpu"}),D(E,_)},[()=>n().backend.toUpperCase()]),T(t,i),vt(),a()}ls(["click"]);var xl=k('<footer class="footer svelte-ww03jg"></footer>');function Sl(t){var e=xl();T(t,e)}var El=k("<div> </div>"),Ml=k('<div><div class="corner top-left svelte-1gtc57s"></div> <div class="corner top-right svelte-1gtc57s"></div> <div class="corner bottom-left svelte-1gtc57s"></div> <div class="corner bottom-right svelte-1gtc57s"></div> <!> <div><!></div></div>');function bt(t,e){let s=Ve(e,"borderColor",3,"primary"),n=Ve(e,"noPadding",3,!1),r=Ve(e,"class",3,"");const a={primary:"border-primary",secondary:"border-secondary",tertiary:"border-tertiary"};var i=Ml(),o=h(v(i),8);{var l=d=>{var p=El(),b=v(p);G(()=>{re(p,1,`title ${a[s()]??""}`,"svelte-1gtc57s"),D(b,e.title)}),T(d,p)};Q(o,d=>{e.title&&d(l)})}var c=h(o,2);let u;var g=v(c);Wo(g,()=>e.children??at),G(()=>{re(i,1,`tui-box ${a[s()]??""} ${r()??""}`,"svelte-1gtc57s"),u=re(c,1,"content svelte-1gtc57s",null,u,{"no-padding":n()})}),T(t,i)}var Tl=k('<span class="label svelte-1l5vt72"> </span>'),kl=k("<span> </span>"),Cl=k('<div class="slider-header svelte-1l5vt72"><!> <!></div>'),$l=k('<div class="slider-container svelte-1l5vt72"><!> <input type="range"/></div>');function vn(t,e){ft(e,!0);let s=Ve(e,"value",15),n=Ve(e,"min",3,0),r=Ve(e,"max",3,100),a=Ve(e,"step",3,1),i=Ve(e,"showValue",3,!0),o=Ve(e,"valueFormat",3,b=>String(b)),l=Ve(e,"color",3,"tertiary");function c(b){const E=b.target;s(parseFloat(E.value)),e.onchange?.(s())}var u=$l(),g=v(u);{var d=b=>{var E=Cl(),_=v(E);{var w=S=>{var M=Tl(),I=v(M);G(()=>D(I,e.label)),T(S,M)};Q(_,S=>{e.label&&S(w)})}var P=h(_,2);{var C=S=>{var M=kl(),I=v(M);G(y=>{re(M,1,`value ${l()??""}`,"svelte-1l5vt72"),D(I,y)},[()=>o()(s())]),T(S,M)};Q(P,S=>{i()&&S(C)})}T(b,E)};Q(g,b=>{(e.label||i())&&b(d)})}var p=h(g,2);p.__input=c,G(()=>{re(p,1,Vo(l()),"svelte-1l5vt72"),Ge(p,"min",n()),Ge(p,"max",r()),Ge(p,"step",a()),wn(p,s())}),T(t,u),vt()}ls(["input"]);var Il=k('<span class="icon svelte-oaxjxu">&#9724;</span> <span class="label svelte-oaxjxu">PAUSE</span>',1),Al=k('<span class="icon svelte-oaxjxu">&#9654;</span> <span class="label svelte-oaxjxu">PLAY</span>',1),Pl=k('<div class="control-grid svelte-oaxjxu"><button><!></button> <button class="control-btn svelte-oaxjxu"><span class="icon svelte-oaxjxu">&#9655;</span> <span class="label svelte-oaxjxu">STEP</span></button> <button class="control-btn svelte-oaxjxu"><span class="icon svelte-oaxjxu">&#8634;</span> <span class="label svelte-oaxjxu">RESET</span></button></div> <div class="speed-control svelte-oaxjxu"><!></div>',1),Dl=k('<button><span class="icon svelte-oaxjxu"><!></span> <span class="label svelte-oaxjxu"> </span></button>'),Ll=k('<div class="brush-settings svelte-oaxjxu"><!> <!></div>'),Ol=k('<div class="tool-grid svelte-oaxjxu"></div> <!>',1),Rl=k('<div><span class="log-prefix svelte-oaxjxu">&gt;</span> <span class="log-message svelte-oaxjxu"> </span></div>'),Nl=k('<div class="log-container svelte-oaxjxu"></div>'),Fl=k('<aside class="left-sidebar svelte-oaxjxu"><!> <!> <!></aside>');function Gl(t,e){ft(e,!0);const s=()=>H(le,"$simulationStore",a),n=()=>H(dt,"$settings",a),r=()=>H(Ca,"$systemLog",a),[a,i]=Bt();let o=Se(60);function l(E){z(o,E,!0),Ia(E)}function c(E){Na(E)}const u=[{id:"view",label:"VIEW",icon:"&#9673;"},{id:"select",label:"SEL",icon:"&#9633;"},{id:"draw",label:"DRAW",icon:"&#9998;"},{id:"erase",label:"ERASE",icon:"&#9747;"}];var g=Fl(),d=v(g);bt(d,{title:"SYS.CONTROL",borderColor:"primary",children:(E,_)=>{var w=Pl(),P=Ee(w),C=v(P);let S;C.__click=()=>s().playing?On():Aa();var M=v(C);{var I=B=>{var se=Il();T(B,se)},y=B=>{var se=Al();T(B,se)};Q(M,B=>{s().playing?B(I):B(y,!1)})}var $=h(C,2);$.__click=()=>Pa();var R=h($,2);R.__click=()=>ys();var L=h(P,2),j=v(L);vn(j,{label:"SIM SPEED",min:15,max:480,step:15,color:"primary",valueFormat:B=>`${B} steps/s`,onchange:l,get value(){return f(o)},set value(B){z(o,B,!0)}}),G(()=>S=re(C,1,"control-btn svelte-oaxjxu",null,S,{active:!s().playing})),T(E,w)},$$slots:{default:!0}});var p=h(d,2);bt(p,{title:"TOOL.KIT",borderColor:"tertiary",children:(E,_)=>{var w=Ol(),P=Ee(w);Ue(P,21,()=>u,nt,(M,I)=>{var y=Dl();let $;y.__click=()=>c(f(I).id);var R=v(y),L=v(R);jo(L,()=>f(I).icon);var j=h(R,2),B=v(j);G(()=>{$=re(y,1,"tool-btn svelte-oaxjxu",null,$,{active:n().mode===f(I).id}),D(B,f(I).label)}),T(M,y)});var C=h(P,2);{var S=M=>{var I=Ll(),y=v(I);vn(y,{label:"BRUSH SIZE",get value(){return n().brushSize},min:1,max:30,step:1,color:"tertiary",valueFormat:L=>`${L}PX`,get onchange(){return Fa}});var $=h(y,2);{var R=L=>{vn(L,{label:"INTENSITY",get value(){return n().brushIntensity},min:0,max:1,step:.05,color:"tertiary",valueFormat:j=>`${Math.round(j*100)}%`,get onchange(){return Ga}})};Q($,L=>{n().mode==="draw"&&L(R)})}T(M,I)};Q(C,M=>{(n().mode==="draw"||n().mode==="erase")&&M(S)})}T(E,w)},$$slots:{default:!0}});var b=h(p,2);bt(b,{title:"DEBUG.LOG",borderColor:"secondary",class:"debug-log-box",children:(E,_)=>{var w=Nl();Ue(w,5,r,nt,(P,C)=>{var S=Rl(),M=h(v(S),2),I=v(M);G(()=>{re(S,1,`log-entry ${f(C).level??""}`,"svelte-oaxjxu"),D(I,f(C).message)}),T(P,S)}),T(E,w)},$$slots:{default:!0}}),T(t,g),vt(),i()}ls(["click"]);const zl={initialized:!1,running:!1,progress:null,result:null,bestState:null,error:null},pe=je(zl);zt(pe,t=>t.running);zt(pe,t=>t.progress);zt(pe,t=>t.bestState);let wt=null,Ls=null;function Nn(t){wt&&wt.postMessage(t)}function Bl(t){const e=t.data;switch(e.type){case"ready":pe.update(s=>({...s,initialized:!0})),X("Evolution engine initialized (worker)","success");break;case"progress":pe.update(s=>({...s,progress:e.data,bestState:e.bestState??s.bestState}));break;case"complete":pe.update(s=>({...s,running:!1,result:e.result,bestState:e.bestState??s.bestState})),e.result&&X(`Evolution complete: fitness=${e.result.stats.best_fitness.toFixed(3)}, reason=${e.result.stats.stop_reason}`,"success");break;case"preview":pe.update(s=>({...s,bestState:e.state}));break;case"error":pe.update(s=>({...s,running:!1,error:e.message})),X(`Evolution error: ${e.message}`,"error");break}}async function za(){if(wt){pe.update(t=>({...t,initialized:!0}));return}return Ls||(Ls=new Promise((t,e)=>{try{wt=new Worker(new URL("/autoverse/preview/pr-41/assets/evolution.worker-ZbCPpdzL.js",import.meta.url),{type:"module"}),wt.onmessage=r=>{Bl(r),r.data.type==="ready"?t():r.data.type==="error"&&!et(pe).initialized&&e(new Error(r.data.message))},wt.onerror=r=>{X(`Worker error: ${r.message}`,"error"),e(r)},Nn({type:"init",wasmUrl:"/autoverse/preview/pr-41/pkg/flow_lenia.js"})}catch(s){X(`Failed to create evolution worker: ${s}`,"error"),e(s)}}),Ls)}function Ba(){return{base_config:et(le).config,algorithm:{type:"GeneticAlgorithm",config:{mutation_rate:.15,crossover_rate:.7,mutation_strength:.1,elitism:2,selection:{method:"Tournament",size:3}}},fitness:{metrics:[{metric:"Persistence",weight:1},{metric:"Compactness",weight:.5},{metric:"Locomotion",weight:.3}],aggregation:"WeightedSum"},population:{size:20,max_generations:50,target_fitness:.95,stagnation_limit:15},evaluation:{steps:200,sample_interval:10,warmup_steps:20},constraints:{radius:{min:.05,max:.25},amplitude:{min:.5,max:2},x:{min:.3,max:.7},y:{min:.3,max:.7}},archive:{enabled:!0,max_size:50,diversity_threshold:.1}}}async function Ya(t){if(!wt)throw new Error("Evolution worker not initialized");On(),Fn(),pe.update(e=>({...e,running:!0,progress:null,result:null,error:null})),X(`Evolution started: pop=${t.population.size}, gens=${t.population.max_generations}`,"info"),Nn({type:"start",configJson:JSON.stringify(t)})}function Fn(){const t=et(pe);wt&&t.running&&(Nn({type:"cancel"}),X("Evolution cancelled","warn")),pe.update(e=>({...e,running:!1}))}function Ua(){const t=et(pe);if(!t.bestState){X("No evolved pattern to load","warn");return}const{width:e,height:s,channels:n}=t.bestState;if(!n||n.length===0){X("No channel data in evolved pattern","warn");return}const r=n[0],a=[];for(let i=0;i<s;i++)for(let o=0;o<e;o++){const l=i*e+o,c=r[l];c>.001&&a.push([o,i,0,c])}ys({pattern:{type:"Custom",values:a}}),X("Loaded evolved pattern into simulation","success")}var Yl=k('<div class="progress-display svelte-auxm5"><div class="progress-row svelte-auxm5"><span class="label svelte-auxm5">GEN</span> <span class="value svelte-auxm5"> </span></div> <div class="progress-row svelte-auxm5"><span class="label svelte-auxm5">FIT</span> <span class="value highlight svelte-auxm5"> </span></div> <div class="progress-bar svelte-auxm5"><div class="progress-fill svelte-auxm5"></div></div></div>'),Ul=k('<div class="result-display svelte-auxm5"><div class="result-row svelte-auxm5"><span class="label svelte-auxm5">RESULT</span> <span class="value success svelte-auxm5"> </span></div> <div class="result-reason svelte-auxm5"> </div></div>'),Xl=k('<div class="idle-status svelte-auxm5">READY</div>'),ql=k('<button class="evo-btn danger svelte-auxm5">STOP</button>'),jl=k('<button class="evo-btn secondary svelte-auxm5">LOAD</button>'),Wl=k('<button class="evo-btn primary svelte-auxm5">EVOLVE</button> <!>',1),Hl=k('<div class="evolution-panel svelte-auxm5"><div class="preview-container svelte-auxm5"><canvas width="64" height="64" class="preview-canvas svelte-auxm5"></canvas> <span class="preview-label svelte-auxm5">BEST</span></div> <!> <div class="controls svelte-auxm5"><!></div> <details class="settings svelte-auxm5"><summary class="svelte-auxm5">SETTINGS</summary> <div class="settings-grid svelte-auxm5"><label class="svelte-auxm5"><span class="svelte-auxm5">POP</span> <input type="number" min="4" max="50" step="2" class="svelte-auxm5"/></label> <label class="svelte-auxm5"><span class="svelte-auxm5">GENS</span> <input type="number" min="10" max="200" step="10" class="svelte-auxm5"/></label> <label class="svelte-auxm5"><span class="svelte-auxm5">MUT%</span> <input type="number" min="1" max="50" step="1" class="svelte-auxm5"/></label> <label class="svelte-auxm5"><span class="svelte-auxm5">STEPS</span> <input type="number" min="50" max="500" step="50" class="svelte-auxm5"/></label></div> <label class="goal-select svelte-auxm5"><span class="svelte-auxm5">GOAL</span> <select class="svelte-auxm5"><option>Survival</option><option>Glider</option><option>Oscillator</option><option>Complex</option></select></label></details></div>');function Vl(t,e){ft(e,!1);const s=()=>H(pe,"$evolutionStore",n),[n,r]=Bt();let a=oe(),i=oe(null),o=oe(20),l=oe(50),c=.95,u=oe(15),g=oe(200),d=oe("survival");function p(S){if(!f(i)||!f(a))return;const{width:M,height:I,channels:y}=S;if(!y||y.length===0)return;const $=y[0];if(!$||$.length===0)return;const R=f(a).width,L=f(a).height,j=f(i).createImageData(M,I);for(let J=0;J<$.length;J++){const O=Math.floor(Math.min(1,Math.max(0,$[J]))*255);j.data[J*4]=O,j.data[J*4+1]=O,j.data[J*4+2]=O,j.data[J*4+3]=255}const B=new OffscreenCanvas(M,I),se=B.getContext("2d");se&&(se.putImageData(j,0,0),bo(i,f(i).imageSmoothingEnabled=!1),f(i).clearRect(0,0,R,L),f(i).drawImage(B,0,0,R,L))}function b(S){switch(S){case"glider":return[{metric:"Persistence",weight:1},{metric:"Locomotion",weight:1.5},{metric:"Compactness",weight:.5}];case"oscillator":return[{metric:"Persistence",weight:1},{metric:"Stability",weight:.8},{metric:"Compactness",weight:.5}];case"complex":return[{metric:"Persistence",weight:1},{metric:"Complexity",weight:1.2},{metric:"MassConcentration",weight:.3}];default:return[{metric:"Persistence",weight:1},{metric:"Compactness",weight:.5},{metric:"Stability",weight:.3}]}}function E(){return{...Ba(),population:{size:f(o),max_generations:f(l),target_fitness:c,stagnation_limit:Math.max(5,Math.floor(f(l)/3))},algorithm:{type:"GeneticAlgorithm",config:{mutation_rate:f(u)/100,crossover_rate:.7,mutation_strength:.1,elitism:Math.max(1,Math.floor(f(o)/10)),selection:{method:"Tournament",size:3}}},evaluation:{steps:f(g),sample_interval:Math.max(1,Math.floor(f(g)/20)),warmup_steps:Math.floor(f(g)/10)},fitness:{metrics:b(f(d)),aggregation:"WeightedSum"}}}async function _(){const S=E();try{await Ya(S)}catch(M){X(`Failed to start evolution: ${M}`,"error")}}function w(){Fn()}function P(){Ua()}function C(S){switch(S){case"TargetReached":return"TARGET HIT";case"MaxGenerations":return"MAX GENS";case"Stagnation":return"STAGNANT";case"Cancelled":return"CANCELLED";default:return S}}Qs(async()=>{if(z(i,f(a)?.getContext("2d")??null),!s().initialized)try{await za()}catch{}}),st(()=>(f(i),s()),()=>{f(i)&&s().bestState&&p(s().bestState)}),Js(),ks(),bt(t,{title:"EVOLVE",borderColor:"tertiary",children:(S,M)=>{var I=Hl(),y=v(I),$=v(y);ss($,W=>z(a,W),()=>f(a));var R=h(y,2);{var L=W=>{var ye=Yl(),He=v(ye),Mt=h(v(He),2),Tt=v(Mt),me=h(He,2),Be=h(v(me),2),Xt=v(Be),qt=h(me,2),jt=v(qt);G(gt=>{D(Tt,`${s(),F(()=>s().progress.generation)??""}/${f(l)??""}`),D(Xt,gt),ws(jt,`width: ${s(),f(l),F(()=>s().progress.generation/f(l)*100)??""}%`)},[()=>(s(),F(()=>s().progress.best_fitness.toFixed(3)))]),T(W,ye)},j=W=>{var ye=Us(),He=Ee(ye);{var Mt=me=>{var Be=Ul(),Xt=v(Be),qt=h(v(Xt),2),jt=v(qt),gt=h(Xt,2),$s=v(gt);G((sn,Is)=>{D(jt,sn),D($s,Is)},[()=>(s(),F(()=>s().result.stats.best_fitness.toFixed(3))),()=>(s(),F(()=>C(s().result.stats.stop_reason)))]),T(me,Be)},Tt=me=>{var Be=Xl();T(me,Be)};Q(He,me=>{s(),F(()=>s().result)?me(Mt):me(Tt,!1)},!0)}T(W,ye)};Q(R,W=>{s(),F(()=>s().running&&s().progress)?W(L):W(j,!1)})}var B=h(R,2),se=v(B);{var J=W=>{var ye=ql();ye.__click=w,T(W,ye)},O=W=>{var ye=Wl(),He=Ee(ye);He.__click=_;var Mt=h(He,2);{var Tt=me=>{var Be=jl();Be.__click=P,T(me,Be)};Q(Mt,me=>{s(),F(()=>s().bestState)&&me(Tt)})}G(()=>He.disabled=(s(),F(()=>!s().initialized))),T(W,ye)};Q(se,W=>{s(),F(()=>s().running)?W(J):W(O,!1)})}var ne=h(B,2),ie=h(v(ne),2),ge=v(ie),we=h(v(ge),2),_e=h(ge,2),Ce=h(v(_e),2),$e=h(_e,2),Et=h(v($e),2),ht=h($e,2),We=h(v(ht),2),ve=h(ie,2),ze=h(v(ve),2);G(()=>{f(d),Ao(()=>{})});var pt=v(ze);pt.value=pt.__value="survival";var Yt=h(pt);Yt.value=Yt.__value="glider";var Ut=h(Yt);Ut.value=Ut.__value="oscillator";var Cs=h(Ut);Cs.value=Cs.__value="complex",$t(we,()=>f(o),W=>z(o,W)),$t(Ce,()=>f(l),W=>z(l,W)),$t(Et,()=>f(u),W=>z(u,W)),$t(We,()=>f(g),W=>z(g,W)),Ma(ze,()=>f(d),W=>z(d,W)),T(S,I)},$$slots:{default:!0}}),vt(),r()}ls(["click"]);const $r="flow-lenia-presets";class Kl{presets=new Map;listeners=new Set;constructor(){this.loadFromStorage()}generateId(){return`preset-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}createThumbnail(e,s=64){const n=document.createElement("canvas");n.width=s,n.height=s;const r=n.getContext("2d"),a=r.createImageData(e.width,e.height),i=e.channels[0];for(let b=0;b<i.length;b++){const E=Math.max(0,Math.min(1,i[b])),_=Math.floor(E*255);a.data[b*4+0]=_,a.data[b*4+1]=_,a.data[b*4+2]=_,a.data[b*4+3]=255}const o=document.createElement("canvas");o.width=e.width,o.height=e.height,o.getContext("2d").putImageData(a,0,0),r.imageSmoothingEnabled=!0,r.fillStyle="#1a1a1a",r.fillRect(0,0,s,s);const c=Math.min(s/e.width,s/e.height),u=e.width*c,g=e.height*c,d=(s-u)/2,p=(s-g)/2;return r.drawImage(o,d,p,u,g),n.toDataURL("image/png")}savePreset(e,s,n){const r={id:this.generateId(),name:e,description:n,thumbnail:this.createThumbnail(s),region:s,createdAt:Date.now()};return this.presets.set(r.id,r),this.persistToStorage(),this.notifyListeners(),r}getPreset(e){return this.presets.get(e)}getAllPresets(){return Array.from(this.presets.values()).sort((e,s)=>s.createdAt-e.createdAt)}deletePreset(e){const s=this.presets.delete(e);return s&&(this.persistToStorage(),this.notifyListeners()),s}renamePreset(e,s){const n=this.presets.get(e);return n?(n.name=s,this.persistToStorage(),this.notifyListeners(),!0):!1}updateDescription(e,s){const n=this.presets.get(e);return n?(n.description=s,this.persistToStorage(),this.notifyListeners(),!0):!1}exportPresets(e){const s=e?e.map(n=>this.presets.get(n)).filter(Boolean):this.getAllPresets();return JSON.stringify(s,null,2)}importPresets(e){try{const s=JSON.parse(e);let n=0;for(const r of s){const a={...r,id:this.generateId(),createdAt:Date.now()};this.presets.set(a.id,a),n++}return this.persistToStorage(),this.notifyListeners(),n}catch{throw new Error("Invalid preset JSON format")}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){const e=this.getAllPresets();for(const s of this.listeners)s(e)}persistToStorage(){try{const e=JSON.stringify(Array.from(this.presets.entries()));localStorage.setItem($r,e)}catch(e){console.warn("Failed to persist presets to storage:",e)}}loadFromStorage(){try{const e=localStorage.getItem($r);if(e){const s=JSON.parse(e);this.presets=new Map(s)}}catch(e){console.warn("Failed to load presets from storage:",e),this.presets=new Map}}clearAll(){this.presets.clear(),this.persistToStorage(),this.notifyListeners()}}const Xa=[{name:"Glider",description:"A simple glider that moves across the grid",seed:{pattern:{type:"GaussianBlob",center:[.5,.5],radius:.1,amplitude:1,channel:0}}},{name:"Ring",description:"A ring pattern that expands",seed:{pattern:{type:"Ring",center:[.5,.5],inner_radius:.05,outer_radius:.1,amplitude:1,channel:0}}},{name:"Dual Blobs",description:"Two interacting blobs",seed:{pattern:{type:"MultiBlob",blobs:[{center:[.35,.5],radius:.08,amplitude:1,channel:0},{center:[.65,.5],radius:.08,amplitude:1,channel:0}]}}},{name:"Random Noise",description:"Random initial conditions",seed:{pattern:{type:"Noise",seed:42,amplitude:.5,channel:0}}}],Mn=je(null),qa=je(0);function Jl(){qa.update(t=>t+1)}function Zl(t,e){const s=et(Mn);s&&s.startDragFromLibrary(t,e)}const Ir=je(null),ns=new Kl,tn=je(ns.getAllPresets());ns.subscribe(t=>{tn.set(t)});function ja(t){const e=ns.getAllPresets().find(s=>s.id===t);ns.deletePreset(t),e&&X(`Deleted preset: ${e.name}`,"info")}function Ql(){const t=ns.exportPresets();return X(`Exported ${et(tn).length} presets`,"success"),t}function Wa(t){try{const e=ns.importPresets(t);return X(`Imported ${e} presets`,"success"),Jl(),e}catch(e){throw X(`Import failed: ${e}`,"error"),e}}function Ha(){const t=Ql(),e=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download="flow-lenia-presets.json",n.click(),URL.revokeObjectURL(s)}var ec=k('<div class="metric-display svelte-1baw31t"><div class="metric-main svelte-1baw31t"><span class="metric-value svelte-1baw31t"> </span> <span class="metric-unit svelte-1baw31t">STEPS</span></div> <div class="metric-row svelte-1baw31t"><div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">TIME</span> <span class="metric-num svelte-1baw31t"> </span></div> <div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">MASS</span> <span class="metric-num highlight svelte-1baw31t"> </span></div></div> <div class="metric-row svelte-1baw31t"><div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">FPS</span> <span class="metric-num accent svelte-1baw31t"> </span></div> <div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">BACKEND</span> <button> </button></div></div></div>'),tc=k('<div class="config-grid svelte-1baw31t"><div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">mu</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">sigma</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">R</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">dt</span> <span class="cfg-value svelte-1baw31t"> </span></div></div>'),sc=k('<button class="builtin-btn svelte-1baw31t"> </button>'),nc=k('<div class="builtin-grid svelte-1baw31t"></div>'),rc=k('<img class="svelte-1baw31t"/>'),ac=k('<div class="preset-item svelte-1baw31t" draggable="true" role="button" tabindex="0"><div class="preset-thumbnail svelte-1baw31t"><!></div> <div class="preset-info svelte-1baw31t"><span class="preset-name svelte-1baw31t"> </span> <span class="preset-size svelte-1baw31t"> </span></div> <button class="delete-btn svelte-1baw31t">&#10005;</button></div>'),ic=k('<div class="empty-state svelte-1baw31t">No saved patterns</div>'),oc=k('<div class="patterns-header svelte-1baw31t"><button class="small-btn svelte-1baw31t">IMPORT</button> <button class="small-btn svelte-1baw31t">EXPORT</button></div> <div class="preset-list svelte-1baw31t"></div>',1),lc=k('<aside class="right-sidebar svelte-1baw31t"><!> <!> <!> <!> <!></aside>');function cc(t,e){ft(e,!1);const s=()=>H(le,"$simulationStore",o),n=()=>H(Ra,"$formattedStep",o),r=()=>H(fl,"$formattedTime",o),a=()=>H(Oa,"$formattedMass",o),i=()=>H(tn,"$presets",o),[o,l]=Bt(),c=oe();function u(){const y=s().backend==="cpu"?"gpu":"cpu";Da(y)}function g(y){const $=Xs();if(!$)return;const R=Math.floor(($.getWidth()-y.region.width)/2),L=Math.floor(($.getHeight()-y.region.height)/2);$.placeRegion(y.region,R,L)}function d(y){ys(y.seed),X(`Loaded pattern: ${y.name}`,"info")}function p(y,$){y.stopPropagation(),ja($)}function b(){Ha()}function E(){const y=document.createElement("input");y.type="file",y.accept=".json",y.onchange=async $=>{const R=$.target.files?.[0];if(!R)return;const L=await R.text();try{Wa(L)}catch{}},y.click()}function _(y,$){y.dataTransfer.effectAllowed="copy",y.dataTransfer.setData("text/plain",$.id),Zl($,y)}st(()=>s(),()=>{z(c,s().config.kernels[0])}),Js(),ks();var w=lc(),P=v(w);Vl(P,{});var C=h(P,2);bt(C,{title:"METRICS",borderColor:"secondary",children:(y,$)=>{var R=ec(),L=v(R),j=v(L),B=v(j),se=h(L,2),J=v(se),O=h(v(J),2),ne=v(O),ie=h(J,2),ge=h(v(ie),2),we=v(ge),_e=h(se,2),Ce=v(_e),$e=h(v(Ce),2),Et=v($e),ht=h(Ce,2),We=h(v(ht),2);let ve;We.__click=u;var ze=v(We);G(pt=>{D(B,n()),D(ne,`${r()??""}s`),D(we,a()),D(Et,(s(),F(()=>s().fps))),ve=re(We,1,"backend-btn svelte-1baw31t",null,ve,{gpu:s().backend==="gpu"}),We.disabled=(s(),F(()=>!s().gpuAvailable)),D(ze,pt)},[()=>(s(),F(()=>s().backend.toUpperCase()))]),T(y,R)},$$slots:{default:!0}});var S=h(C,2);bt(S,{title:"KERNEL",borderColor:"primary",children:(y,$)=>{var R=tc(),L=v(R),j=h(v(L),2),B=v(j),se=h(L,2),J=h(v(se),2),O=v(J),ne=h(se,2),ie=h(v(ne),2),ge=v(ie),we=h(ne,2),_e=h(v(we),2),Ce=v(_e);G(()=>{D(B,(f(c),F(()=>f(c)?.mu??"â"))),D(O,(f(c),F(()=>f(c)?.sigma??"â"))),D(ge,(s(),F(()=>s().config.kernel_radius))),D(Ce,(s(),F(()=>s().config.dt)))}),T(y,R)},$$slots:{default:!0}});var M=h(S,2);bt(M,{title:"SEEDS",borderColor:"tertiary",children:(y,$)=>{var R=nc();Ue(R,5,()=>Xa,nt,(L,j)=>{var B=sc();B.__click=()=>d(f(j));var se=v(B);G(()=>{Ge(B,"title",(f(j),F(()=>f(j).description))),D(se,(f(j),F(()=>f(j).name)))}),T(L,B)}),T(y,R)},$$slots:{default:!0}});var I=h(M,2);bt(I,{title:"SAVED",borderColor:"primary",class:"saved-box",children:(y,$)=>{var R=oc(),L=Ee(R),j=v(L);j.__click=E;var B=h(j,2);B.__click=b;var se=h(L,2);Ue(se,5,i,J=>J.id,(J,O)=>{var ne=ac();ne.__click=()=>g(f(O)),ne.__keydown=ve=>ve.key==="Enter"&&g(f(O));var ie=v(ne),ge=v(ie);{var we=ve=>{var ze=rc();G(()=>{Ge(ze,"src",(f(O),F(()=>f(O).thumbnail))),Ge(ze,"alt",(f(O),F(()=>f(O).name)))}),T(ve,ze)};Q(ge,ve=>{f(O),F(()=>f(O).thumbnail)&&ve(we)})}var _e=h(ie,2),Ce=v(_e),$e=v(Ce),Et=h(Ce,2),ht=v(Et),We=h(_e,2);We.__click=ve=>p(ve,f(O).id),G(()=>{D($e,(f(O),F(()=>f(O).name))),D(ht,`${f(O),F(()=>f(O).region.width)??""}x${f(O),F(()=>f(O).region.height)??""}`)}),wa("dragstart",ne,ve=>_(ve,f(O))),T(J,ne)},J=>{var O=ic();T(J,O)}),T(y,R)},$$slots:{default:!0}}),T(t,w),vt(),l()}ls(["click","keydown"]);class uc{canvas;ctx;offscreenCanvas;offscreenCtx;settings;grayscaleMap;thermalMap;viridisMap;themeMap;constructor(e,s){this.canvas=e;const n=e.getContext("2d");if(!n)throw new Error("Failed to get 2D context");this.ctx=n,this.offscreenCanvas=document.createElement("canvas");const r=this.offscreenCanvas.getContext("2d");if(!r)throw new Error("Failed to get offscreen 2D context");this.offscreenCtx=r,this.settings=s,this.grayscaleMap=this.buildGrayscaleMap(),this.thermalMap=this.buildThermalMap(),this.viridisMap=this.buildViridisMap(),this.themeMap=this.viridisMap}setThemeColors(e){this.themeMap=this.buildThemeMap(e)}updateSettings(e){this.settings={...this.settings,...e}}render(e,s,n){const{width:r,height:a,channels:i}=e;(this.offscreenCanvas.width!==r||this.offscreenCanvas.height!==a)&&(this.offscreenCanvas.width=r,this.offscreenCanvas.height=a);const o=this.getColorMap(),l=this.offscreenCtx.createImageData(r,a),c=i[0];for(let u=0;u<c.length;u++){const g=Math.max(0,Math.min(1,c[u])),d=Math.floor(g*255)*4;l.data[u*4+0]=o[d+0],l.data[u*4+1]=o[d+1],l.data[u*4+2]=o[d+2],l.data[u*4+3]=255}this.offscreenCtx.putImageData(l,0,0),this.ctx.imageSmoothingEnabled=!1,this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.offscreenCanvas,0,0,r,a,0,0,this.canvas.width,this.canvas.height),this.settings.showGrid&&this.drawGrid(r,a),n&&this.drawGhostPreview(n,r,a),s&&this.settings.showSelection&&this.drawSelection(s,r,a)}drawGrid(e,s){const n=this.canvas.width/e,r=this.canvas.height/s;if(this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1,n>=4&&r>=4){this.ctx.beginPath();for(let a=0;a<=e;a++){const i=a*n;this.ctx.moveTo(i,0),this.ctx.lineTo(i,this.canvas.height)}for(let a=0;a<=s;a++){const i=a*r;this.ctx.moveTo(0,i),this.ctx.lineTo(this.canvas.width,i)}this.ctx.stroke()}}drawSelection(e,s,n){const r=this.canvas.width/s,a=this.canvas.height/n,i=Math.min(e.startX,e.endX)*r,o=Math.min(e.startY,e.endY)*a,l=Math.abs(e.endX-e.startX)*r,c=Math.abs(e.endY-e.startY)*a;this.ctx.fillStyle="rgba(79, 195, 247, 0.2)",this.ctx.fillRect(i,o,l,c),this.ctx.strokeStyle="#4fc3f7",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.strokeRect(i,o,l,c),this.ctx.setLineDash([]);const u=Math.abs(e.endX-e.startX),g=Math.abs(e.endY-e.startY);u>0&&g>0&&(this.ctx.fillStyle="#4fc3f7",this.ctx.font="12px monospace",this.ctx.fillText(`${u} x ${g}`,i+4,o-4))}drawGhostPreview(e,s,n){const r=this.canvas.width/s,a=this.canvas.height/n,{region:i,x:o,y:l}=e,c=document.createElement("canvas");c.width=i.width,c.height=i.height;const u=c.getContext("2d"),g=u.createImageData(i.width,i.height),d=this.getColorMap();for(let p=0;p<i.channels[0].length;p++){const b=Math.max(0,Math.min(1,i.channels[0][p])),E=Math.floor(b*255)*4;g.data[p*4+0]=d[E+0],g.data[p*4+1]=d[E+1],g.data[p*4+2]=d[E+2],g.data[p*4+3]=b>.01?180:0}u.putImageData(g,0,0),this.ctx.globalAlpha=.7,this.ctx.drawImage(c,0,0,i.width,i.height,o*r,l*a,i.width*r,i.height*a),this.ctx.globalAlpha=1,this.ctx.strokeStyle="#4fc3f7",this.ctx.lineWidth=2,this.ctx.setLineDash([3,3]),this.ctx.strokeRect(o*r,l*a,i.width*r,i.height*a),this.ctx.setLineDash([])}canvasToSim(e,s,n,r){const a=this.canvas.getBoundingClientRect(),i=n/this.canvas.width,o=r/this.canvas.height;return{x:Math.floor((e-a.left)*i),y:Math.floor((s-a.top)*o)}}getColorMap(){switch(this.settings.colorScheme){case"thermal":return this.thermalMap;case"viridis":return this.viridisMap;case"theme":return this.themeMap;default:return this.grayscaleMap}}buildGrayscaleMap(){const e=new Uint8ClampedArray(1024);for(let s=0;s<256;s++)e[s*4+0]=s,e[s*4+1]=s,e[s*4+2]=s,e[s*4+3]=255;return e}buildThermalMap(){const e=new Uint8ClampedArray(1024);for(let s=0;s<256;s++){const n=s/255;let r,a,i;if(n<.2){const o=n/.2;r=0,a=0,i=Math.floor(o*128)}else if(n<.4){const o=(n-.2)/.2;r=0,a=Math.floor(o*255),i=128+Math.floor(o*127)}else if(n<.6){const o=(n-.4)/.2;r=Math.floor(o*255),a=255,i=255-Math.floor(o*255)}else if(n<.8){const o=(n-.6)/.2;r=255,a=255-Math.floor(o*255),i=0}else{const o=(n-.8)/.2;r=255,a=Math.floor(o*255),i=Math.floor(o*255)}e[s*4+0]=r,e[s*4+1]=a,e[s*4+2]=i,e[s*4+3]=255}return e}buildViridisMap(){const e=[[68,1,84],[72,35,116],[64,67,135],[52,94,141],[41,120,142],[32,144,140],[34,167,132],[68,190,112],[121,209,81],[189,222,38],[253,231,36]],s=new Uint8ClampedArray(256*4);for(let n=0;n<256;n++){const a=n/255*(e.length-1),i=Math.floor(a),o=Math.min(i+1,e.length-1),l=a-i;s[n*4+0]=Math.floor(e[i][0]+l*(e[o][0]-e[i][0])),s[n*4+1]=Math.floor(e[i][1]+l*(e[o][1]-e[i][1])),s[n*4+2]=Math.floor(e[i][2]+l*(e[o][2]-e[i][2])),s[n*4+3]=255}return s}getCanvas(){return this.canvas}buildThemeMap(e){const s=l=>{const c=l.replace("#","");return[parseInt(c.slice(0,2),16),parseInt(c.slice(2,4),16),parseInt(c.slice(4,6),16)]},n=s(e.primary),r=s(e.secondary),a=s(e.tertiary),i=[{t:0,color:[5,5,5]},{t:.15,color:[n[0]*.3,n[1]*.3,n[2]*.3]},{t:.35,color:n},{t:.6,color:r},{t:.85,color:a},{t:1,color:[255,255,255]}],o=new Uint8ClampedArray(256*4);for(let l=0;l<256;l++){const c=l/255;let u=i[0],g=i[1];for(let p=1;p<i.length;p++)if(c<=i[p].t){u=i[p-1],g=i[p];break}const d=(c-u.t)/(g.t-u.t);o[l*4+0]=Math.floor(u.color[0]+d*(g.color[0]-u.color[0])),o[l*4+1]=Math.floor(u.color[1]+d*(g.color[1]-u.color[1])),o[l*4+2]=Math.floor(u.color[2]+d*(g.color[2]-u.color[2])),o[l*4+3]=255}return o}}class fc{canvas;simulation;callbacks;mode="view";selection=null;isSelecting=!1;isDrawing=!1;isDragging=!1;draggedCreature=null;ghostPreview=null;brushSize=3;brushIntensity=.5;constructor(e,s,n,r={}){this.canvas=e,this.simulation=s,this.callbacks=r,this.setupEventListeners(),this.setupDragDrop()}setMode(e){switch(this.mode=e,this.selection=null,this.isSelecting=!1,this.isDrawing=!1,e){case"select":this.canvas.style.cursor="crosshair";break;case"draw":this.canvas.style.cursor="cell";break;case"erase":this.canvas.style.cursor="not-allowed";break;default:this.canvas.style.cursor="default"}this.callbacks.onModeChange?.(e)}getMode(){return this.mode}getSelection(){return this.selection}clearSelection(){this.selection=null,this.callbacks.onSelectionChange?.(null)}setBrushSize(e){this.brushSize=Math.max(1,Math.min(20,e))}setBrushIntensity(e){this.brushIntensity=Math.max(0,Math.min(1,e))}getGhostPreview(){return this.ghostPreview}startDragFromLibrary(e,s){this.isDragging=!0,this.draggedCreature={preset:e,offsetX:e.region.width/2,offsetY:e.region.height/2};const n=this.getSimCoords(s);this.ghostPreview={region:e.region,x:n.x-this.draggedCreature.offsetX,y:n.y-this.draggedCreature.offsetY}}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.canvas.addEventListener("touchcancel",this.handleTouchEnd.bind(this),{passive:!1}),document.addEventListener("keydown",this.handleKeyDown.bind(this))}setupDragDrop(){this.canvas.addEventListener("dragover",e=>{if(e.preventDefault(),e.dataTransfer.dropEffect="copy",this.draggedCreature){const s=this.getSimCoords(e);this.ghostPreview={region:this.draggedCreature.preset.region,x:s.x-this.draggedCreature.offsetX,y:s.y-this.draggedCreature.offsetY}}}),this.canvas.addEventListener("drop",e=>{if(e.preventDefault(),this.draggedCreature){const s=this.getSimCoords(e),n=Math.floor(s.x-this.draggedCreature.offsetX),r=Math.floor(s.y-this.draggedCreature.offsetY);this.callbacks.onDrop?.(this.draggedCreature.preset,n,r),this.draggedCreature=null,this.ghostPreview=null,this.isDragging=!1}}),this.canvas.addEventListener("dragleave",()=>{this.ghostPreview=null})}handleMouseDown(e){const s=this.getSimCoords(e);switch(this.mode){case"select":this.isSelecting=!0,this.selection={startX:s.x,startY:s.y,endX:s.x,endY:s.y},this.callbacks.onSelectionChange?.(this.selection);break;case"draw":this.isDrawing=!0,this.callbacks.onDraw?.(s.x,s.y);break;case"erase":this.isDrawing=!0,this.callbacks.onErase?.(s.x,s.y);break}}handleMouseMove(e){const s=this.getSimCoords(e);this.isSelecting&&this.selection&&(this.selection.endX=s.x,this.selection.endY=s.y,this.callbacks.onSelectionChange?.(this.selection)),this.isDrawing&&(this.mode==="draw"?this.callbacks.onDraw?.(s.x,s.y):this.mode==="erase"&&this.callbacks.onErase?.(s.x,s.y)),this.isDragging&&this.draggedCreature&&(this.ghostPreview={region:this.draggedCreature.preset.region,x:s.x-this.draggedCreature.offsetX,y:s.y-this.draggedCreature.offsetY})}handleMouseUp(e){if(this.isSelecting&&this.selection){const s={startX:Math.min(this.selection.startX,this.selection.endX),startY:Math.min(this.selection.startY,this.selection.endY),endX:Math.max(this.selection.startX,this.selection.endX),endY:Math.max(this.selection.startY,this.selection.endY)};s.endX>s.startX&&s.endY>s.startY?(this.selection=s,this.callbacks.onSelectionComplete?.(s)):this.selection=null,this.callbacks.onSelectionChange?.(this.selection)}this.isSelecting=!1,this.isDrawing=!1}handleMouseLeave(e){this.isSelecting&&(this.isSelecting=!1,this.selection=null,this.callbacks.onSelectionChange?.(null)),this.isDrawing=!1,this.ghostPreview=null}handleTouchStart(e){if(e.touches.length!==1)return;this.mode!=="view"&&e.preventDefault();const s=e.touches[0],n=this.getTouchSimCoords(s);switch(this.mode){case"select":this.isSelecting=!0,this.selection={startX:n.x,startY:n.y,endX:n.x,endY:n.y},this.callbacks.onSelectionChange?.(this.selection);break;case"draw":this.isDrawing=!0,this.callbacks.onDraw?.(n.x,n.y);break;case"erase":this.isDrawing=!0,this.callbacks.onErase?.(n.x,n.y);break}}handleTouchMove(e){if(e.touches.length!==1)return;this.mode!=="view"&&(this.isDrawing||this.isSelecting)&&e.preventDefault();const s=e.touches[0],n=this.getTouchSimCoords(s);this.isSelecting&&this.selection&&(this.selection.endX=n.x,this.selection.endY=n.y,this.callbacks.onSelectionChange?.(this.selection)),this.isDrawing&&(this.mode==="draw"?this.callbacks.onDraw?.(n.x,n.y):this.mode==="erase"&&this.callbacks.onErase?.(n.x,n.y))}handleTouchEnd(e){if(this.mode!=="view"&&(this.isDrawing||this.isSelecting)&&e.preventDefault(),this.isSelecting&&this.selection){const s={startX:Math.min(this.selection.startX,this.selection.endX),startY:Math.min(this.selection.startY,this.selection.endY),endX:Math.max(this.selection.startX,this.selection.endX),endY:Math.max(this.selection.startY,this.selection.endY)};s.endX>s.startX&&s.endY>s.startY?(this.selection=s,this.callbacks.onSelectionComplete?.(s)):this.selection=null,this.callbacks.onSelectionChange?.(this.selection)}this.isSelecting=!1,this.isDrawing=!1}getTouchSimCoords(e){const s=this.canvas.getBoundingClientRect(),n=e.clientX-s.left,r=e.clientY-s.top,a=this.simulation.getWidth(),i=this.simulation.getHeight();return{x:Math.floor(n/s.width*a),y:Math.floor(r/s.height*i)}}handleKeyDown(e){const s=e.target;s.tagName==="INPUT"||s.tagName==="TEXTAREA"||(e.key==="v"||e.key==="Escape"?this.setMode("view"):e.key==="s"?this.setMode("select"):e.key==="d"?this.setMode("draw"):e.key==="e"&&this.setMode("erase"),e.key==="["?(this.setBrushSize(this.brushSize-1),this.callbacks.onBrushSizeChange?.(this.brushSize)):e.key==="]"&&(this.setBrushSize(this.brushSize+1),this.callbacks.onBrushSizeChange?.(this.brushSize)))}getSimCoords(e){const s=this.canvas.getBoundingClientRect(),n=e.clientX-s.left,r=e.clientY-s.top,a=this.simulation.getWidth(),i=this.simulation.getHeight();return{x:Math.floor(n/s.width*a),y:Math.floor(r/s.height*i)}}getBrushSize(){return this.brushSize}getBrushIntensity(){return this.brushIntensity}}var vc=k('<div class="simulation-view svelte-145nxqv"><div class="canvas-frame svelte-145nxqv"><div class="canvas-header svelte-145nxqv"><span class="dim-label svelte-145nxqv"> </span></div> <div class="canvas-container svelte-145nxqv"><canvas class="svelte-145nxqv"></canvas> <div class="corner-marker top-left svelte-145nxqv"></div> <div class="corner-marker top-right svelte-145nxqv"></div> <div class="corner-marker bottom-left svelte-145nxqv"></div> <div class="corner-marker bottom-right svelte-145nxqv"></div> <div class="canvas-scanlines svelte-145nxqv"></div></div></div></div>');function Ar(t,e){ft(e,!1);const s=()=>H(dt,"$settings",i),n=()=>H(le,"$simulationStore",i),r=()=>H(en,"$currentScheme",i),a=()=>H(qa,"$renderTrigger",i),[i,o]=Bt();let l=oe(),c=oe(),u=oe(null),g=oe(null);const d=512;Qs(()=>{const M=Xs();!M||!f(c)||(Ir.set(f(c)),z(u,new uc(f(c),{colorScheme:s().colorScheme,showGrid:s().showGrid,showSelection:s().showSelection,brushSize:s().brushSize,brushIntensity:s().brushIntensity,backend:n().backend})),z(g,new fc(f(c),M,f(u),{onSelectionChange:()=>p(),onSelectionComplete:()=>{},onDrop:(I,y,$)=>{M.placeRegion(I.region,y,$),p()},onDraw:(I,y)=>{M.drawAt(I,y,s().brushSize,s().brushIntensity),p()},onErase:(I,y)=>{M.eraseAt(I,y,s().brushSize),p()},onModeChange:()=>{},onBrushSizeChange:()=>{}})),Mn.set(f(g)),p())}),ka(()=>{Mn.set(null),Ir.set(null),z(u,null),z(g,null)});function p(){if(!f(u))return;const M=Xs();if(!M)return;const I=M.getState(),y=f(g)?.getSelection(),$=f(g)?.getGhostPreview();f(u).render(I,y,$)}st(()=>(n(),f(u)),()=>{n().state&&f(u)&&p()}),st(()=>(f(g),s()),()=>{f(g)&&s().mode&&f(g).setMode(s().mode)}),st(()=>(f(g),s()),()=>{f(g)&&(f(g).setBrushSize(s().brushSize),f(g).setBrushIntensity(s().brushIntensity))}),st(()=>(f(u),s()),()=>{f(u)&&s().colorScheme&&(f(u).updateSettings({colorScheme:s().colorScheme}),p())}),st(()=>(f(u),r()),()=>{f(u)&&r()&&(f(u).setThemeColors({primary:r().colors.primary,secondary:r().colors.secondary,tertiary:r().colors.tertiary}),p())}),st(()=>(a(),f(u)),()=>{a()&&f(u)&&p()}),Js(),ks();var b=vc(),E=v(b),_=v(E),w=v(_),P=v(w),C=h(_,2),S=v(C);Ge(S,"width",d),Ge(S,"height",d),ss(S,M=>z(c,M),()=>f(c)),ss(C,M=>z(l,M),()=>f(l)),G(()=>D(P,`${n(),F(()=>n().config.width)??""}x${n(),F(()=>n().config.height)??""}`)),T(t,b),vt(),o()}var dc=k("<button> </button>"),hc=k('<span class="icon svelte-xicwp9">â¸</span>'),pc=k('<span class="icon svelte-xicwp9">â¶</span>'),gc=k('<button><span class="icon svelte-xicwp9"> </span> <span class="label svelte-xicwp9"> </span></button>'),_c=k('<div class="brush-row svelte-xicwp9"><label class="svelte-xicwp9">INTENSITY</label> <input type="range" min="0" max="100" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div>'),mc=k('<div class="brush-settings svelte-xicwp9"><div class="brush-row svelte-xicwp9"><label class="svelte-xicwp9">SIZE</label> <input type="range" min="1" max="30" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <!></div>'),bc=k("<button> </button>"),wc=k('<img class="svelte-xicwp9"/>'),yc=k('<div class="preset-placeholder svelte-xicwp9"></div>'),xc=k('<div class="preset-item svelte-xicwp9" role="button" tabindex="0"><!> <span class="preset-name svelte-xicwp9"> </span> <span class="preset-size svelte-xicwp9"> </span></div>'),Sc=k('<div class="empty-state svelte-xicwp9">No saved patterns</div>'),Ec=k('<button class="builtin-btn svelte-xicwp9"><span class="builtin-name svelte-xicwp9"> </span> <span class="builtin-desc svelte-xicwp9"> </span></button>'),Mc=k('<div class="evo-progress svelte-xicwp9"><span class="evo-label svelte-xicwp9">GEN</span> <span class="evo-value svelte-xicwp9"> </span></div> <div class="evo-progress svelte-xicwp9"><span class="evo-label svelte-xicwp9">FIT</span> <span class="evo-value highlight svelte-xicwp9"> </span></div> <div class="evo-bar svelte-xicwp9"><div class="evo-bar-fill svelte-xicwp9"></div></div>',1),Tc=k('<div class="evo-progress svelte-xicwp9"><span class="evo-label svelte-xicwp9">RESULT</span> <span class="evo-value success svelte-xicwp9"> </span></div> <div class="evo-reason svelte-xicwp9"> </div>',1),kc=k('<span class="evo-ready svelte-xicwp9">READY</span>'),Cc=k('<button class="evo-btn danger svelte-xicwp9">STOP</button>'),$c=k('<button class="evo-btn secondary svelte-xicwp9">LOAD</button>'),Ic=k('<button class="evo-btn primary svelte-xicwp9">EVOLVE</button> <!>',1),Ac=k("<button></button>"),Pc=k('<div class="bottom-sheet svelte-xicwp9"><div class="mobile-stats svelte-xicwp9"><div class="stats-group svelte-xicwp9"><span>STEP: <strong class="svelte-xicwp9"> </strong></span> <span>MASS: <strong class="svelte-xicwp9"> </strong></span> <span>FPS: <strong class="svelte-xicwp9"> </strong></span></div> <div class="backend-toggle svelte-xicwp9"><span>CPU</span> <button aria-label="Toggle between CPU and GPU backend"><span class="toggle-knob svelte-xicwp9"></span></button> <span>GPU</span></div></div> <div class="tabs svelte-xicwp9"></div> <div class="panels-container svelte-xicwp9"><div><div class="panel svelte-xicwp9"><div class="playback-controls svelte-xicwp9"><button><!></button> <button class="ctrl-btn svelte-xicwp9"><span class="icon svelte-xicwp9">â­</span></button> <button class="ctrl-btn svelte-xicwp9"><span class="icon svelte-xicwp9">âº</span></button> <div class="speed-control svelte-xicwp9"><button class="speed-btn svelte-xicwp9">â</button> <strong> </strong> <button class="speed-btn svelte-xicwp9">+</button></div></div> <div class="tools-grid svelte-xicwp9"></div> <!></div> <div class="panel svelte-xicwp9"><div class="display-section svelte-xicwp9"><label class="section-label svelte-xicwp9">COLOR SCHEME</label> <div class="scheme-grid svelte-xicwp9"></div></div> <div class="display-section svelte-xicwp9"><label class="section-label svelte-xicwp9">EFFECTS</label> <div class="toggle-row svelte-xicwp9"><span>CRT Scanlines</span> <button aria-label="Toggle CRT scanlines effect"><span class="toggle-knob svelte-xicwp9"></span></button></div></div></div> <div class="panel svelte-xicwp9"><div class="preset-actions svelte-xicwp9"><button class="action-btn svelte-xicwp9">IMPORT</button> <button class="action-btn svelte-xicwp9">EXPORT</button></div> <div class="preset-grid svelte-xicwp9"></div></div> <div class="panel svelte-xicwp9"><div class="builtin-grid svelte-xicwp9"></div></div> <div class="panel evolve-panel svelte-xicwp9"><div class="evo-header svelte-xicwp9"><canvas width="48" height="48" class="evo-preview svelte-xicwp9"></canvas> <div class="evo-status svelte-xicwp9"><!></div></div> <div class="evo-controls svelte-xicwp9"><!></div> <div class="evo-settings svelte-xicwp9"><div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">POP</label> <input type="range" min="10" max="50" step="5" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">GENS</label> <input type="range" min="20" max="100" step="10" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">MUT%</label> <input type="range" min="5" max="30" step="5" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">GOAL</label> <select class="svelte-xicwp9"><option>Survival</option><option>Glider</option><option>Oscillator</option><option>Complex</option></select></div></div></div></div></div> <div class="swipe-indicator svelte-xicwp9"></div></div>');function Dc(t,e){ft(e,!0);const s=()=>H(pe,"$evolutionStore",u),n=()=>H(Ne,"$mobileStore",u),r=()=>H(ml,"$currentTabIndex",u),a=()=>H(Ra,"$formattedStep",u),i=()=>H(Oa,"$formattedMass",u),o=()=>H(le,"$simulationStore",u),l=()=>H(dt,"$settings",u),c=()=>H(tn,"$presets",u),[u,g]=Bt();let d,p=0,b=0,E=Se(1),_=Se(20),w=Se(50),P=Se(15),C=Se("survival"),S,M=null;ms(()=>{S&&!M&&(M=S.getContext("2d"))}),ms(()=>{M&&s().bestState&&I(s().bestState)});function I(m){if(!M||!S)return;const{width:x,height:A,channels:N}=m;if(!N||N.length===0)return;const V=N[0];if(!V||V.length===0)return;const K=S.width,ae=S.height,de=M.createImageData(x,A);for(let Z=0;Z<V.length;Z++){const Ie=Math.floor(Math.min(1,Math.max(0,V[Z]))*255);de.data[Z*4]=Ie,de.data[Z*4+1]=Ie,de.data[Z*4+2]=Ie,de.data[Z*4+3]=255}const xe=new OffscreenCanvas(x,A),Ye=xe.getContext("2d");Ye&&(Ye.putImageData(de,0,0),M.imageSmoothingEnabled=!1,M.clearRect(0,0,K,ae),M.drawImage(xe,0,0,K,ae))}function y(m){switch(m){case"glider":return[{metric:"Persistence",weight:1},{metric:"Locomotion",weight:1.5},{metric:"Compactness",weight:.5}];case"oscillator":return[{metric:"Persistence",weight:1},{metric:"Stability",weight:.8},{metric:"Compactness",weight:.5}];case"complex":return[{metric:"Persistence",weight:1},{metric:"Complexity",weight:1.2},{metric:"MassConcentration",weight:.3}];default:return[{metric:"Persistence",weight:1},{metric:"Compactness",weight:.5},{metric:"Stability",weight:.3}]}}function $(){return{...Ba(),population:{size:f(_),max_generations:f(w),target_fitness:.95,stagnation_limit:Math.max(5,Math.floor(f(w)/3))},algorithm:{type:"GeneticAlgorithm",config:{mutation_rate:f(P)/100,crossover_rate:.7,mutation_strength:.1,elitism:Math.max(1,Math.floor(f(_)/10)),selection:{method:"Tournament",size:3}}},fitness:{metrics:y(f(C)),aggregation:"WeightedSum"}}}async function R(){if(!s().initialized)try{await za()}catch{return}const m=$();try{await Ya(m)}catch(x){X(`Failed to start evolution: ${x}`,"error")}}function L(){Fn()}function j(){Ua()}function B(m){switch(m){case"TargetReached":return"TARGET";case"MaxGenerations":return"MAX GENS";case"Stagnation":return"STAGNANT";case"Cancelled":return"CANCELLED";default:return m}}function se(m){const x=m.touches[0];p=x.clientX,b=x.clientX,Ne.startSwipe()}function J(m){if(!n().isSwiping)return;b=m.touches[0].clientX;const A=b-p,N=r();N===0&&A>0||N===fn.length-1&&A<0?Ne.updateSwipe(A*.3):Ne.updateSwipe(A)}function O(){!n().isSwiping||!d||Ne.endSwipe(d.clientWidth)}function ne(m){Ne.setTab(m)}function ie(m){z(E,Math.max(1,Math.min(10,f(E)+m)),!0),cl(f(E))}const ge=[{id:"view",label:"VIEW",icon:"â"},{id:"select",label:"SEL",icon:"â¡"},{id:"draw",label:"DRAW",icon:"â"},{id:"erase",label:"ERASE",icon:"â"}],we=[{id:"theme",label:"THEME"},{id:"grayscale",label:"GRAY"},{id:"thermal",label:"THERMAL"},{id:"viridis",label:"VIRIDIS"}];function _e(m){const x=Xs();if(!x)return;const A=Math.floor((x.getWidth()-m.region.width)/2),N=Math.floor((x.getHeight()-m.region.height)/2);x.placeRegion(m.region,A,N)}function Ce(m){ys(m.seed),X(`Loaded: ${m.name}`,"info")}let $e=null;function Et(m){$e=setTimeout(()=>{confirm(`Delete "${m.name}"?`)&&ja(m.id)},500)}function ht(){$e&&(clearTimeout($e),$e=null)}function We(){const m=document.createElement("input");m.type="file",m.accept=".json",m.onchange=async x=>{const A=x.target.files?.[0];if(!A)return;const N=await A.text();try{Wa(N)}catch{}},m.click()}let ve=_o(()=>{const m=-r()*100,x=d?n().swipeOffset/d.clientWidth*100:0;return`translateX(${m+x}%)`});var ze=Pc(),pt=v(ze),Yt=v(pt),Ut=v(Yt),Cs=h(v(Ut)),W=v(Cs),ye=h(Ut,2),He=h(v(ye)),Mt=v(He),Tt=h(ye,2),me=h(v(Tt)),Be=v(me),Xt=h(Yt,2),qt=v(Xt);let jt;var gt=h(qt,2);let $s;gt.__click=()=>Da(o().backend==="cpu"?"gpu":"cpu");var sn=h(gt,2);let Is;var Gn=h(pt,2);Ue(Gn,21,()=>fn,nt,(m,x)=>{var A=dc();let N;A.__click=()=>ne(f(x));var V=v(A);G(K=>{N=re(A,1,"tab svelte-xicwp9",null,N,{active:n().activeTab===f(x)}),D(V,K)},[()=>f(x).toUpperCase()]),T(m,A)});var kt=h(Gn,2);kt.__touchstart=se,kt.__touchmove=J,kt.__touchend=O;var nn=v(kt);let zn;var Bn=v(nn),Yn=v(Bn),As=v(Yn);let Un;As.__click=()=>o().playing?On():Aa();var Va=v(As);{var Ka=m=>{var x=hc();T(m,x)},Ja=m=>{var x=pc();T(m,x)};Q(Va,m=>{o().playing?m(Ka):m(Ja,!1)})}var Xn=h(As,2);Xn.__click=()=>Pa();var qn=h(Xn,2);qn.__click=()=>ys();var Za=h(qn,2),jn=v(Za);jn.__click=()=>ie(-1);var Wn=h(jn,2),Qa=v(Wn),ei=h(Wn,2);ei.__click=()=>ie(1);var Hn=h(Yn,2);Ue(Hn,21,()=>ge,nt,(m,x)=>{var A=gc();let N;A.__click=()=>Na(f(x).id);var V=v(A),K=v(V),ae=h(V,2),de=v(ae);G(()=>{N=re(A,1,"tool-btn svelte-xicwp9",null,N,{active:l().mode===f(x).id}),D(K,f(x).icon),D(de,f(x).label)}),T(m,A)});var ti=h(Hn,2);{var si=m=>{var x=mc(),A=v(x),N=h(v(A),2);N.__input=xe=>Fa(parseInt(xe.currentTarget.value));var V=h(N,2),K=v(V),ae=h(A,2);{var de=xe=>{var Ye=_c(),Z=h(v(Ye),2);Z.__input=cs=>Ga(parseInt(cs.currentTarget.value)/100);var Ie=h(Z,2),ln=v(Ie);G((cs,Ti)=>{wn(Z,cs),D(ln,`${Ti??""}%`)},[()=>Math.round(l().brushIntensity*100),()=>Math.round(l().brushIntensity*100)]),T(xe,Ye)};Q(ae,xe=>{l().mode==="draw"&&xe(de)})}G(()=>{wn(N,l().brushSize),D(K,l().brushSize)}),T(m,x)};Q(ti,m=>{(l().mode==="draw"||l().mode==="erase")&&m(si)})}var Vn=h(Bn,2),Kn=v(Vn),ni=h(v(Kn),2);Ue(ni,21,()=>we,nt,(m,x)=>{var A=bc();let N;A.__click=()=>dl(f(x).id);var V=v(A);G(()=>{N=re(A,1,"scheme-btn svelte-xicwp9",null,N,{active:l().colorScheme===f(x).id}),D(V,f(x).label)}),T(m,A)});var ri=h(Kn,2),ai=h(v(ri),2),Jn=h(v(ai),2);let Zn;Jn.__click=function(...m){hl?.apply(this,m)};var Qn=h(Vn,2),er=v(Qn),tr=v(er);tr.__click=We;var ii=h(tr,2);ii.__click=function(...m){Ha?.apply(this,m)};var oi=h(er,2);Ue(oi,5,c,m=>m.id,(m,x)=>{var A=xc();A.__click=()=>_e(f(x)),A.__keydown=Z=>Z.key==="Enter"&&_e(f(x)),A.__touchstart=()=>Et(f(x)),A.__touchend=ht,A.__touchmove=ht;var N=v(A);{var V=Z=>{var Ie=wc();G(()=>{Ge(Ie,"src",f(x).thumbnail),Ge(Ie,"alt",f(x).name)}),T(Z,Ie)},K=Z=>{var Ie=yc();T(Z,Ie)};Q(N,Z=>{f(x).thumbnail?Z(V):Z(K,!1)})}var ae=h(N,2),de=v(ae),xe=h(ae,2),Ye=v(xe);G(()=>{D(de,f(x).name),D(Ye,`${f(x).region.width??""}Ã${f(x).region.height??""}`)}),T(m,A)},m=>{var x=Sc();T(m,x)});var sr=h(Qn,2),li=v(sr);Ue(li,21,()=>Xa,nt,(m,x)=>{var A=Ec();A.__click=()=>Ce(f(x));var N=v(A),V=v(N),K=h(N,2),ae=v(K);G(()=>{D(V,f(x).name),D(ae,f(x).description)}),T(m,A)});var ci=h(sr,2),nr=v(ci),rr=v(nr);ss(rr,m=>S=m,()=>S);var ui=h(rr,2),fi=v(ui);{var vi=m=>{var x=Mc(),A=Ee(x),N=h(v(A),2),V=v(N),K=h(A,2),ae=h(v(K),2),de=v(ae),xe=h(K,2),Ye=v(xe);G(Z=>{D(V,`${s().progress.generation??""}/${f(w)??""}`),D(de,Z),ws(Ye,`width: ${s().progress.generation/f(w)*100}%`)},[()=>s().progress.best_fitness.toFixed(3)]),T(m,x)},di=m=>{var x=Us(),A=Ee(x);{var N=K=>{var ae=Tc(),de=Ee(ae),xe=h(v(de),2),Ye=v(xe),Z=h(de,2),Ie=v(Z);G((ln,cs)=>{D(Ye,ln),D(Ie,cs)},[()=>s().result.stats.best_fitness.toFixed(3),()=>B(s().result.stats.stop_reason)]),T(K,ae)},V=K=>{var ae=kc();T(K,ae)};Q(A,K=>{s().result?K(N):K(V,!1)},!0)}T(m,x)};Q(fi,m=>{s().running&&s().progress?m(vi):m(di,!1)})}var ar=h(nr,2),hi=v(ar);{var pi=m=>{var x=Cc();x.__click=L,T(m,x)},gi=m=>{var x=Ic(),A=Ee(x);A.__click=R;var N=h(A,2);{var V=K=>{var ae=$c();ae.__click=j,T(K,ae)};Q(N,K=>{s().bestState&&K(V)})}T(m,x)};Q(hi,m=>{s().running?m(pi):m(gi,!1)})}var _i=h(ar,2),ir=v(_i),or=h(v(ir),2),mi=h(or,2),bi=v(mi),lr=h(ir,2),cr=h(v(lr),2),wi=h(cr,2),yi=v(wi),ur=h(lr,2),fr=h(v(ur),2),xi=h(fr,2),Si=v(xi),Ei=h(ur,2),vr=h(v(Ei),2),rn=v(vr);rn.value=rn.__value="survival";var an=h(rn);an.value=an.__value="glider";var on=h(an);on.value=on.__value="oscillator";var dr=h(on);dr.value=dr.__value="complex",ss(kt,m=>d=m,()=>d);var Mi=h(kt,2);Ue(Mi,21,()=>fn,nt,(m,x,A)=>{var N=Ac();let V;N.__click=()=>Ne.setTab(f(x)),G(()=>{V=re(N,1,"dot svelte-xicwp9",null,V,{active:r()===A}),Ge(N,"aria-label",`Go to ${f(x)??""} panel`)}),T(m,N)}),G(()=>{D(W,a()),D(Mt,i()),D(Be,o().fps),jt=re(qt,1,"backend-label svelte-xicwp9",null,jt,{active:o().backend==="cpu"}),$s=re(gt,1,"toggle-btn svelte-xicwp9",null,$s,{gpu:o().backend==="gpu"}),gt.disabled=!o().gpuAvailable,Is=re(sn,1,"backend-label svelte-xicwp9",null,Is,{active:o().backend==="gpu",unavailable:!o().gpuAvailable}),zn=re(nn,1,"panels-wrapper svelte-xicwp9",null,zn,{swiping:n().isSwiping}),ws(nn,`transform: ${f(ve)??""}`),Un=re(As,1,"play-btn svelte-xicwp9",null,Un,{active:o().playing}),D(Qa,`${f(E)??""}X`),Zn=re(Jn,1,"toggle-btn small svelte-xicwp9",null,Zn,{on:l().showScanlines}),D(bi,f(_)),D(yi,f(w)),D(Si,f(P))}),wa("touchcancel",kt,O),$t(or,()=>f(_),m=>z(_,m)),$t(cr,()=>f(w),m=>z(w,m)),$t(fr,()=>f(P),m=>z(P,m)),Ma(vr,()=>f(C),m=>z(C,m)),T(t,ze),vt(),g()}ls(["click","touchstart","touchmove","touchend","input","keydown"]);var Lc=k('<div class="loading-screen svelte-1n46o8q"><div class="loading-content svelte-1n46o8q"><div class="glitch-text svelte-1n46o8q" data-text="FLOW_LENIA">FLOW_LENIA</div> <div class="loading-status svelte-1n46o8q"><span class="animate-pulse">INITIALIZING SUBSTRATE</span> <span class="animate-blink">_</span></div></div></div>'),Oc=k('<div class="error-screen svelte-1n46o8q"><div class="error-content svelte-1n46o8q"><div class="error-title svelte-1n46o8q">SYSTEM FAILURE</div> <div class="error-message svelte-1n46o8q"> </div> <div class="error-hint svelte-1n46o8q">Ensure WASM is built: <code class="svelte-1n46o8q">wasm-pack build --target web --release</code></div></div></div>'),Rc=k('<div class="mobile-header svelte-1n46o8q"><span class="mobile-title svelte-1n46o8q">FLOW_LENIA</span></div> <div class="mobile-canvas-container svelte-1n46o8q"><!></div> <!>',1),Nc=k('<!> <div class="main-content svelte-1n46o8q"><!> <!> <!></div> <!>',1),Fc=k('<div class="scanlines"></div>'),Gc=k('<div><!></div> <!> <div class="vignette"></div>',1);function zc(t,e){ft(e,!1);const s=()=>H(le,"$simulationStore",i),n=()=>H(en,"$currentScheme",i),r=()=>H(Ne,"$mobileStore",i),a=()=>H(dt,"$settings",i),[i,o]=Bt();let l=oe(!1),c=oe(null),u=oe(),g=oe("");function d(w,P){const C=parseInt(w.slice(1,3),16),S=parseInt(w.slice(3,5),16),M=parseInt(w.slice(5,7),16);return`rgba(${C}, ${S}, ${M}, ${P})`}Qs(async()=>{gl(),Ne.checkViewport(),window.addEventListener("resize",Ne.checkViewport),X("SYS.BOOT","info"),X("Loading WASM module...","info");try{await ul(),z(l,!0),X("WASM initialized","success"),X(`Backend: ${s().backend.toUpperCase()}`,"info"),X(`Theme: ${n().name}`,"info"),s().gpuAvailable?X("WebGPU available","success"):X("WebGPU not available","warn"),X("SYSTEM READY","success")}catch(w){z(c,String(w)),X(`INIT FAILED: ${w}`,"error")}}),ka(()=>{window.removeEventListener("resize",Ne.checkViewport)}),st(()=>(s(),n()),()=>{const{width:w,height:P}=s().config,C=Math.max(1,w*P),S=s().totalMass/C,I=.15+Math.min(1,Math.max(0,S))*.45,y=n().colors;z(g,[`--color-primary-glow: ${d(y.primary,I)}`,`--color-secondary-glow: ${d(y.secondary,I)}`,`--color-tertiary-glow: ${d(y.tertiary,I)}`].join("; "))}),Js(),ks();var p=Us(),b=Ee(p);{var E=w=>{var P=Lc();T(w,P)},_=w=>{var P=Us(),C=Ee(P);{var S=I=>{var y=Oc(),$=v(y),R=h(v($),2),L=v(R);G(()=>D(L,f(c))),T(I,y)},M=I=>{var y=Gc(),$=Ee(y);let R;var L=v($);{var j=O=>{var ne=Rc(),ie=h(Ee(ne),2),ge=v(ie);Ar(ge,{});var we=h(ie,2);Dc(we,{}),T(O,ne)},B=O=>{var ne=Nc(),ie=Ee(ne);yl(ie,{});var ge=h(ie,2),we=v(ge);Gl(we,{});var _e=h(we,2);Ar(_e,{});var Ce=h(_e,2);cc(Ce,{});var $e=h(ge,2);Sl($e),T(O,ne)};Q(L,O=>{r(),F(()=>r().isMobile)?O(j):O(B,!1)})}ss($,O=>z(u,O),()=>f(u));var se=h($,2);{var J=O=>{var ne=Fc();T(O,ne)};Q(se,O=>{a(),F(()=>a().showScanlines)&&O(J)})}G(()=>{R=re($,1,"app-container svelte-1n46o8q",null,R,{"mobile-layout":r().isMobile}),ws($,f(g))}),T(I,y)};Q(C,I=>{f(c)?I(S):I(M,!1)},!0)}T(w,P)};Q(b,w=>{!f(l)&&!f(c)?w(E):w(_,!1)})}T(t,p),vt(),o()}zo(zc,{target:document.getElementById("app")});
