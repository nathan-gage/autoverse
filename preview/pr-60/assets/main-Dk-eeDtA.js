import"./modulepreload-polyfill-B5Qt9EMX.js";const dn=!1;var kn=Array.isArray,Ti=Array.prototype.indexOf,qs=Array.from,Pr=Object.defineProperty,Zt=Object.getOwnPropertyDescriptor,Dr=Object.getOwnPropertyDescriptors,Ci=Object.prototype,$i=Array.prototype,Tn=Object.getPrototypeOf,hr=Object.isExtensible;const at=()=>{};function Ii(e){return e()}function Gs(e){for(var t=0;t<e.length;t++)e[t]()}function Lr(){var e,t,s=new Promise((n,r)=>{e=n,t=r});return{promise:s,resolve:e,reject:t}}const fe=2,Cn=4,js=8,Ai=1<<24,ct=16,ut=32,Gt=64,Ws=128,Xe=512,ce=1024,Te=2048,qe=4096,Pe=8192,it=16384,$n=32768,Dt=65536,pr=1<<17,Or=1<<18,rs=1<<19,Rr=1<<20,rt=1<<25,Lt=32768,hn=1<<21,In=1<<22,yt=1<<23,ot=Symbol("$state"),Pi=Symbol("legacy props"),Di=Symbol(""),Kt=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Nr(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Li(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Oi(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ri(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ni(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Gi(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function zi(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Fi(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Bi(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Yi(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Ui(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Xi=1,qi=2,Gr=4,ji=8,Wi=16,Hi=1,Vi=2,Ki=4,Ji=8,Zi=16,Qi=1,eo=2,he=Symbol(),to="http://www.w3.org/1999/xhtml";function so(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function no(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function zr(e){return e===this.v}function Fr(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Br(e){return!Fr(e,this.v)}let as=!1,ro=!1;function ao(){as=!0}let ee=null;function Qt(e){ee=e}function ft(e,t=!1,s){ee={p:ee,i:!1,c:null,e:null,s:e,x:null,l:as&&!t?{s:null,u:null,$:[]}:null}}function vt(e){var t=ee,s=t.e;if(s!==null){t.e=null;for(var n of s)na(n)}return t.i=!0,ee=t.p,{}}function Ss(){return!as||ee!==null&&ee.l===null}let Ct=[];function Yr(){var e=Ct;Ct=[],Gs(e)}function is(e){if(Ct.length===0&&!ds){var t=Ct;queueMicrotask(()=>{t===Ct&&Yr()})}Ct.push(e)}function io(){for(;Ct.length>0;)Yr()}function Ur(e){var t=q;if(t===null)return Y.f|=yt,e;if((t.f&$n)===0){if((t.f&Ws)===0)throw e;t.b.error(e)}else es(e,t)}function es(e,t){for(;t!==null;){if((t.f&Ws)!==0)try{t.b.error(e);return}catch(s){e=s}t=t.parent}throw e}const Ps=new Set;let U=null,vs=null,Ge=null,Oe=[],Hs=null,pn=!1,ds=!1;class Ke{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#s=0;#l=null;#a=new Set;#r=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(t){Oe=[],vs=null,this.apply();var s={parent:null,effect:null,effects:[],render_effects:[]};for(const n of t)this.#i(n,s);this.is_fork||this.#u(),this.is_deferred()?(this.#o(s.effects),this.#o(s.render_effects)):(vs=this,U=null,gr(s.render_effects),gr(s.effects),vs=null,this.#l?.resolve()),Ge=null}#i(t,s){t.f^=ce;for(var n=t.first;n!==null;){var r=n.f,a=(r&(ut|Gt))!==0,i=a&&(r&ce)!==0,o=i||(r&Pe)!==0||this.skipped_effects.has(n);if((n.f&Ws)!==0&&n.b?.is_pending()&&(s={parent:s,effect:n,effects:[],render_effects:[]}),!o&&n.fn!==null){a?n.f^=ce:(r&Cn)!==0?s.effects.push(n):os(n)&&((n.f&ct)!==0&&this.#a.add(n),ts(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)c===s.effect&&(this.#o(s.effects),this.#o(s.render_effects),s=s.parent),n=c.next,c=c.parent}}#o(t){for(const s of t)(s.f&Te)!==0?this.#a.add(s):(s.f&qe)!==0&&this.#r.add(s),this.#c(s.deps),ue(s,ce)}#c(t){if(t!==null)for(const s of t)(s.f&fe)===0||(s.f&Lt)===0||(s.f^=Lt,this.#c(s.deps))}capture(t,s){this.previous.has(t)||this.previous.set(t,s),(t.f&yt)===0&&(this.current.set(t,t.v),Ge?.set(t,t.v))}activate(){U=this,this.apply()}deactivate(){U===this&&(U=null,Ge=null)}flush(){if(this.activate(),Oe.length>0){if(Xr(),U!==null&&U!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const t of this.#t)t(this);this.#t.clear()}#u(){if(this.#s===0){for(const t of this.#e)t();this.#e.clear()}this.#n===0&&this.#f()}#f(){if(Ps.size>1){this.previous.clear();var t=Ge,s=!0,n={parent:null,effect:null,effects:[],render_effects:[]};for(const a of Ps){if(a===this){s=!1;continue}const i=[];for(const[l,c]of this.current){if(a.current.has(l))if(s&&c!==a.current.get(l))a.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...a.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Oe;Oe=[];const l=new Set,c=new Map;for(const u of i)qr(u,o,l,c);if(Oe.length>0){U=a,a.apply();for(const u of Oe)a.#i(u,n);a.deactivate()}Oe=r}}U=null,Ge=t}this.committed=!0,Ps.delete(this)}increment(t){this.#n+=1,t&&(this.#s+=1)}decrement(t){this.#n-=1,t&&(this.#s-=1),this.revive()}revive(){for(const t of this.#a)this.#r.delete(t),ue(t,Te),Ot(t);for(const t of this.#r)ue(t,qe),Ot(t);this.flush()}oncommit(t){this.#e.add(t)}ondiscard(t){this.#t.add(t)}settled(){return(this.#l??=Lr()).promise}static ensure(){if(U===null){const t=U=new Ke;Ps.add(U),ds||Ke.enqueue(()=>{U===t&&t.flush()})}return U}static enqueue(t){is(t)}apply(){}}function oo(e){var t=ds;ds=!0;try{for(var s;;){if(io(),Oe.length===0&&(U?.flush(),Oe.length===0))return Hs=null,s;Xr()}}finally{ds=t}}function Xr(){var e=At;pn=!0;var t=null;try{var s=0;for(Fs(!0);Oe.length>0;){var n=Ke.ensure();if(s++>1e3){var r,a;lo()}n.process(Oe),xt.clear()}}finally{pn=!1,Fs(e),Hs=null}}function lo(){try{Gi()}catch(e){es(e,Hs)}}let tt=null;function gr(e){var t=e.length;if(t!==0){for(var s=0;s<t;){var n=e[s++];if((n.f&(it|Pe))===0&&os(n)&&(tt=new Set,ts(n),n.deps===null&&n.first===null&&n.nodes===null&&(n.teardown===null&&n.ac===null?la(n):n.fn=null),tt?.size>0)){xt.clear();for(const r of tt){if((r.f&(it|Pe))!==0)continue;const a=[r];let i=r.parent;for(;i!==null;)tt.has(i)&&(tt.delete(i),a.push(i)),i=i.parent;for(let o=a.length-1;o>=0;o--){const l=a[o];(l.f&(it|Pe))===0&&ts(l)}}tt.clear()}}tt=null}}function qr(e,t,s,n){if(!s.has(e)&&(s.add(e),e.reactions!==null))for(const r of e.reactions){const a=r.f;(a&fe)!==0?qr(r,t,s,n):(a&(In|ct))!==0&&(a&Te)===0&&jr(r,t,n)&&(ue(r,Te),Ot(r))}}function jr(e,t,s){const n=s.get(e);if(n!==void 0)return n;if(e.deps!==null)for(const r of e.deps){if(t.includes(r))return!0;if((r.f&fe)!==0&&jr(r,t,s))return s.set(r,!0),!0}return s.set(e,!1),!1}function Ot(e){for(var t=Hs=e;t.parent!==null;){t=t.parent;var s=t.f;if(pn&&t===q&&(s&ct)!==0&&(s&Or)===0)return;if((s&(Gt|ut))!==0){if((s&ce)===0)return;t.f^=ce}}Oe.push(t)}function co(e){let t=0,s=Rt(0),n;return()=>{_s()&&(f(s),ks(()=>(t===0&&(n=G(()=>e(()=>hs(s)))),t+=1,()=>{is(()=>{t-=1,t===0&&(n?.(),n=void 0,hs(s))})})))}}var uo=Dt|rs|Ws;function fo(e,t,s){new vo(e,t,s)}class vo{parent;#e=!1;#t;#n=null;#s;#l;#a;#r=null;#i=null;#o=null;#c=null;#u=null;#f=0;#v=0;#h=!1;#d=null;#b=co(()=>(this.#d=Rt(this.#f),()=>{this.#d=null}));constructor(t,s,n){this.#t=t,this.#s=s,this.#l=n,this.parent=q.b,this.#e=!!this.#s.pending,this.#a=Zs(()=>{q.b=this;{var r=this.#_();try{this.#r=Re(()=>n(r))}catch(a){this.error(a)}this.#v>0?this.#g():this.#e=!1}return()=>{this.#u?.remove()}},uo)}#w(){try{this.#r=Re(()=>this.#l(this.#t))}catch(t){this.error(t)}this.#e=!1}#y(){const t=this.#s.pending;t&&(this.#i=Re(()=>t(this.#t)),Ke.enqueue(()=>{var s=this.#_();this.#r=this.#p(()=>(Ke.ensure(),Re(()=>this.#l(s)))),this.#v>0?this.#g():(It(this.#i,()=>{this.#i=null}),this.#e=!1)}))}#_(){var t=this.#t;return this.#e&&(this.#u=St(),this.#t.before(this.#u),t=this.#u),t}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#s.pending}#p(t){var s=q,n=Y,r=ee;Ze(this.#a),Me(this.#a),Qt(this.#a.ctx);try{return t()}catch(a){return Ur(a),null}finally{Ze(s),Me(n),Qt(r)}}#g(){const t=this.#s.pending;this.#r!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#u),fa(this.#r,this.#c)),this.#i===null&&(this.#i=Re(()=>t(this.#t)))}#m(t){if(!this.has_pending_snippet()){this.parent&&this.parent.#m(t);return}this.#v+=t,this.#v===0&&(this.#e=!1,this.#i&&It(this.#i,()=>{this.#i=null}),this.#c&&(this.#t.before(this.#c),this.#c=null))}update_pending_count(t){this.#m(t),this.#f+=t,this.#d&&Nt(this.#d,this.#f)}get_effect_pending(){return this.#b(),f(this.#d)}error(t){var s=this.#s.onerror;let n=this.#s.failed;if(this.#h||!s&&!n)throw t;this.#r&&(ke(this.#r),this.#r=null),this.#i&&(ke(this.#i),this.#i=null),this.#o&&(ke(this.#o),this.#o=null);var r=!1,a=!1;const i=()=>{if(r){no();return}r=!0,a&&Ui(),Ke.ensure(),this.#f=0,this.#o!==null&&It(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#r=this.#p(()=>(this.#h=!1,Re(()=>this.#l(this.#t)))),this.#v>0?this.#g():this.#e=!1};var o=Y;try{Me(null),a=!0,s?.(t,i),a=!1}catch(l){es(l,this.#a&&this.#a.parent)}finally{Me(o)}n&&is(()=>{this.#o=this.#p(()=>{Ke.ensure(),this.#h=!0;try{return Re(()=>{n(this.#t,()=>t,()=>i)})}catch(l){return es(l,this.#a.parent),null}finally{this.#h=!1}})})}}function ho(e,t,s,n){const r=Ss()?Es:An;if(s.length===0&&e.length===0){n(t.map(r));return}var a=U,i=q,o=po();function l(){Promise.all(s.map(c=>go(c))).then(c=>{o();try{n([...t.map(r),...c])}catch(u){(i.f&it)===0&&es(u,i)}a?.deactivate(),zs()}).catch(c=>{es(c,i)})}e.length>0?Promise.all(e).then(()=>{o();try{return l()}finally{a?.deactivate(),zs()}}):l()}function po(){var e=q,t=Y,s=ee,n=U;return function(a=!0){Ze(e),Me(t),Qt(s),a&&n?.activate()}}function zs(){Ze(null),Me(null),Qt(null)}function Es(e){var t=fe|Te,s=Y!==null&&(Y.f&fe)!==0?Y:null;return q!==null&&(q.f|=rs),{ctx:ee,deps:null,effects:null,equals:zr,f:t,fn:e,reactions:null,rv:0,v:he,wv:0,parent:s??q,ac:null}}function go(e,t){let s=q;s===null&&Li();var n=s.b,r=void 0,a=Rt(he),i=!Y,o=new Map;return Co(()=>{var l=Lr();r=l.promise;try{Promise.resolve(e()).then(l.resolve,l.reject).then(()=>{c===U&&c.committed&&c.deactivate(),zs()})}catch(d){l.reject(d),zs()}var c=U;if(i){var u=!n.is_pending();n.update_pending_count(1),c.increment(u),o.get(c)?.reject(Kt),o.delete(c),o.set(c,l)}const g=(d,p=void 0)=>{if(c.activate(),p)p!==Kt&&(a.f|=yt,Nt(a,p));else{(a.f&yt)!==0&&(a.f^=yt),Nt(a,d);for(const[b,E]of o){if(o.delete(b),b===c)break;E.reject(Kt)}}i&&(n.update_pending_count(-1),c.decrement(u))};l.promise.then(g,d=>g(null,d||"unknown"))}),Ks(()=>{for(const l of o.values())l.reject(Kt)}),new Promise(l=>{function c(u){function g(){u===r?l(a):c(r)}u.then(g,g)}c(r)})}function _o(e){const t=Es(e);return va(t),t}function An(e){const t=Es(e);return t.equals=Br,t}function Wr(e){var t=e.effects;if(t!==null){e.effects=null;for(var s=0;s<t.length;s+=1)ke(t[s])}}function mo(e){for(var t=e.parent;t!==null;){if((t.f&fe)===0)return(t.f&it)===0?t:null;t=t.parent}return null}function Pn(e){var t,s=q;Ze(mo(e));try{e.f&=~Lt,Wr(e),t=ga(e)}finally{Ze(s)}return t}function Hr(e){var t=Pn(e);if(e.equals(t)||(U?.is_fork||(e.v=t),e.wv=ha()),!zt)if(Ge!==null)(_s()||U?.is_fork)&&Ge.set(e,t);else{var s=(e.f&Xe)===0?qe:ce;ue(e,s)}}let gn=new Set;const xt=new Map;let Vr=!1;function Rt(e,t){var s={f:0,v:e,reactions:null,equals:zr,rv:0,wv:0};return s}function Se(e,t){const s=Rt(e);return va(s),s}function oe(e,t=!1,s=!0){const n=Rt(e);return t||(n.equals=Br),as&&s&&ee!==null&&ee.l!==null&&(ee.l.s??=[]).push(n),n}function bo(e,t){return F(e,G(()=>f(e))),t}function F(e,t,s=!1){Y!==null&&(!Je||(Y.f&pr)!==0)&&Ss()&&(Y.f&(fe|ct|In|pr))!==0&&!lt?.includes(e)&&Yi();let n=s?Jt(t):t;return Nt(e,n)}function Nt(e,t){if(!e.equals(t)){var s=e.v;zt?xt.set(e,t):xt.set(e,s),e.v=t;var n=Ke.ensure();n.capture(e,s),(e.f&fe)!==0&&((e.f&Te)!==0&&Pn(e),ue(e,(e.f&Xe)!==0?ce:qe)),e.wv=ha(),Kr(e,Te),Ss()&&q!==null&&(q.f&ce)!==0&&(q.f&(ut|Gt))===0&&(Le===null?Po([e]):Le.push(e)),!n.is_fork&&gn.size>0&&!Vr&&wo()}return t}function wo(){Vr=!1;var e=At;Fs(!0);const t=Array.from(gn);try{for(const s of t)(s.f&ce)!==0&&ue(s,qe),os(s)&&ts(s)}finally{Fs(e)}gn.clear()}function hs(e){F(e,e.v+1)}function Kr(e,t){var s=e.reactions;if(s!==null)for(var n=Ss(),r=s.length,a=0;a<r;a++){var i=s[a],o=i.f;if(!(!n&&i===q)){var l=(o&Te)===0;if(l&&ue(i,t),(o&fe)!==0){var c=i;Ge?.delete(c),(o&Lt)===0&&(o&Xe&&(i.f|=Lt),Kr(c,qe))}else l&&((o&ct)!==0&&tt!==null&&tt.add(i),Ot(i))}}}function Jt(e){if(typeof e!="object"||e===null||ot in e)return e;const t=Tn(e);if(t!==Ci&&t!==$i)return e;var s=new Map,n=kn(e),r=Se(0),a=Pt,i=o=>{if(Pt===a)return o();var l=Y,c=Pt;Me(null),yr(a);var u=o();return Me(l),yr(c),u};return n&&s.set("length",Se(e.length)),new Proxy(e,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Fi();var u=s.get(l);return u===void 0?u=i(()=>{var g=Se(c.value);return s.set(l,g),g}):F(u,c.value,!0),!0},deleteProperty(o,l){var c=s.get(l);if(c===void 0){if(l in o){const u=i(()=>Se(he));s.set(l,u),hs(r)}}else F(c,he),hs(r);return!0},get(o,l,c){if(l===ot)return e;var u=s.get(l),g=l in o;if(u===void 0&&(!g||Zt(o,l)?.writable)&&(u=i(()=>{var p=Jt(g?o[l]:he),b=Se(p);return b}),s.set(l,u)),u!==void 0){var d=f(u);return d===he?void 0:d}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var u=s.get(l);u&&(c.value=f(u))}else if(c===void 0){var g=s.get(l),d=g?.v;if(g!==void 0&&d!==he)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return c},has(o,l){if(l===ot)return!0;var c=s.get(l),u=c!==void 0&&c.v!==he||Reflect.has(o,l);if(c!==void 0||q!==null&&(!u||Zt(o,l)?.writable)){c===void 0&&(c=i(()=>{var d=u?Jt(o[l]):he,p=Se(d);return p}),s.set(l,c));var g=f(c);if(g===he)return!1}return u},set(o,l,c,u){var g=s.get(l),d=l in o;if(n&&l==="length")for(var p=c;p<g.v;p+=1){var b=s.get(p+"");b!==void 0?F(b,he):p in o&&(b=i(()=>Se(he)),s.set(p+"",b))}if(g===void 0)(!d||Zt(o,l)?.writable)&&(g=i(()=>Se(void 0)),F(g,Jt(c)),s.set(l,g));else{d=g.v!==he;var E=i(()=>Jt(c));F(g,E)}var _=Reflect.getOwnPropertyDescriptor(o,l);if(_?.set&&_.set.call(u,c),!d){if(n&&typeof l=="string"){var w=s.get("length"),P=Number(l);Number.isInteger(P)&&P>=w.v&&F(w,P+1)}hs(r)}return!0},ownKeys(o){f(r);var l=Reflect.ownKeys(o).filter(g=>{var d=s.get(g);return d===void 0||d.v!==he});for(var[c,u]of s)u.v!==he&&!(c in o)&&l.push(c);return l},setPrototypeOf(){Bi()}})}function _r(e){try{if(e!==null&&typeof e=="object"&&ot in e)return e[ot]}catch{}return e}function yo(e,t){return Object.is(_r(e),_r(t))}var mr,Jr,Zr,Qr;function xo(){if(mr===void 0){mr=window,Jr=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,s=Text.prototype;Zr=Zt(t,"firstChild").get,Qr=Zt(t,"nextSibling").get,hr(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),hr(s)&&(s.__t=void 0)}}function St(e=""){return document.createTextNode(e)}function mt(e){return Zr.call(e)}function Ms(e){return Qr.call(e)}function v(e,t){return mt(e)}function Ee(e,t=!1){{var s=mt(e);return s instanceof Comment&&s.data===""?Ms(s):s}}function h(e,t=1,s=!1){let n=e;for(;t--;)n=Ms(n);return n}function So(e){e.textContent=""}function ea(){return!1}let br=!1;function Eo(){br||(br=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const t of e.target.elements)t.__on_r?.()})},{capture:!0}))}function Vs(e){var t=Y,s=q;Me(null),Ze(null);try{return e()}finally{Me(t),Ze(s)}}function ta(e,t,s,n=s){e.addEventListener(t,()=>Vs(s));const r=e.__on_r;r?e.__on_r=()=>{r(),n(!0)}:e.__on_r=()=>n(!0),Eo()}function sa(e){q===null&&(Y===null&&Ni(),Ri()),zt&&Oi()}function Mo(e,t){var s=t.last;s===null?t.last=t.first=e:(s.next=e,e.prev=s,t.last=e)}function Qe(e,t,s){var n=q;n!==null&&(n.f&Pe)!==0&&(e|=Pe);var r={ctx:ee,deps:null,nodes:null,f:e|Te|Xe,first:null,fn:t,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,wv:0,ac:null};if(s)try{ts(r),r.f|=$n}catch(o){throw ke(r),o}else t!==null&&Ot(r);var a=r;if(s&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&(a.f&rs)===0&&(a=a.first,(e&ct)!==0&&(e&Dt)!==0&&a!==null&&(a.f|=Dt)),a!==null&&(a.parent=n,n!==null&&Mo(a,n),Y!==null&&(Y.f&fe)!==0&&(e&Gt)===0)){var i=Y;(i.effects??=[]).push(a)}return r}function _s(){return Y!==null&&!Je}function Ks(e){const t=Qe(js,null,!1);return ue(t,ce),t.teardown=e,t}function ms(e){sa();var t=q.f,s=!Y&&(t&ut)!==0&&(t&$n)===0;if(s){var n=ee;(n.e??=[]).push(e)}else return na(e)}function na(e){return Qe(Cn|Rr,e,!1)}function ko(e){return sa(),Qe(js|Rr,e,!0)}function To(e){Ke.ensure();const t=Qe(Gt|rs,e,!0);return(s={})=>new Promise(n=>{s.outro?It(t,()=>{ke(t),n(void 0)}):(ke(t),n(void 0))})}function ra(e){return Qe(Cn,e,!1)}function st(e,t){var s=ee,n={effect:null,ran:!1,deps:e};s.l.$.push(n),n.effect=ks(()=>{e(),!n.ran&&(n.ran=!0,G(t))})}function Js(){var e=ee;ks(()=>{for(var t of e.l.$){t.deps();var s=t.effect;(s.f&ce)!==0&&ue(s,qe),os(s)&&ts(s),t.ran=!1}})}function Co(e){return Qe(In|rs,e,!0)}function ks(e,t=0){return Qe(js|t,e,!0)}function z(e,t=[],s=[],n=[]){ho(n,t,s,r=>{Qe(js,()=>e(...r.map(f)),!0)})}function Zs(e,t=0){var s=Qe(ct|t,e,!0);return s}function Re(e){return Qe(ut|rs,e,!0)}function aa(e){var t=e.teardown;if(t!==null){const s=zt,n=Y;wr(!0),Me(null);try{t.call(null)}finally{wr(s),Me(n)}}}function ia(e,t=!1){var s=e.first;for(e.first=e.last=null;s!==null;){const r=s.ac;r!==null&&Vs(()=>{r.abort(Kt)});var n=s.next;(s.f&Gt)!==0?s.parent=null:ke(s,t),s=n}}function $o(e){for(var t=e.first;t!==null;){var s=t.next;(t.f&ut)===0&&ke(t),t=s}}function ke(e,t=!0){var s=!1;(t||(e.f&Or)!==0)&&e.nodes!==null&&e.nodes.end!==null&&(oa(e.nodes.start,e.nodes.end),s=!0),ia(e,t&&!s),Bs(e,0),ue(e,it);var n=e.nodes&&e.nodes.t;if(n!==null)for(const a of n)a.stop();aa(e);var r=e.parent;r!==null&&r.first!==null&&la(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes=e.ac=null}function oa(e,t){for(;e!==null;){var s=e===t?null:Ms(e);e.remove(),e=s}}function la(e){var t=e.parent,s=e.prev,n=e.next;s!==null&&(s.next=n),n!==null&&(n.prev=s),t!==null&&(t.first===e&&(t.first=n),t.last===e&&(t.last=s))}function It(e,t,s=!0){var n=[];ca(e,n,!0);var r=()=>{s&&ke(e),t&&t()},a=n.length;if(a>0){var i=()=>--a||r();for(var o of n)o.out(i)}else r()}function ca(e,t,s){if((e.f&Pe)===0){e.f^=Pe;var n=e.nodes&&e.nodes.t;if(n!==null)for(const o of n)(o.is_global||s)&&t.push(o);for(var r=e.first;r!==null;){var a=r.next,i=(r.f&Dt)!==0||(r.f&ut)!==0&&(e.f&ct)!==0;ca(r,t,i?s:!1),r=a}}}function Dn(e){ua(e,!0)}function ua(e,t){if((e.f&Pe)!==0){e.f^=Pe,(e.f&ce)===0&&(ue(e,Te),Ot(e));for(var s=e.first;s!==null;){var n=s.next,r=(s.f&Dt)!==0||(s.f&ut)!==0;ua(s,r?t:!1),s=n}var a=e.nodes&&e.nodes.t;if(a!==null)for(const i of a)(i.is_global||t)&&i.in()}}function fa(e,t){if(e.nodes)for(var s=e.nodes.start,n=e.nodes.end;s!==null;){var r=s===n?null:Ms(s);t.append(s),s=r}}let Vt=null;function Io(e){var t=Vt;try{if(Vt=new Set,G(e),t!==null)for(var s of Vt)t.add(s);return Vt}finally{Vt=t}}function Ao(e){for(var t of Io(e))Nt(t,t.v)}let At=!1;function Fs(e){At=e}let zt=!1;function wr(e){zt=e}let Y=null,Je=!1;function Me(e){Y=e}let q=null;function Ze(e){q=e}let lt=null;function va(e){Y!==null&&(lt===null?lt=[e]:lt.push(e))}let be=null,Ae=0,Le=null;function Po(e){Le=e}let da=1,bs=0,Pt=bs;function yr(e){Pt=e}function ha(){return++da}function os(e){var t=e.f;if((t&Te)!==0)return!0;if(t&fe&&(e.f&=~Lt),(t&qe)!==0){var s=e.deps;if(s!==null)for(var n=s.length,r=0;r<n;r++){var a=s[r];if(os(a)&&Hr(a),a.wv>e.wv)return!0}(t&Xe)!==0&&Ge===null&&ue(e,ce)}return!1}function pa(e,t,s=!0){var n=e.reactions;if(n!==null&&!lt?.includes(e))for(var r=0;r<n.length;r++){var a=n[r];(a.f&fe)!==0?pa(a,t,!1):t===a&&(s?ue(a,Te):(a.f&ce)!==0&&ue(a,qe),Ot(a))}}function ga(e){var t=be,s=Ae,n=Le,r=Y,a=lt,i=ee,o=Je,l=Pt,c=e.f;be=null,Ae=0,Le=null,Y=(c&(ut|Gt))===0?e:null,lt=null,Qt(e.ctx),Je=!1,Pt=++bs,e.ac!==null&&(Vs(()=>{e.ac.abort(Kt)}),e.ac=null);try{e.f|=hn;var u=e.fn,g=u(),d=e.deps;if(be!==null){var p;if(Bs(e,Ae),d!==null&&Ae>0)for(d.length=Ae+be.length,p=0;p<be.length;p++)d[Ae+p]=be[p];else e.deps=d=be;if(_s()&&(e.f&Xe)!==0)for(p=Ae;p<d.length;p++)(d[p].reactions??=[]).push(e)}else d!==null&&Ae<d.length&&(Bs(e,Ae),d.length=Ae);if(Ss()&&Le!==null&&!Je&&d!==null&&(e.f&(fe|qe|Te))===0)for(p=0;p<Le.length;p++)pa(Le[p],e);return r!==null&&r!==e&&(bs++,Le!==null&&(n===null?n=Le:n.push(...Le))),(e.f&yt)!==0&&(e.f^=yt),g}catch(b){return Ur(b)}finally{e.f^=hn,be=t,Ae=s,Le=n,Y=r,lt=a,Qt(i),Je=o,Pt=l}}function Do(e,t){let s=t.reactions;if(s!==null){var n=Ti.call(s,e);if(n!==-1){var r=s.length-1;r===0?s=t.reactions=null:(s[n]=s[r],s.pop())}}s===null&&(t.f&fe)!==0&&(be===null||!be.includes(t))&&(ue(t,qe),(t.f&Xe)!==0&&(t.f^=Xe,t.f&=~Lt),Wr(t),Bs(t,0))}function Bs(e,t){var s=e.deps;if(s!==null)for(var n=t;n<s.length;n++)Do(e,s[n])}function ts(e){var t=e.f;if((t&it)===0){ue(e,ce);var s=q,n=At;q=e,At=!0;try{(t&(ct|Ai))!==0?$o(e):ia(e),aa(e);var r=ga(e);e.teardown=typeof r=="function"?r:null,e.wv=da;var a;dn&&ro&&(e.f&Te)!==0&&e.deps}finally{At=n,q=s}}}async function Lo(){await Promise.resolve(),oo()}function f(e){var t=e.f,s=(t&fe)!==0;if(Vt?.add(e),Y!==null&&!Je){var n=q!==null&&(q.f&it)!==0;if(!n&&!lt?.includes(e)){var r=Y.deps;if((Y.f&hn)!==0)e.rv<bs&&(e.rv=bs,be===null&&r!==null&&r[Ae]===e?Ae++:be===null?be=[e]:be.includes(e)||be.push(e));else{(Y.deps??=[]).push(e);var a=e.reactions;a===null?e.reactions=[Y]:a.includes(Y)||a.push(Y)}}}if(zt){if(xt.has(e))return xt.get(e);if(s){var i=e,o=i.v;return((i.f&ce)===0&&i.reactions!==null||ma(i))&&(o=Pn(i)),xt.set(i,o),o}}else s&&(!Ge?.has(e)||U?.is_fork&&!_s())&&(i=e,os(i)&&Hr(i),At&&_s()&&(i.f&Xe)===0&&_a(i));if(Ge?.has(e))return Ge.get(e);if((e.f&yt)!==0)throw e.v;return e.v}function _a(e){if(e.deps!==null){e.f^=Xe;for(const t of e.deps)(t.reactions??=[]).push(e),(t.f&fe)!==0&&(t.f&Xe)===0&&_a(t)}}function ma(e){if(e.v===he)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(xt.has(t)||(t.f&fe)!==0&&ma(t))return!0;return!1}function G(e){var t=Je;try{return Je=!0,e()}finally{Je=t}}const Oo=-7169;function ue(e,t){e.f=e.f&Oo|t}function Ro(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(ot in e)_n(e);else if(!Array.isArray(e))for(let t in e){const s=e[t];typeof s=="object"&&s&&ot in s&&_n(s)}}}function _n(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let n in e)try{_n(e[n],t)}catch{}const s=Tn(e);if(s!==Object.prototype&&s!==Array.prototype&&s!==Map.prototype&&s!==Set.prototype&&s!==Date.prototype){const n=Dr(s);for(let r in n){const a=n[r].get;if(a)try{a.call(e)}catch{}}}}}const No=["touchstart","touchmove"];function Go(e){return No.includes(e)}const ba=new Set,mn=new Set;function zo(e,t,s,n={}){function r(a){if(n.capture||us.call(t,a),!a.cancelBubble)return Vs(()=>s?.call(this,a))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?is(()=>{t.addEventListener(e,r,n)}):t.addEventListener(e,r,n),r}function wa(e,t,s,n,r){var a={capture:n,passive:r},i=zo(e,t,s,a);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&Ks(()=>{t.removeEventListener(e,i,a)})}function ls(e){for(var t=0;t<e.length;t++)ba.add(e[t]);for(var s of mn)s(e)}let xr=null;function us(e){var t=this,s=t.ownerDocument,n=e.type,r=e.composedPath?.()||[],a=r[0]||e.target;xr=e;var i=0,o=xr===e&&e.__root;if(o){var l=r.indexOf(o);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var c=r.indexOf(t);if(c===-1)return;l<=c&&(i=l)}if(a=r[i]||e.target,a!==t){Pr(e,"currentTarget",{configurable:!0,get(){return a||s}});var u=Y,g=q;Me(null),Ze(null);try{for(var d,p=[];a!==null;){var b=a.assignedSlot||a.parentNode||a.host||null;try{var E=a["__"+n];E!=null&&(!a.disabled||e.target===a)&&E.call(a,e)}catch(_){d?p.push(_):d=_}if(e.cancelBubble||b===t||b===null)break;a=b}if(d){for(let _ of p)queueMicrotask(()=>{throw _});throw d}}finally{e.__root=t,delete e.currentTarget,Me(u),Ze(g)}}}function ya(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function Ys(e,t){var s=q;s.nodes===null&&(s.nodes={start:e,end:t,a:null,t:null})}function T(e,t){var s=(t&Qi)!==0,n=(t&eo)!==0,r,a=!e.startsWith("<!>");return()=>{r===void 0&&(r=ya(a?e:"<!>"+e),s||(r=mt(r)));var i=n||Jr?document.importNode(r,!0):r.cloneNode(!0);if(s){var o=mt(i),l=i.lastChild;Ys(o,l)}else Ys(i,i);return i}}function Us(){var e=document.createDocumentFragment(),t=document.createComment(""),s=St();return e.append(t,s),Ys(t,s),e}function k(e,t){e!==null&&e.before(t)}function D(e,t){var s=t==null?"":typeof t=="object"?t+"":t;s!==(e.__t??=e.nodeValue)&&(e.__t=s,e.nodeValue=s+"")}function Fo(e,t){return Bo(e,t)}const Wt=new Map;function Bo(e,{target:t,anchor:s,props:n={},events:r,context:a,intro:i=!0}){xo();var o=new Set,l=g=>{for(var d=0;d<g.length;d++){var p=g[d];if(!o.has(p)){o.add(p);var b=Go(p);t.addEventListener(p,us,{passive:b});var E=Wt.get(p);E===void 0?(document.addEventListener(p,us,{passive:b}),Wt.set(p,1)):Wt.set(p,E+1)}}};l(qs(ba)),mn.add(l);var c=void 0,u=To(()=>{var g=s??t.appendChild(St());return fo(g,{pending:()=>{}},d=>{if(a){ft({});var p=ee;p.c=a}r&&(n.$$events=r),c=e(d,n)||{},a&&vt()}),()=>{for(var d of o){t.removeEventListener(d,us);var p=Wt.get(d);--p===0?(document.removeEventListener(d,us),Wt.delete(d)):Wt.set(d,p)}mn.delete(l),g!==s&&g.parentNode?.removeChild(g)}});return Yo.set(c,u),c}let Yo=new WeakMap;class xa{anchor;#e=new Map;#t=new Map;#n=new Map;#s=new Set;#l=!0;constructor(t,s=!0){this.anchor=t,this.#l=s}#a=()=>{var t=U;if(this.#e.has(t)){var s=this.#e.get(t),n=this.#t.get(s);if(n)Dn(n),this.#s.delete(s);else{var r=this.#n.get(s);r&&(this.#t.set(s,r.effect),this.#n.delete(s),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),n=r.effect)}for(const[a,i]of this.#e){if(this.#e.delete(a),a===t)break;const o=this.#n.get(i);o&&(ke(o.effect),this.#n.delete(i))}for(const[a,i]of this.#t){if(a===s||this.#s.has(a))continue;const o=()=>{if(Array.from(this.#e.values()).includes(a)){var c=document.createDocumentFragment();fa(i,c),c.append(St()),this.#n.set(a,{effect:i,fragment:c})}else ke(i);this.#s.delete(a),this.#t.delete(a)};this.#l||!n?(this.#s.add(a),It(i,o,!1)):o()}}};#r=t=>{this.#e.delete(t);const s=Array.from(this.#e.values());for(const[n,r]of this.#n)s.includes(n)||(ke(r.effect),this.#n.delete(n))};ensure(t,s){var n=U,r=ea();if(s&&!this.#t.has(t)&&!this.#n.has(t))if(r){var a=document.createDocumentFragment(),i=St();a.append(i),this.#n.set(t,{effect:Re(()=>s(i)),fragment:a})}else this.#t.set(t,Re(()=>s(this.anchor)));if(this.#e.set(n,t),r){for(const[o,l]of this.#t)o===t?n.skipped_effects.delete(l):n.skipped_effects.add(l);for(const[o,l]of this.#n)o===t?n.skipped_effects.delete(l.effect):n.skipped_effects.add(l.effect);n.oncommit(this.#a),n.ondiscard(this.#r)}else this.#a()}}function Q(e,t,s=!1){var n=new xa(e),r=s?Dt:0;function a(i,o){n.ensure(i,o)}Zs(()=>{var i=!1;t((o,l=!0)=>{i=!0,a(l,o)}),i||a(!1,null)},r)}function nt(e,t){return t}function Uo(e,t,s){for(var n=[],r=t.length,a,i=t.length,o=0;o<r;o++){let g=t[o];It(g,()=>{if(a){if(a.pending.delete(g),a.done.add(g),a.pending.size===0){var d=e.outrogroups;bn(qs(a.done)),d.delete(a),d.size===0&&(e.outrogroups=null)}}else i-=1},!1)}if(i===0){var l=n.length===0&&s!==null;if(l){var c=s,u=c.parentNode;So(u),u.append(c),e.items.clear()}bn(t,!l)}else a={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(a)}function bn(e,t=!0){for(var s=0;s<e.length;s++)ke(e[s],t)}var Sr;function Ue(e,t,s,n,r,a=null){var i=e,o=new Map,l=(t&Gr)!==0;if(l){var c=e;i=c.appendChild(St())}var u=null,g=An(()=>{var w=s();return kn(w)?w:w==null?[]:qs(w)}),d,p=!0;function b(){_.fallback=u,Xo(_,d,i,t,n),u!==null&&(d.length===0?(u.f&rt)===0?Dn(u):(u.f^=rt,fs(u,null,i)):It(u,()=>{u=null}))}var E=Zs(()=>{d=f(g);for(var w=d.length,P=new Set,C=U,S=ea(),M=0;M<w;M+=1){var I=d[M],y=n(I,M),$=p?null:o.get(y);$?($.v&&Nt($.v,I),$.i&&Nt($.i,M),S&&C.skipped_effects.delete($.e)):($=qo(o,p?i:Sr??=St(),I,y,M,r,t,s),p||($.e.f|=rt),o.set(y,$)),P.add(y)}if(w===0&&a&&!u&&(p?u=Re(()=>a(i)):(u=Re(()=>a(Sr??=St())),u.f|=rt)),!p)if(S){for(const[R,L]of o)P.has(R)||C.skipped_effects.add(L.e);C.oncommit(b),C.ondiscard(()=>{})}else b();f(g)}),_={effect:E,items:o,outrogroups:null,fallback:u};p=!1}function Xo(e,t,s,n,r){var a=(n&ji)!==0,i=t.length,o=e.items,l=e.effect.first,c,u=null,g,d=[],p=[],b,E,_,w;if(a)for(w=0;w<i;w+=1)b=t[w],E=r(b,w),_=o.get(E).e,(_.f&rt)===0&&(_.nodes?.a?.measure(),(g??=new Set).add(_));for(w=0;w<i;w+=1){if(b=t[w],E=r(b,w),_=o.get(E).e,e.outrogroups!==null)for(const L of e.outrogroups)L.pending.delete(_),L.done.delete(_);if((_.f&rt)!==0)if(_.f^=rt,_===l)fs(_,null,s);else{var P=u?u.next:l;_===e.effect.last&&(e.effect.last=_.prev),_.prev&&(_.prev.next=_.next),_.next&&(_.next.prev=_.prev),_t(e,u,_),_t(e,_,P),fs(_,P,s),u=_,d=[],p=[],l=u.next;continue}if((_.f&Pe)!==0&&(Dn(_),a&&(_.nodes?.a?.unfix(),(g??=new Set).delete(_))),_!==l){if(c!==void 0&&c.has(_)){if(d.length<p.length){var C=p[0],S;u=C.prev;var M=d[0],I=d[d.length-1];for(S=0;S<d.length;S+=1)fs(d[S],C,s);for(S=0;S<p.length;S+=1)c.delete(p[S]);_t(e,M.prev,I.next),_t(e,u,M),_t(e,I,C),l=C,u=I,w-=1,d=[],p=[]}else c.delete(_),fs(_,l,s),_t(e,_.prev,_.next),_t(e,_,u===null?e.effect.first:u.next),_t(e,u,_),u=_;continue}for(d=[],p=[];l!==null&&l!==_;)(c??=new Set).add(l),p.push(l),l=l.next;if(l===null)continue}(_.f&rt)===0&&d.push(_),u=_,l=_.next}if(e.outrogroups!==null){for(const L of e.outrogroups)L.pending.size===0&&(bn(qs(L.done)),e.outrogroups?.delete(L));e.outrogroups.size===0&&(e.outrogroups=null)}if(l!==null||c!==void 0){var y=[];if(c!==void 0)for(_ of c)(_.f&Pe)===0&&y.push(_);for(;l!==null;)(l.f&Pe)===0&&l!==e.fallback&&y.push(l),l=l.next;var $=y.length;if($>0){var R=(n&Gr)!==0&&i===0?s:null;if(a){for(w=0;w<$;w+=1)y[w].nodes?.a?.measure();for(w=0;w<$;w+=1)y[w].nodes?.a?.fix()}Uo(e,y,R)}}a&&is(()=>{if(g!==void 0)for(_ of g)_.nodes?.a?.apply()})}function qo(e,t,s,n,r,a,i,o){var l=(i&Xi)!==0?(i&Wi)===0?oe(s,!1,!1):Rt(s):null,c=(i&qi)!==0?Rt(r):null;return{v:l,i:c,e:Re(()=>(a(t,l??s,c??r,o),()=>{e.delete(n)}))}}function fs(e,t,s){if(e.nodes)for(var n=e.nodes.start,r=e.nodes.end,a=t&&(t.f&rt)===0?t.nodes.start:s;n!==null;){var i=Ms(n);if(a.before(n),n===r)return;n=i}}function _t(e,t,s){t===null?e.effect.first=s:t.next=s,s===null?e.effect.last=t:s.prev=t}function jo(e,t,s=!1,n=!1,r=!1){var a=e,i="";z(()=>{var o=q;if(i!==(i=t()??"")&&(o.nodes!==null&&(oa(o.nodes.start,o.nodes.end),o.nodes=null),i!=="")){var l=i+"";s?l=`<svg>${l}</svg>`:n&&(l=`<math>${l}</math>`);var c=ya(l);if((s||n)&&(c=mt(c)),Ys(mt(c),c.lastChild),s||n)for(;mt(c);)a.before(mt(c));else a.before(c)}})}function Wo(e,t,...s){var n=new xa(e);Zs(()=>{const r=t()??null;n.ensure(r,r&&(a=>r(a,...s)))},Dt)}function Sa(e){var t,s,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(s=Sa(e[t]))&&(n&&(n+=" "),n+=s)}else for(s in e)e[s]&&(n&&(n+=" "),n+=s);return n}function Ho(){for(var e,t,s=0,n="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=Sa(e))&&(n&&(n+=" "),n+=t);return n}function Vo(e){return typeof e=="object"?Ho(e):e??""}const Er=[...` 	
\r\f \v\uFEFF`];function Ko(e,t,s){var n=e==null?"":""+e;if(t&&(n=n?n+" "+t:t),s){for(var r in s)if(s[r])n=n?n+" "+r:r;else if(n.length)for(var a=r.length,i=0;(i=n.indexOf(r,i))>=0;){var o=i+a;(i===0||Er.includes(n[i-1]))&&(o===n.length||Er.includes(n[o]))?n=(i===0?"":n.substring(0,i))+n.substring(o+1):i=o}}return n===""?null:n}function Jo(e,t){return e==null?null:String(e)}function re(e,t,s,n,r,a){var i=e.__className;if(i!==s||i===void 0){var o=Ko(s,n,a);o==null?e.removeAttribute("class"):e.className=o,e.__className=s}else if(a&&r!==a)for(var l in a){var c=!!a[l];(r==null||c!==!!r[l])&&e.classList.toggle(l,c)}return a}function ws(e,t,s,n){var r=e.__style;if(r!==t){var a=Jo(t);a==null?e.removeAttribute("style"):e.style.cssText=a,e.__style=t}return n}function Ea(e,t,s=!1){if(e.multiple){if(t==null)return;if(!kn(t))return so();for(var n of e.options)n.selected=t.includes(ps(n));return}for(n of e.options){var r=ps(n);if(yo(r,t)){n.selected=!0;return}}(!s||t!==void 0)&&(e.selectedIndex=-1)}function Zo(e){var t=new MutationObserver(()=>{Ea(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ks(()=>{t.disconnect()})}function Ma(e,t,s=t){var n=new WeakSet,r=!0;ta(e,"change",a=>{var i=a?"[selected]":":checked",o;if(e.multiple)o=[].map.call(e.querySelectorAll(i),ps);else{var l=e.querySelector(i)??e.querySelector("option:not([disabled])");o=l&&ps(l)}s(o),U!==null&&n.add(U)}),ra(()=>{var a=t();if(e===document.activeElement){var i=vs??U;if(n.has(i))return}if(Ea(e,a,r),r&&a===void 0){var o=e.querySelector(":checked");o!==null&&(a=ps(o),s(a))}e.__value=a,r=!1}),Zo(e)}function ps(e){return"__value"in e?e.__value:e.value}const Qo=Symbol("is custom element"),el=Symbol("is html");function wn(e,t){var s=ka(e);s.value===(s.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function ze(e,t,s,n){var r=ka(e);r[t]!==(r[t]=s)&&(t==="loading"&&(e[Di]=s),s==null?e.removeAttribute(t):typeof s!="string"&&tl(e).includes(t)?e[t]=s:e.setAttribute(t,s))}function ka(e){return e.__attributes??={[Qo]:e.nodeName.includes("-"),[el]:e.namespaceURI===to}}var Mr=new Map;function tl(e){var t=e.getAttribute("is")||e.nodeName,s=Mr.get(t);if(s)return s;Mr.set(t,s=[]);for(var n,r=e,a=Element.prototype;a!==r;){n=Dr(r);for(var i in n)n[i].set&&s.push(i);r=Tn(r)}return s}function $t(e,t,s=t){var n=new WeakSet;ta(e,"input",async r=>{var a=r?e.defaultValue:e.value;if(a=cn(e)?un(a):a,s(a),U!==null&&n.add(U),await Lo(),a!==(a=t())){var i=e.selectionStart,o=e.selectionEnd,l=e.value.length;if(e.value=a??"",o!==null){var c=e.value.length;i===o&&o===l&&c>l?(e.selectionStart=c,e.selectionEnd=c):(e.selectionStart=i,e.selectionEnd=Math.min(o,c))}}}),G(t)==null&&e.value&&(s(cn(e)?un(e.value):e.value),U!==null&&n.add(U)),ks(()=>{var r=t();if(e===document.activeElement){var a=vs??U;if(n.has(a))return}cn(e)&&r===un(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function cn(e){var t=e.type;return t==="number"||t==="range"}function un(e){return e===""?null:+e}function kr(e,t){return e===t||e?.[ot]===t}function ss(e={},t,s,n){return ra(()=>{var r,a;return ks(()=>{r=a,a=[],G(()=>{e!==s(...a)&&(t(e,...a),r&&kr(s(...r),e)&&t(null,...r))})}),()=>{is(()=>{a&&kr(s(...a),e)&&t(null,...a)})}}),e}function Ts(e=!1){const t=ee,s=t.l.u;if(!s)return;let n=()=>Ro(t.s);if(e){let r=0,a={};const i=Es(()=>{let o=!1;const l=t.s;for(const c in l)l[c]!==a[c]&&(a[c]=l[c],o=!0);return o&&r++,r});n=()=>f(i)}s.b.length&&ko(()=>{Tr(t,n),Gs(s.b)}),ms(()=>{const r=G(()=>s.m.map(Ii));return()=>{for(const a of r)typeof a=="function"&&a()}}),s.a.length&&ms(()=>{Tr(t,n),Gs(s.a)})}function Tr(e,t){if(e.l.s)for(const s of e.l.s)f(s);t()}function Ln(e,t,s){if(e==null)return t(void 0),s&&s(void 0),at;const n=G(()=>e.subscribe(t,s));return n.unsubscribe?()=>n.unsubscribe():n}const Ht=[];function sl(e,t){return{subscribe:je(e,t).subscribe}}function je(e,t=at){let s=null;const n=new Set;function r(o){if(Fr(e,o)&&(e=o,s)){const l=!Ht.length;for(const c of n)c[1](),Ht.push(c,e);if(l){for(let c=0;c<Ht.length;c+=2)Ht[c][0](Ht[c+1]);Ht.length=0}}}function a(o){r(o(e))}function i(o,l=at){const c=[o,l];return n.add(c),n.size===1&&(s=t(r,a)||at),o(e),()=>{n.delete(c),n.size===0&&s&&(s(),s=null)}}return{set:r,update:a,subscribe:i}}function Ft(e,t,s){const n=!Array.isArray(e),r=n?[e]:e;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=t.length<2;return sl(s,(i,o)=>{let l=!1;const c=[];let u=0,g=at;const d=()=>{if(u)return;g();const b=t(n?c[0]:c,i,o);a?i(b):g=typeof b=="function"?b:at},p=r.map((b,E)=>Ln(b,_=>{c[E]=_,u&=~(1<<E),l&&d()},()=>{u|=1<<E}));return l=!0,d(),function(){Gs(p),g(),l=!1}})}function et(e){let t;return Ln(e,s=>t=s)(),t}let Ds=!1,yn=Symbol();function H(e,t,s){const n=s[t]??={store:null,source:oe(void 0),unsubscribe:at};if(n.store!==e&&!(yn in s))if(n.unsubscribe(),n.store=e??null,e==null)n.source.v=void 0,n.unsubscribe=at;else{var r=!0;n.unsubscribe=Ln(e,a=>{r?n.source.v=a:F(n.source,a)}),r=!1}return e&&yn in s?et(e):f(n.source)}function Bt(){const e={};function t(){Ks(()=>{for(var s in e)e[s].unsubscribe();Pr(e,yn,{enumerable:!1,value:!0})})}return[e,t]}function nl(e){var t=Ds;try{return Ds=!1,[e(),Ds]}finally{Ds=t}}function Ve(e,t,s,n){var r=!as||(s&Vi)!==0,a=(s&Ji)!==0,i=(s&Zi)!==0,o=n,l=!0,c=()=>(l&&(l=!1,o=i?G(n):n),o),u;if(a){var g=ot in e||Pi in e;u=Zt(e,t)?.set??(g&&t in e?C=>e[t]=C:void 0)}var d,p=!1;a?[d,p]=nl(()=>e[t]):d=e[t],d===void 0&&n!==void 0&&(d=c(),u&&(r&&zi(),u(d)));var b;if(r?b=()=>{var C=e[t];return C===void 0?c():(l=!0,C)}:b=()=>{var C=e[t];return C!==void 0&&(o=void 0),C===void 0?o:C},r&&(s&Ki)===0)return b;if(u){var E=e.$$legacy;return(function(C,S){return arguments.length>0?((!r||!S||E||p)&&u(S?b():C),C):b()})}var _=!1,w=((s&Hi)!==0?Es:An)(()=>(_=!1,b()));a&&f(w);var P=q;return(function(C,S){if(arguments.length>0){const M=S?f(w):r&&a?Jt(C):C;return F(w,M),_=!0,o!==void 0&&(o=M),C}return zt&&_||(P.f&it)!==0?w.v:f(w)})}function Qs(e){ee===null&&Nr(),as&&ee.l!==null?rl(ee).m.push(e):ms(()=>{const t=G(e);if(typeof t=="function")return t})}function Ta(e){ee===null&&Nr(),Qs(()=>()=>G(e))}function rl(e){var t=e.l;return t.u??={a:[],b:[],m:[]}}const al="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(al);ao();class il{propagator=null;config;currentSeed;isInitialized=!1;wasmModule=null;currentBackend="cpu";gpuAvailable=!1;constructor(t,s){this.config=t,this.currentSeed=s}async initialize(t="cpu"){try{const n="/autoverse/preview/pr-60/pkg/flow_lenia.js";this.wasmModule=await import(n),await this.wasmModule.default(),this.gpuAvailable=await this.checkWebGPU();const r=t==="gpu"&&this.gpuAvailable?"gpu":"cpu";await this.createPropagator(r),this.isInitialized=!0}catch(s){throw new Error(`Failed to initialize WASM: ${s}`)}}async checkWebGPU(){if(typeof navigator>"u"||!("gpu"in navigator))return!1;try{return await navigator.gpu.requestAdapter()!==null}catch{return!1}}async createPropagator(t){if(!this.wasmModule)throw new Error("WASM module not loaded");const s=JSON.stringify(this.config),n=JSON.stringify(this.currentSeed);t==="gpu"&&this.gpuAvailable?(this.propagator=await new this.wasmModule.WasmGpuPropagator(s,n),this.currentBackend="gpu"):(this.propagator=new this.wasmModule.WasmPropagator(s,n),this.currentBackend="cpu")}async switchBackend(t){if(!this.isInitialized)throw new Error("Simulation not initialized");return t==="gpu"&&!this.gpuAvailable?!1:(t===this.currentBackend||await this.createPropagator(t),!0)}isGpuAvailable(){return this.gpuAvailable}getBackend(){return this.currentBackend}async step(){this.ensureInitialized(),this.currentBackend==="gpu"?await this.propagator.step():this.propagator.step()}async run(t){this.ensureInitialized(),this.currentBackend==="gpu"?await this.propagator.run(BigInt(t)):this.propagator.run(BigInt(t))}getState(){return this.ensureInitialized(),this.propagator.getState()}reset(t){this.ensureInitialized(),t&&(this.currentSeed=t),this.propagator.reset(JSON.stringify(this.currentSeed))}totalMass(){return this.ensureInitialized(),this.propagator.totalMass()}getTime(){return this.ensureInitialized(),this.propagator.getTime()}getStep(){return this.ensureInitialized(),this.propagator.getStep()}getWidth(){return this.config.width}getHeight(){return this.config.height}getConfig(){return{...this.config}}extractRegion(t,s,n,r){this.ensureInitialized();const a=this.getState(),i=[];for(let o=0;o<a.channels.length;o++){const l=[];for(let c=0;c<r;c++)for(let u=0;u<n;u++){const g=(t+u)%a.width,p=(s+c)%a.height*a.width+g;l.push(a.channels[o][p])}i.push(l)}return{width:n,height:r,channels:i,sourceX:t,sourceY:s}}placeRegion(t,s,n){this.ensureInitialized();const r=this.getState(),a=new Map;for(let l=0;l<r.channels.length;l++)for(let c=0;c<r.height;c++)for(let u=0;u<r.width;u++){const g=c*r.width+u,d=r.channels[l][g];d>.001&&a.set(`${u},${c},${l}`,d)}for(let l=0;l<t.channels.length;l++)for(let c=0;c<t.height;c++)for(let u=0;u<t.width;u++){const g=(s+u)%this.config.width,d=(n+c)%this.config.height,p=c*t.width+u,b=t.channels[l][p];b>.001&&a.set(`${g},${d},${l}`,b)}const i=[];for(const[l,c]of a){const[u,g,d]=l.split(",").map(Number);i.push([u,g,d,c])}const o={pattern:{type:"Custom",values:i}};this.reset(o)}drawAt(t,s,n,r,a=0){this.ensureInitialized();const i=this.getState(),o=[];for(let c=0;c<i.channels.length;c++)for(let u=0;u<i.height;u++)for(let g=0;g<i.width;g++){const d=u*i.width+g;let p=i.channels[c][d];if(c===a){const b=g-t,E=u-s,_=Math.sqrt(b*b+E*E);if(_<=n){const w=1-_/n;p=Math.min(1,p+r*w*w)}}p>.001&&o.push([g,u,c,p])}const l={pattern:{type:"Custom",values:o}};this.reset(l)}eraseAt(t,s,n,r=0){this.ensureInitialized();const a=this.getState(),i=[];for(let l=0;l<a.channels.length;l++)for(let c=0;c<a.height;c++)for(let u=0;u<a.width;u++){const g=c*a.width+u;let d=a.channels[l][g];if(l===r){const p=u-t,b=c-s,E=Math.sqrt(p*p+b*b);if(E<=n){const _=1-E/n;d=Math.max(0,d*(1-_*_))}}d>.001&&i.push([u,c,l,d])}const o={pattern:{type:"Custom",values:i}};this.reset(o)}ensureInitialized(){if(!this.isInitialized||!this.propagator)throw new Error("Simulation not initialized. Call initialize() first.")}}const xn={width:128,height:128,channels:1,dt:.1,kernel_radius:13,kernels:[{radius:1,rings:[{amplitude:1,distance:.5,width:.15}],weight:1,mu:.15,sigma:.015,source_channel:0,target_channel:0}],flow:{beta_a:1,n:2,distribution_size:1}},ol={pattern:{type:"GaussianBlob",center:[.5,.5],radius:.1,amplitude:1,channel:0}},ll={initialized:!1,playing:!1,step:0,time:0,totalMass:0,fps:0,frameTime:0,backend:"cpu",gpuAvailable:!1,config:xn,state:null},le=je(ll),Ca=je([]);function X(e,t="info"){Ca.update(s=>[...s.slice(-100),{message:e,level:t,timestamp:Date.now()}])}let te=null,Os=null,gs=0,Rs=0,Sn=0,$a=60,Ns=0;function Xs(){return te}function Ia(e){$a=Math.max(1,Math.min(480,e)),Ns=0}function cl(e){Ia(60*Math.max(1,Math.min(10,e)))}async function ul(){te=new il(xn,ol),await te.initialize();const e=te.getState();le.update(t=>({...t,initialized:!0,step:te.getStep(),time:te.getTime(),totalMass:te.totalMass(),backend:te.getBackend(),gpuAvailable:te.isGpuAvailable(),config:xn,state:e}))}function Aa(){!te||et(le).playing||(le.update(t=>({...t,playing:!0})),gs=performance.now(),Sn=gs,Rs=0,La(gs),X("Simulation started","info"))}function On(){le.update(e=>({...e,playing:!1})),Os!==null&&(cancelAnimationFrame(Os),Os=null),X("Simulation paused","info")}async function Pa(){te&&(await te.step(),Rn())}function ys(e){te&&(te.reset(e),Rn(),X("Simulation reset","info"))}async function Da(e){if(!te)return!1;const t=await te.switchBackend(e);return t?(le.update(s=>({...s,backend:e})),X(`Switched to ${e.toUpperCase()} backend`,"success")):X(`Failed to switch to ${e} backend`,"error"),t}async function La(e){if(!et(le).playing||!te)return;let s=e-gs;gs=e;const n=250;s>n&&(s=n,Ns=0);const r=$a*s/1e3+Ns,a=Math.floor(r);Ns=r-a,a>0&&await te.run(a),Rn(),Rs++,e-Sn>=1e3&&(le.update(i=>({...i,fps:Rs,frameTime:s})),Rs=0,Sn=e),Os=requestAnimationFrame(i=>La(i))}function Rn(){if(!te)return;const e=te.getState();le.update(t=>({...t,step:te.getStep(),time:te.getTime(),totalMass:te.totalMass(),state:e}))}const fl=Ft(le,e=>e.time.toFixed(2)),Oa=Ft(le,e=>e.totalMass.toLocaleString(void 0,{maximumFractionDigits:0})),Ra=Ft(le,e=>e.step.toString().padStart(8,"0")),vl={mode:"view",brushSize:5,brushIntensity:.8,colorScheme:"theme",visualizationMode:"mass",showGrid:!1,showScanlines:!0,showSelection:!0,zoom:1,panX:0,panY:0},dt=je(vl);function Na(e){dt.update(t=>({...t,mode:e}))}function Ga(e){dt.update(t=>({...t,brushSize:Math.max(1,Math.min(50,e))}))}function za(e){dt.update(t=>({...t,brushIntensity:Math.max(0,Math.min(1,e))}))}function dl(e){dt.update(t=>({...t,colorScheme:e}))}function hl(){dt.update(e=>({...e,showScanlines:!e.showScanlines}))}const xs=[{id:"void",name:"VOID",colors:{primary:"#a855f7",primaryDim:"#6b21a8",primaryGlow:"rgba(168, 85, 247, 0.4)",secondary:"#3b82f6",secondaryDim:"#1e40af",secondaryGlow:"rgba(59, 130, 246, 0.4)",tertiary:"#ec4899",tertiaryDim:"#9d174d",tertiaryGlow:"rgba(236, 72, 153, 0.4)",success:"#a855f7",warning:"#f59e0b",danger:"#ef4444"}},{id:"neon-tokyo",name:"NEON TOKYO",colors:{primary:"#ff2d95",primaryDim:"#9d1a5a",primaryGlow:"rgba(255, 45, 149, 0.4)",secondary:"#00f0ff",secondaryDim:"#0891b2",secondaryGlow:"rgba(0, 240, 255, 0.4)",tertiary:"#ffee00",tertiaryDim:"#a38a00",tertiaryGlow:"rgba(255, 238, 0, 0.4)",success:"#00f0ff",warning:"#ffee00",danger:"#ff2d95"}},{id:"synthwave",name:"SYNTHWAVE",colors:{primary:"#f472b6",primaryDim:"#a21caf",primaryGlow:"rgba(244, 114, 182, 0.4)",secondary:"#818cf8",secondaryDim:"#4338ca",secondaryGlow:"rgba(129, 140, 248, 0.4)",tertiary:"#22d3ee",tertiaryDim:"#0e7490",tertiaryGlow:"rgba(34, 211, 238, 0.4)",success:"#22d3ee",warning:"#fbbf24",danger:"#f43f5e"}},{id:"bloodmoon",name:"BLOODMOON",colors:{primary:"#dc2626",primaryDim:"#7f1d1d",primaryGlow:"rgba(220, 38, 38, 0.4)",secondary:"#f97316",secondaryDim:"#9a3412",secondaryGlow:"rgba(249, 115, 22, 0.4)",tertiary:"#fbbf24",tertiaryDim:"#92400e",tertiaryGlow:"rgba(251, 191, 36, 0.4)",success:"#f97316",warning:"#fbbf24",danger:"#dc2626"}},{id:"toxic",name:"TOXIC",colors:{primary:"#84cc16",primaryDim:"#3f6212",primaryGlow:"rgba(132, 204, 22, 0.5)",secondary:"#facc15",secondaryDim:"#854d0e",secondaryGlow:"rgba(250, 204, 21, 0.4)",tertiary:"#22c55e",tertiaryDim:"#166534",tertiaryGlow:"rgba(34, 197, 94, 0.4)",success:"#22c55e",warning:"#facc15",danger:"#ef4444"}},{id:"ice",name:"ICE",colors:{primary:"#38bdf8",primaryDim:"#0369a1",primaryGlow:"rgba(56, 189, 248, 0.4)",secondary:"#e0f2fe",secondaryDim:"#7dd3fc",secondaryGlow:"rgba(224, 242, 254, 0.3)",tertiary:"#a5b4fc",tertiaryDim:"#4f46e5",tertiaryGlow:"rgba(165, 180, 252, 0.4)",success:"#38bdf8",warning:"#fcd34d",danger:"#f87171"}},{id:"hacker",name:"HACKER",colors:{primary:"#22c55e",primaryDim:"#166534",primaryGlow:"rgba(34, 197, 94, 0.5)",secondary:"#4ade80",secondaryDim:"#15803d",secondaryGlow:"rgba(74, 222, 128, 0.4)",tertiary:"#86efac",tertiaryDim:"#22c55e",tertiaryGlow:"rgba(134, 239, 172, 0.3)",success:"#22c55e",warning:"#fbbf24",danger:"#ef4444"}},{id:"phosphor",name:"PHOSPHOR",colors:{primary:"#fef08a",primaryDim:"#a16207",primaryGlow:"rgba(254, 240, 138, 0.5)",secondary:"#fde047",secondaryDim:"#854d0e",secondaryGlow:"rgba(253, 224, 71, 0.4)",tertiary:"#fbbf24",tertiaryDim:"#92400e",tertiaryGlow:"rgba(251, 191, 36, 0.4)",success:"#a3e635",warning:"#fbbf24",danger:"#f87171"}}],en=je(xs[0]);function En(e){const t=document.documentElement,{colors:s}=e;t.style.setProperty("--color-primary",s.primary),t.style.setProperty("--color-primary-dim",s.primaryDim),t.style.setProperty("--color-primary-glow",s.primaryGlow),t.style.setProperty("--color-secondary",s.secondary),t.style.setProperty("--color-secondary-dim",s.secondaryDim),t.style.setProperty("--color-secondary-glow",s.secondaryGlow),t.style.setProperty("--color-tertiary",s.tertiary),t.style.setProperty("--color-tertiary-dim",s.tertiaryDim),t.style.setProperty("--color-tertiary-glow",s.tertiaryGlow),t.style.setProperty("--color-success",s.success),t.style.setProperty("--color-warning",s.warning),t.style.setProperty("--color-danger",s.danger),en.set(e),localStorage.setItem("autoverse-theme",e.id)}function pl(e){const t=xs.find(s=>s.id===e);t&&En(t)}function gl(){const e=localStorage.getItem("autoverse-theme");if(e){const t=xs.find(s=>s.id===e);if(t){En(t);return}}En(xs[0])}const Cr=900,De=["controls","display","presets","patterns","evolve"];function _l(){const{subscribe:e,set:t,update:s}=je({isMobile:typeof window<"u"&&window.innerWidth<=Cr,activeTab:"controls",swipeOffset:0,isSwiping:!1});return{subscribe:e,set:t,update:s,checkViewport:()=>{if(typeof window>"u")return;const n=window.innerWidth<=Cr;s(r=>({...r,isMobile:n}))},setTab:n=>{s(r=>({...r,activeTab:n,swipeOffset:0}))},nextTab:()=>{s(n=>{const r=De.indexOf(n.activeTab),a=Math.min(r+1,De.length-1);return{...n,activeTab:De[a],swipeOffset:0}})},prevTab:()=>{s(n=>{const r=De.indexOf(n.activeTab),a=Math.max(r-1,0);return{...n,activeTab:De[a],swipeOffset:0}})},startSwipe:()=>{s(n=>({...n,isSwiping:!0}))},updateSwipe:n=>{s(r=>({...r,swipeOffset:n}))},endSwipe:n=>{const r=et({subscribe:e}),a=n*.2,i=r.swipeOffset;if(Math.abs(i)>a)if(i>0){const o=De.indexOf(r.activeTab);if(o>0){t({...r,activeTab:De[o-1],swipeOffset:0,isSwiping:!1});return}}else{const o=De.indexOf(r.activeTab);if(o<De.length-1){t({...r,activeTab:De[o+1],swipeOffset:0,isSwiping:!1});return}}s(o=>({...o,swipeOffset:0,isSwiping:!1}))}}}const Ne=_l(),ml=Ft(Ne,e=>De.indexOf(e.activeTab)),fn=De;var bl=T("<button></button>"),wl=T('<header class="header svelte-4b3o1e"><div class="header-left svelte-4b3o1e"><pre class="ascii-logo svelte-4b3o1e"></pre></div> <div class="header-right svelte-4b3o1e"><div class="theme-picker svelte-4b3o1e"><span class="picker-label svelte-4b3o1e">THEME</span> <div class="theme-swatches svelte-4b3o1e"></div></div> <div><span class="backend-label svelte-4b3o1e">COMPUTE</span> <span class="backend-value svelte-4b3o1e"> </span></div></div></header>');function yl(e,t){ft(t,!1);const s=()=>H(en,"$currentScheme",r),n=()=>H(le,"$simulationStore",r),[r,a]=Bt();Ts();var i=wl(),o=v(i),l=v(o);l.textContent=`
 ▄▀▄ █ █ ▀█▀ ▄▀▄ █ █ █▀▀ █▀▄ ▄▀▀ █▀▀
 █▀█ █▄█  █  █ █ ▀▄▀ ██▄ █▀▄ ▄██ ██▄`;var c=h(o,2),u=v(c),g=h(v(u),2);Ue(g,5,()=>xs,nt,(_,w)=>{var P=bl();let C;P.__click=()=>pl(f(w).id),z(()=>{C=re(P,1,"swatch svelte-4b3o1e",null,C,{active:s().id===f(w).id}),ws(P,`--swatch-color: ${f(w).colors.primary??""}`),ze(P,"title",f(w).name)}),k(_,P)});var d=h(u,2);let p;var b=h(v(d),2),E=v(b);z(_=>{p=re(d,1,"backend-indicator svelte-4b3o1e",null,p,{gpu:n().backend==="gpu"}),D(E,_)},[()=>n().backend.toUpperCase()]),k(e,i),vt(),a()}ls(["click"]);var xl=T('<footer class="footer svelte-ww03jg"></footer>');function Sl(e){var t=xl();k(e,t)}var El=T("<div> </div>"),Ml=T('<div><div class="corner top-left svelte-1gtc57s"></div> <div class="corner top-right svelte-1gtc57s"></div> <div class="corner bottom-left svelte-1gtc57s"></div> <div class="corner bottom-right svelte-1gtc57s"></div> <!> <div><!></div></div>');function bt(e,t){let s=Ve(t,"borderColor",3,"primary"),n=Ve(t,"noPadding",3,!1),r=Ve(t,"class",3,"");const a={primary:"border-primary",secondary:"border-secondary",tertiary:"border-tertiary"};var i=Ml(),o=h(v(i),8);{var l=d=>{var p=El(),b=v(p);z(()=>{re(p,1,`title ${a[s()]??""}`,"svelte-1gtc57s"),D(b,t.title)}),k(d,p)};Q(o,d=>{t.title&&d(l)})}var c=h(o,2);let u;var g=v(c);Wo(g,()=>t.children??at),z(()=>{re(i,1,`tui-box ${a[s()]??""} ${r()??""}`,"svelte-1gtc57s"),u=re(c,1,"content svelte-1gtc57s",null,u,{"no-padding":n()})}),k(e,i)}var kl=T('<span class="label svelte-1l5vt72"> </span>'),Tl=T("<span> </span>"),Cl=T('<div class="slider-header svelte-1l5vt72"><!> <!></div>'),$l=T('<div class="slider-container svelte-1l5vt72"><!> <input type="range"/></div>');function vn(e,t){ft(t,!0);let s=Ve(t,"value",15),n=Ve(t,"min",3,0),r=Ve(t,"max",3,100),a=Ve(t,"step",3,1),i=Ve(t,"showValue",3,!0),o=Ve(t,"valueFormat",3,b=>String(b)),l=Ve(t,"color",3,"tertiary");function c(b){const E=b.target;s(parseFloat(E.value)),t.onchange?.(s())}var u=$l(),g=v(u);{var d=b=>{var E=Cl(),_=v(E);{var w=S=>{var M=kl(),I=v(M);z(()=>D(I,t.label)),k(S,M)};Q(_,S=>{t.label&&S(w)})}var P=h(_,2);{var C=S=>{var M=Tl(),I=v(M);z(y=>{re(M,1,`value ${l()??""}`,"svelte-1l5vt72"),D(I,y)},[()=>o()(s())]),k(S,M)};Q(P,S=>{i()&&S(C)})}k(b,E)};Q(g,b=>{(t.label||i())&&b(d)})}var p=h(g,2);p.__input=c,z(()=>{re(p,1,Vo(l()),"svelte-1l5vt72"),ze(p,"min",n()),ze(p,"max",r()),ze(p,"step",a()),wn(p,s())}),k(e,u),vt()}ls(["input"]);var Il=T('<span class="icon svelte-oaxjxu">&#9724;</span> <span class="label svelte-oaxjxu">PAUSE</span>',1),Al=T('<span class="icon svelte-oaxjxu">&#9654;</span> <span class="label svelte-oaxjxu">PLAY</span>',1),Pl=T('<div class="control-grid svelte-oaxjxu"><button><!></button> <button class="control-btn svelte-oaxjxu"><span class="icon svelte-oaxjxu">&#9655;</span> <span class="label svelte-oaxjxu">STEP</span></button> <button class="control-btn svelte-oaxjxu"><span class="icon svelte-oaxjxu">&#8634;</span> <span class="label svelte-oaxjxu">RESET</span></button></div> <div class="speed-control svelte-oaxjxu"><!></div>',1),Dl=T('<button><span class="icon svelte-oaxjxu"><!></span> <span class="label svelte-oaxjxu"> </span></button>'),Ll=T('<div class="brush-settings svelte-oaxjxu"><!> <!></div>'),Ol=T('<div class="tool-grid svelte-oaxjxu"></div> <!>',1),Rl=T('<div><span class="log-prefix svelte-oaxjxu">&gt;</span> <span class="log-message svelte-oaxjxu"> </span></div>'),Nl=T('<div class="log-container svelte-oaxjxu"></div>'),Gl=T('<aside class="left-sidebar svelte-oaxjxu"><!> <!> <!></aside>');function zl(e,t){ft(t,!0);const s=()=>H(le,"$simulationStore",a),n=()=>H(dt,"$settings",a),r=()=>H(Ca,"$systemLog",a),[a,i]=Bt();let o=Se(60);function l(E){F(o,E,!0),Ia(E)}function c(E){Na(E)}const u=[{id:"view",label:"VIEW",icon:"&#9673;"},{id:"select",label:"SEL",icon:"&#9633;"},{id:"draw",label:"DRAW",icon:"&#9998;"},{id:"erase",label:"ERASE",icon:"&#9747;"}];var g=Gl(),d=v(g);bt(d,{title:"SYS.CONTROL",borderColor:"primary",children:(E,_)=>{var w=Pl(),P=Ee(w),C=v(P);let S;C.__click=()=>s().playing?On():Aa();var M=v(C);{var I=B=>{var se=Il();k(B,se)},y=B=>{var se=Al();k(B,se)};Q(M,B=>{s().playing?B(I):B(y,!1)})}var $=h(C,2);$.__click=()=>Pa();var R=h($,2);R.__click=()=>ys();var L=h(P,2),j=v(L);vn(j,{label:"SIM SPEED",min:15,max:480,step:15,color:"primary",valueFormat:B=>`${B} steps/s`,onchange:l,get value(){return f(o)},set value(B){F(o,B,!0)}}),z(()=>S=re(C,1,"control-btn svelte-oaxjxu",null,S,{active:!s().playing})),k(E,w)},$$slots:{default:!0}});var p=h(d,2);bt(p,{title:"TOOL.KIT",borderColor:"tertiary",children:(E,_)=>{var w=Ol(),P=Ee(w);Ue(P,21,()=>u,nt,(M,I)=>{var y=Dl();let $;y.__click=()=>c(f(I).id);var R=v(y),L=v(R);jo(L,()=>f(I).icon);var j=h(R,2),B=v(j);z(()=>{$=re(y,1,"tool-btn svelte-oaxjxu",null,$,{active:n().mode===f(I).id}),D(B,f(I).label)}),k(M,y)});var C=h(P,2);{var S=M=>{var I=Ll(),y=v(I);vn(y,{label:"BRUSH SIZE",get value(){return n().brushSize},min:1,max:30,step:1,color:"tertiary",valueFormat:L=>`${L}PX`,get onchange(){return Ga}});var $=h(y,2);{var R=L=>{vn(L,{label:"INTENSITY",get value(){return n().brushIntensity},min:0,max:1,step:.05,color:"tertiary",valueFormat:j=>`${Math.round(j*100)}%`,get onchange(){return za}})};Q($,L=>{n().mode==="draw"&&L(R)})}k(M,I)};Q(C,M=>{(n().mode==="draw"||n().mode==="erase")&&M(S)})}k(E,w)},$$slots:{default:!0}});var b=h(p,2);bt(b,{title:"DEBUG.LOG",borderColor:"secondary",class:"debug-log-box",children:(E,_)=>{var w=Nl();Ue(w,5,r,nt,(P,C)=>{var S=Rl(),M=h(v(S),2),I=v(M);z(()=>{re(S,1,`log-entry ${f(C).level??""}`,"svelte-oaxjxu"),D(I,f(C).message)}),k(P,S)}),k(E,w)},$$slots:{default:!0}}),k(e,g),vt(),i()}ls(["click"]);const Fl={initialized:!1,running:!1,progress:null,result:null,bestState:null,error:null},pe=je(Fl);Ft(pe,e=>e.running);Ft(pe,e=>e.progress);Ft(pe,e=>e.bestState);let wt=null,Ls=null;function Nn(e){wt&&wt.postMessage(e)}function Bl(e){const t=e.data;switch(t.type){case"ready":pe.update(s=>({...s,initialized:!0})),X("Evolution engine initialized (worker)","success");break;case"progress":pe.update(s=>({...s,progress:t.data,bestState:t.bestState??s.bestState}));break;case"complete":pe.update(s=>({...s,running:!1,result:t.result,bestState:t.bestState??s.bestState})),t.result&&X(`Evolution complete: fitness=${t.result.stats.best_fitness.toFixed(3)}, reason=${t.result.stats.stop_reason}`,"success");break;case"preview":pe.update(s=>({...s,bestState:t.state}));break;case"error":pe.update(s=>({...s,running:!1,error:t.message})),X(`Evolution error: ${t.message}`,"error");break}}async function Fa(){if(wt){pe.update(e=>({...e,initialized:!0}));return}return Ls||(Ls=new Promise((e,t)=>{try{wt=new Worker(new URL("/autoverse/preview/pr-60/assets/evolution.worker-ZbCPpdzL.js",import.meta.url),{type:"module"}),wt.onmessage=r=>{Bl(r),r.data.type==="ready"?e():r.data.type==="error"&&!et(pe).initialized&&t(new Error(r.data.message))},wt.onerror=r=>{X(`Worker error: ${r.message}`,"error"),t(r)},Nn({type:"init",wasmUrl:"/autoverse/preview/pr-60/pkg/flow_lenia.js"})}catch(s){X(`Failed to create evolution worker: ${s}`,"error"),t(s)}}),Ls)}function Ba(){return{base_config:et(le).config,algorithm:{type:"GeneticAlgorithm",config:{mutation_rate:.15,crossover_rate:.7,mutation_strength:.1,elitism:2,selection:{method:"Tournament",size:3}}},fitness:{metrics:[{metric:"Persistence",weight:1},{metric:"Compactness",weight:.5},{metric:"Locomotion",weight:.3}],aggregation:"WeightedSum"},population:{size:20,max_generations:50,target_fitness:.95,stagnation_limit:15},evaluation:{steps:200,sample_interval:10,warmup_steps:20},constraints:{radius:{min:.05,max:.25},amplitude:{min:.5,max:2},x:{min:.3,max:.7},y:{min:.3,max:.7}},archive:{enabled:!0,max_size:50,diversity_threshold:.1}}}async function Ya(e){if(!wt)throw new Error("Evolution worker not initialized");On(),Gn(),pe.update(t=>({...t,running:!0,progress:null,result:null,error:null})),X(`Evolution started: pop=${e.population.size}, gens=${e.population.max_generations}`,"info"),Nn({type:"start",configJson:JSON.stringify(e)})}function Gn(){const e=et(pe);wt&&e.running&&(Nn({type:"cancel"}),X("Evolution cancelled","warn")),pe.update(t=>({...t,running:!1}))}function Ua(){const e=et(pe);if(!e.bestState){X("No evolved pattern to load","warn");return}const{width:t,height:s,channels:n}=e.bestState;if(!n||n.length===0){X("No channel data in evolved pattern","warn");return}const r=n[0],a=[];for(let i=0;i<s;i++)for(let o=0;o<t;o++){const l=i*t+o,c=r[l];c>.001&&a.push([o,i,0,c])}ys({pattern:{type:"Custom",values:a}}),X("Loaded evolved pattern into simulation","success")}var Yl=T('<div class="progress-display svelte-auxm5"><div class="progress-row svelte-auxm5"><span class="label svelte-auxm5">GEN</span> <span class="value svelte-auxm5"> </span></div> <div class="progress-row svelte-auxm5"><span class="label svelte-auxm5">FIT</span> <span class="value highlight svelte-auxm5"> </span></div> <div class="progress-bar svelte-auxm5"><div class="progress-fill svelte-auxm5"></div></div></div>'),Ul=T('<div class="result-display svelte-auxm5"><div class="result-row svelte-auxm5"><span class="label svelte-auxm5">RESULT</span> <span class="value success svelte-auxm5"> </span></div> <div class="result-reason svelte-auxm5"> </div></div>'),Xl=T('<div class="idle-status svelte-auxm5">READY</div>'),ql=T('<button class="evo-btn danger svelte-auxm5">STOP</button>'),jl=T('<button class="evo-btn secondary svelte-auxm5">LOAD</button>'),Wl=T('<button class="evo-btn primary svelte-auxm5">EVOLVE</button> <!>',1),Hl=T('<div class="evolution-panel svelte-auxm5"><div class="preview-container svelte-auxm5"><canvas width="64" height="64" class="preview-canvas svelte-auxm5"></canvas> <span class="preview-label svelte-auxm5">BEST</span></div> <!> <div class="controls svelte-auxm5"><!></div> <details class="settings svelte-auxm5"><summary class="svelte-auxm5">SETTINGS</summary> <div class="settings-grid svelte-auxm5"><label class="svelte-auxm5"><span class="svelte-auxm5">POP</span> <input type="number" min="4" max="50" step="2" class="svelte-auxm5"/></label> <label class="svelte-auxm5"><span class="svelte-auxm5">GENS</span> <input type="number" min="10" max="200" step="10" class="svelte-auxm5"/></label> <label class="svelte-auxm5"><span class="svelte-auxm5">MUT%</span> <input type="number" min="1" max="50" step="1" class="svelte-auxm5"/></label> <label class="svelte-auxm5"><span class="svelte-auxm5">STEPS</span> <input type="number" min="50" max="500" step="50" class="svelte-auxm5"/></label></div> <label class="goal-select svelte-auxm5"><span class="svelte-auxm5">GOAL</span> <select class="svelte-auxm5"><option>Survival</option><option>Glider</option><option>Oscillator</option><option>Complex</option></select></label></details></div>');function Vl(e,t){ft(t,!1);const s=()=>H(pe,"$evolutionStore",n),[n,r]=Bt();let a=oe(),i=oe(null),o=oe(20),l=oe(50),c=.95,u=oe(15),g=oe(200),d=oe("survival");function p(S){if(!f(i)||!f(a))return;const{width:M,height:I,channels:y}=S;if(!y||y.length===0)return;const $=y[0];if(!$||$.length===0)return;const R=f(a).width,L=f(a).height,j=f(i).createImageData(M,I);for(let J=0;J<$.length;J++){const O=Math.floor(Math.min(1,Math.max(0,$[J]))*255);j.data[J*4]=O,j.data[J*4+1]=O,j.data[J*4+2]=O,j.data[J*4+3]=255}const B=new OffscreenCanvas(M,I),se=B.getContext("2d");se&&(se.putImageData(j,0,0),bo(i,f(i).imageSmoothingEnabled=!1),f(i).clearRect(0,0,R,L),f(i).drawImage(B,0,0,R,L))}function b(S){switch(S){case"glider":return[{metric:"Persistence",weight:1},{metric:"Locomotion",weight:1.5},{metric:"Compactness",weight:.5}];case"oscillator":return[{metric:"Persistence",weight:1},{metric:"Stability",weight:.8},{metric:"Compactness",weight:.5}];case"complex":return[{metric:"Persistence",weight:1},{metric:"Complexity",weight:1.2},{metric:"MassConcentration",weight:.3}];default:return[{metric:"Persistence",weight:1},{metric:"Compactness",weight:.5},{metric:"Stability",weight:.3}]}}function E(){return{...Ba(),population:{size:f(o),max_generations:f(l),target_fitness:c,stagnation_limit:Math.max(5,Math.floor(f(l)/3))},algorithm:{type:"GeneticAlgorithm",config:{mutation_rate:f(u)/100,crossover_rate:.7,mutation_strength:.1,elitism:Math.max(1,Math.floor(f(o)/10)),selection:{method:"Tournament",size:3}}},evaluation:{steps:f(g),sample_interval:Math.max(1,Math.floor(f(g)/20)),warmup_steps:Math.floor(f(g)/10)},fitness:{metrics:b(f(d)),aggregation:"WeightedSum"}}}async function _(){const S=E();try{await Ya(S)}catch(M){X(`Failed to start evolution: ${M}`,"error")}}function w(){Gn()}function P(){Ua()}function C(S){switch(S){case"TargetReached":return"TARGET HIT";case"MaxGenerations":return"MAX GENS";case"Stagnation":return"STAGNANT";case"Cancelled":return"CANCELLED";default:return S}}Qs(async()=>{if(F(i,f(a)?.getContext("2d")??null),!s().initialized)try{await Fa()}catch{}}),st(()=>(f(i),s()),()=>{f(i)&&s().bestState&&p(s().bestState)}),Js(),Ts(),bt(e,{title:"EVOLVE",borderColor:"tertiary",children:(S,M)=>{var I=Hl(),y=v(I),$=v(y);ss($,W=>F(a,W),()=>f(a));var R=h(y,2);{var L=W=>{var ye=Yl(),He=v(ye),Mt=h(v(He),2),kt=v(Mt),me=h(He,2),Be=h(v(me),2),Xt=v(Be),qt=h(me,2),jt=v(qt);z(gt=>{D(kt,`${s(),G(()=>s().progress.generation)??""}/${f(l)??""}`),D(Xt,gt),ws(jt,`width: ${s(),f(l),G(()=>s().progress.generation/f(l)*100)??""}%`)},[()=>(s(),G(()=>s().progress.best_fitness.toFixed(3)))]),k(W,ye)},j=W=>{var ye=Us(),He=Ee(ye);{var Mt=me=>{var Be=Ul(),Xt=v(Be),qt=h(v(Xt),2),jt=v(qt),gt=h(Xt,2),$s=v(gt);z((sn,Is)=>{D(jt,sn),D($s,Is)},[()=>(s(),G(()=>s().result.stats.best_fitness.toFixed(3))),()=>(s(),G(()=>C(s().result.stats.stop_reason)))]),k(me,Be)},kt=me=>{var Be=Xl();k(me,Be)};Q(He,me=>{s(),G(()=>s().result)?me(Mt):me(kt,!1)},!0)}k(W,ye)};Q(R,W=>{s(),G(()=>s().running&&s().progress)?W(L):W(j,!1)})}var B=h(R,2),se=v(B);{var J=W=>{var ye=ql();ye.__click=w,k(W,ye)},O=W=>{var ye=Wl(),He=Ee(ye);He.__click=_;var Mt=h(He,2);{var kt=me=>{var Be=jl();Be.__click=P,k(me,Be)};Q(Mt,me=>{s(),G(()=>s().bestState)&&me(kt)})}z(()=>He.disabled=(s(),G(()=>!s().initialized))),k(W,ye)};Q(se,W=>{s(),G(()=>s().running)?W(J):W(O,!1)})}var ne=h(B,2),ie=h(v(ne),2),ge=v(ie),we=h(v(ge),2),_e=h(ge,2),Ce=h(v(_e),2),$e=h(_e,2),Et=h(v($e),2),ht=h($e,2),We=h(v(ht),2),ve=h(ie,2),Fe=h(v(ve),2);z(()=>{f(d),Ao(()=>{})});var pt=v(Fe);pt.value=pt.__value="survival";var Yt=h(pt);Yt.value=Yt.__value="glider";var Ut=h(Yt);Ut.value=Ut.__value="oscillator";var Cs=h(Ut);Cs.value=Cs.__value="complex",$t(we,()=>f(o),W=>F(o,W)),$t(Ce,()=>f(l),W=>F(l,W)),$t(Et,()=>f(u),W=>F(u,W)),$t(We,()=>f(g),W=>F(g,W)),Ma(Fe,()=>f(d),W=>F(d,W)),k(S,I)},$$slots:{default:!0}}),vt(),r()}ls(["click"]);const $r="flow-lenia-presets";class Kl{presets=new Map;listeners=new Set;constructor(){this.loadFromStorage()}generateId(){return`preset-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}createThumbnail(t,s=64){const n=document.createElement("canvas");n.width=s,n.height=s;const r=n.getContext("2d"),a=r.createImageData(t.width,t.height),i=t.channels[0];for(let b=0;b<i.length;b++){const E=Math.max(0,Math.min(1,i[b])),_=Math.floor(E*255);a.data[b*4+0]=_,a.data[b*4+1]=_,a.data[b*4+2]=_,a.data[b*4+3]=255}const o=document.createElement("canvas");o.width=t.width,o.height=t.height,o.getContext("2d").putImageData(a,0,0),r.imageSmoothingEnabled=!0,r.fillStyle="#1a1a1a",r.fillRect(0,0,s,s);const c=Math.min(s/t.width,s/t.height),u=t.width*c,g=t.height*c,d=(s-u)/2,p=(s-g)/2;return r.drawImage(o,d,p,u,g),n.toDataURL("image/png")}savePreset(t,s,n){const r={id:this.generateId(),name:t,description:n,thumbnail:this.createThumbnail(s),region:s,createdAt:Date.now()};return this.presets.set(r.id,r),this.persistToStorage(),this.notifyListeners(),r}getPreset(t){return this.presets.get(t)}getAllPresets(){return Array.from(this.presets.values()).sort((t,s)=>s.createdAt-t.createdAt)}deletePreset(t){const s=this.presets.delete(t);return s&&(this.persistToStorage(),this.notifyListeners()),s}renamePreset(t,s){const n=this.presets.get(t);return n?(n.name=s,this.persistToStorage(),this.notifyListeners(),!0):!1}updateDescription(t,s){const n=this.presets.get(t);return n?(n.description=s,this.persistToStorage(),this.notifyListeners(),!0):!1}exportPresets(t){const s=t?t.map(n=>this.presets.get(n)).filter(Boolean):this.getAllPresets();return JSON.stringify(s,null,2)}importPresets(t){try{const s=JSON.parse(t);let n=0;for(const r of s){const a={...r,id:this.generateId(),createdAt:Date.now()};this.presets.set(a.id,a),n++}return this.persistToStorage(),this.notifyListeners(),n}catch{throw new Error("Invalid preset JSON format")}}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(){const t=this.getAllPresets();for(const s of this.listeners)s(t)}persistToStorage(){try{const t=JSON.stringify(Array.from(this.presets.entries()));localStorage.setItem($r,t)}catch(t){console.warn("Failed to persist presets to storage:",t)}}loadFromStorage(){try{const t=localStorage.getItem($r);if(t){const s=JSON.parse(t);this.presets=new Map(s)}}catch(t){console.warn("Failed to load presets from storage:",t),this.presets=new Map}}clearAll(){this.presets.clear(),this.persistToStorage(),this.notifyListeners()}}const Xa=[{name:"Glider",description:"A simple glider that moves across the grid",seed:{pattern:{type:"GaussianBlob",center:[.5,.5],radius:.1,amplitude:1,channel:0}}},{name:"Ring",description:"A ring pattern that expands",seed:{pattern:{type:"Ring",center:[.5,.5],inner_radius:.05,outer_radius:.1,amplitude:1,channel:0}}},{name:"Dual Blobs",description:"Two interacting blobs",seed:{pattern:{type:"MultiBlob",blobs:[{center:[.35,.5],radius:.08,amplitude:1,channel:0},{center:[.65,.5],radius:.08,amplitude:1,channel:0}]}}},{name:"Random Noise",description:"Random initial conditions",seed:{pattern:{type:"Noise",seed:42,amplitude:.5,channel:0}}}],Mn=je(null),qa=je(0);function Jl(){qa.update(e=>e+1)}function Zl(e,t){const s=et(Mn);s&&s.startDragFromLibrary(e,t)}const Ir=je(null),ns=new Kl,tn=je(ns.getAllPresets());ns.subscribe(e=>{tn.set(e)});function ja(e){const t=ns.getAllPresets().find(s=>s.id===e);ns.deletePreset(e),t&&X(`Deleted preset: ${t.name}`,"info")}function Ql(){const e=ns.exportPresets();return X(`Exported ${et(tn).length} presets`,"success"),e}function Wa(e){try{const t=ns.importPresets(e);return X(`Imported ${t} presets`,"success"),Jl(),t}catch(t){throw X(`Import failed: ${t}`,"error"),t}}function Ha(){const e=Ql(),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download="flow-lenia-presets.json",n.click(),URL.revokeObjectURL(s)}var ec=T('<div class="metric-display svelte-1baw31t"><div class="metric-main svelte-1baw31t"><span class="metric-value svelte-1baw31t"> </span> <span class="metric-unit svelte-1baw31t">STEPS</span></div> <div class="metric-row svelte-1baw31t"><div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">TIME</span> <span class="metric-num svelte-1baw31t"> </span></div> <div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">MASS</span> <span class="metric-num highlight svelte-1baw31t"> </span></div></div> <div class="metric-row svelte-1baw31t"><div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">FPS</span> <span class="metric-num accent svelte-1baw31t"> </span></div> <div class="metric-item svelte-1baw31t"><span class="metric-label svelte-1baw31t">BACKEND</span> <button> </button></div></div></div>'),tc=T('<div class="config-grid svelte-1baw31t"><div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">mu</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">sigma</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">R</span> <span class="cfg-value svelte-1baw31t"> </span></div> <div class="config-item svelte-1baw31t"><span class="cfg-label svelte-1baw31t">dt</span> <span class="cfg-value svelte-1baw31t"> </span></div></div>'),sc=T('<button class="builtin-btn svelte-1baw31t"> </button>'),nc=T('<div class="builtin-grid svelte-1baw31t"></div>'),rc=T('<img class="svelte-1baw31t"/>'),ac=T('<div class="preset-item svelte-1baw31t" draggable="true" role="button" tabindex="0"><div class="preset-thumbnail svelte-1baw31t"><!></div> <div class="preset-info svelte-1baw31t"><span class="preset-name svelte-1baw31t"> </span> <span class="preset-size svelte-1baw31t"> </span></div> <button class="delete-btn svelte-1baw31t">&#10005;</button></div>'),ic=T('<div class="empty-state svelte-1baw31t">No saved patterns</div>'),oc=T('<div class="patterns-header svelte-1baw31t"><button class="small-btn svelte-1baw31t">IMPORT</button> <button class="small-btn svelte-1baw31t">EXPORT</button></div> <div class="preset-list svelte-1baw31t"></div>',1),lc=T('<aside class="right-sidebar svelte-1baw31t"><!> <!> <!> <!> <!></aside>');function cc(e,t){ft(t,!1);const s=()=>H(le,"$simulationStore",o),n=()=>H(Ra,"$formattedStep",o),r=()=>H(fl,"$formattedTime",o),a=()=>H(Oa,"$formattedMass",o),i=()=>H(tn,"$presets",o),[o,l]=Bt(),c=oe();function u(){const y=s().backend==="cpu"?"gpu":"cpu";Da(y)}function g(y){const $=Xs();if(!$)return;const R=Math.floor(($.getWidth()-y.region.width)/2),L=Math.floor(($.getHeight()-y.region.height)/2);$.placeRegion(y.region,R,L)}function d(y){ys(y.seed),X(`Loaded pattern: ${y.name}`,"info")}function p(y,$){y.stopPropagation(),ja($)}function b(){Ha()}function E(){const y=document.createElement("input");y.type="file",y.accept=".json",y.onchange=async $=>{const R=$.target.files?.[0];if(!R)return;const L=await R.text();try{Wa(L)}catch{}},y.click()}function _(y,$){y.dataTransfer.effectAllowed="copy",y.dataTransfer.setData("text/plain",$.id),Zl($,y)}st(()=>s(),()=>{F(c,s().config.kernels[0])}),Js(),Ts();var w=lc(),P=v(w);Vl(P,{});var C=h(P,2);bt(C,{title:"METRICS",borderColor:"secondary",children:(y,$)=>{var R=ec(),L=v(R),j=v(L),B=v(j),se=h(L,2),J=v(se),O=h(v(J),2),ne=v(O),ie=h(J,2),ge=h(v(ie),2),we=v(ge),_e=h(se,2),Ce=v(_e),$e=h(v(Ce),2),Et=v($e),ht=h(Ce,2),We=h(v(ht),2);let ve;We.__click=u;var Fe=v(We);z(pt=>{D(B,n()),D(ne,`${r()??""}s`),D(we,a()),D(Et,(s(),G(()=>s().fps))),ve=re(We,1,"backend-btn svelte-1baw31t",null,ve,{gpu:s().backend==="gpu"}),We.disabled=(s(),G(()=>!s().gpuAvailable)),D(Fe,pt)},[()=>(s(),G(()=>s().backend.toUpperCase()))]),k(y,R)},$$slots:{default:!0}});var S=h(C,2);bt(S,{title:"KERNEL",borderColor:"primary",children:(y,$)=>{var R=tc(),L=v(R),j=h(v(L),2),B=v(j),se=h(L,2),J=h(v(se),2),O=v(J),ne=h(se,2),ie=h(v(ne),2),ge=v(ie),we=h(ne,2),_e=h(v(we),2),Ce=v(_e);z(()=>{D(B,(f(c),G(()=>f(c)?.mu??"—"))),D(O,(f(c),G(()=>f(c)?.sigma??"—"))),D(ge,(s(),G(()=>s().config.kernel_radius))),D(Ce,(s(),G(()=>s().config.dt)))}),k(y,R)},$$slots:{default:!0}});var M=h(S,2);bt(M,{title:"SEEDS",borderColor:"tertiary",children:(y,$)=>{var R=nc();Ue(R,5,()=>Xa,nt,(L,j)=>{var B=sc();B.__click=()=>d(f(j));var se=v(B);z(()=>{ze(B,"title",(f(j),G(()=>f(j).description))),D(se,(f(j),G(()=>f(j).name)))}),k(L,B)}),k(y,R)},$$slots:{default:!0}});var I=h(M,2);bt(I,{title:"SAVED",borderColor:"primary",class:"saved-box",children:(y,$)=>{var R=oc(),L=Ee(R),j=v(L);j.__click=E;var B=h(j,2);B.__click=b;var se=h(L,2);Ue(se,5,i,J=>J.id,(J,O)=>{var ne=ac();ne.__click=()=>g(f(O)),ne.__keydown=ve=>ve.key==="Enter"&&g(f(O));var ie=v(ne),ge=v(ie);{var we=ve=>{var Fe=rc();z(()=>{ze(Fe,"src",(f(O),G(()=>f(O).thumbnail))),ze(Fe,"alt",(f(O),G(()=>f(O).name)))}),k(ve,Fe)};Q(ge,ve=>{f(O),G(()=>f(O).thumbnail)&&ve(we)})}var _e=h(ie,2),Ce=v(_e),$e=v(Ce),Et=h(Ce,2),ht=v(Et),We=h(_e,2);We.__click=ve=>p(ve,f(O).id),z(()=>{D($e,(f(O),G(()=>f(O).name))),D(ht,`${f(O),G(()=>f(O).region.width)??""}x${f(O),G(()=>f(O).region.height)??""}`)}),wa("dragstart",ne,ve=>_(ve,f(O))),k(J,ne)},J=>{var O=ic();k(J,O)}),k(y,R)},$$slots:{default:!0}}),k(e,w),vt(),l()}ls(["click","keydown"]);class uc{canvas;ctx;offscreenCanvas;offscreenCtx;settings;grayscaleMap;thermalMap;viridisMap;themeMap;constructor(t,s){this.canvas=t;const n=t.getContext("2d");if(!n)throw new Error("Failed to get 2D context");this.ctx=n,this.offscreenCanvas=document.createElement("canvas");const r=this.offscreenCanvas.getContext("2d");if(!r)throw new Error("Failed to get offscreen 2D context");this.offscreenCtx=r,this.settings=s,this.grayscaleMap=this.buildGrayscaleMap(),this.thermalMap=this.buildThermalMap(),this.viridisMap=this.buildViridisMap(),this.themeMap=this.viridisMap}setThemeColors(t){this.themeMap=this.buildThemeMap(t)}updateSettings(t){this.settings={...this.settings,...t}}render(t,s,n){const{width:r,height:a,channels:i}=t;(this.offscreenCanvas.width!==r||this.offscreenCanvas.height!==a)&&(this.offscreenCanvas.width=r,this.offscreenCanvas.height=a);const o=this.getColorMap(),l=this.offscreenCtx.createImageData(r,a),c=i[0];for(let u=0;u<c.length;u++){const g=Math.max(0,Math.min(1,c[u])),d=Math.floor(g*255)*4;l.data[u*4+0]=o[d+0],l.data[u*4+1]=o[d+1],l.data[u*4+2]=o[d+2],l.data[u*4+3]=255}this.offscreenCtx.putImageData(l,0,0),this.ctx.imageSmoothingEnabled=!1,this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.offscreenCanvas,0,0,r,a,0,0,this.canvas.width,this.canvas.height),this.settings.showGrid&&this.drawGrid(r,a),n&&this.drawGhostPreview(n,r,a),s&&this.settings.showSelection&&this.drawSelection(s,r,a)}drawGrid(t,s){const n=this.canvas.width/t,r=this.canvas.height/s;if(this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1,n>=4&&r>=4){this.ctx.beginPath();for(let a=0;a<=t;a++){const i=a*n;this.ctx.moveTo(i,0),this.ctx.lineTo(i,this.canvas.height)}for(let a=0;a<=s;a++){const i=a*r;this.ctx.moveTo(0,i),this.ctx.lineTo(this.canvas.width,i)}this.ctx.stroke()}}drawSelection(t,s,n){const r=this.canvas.width/s,a=this.canvas.height/n,i=Math.min(t.startX,t.endX)*r,o=Math.min(t.startY,t.endY)*a,l=Math.abs(t.endX-t.startX)*r,c=Math.abs(t.endY-t.startY)*a;this.ctx.fillStyle="rgba(79, 195, 247, 0.2)",this.ctx.fillRect(i,o,l,c),this.ctx.strokeStyle="#4fc3f7",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.strokeRect(i,o,l,c),this.ctx.setLineDash([]);const u=Math.abs(t.endX-t.startX),g=Math.abs(t.endY-t.startY);u>0&&g>0&&(this.ctx.fillStyle="#4fc3f7",this.ctx.font="12px monospace",this.ctx.fillText(`${u} x ${g}`,i+4,o-4))}drawGhostPreview(t,s,n){const r=this.canvas.width/s,a=this.canvas.height/n,{region:i,x:o,y:l}=t,c=document.createElement("canvas");c.width=i.width,c.height=i.height;const u=c.getContext("2d"),g=u.createImageData(i.width,i.height),d=this.getColorMap();for(let p=0;p<i.channels[0].length;p++){const b=Math.max(0,Math.min(1,i.channels[0][p])),E=Math.floor(b*255)*4;g.data[p*4+0]=d[E+0],g.data[p*4+1]=d[E+1],g.data[p*4+2]=d[E+2],g.data[p*4+3]=b>.01?180:0}u.putImageData(g,0,0),this.ctx.globalAlpha=.7,this.ctx.drawImage(c,0,0,i.width,i.height,o*r,l*a,i.width*r,i.height*a),this.ctx.globalAlpha=1,this.ctx.strokeStyle="#4fc3f7",this.ctx.lineWidth=2,this.ctx.setLineDash([3,3]),this.ctx.strokeRect(o*r,l*a,i.width*r,i.height*a),this.ctx.setLineDash([])}canvasToSim(t,s,n,r){const a=this.canvas.getBoundingClientRect(),i=n/this.canvas.width,o=r/this.canvas.height;return{x:Math.floor((t-a.left)*i),y:Math.floor((s-a.top)*o)}}getColorMap(){switch(this.settings.colorScheme){case"thermal":return this.thermalMap;case"viridis":return this.viridisMap;case"theme":return this.themeMap;default:return this.grayscaleMap}}buildGrayscaleMap(){const t=new Uint8ClampedArray(1024);for(let s=0;s<256;s++)t[s*4+0]=s,t[s*4+1]=s,t[s*4+2]=s,t[s*4+3]=255;return t}buildThermalMap(){const t=new Uint8ClampedArray(1024);for(let s=0;s<256;s++){const n=s/255;let r,a,i;if(n<.2){const o=n/.2;r=0,a=0,i=Math.floor(o*128)}else if(n<.4){const o=(n-.2)/.2;r=0,a=Math.floor(o*255),i=128+Math.floor(o*127)}else if(n<.6){const o=(n-.4)/.2;r=Math.floor(o*255),a=255,i=255-Math.floor(o*255)}else if(n<.8){const o=(n-.6)/.2;r=255,a=255-Math.floor(o*255),i=0}else{const o=(n-.8)/.2;r=255,a=Math.floor(o*255),i=Math.floor(o*255)}t[s*4+0]=r,t[s*4+1]=a,t[s*4+2]=i,t[s*4+3]=255}return t}buildViridisMap(){const t=[[68,1,84],[72,35,116],[64,67,135],[52,94,141],[41,120,142],[32,144,140],[34,167,132],[68,190,112],[121,209,81],[189,222,38],[253,231,36]],s=new Uint8ClampedArray(256*4);for(let n=0;n<256;n++){const a=n/255*(t.length-1),i=Math.floor(a),o=Math.min(i+1,t.length-1),l=a-i;s[n*4+0]=Math.floor(t[i][0]+l*(t[o][0]-t[i][0])),s[n*4+1]=Math.floor(t[i][1]+l*(t[o][1]-t[i][1])),s[n*4+2]=Math.floor(t[i][2]+l*(t[o][2]-t[i][2])),s[n*4+3]=255}return s}getCanvas(){return this.canvas}buildThemeMap(t){const s=l=>{const c=l.replace("#","");return[parseInt(c.slice(0,2),16),parseInt(c.slice(2,4),16),parseInt(c.slice(4,6),16)]},n=s(t.primary),r=s(t.secondary),a=s(t.tertiary),i=[{t:0,color:[5,5,5]},{t:.15,color:[n[0]*.3,n[1]*.3,n[2]*.3]},{t:.35,color:n},{t:.6,color:r},{t:.85,color:a},{t:1,color:[255,255,255]}],o=new Uint8ClampedArray(256*4);for(let l=0;l<256;l++){const c=l/255;let u=i[0],g=i[1];for(let p=1;p<i.length;p++)if(c<=i[p].t){u=i[p-1],g=i[p];break}const d=(c-u.t)/(g.t-u.t);o[l*4+0]=Math.floor(u.color[0]+d*(g.color[0]-u.color[0])),o[l*4+1]=Math.floor(u.color[1]+d*(g.color[1]-u.color[1])),o[l*4+2]=Math.floor(u.color[2]+d*(g.color[2]-u.color[2])),o[l*4+3]=255}return o}}class fc{canvas;simulation;callbacks;mode="view";selection=null;isSelecting=!1;isDrawing=!1;isDragging=!1;draggedCreature=null;ghostPreview=null;brushSize=3;brushIntensity=.5;constructor(t,s,n,r={}){this.canvas=t,this.simulation=s,this.callbacks=r,this.setupEventListeners(),this.setupDragDrop()}setMode(t){switch(this.mode=t,this.selection=null,this.isSelecting=!1,this.isDrawing=!1,t){case"select":this.canvas.style.cursor="crosshair";break;case"draw":this.canvas.style.cursor="cell";break;case"erase":this.canvas.style.cursor="not-allowed";break;default:this.canvas.style.cursor="default"}this.callbacks.onModeChange?.(t)}getMode(){return this.mode}getSelection(){return this.selection}clearSelection(){this.selection=null,this.callbacks.onSelectionChange?.(null)}setBrushSize(t){this.brushSize=Math.max(1,Math.min(20,t))}setBrushIntensity(t){this.brushIntensity=Math.max(0,Math.min(1,t))}getGhostPreview(){return this.ghostPreview}startDragFromLibrary(t,s){this.isDragging=!0,this.draggedCreature={preset:t,offsetX:t.region.width/2,offsetY:t.region.height/2};const n=this.getSimCoords(s);this.ghostPreview={region:t.region,x:n.x-this.draggedCreature.offsetX,y:n.y-this.draggedCreature.offsetY}}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.canvas.addEventListener("touchcancel",this.handleTouchEnd.bind(this),{passive:!1}),document.addEventListener("keydown",this.handleKeyDown.bind(this))}setupDragDrop(){this.canvas.addEventListener("dragover",t=>{if(t.preventDefault(),t.dataTransfer.dropEffect="copy",this.draggedCreature){const s=this.getSimCoords(t);this.ghostPreview={region:this.draggedCreature.preset.region,x:s.x-this.draggedCreature.offsetX,y:s.y-this.draggedCreature.offsetY}}}),this.canvas.addEventListener("drop",t=>{if(t.preventDefault(),this.draggedCreature){const s=this.getSimCoords(t),n=Math.floor(s.x-this.draggedCreature.offsetX),r=Math.floor(s.y-this.draggedCreature.offsetY);this.callbacks.onDrop?.(this.draggedCreature.preset,n,r),this.draggedCreature=null,this.ghostPreview=null,this.isDragging=!1}}),this.canvas.addEventListener("dragleave",()=>{this.ghostPreview=null})}handleMouseDown(t){const s=this.getSimCoords(t);switch(this.mode){case"select":this.isSelecting=!0,this.selection={startX:s.x,startY:s.y,endX:s.x,endY:s.y},this.callbacks.onSelectionChange?.(this.selection);break;case"draw":this.isDrawing=!0,this.callbacks.onDraw?.(s.x,s.y);break;case"erase":this.isDrawing=!0,this.callbacks.onErase?.(s.x,s.y);break}}handleMouseMove(t){const s=this.getSimCoords(t);this.isSelecting&&this.selection&&(this.selection.endX=s.x,this.selection.endY=s.y,this.callbacks.onSelectionChange?.(this.selection)),this.isDrawing&&(this.mode==="draw"?this.callbacks.onDraw?.(s.x,s.y):this.mode==="erase"&&this.callbacks.onErase?.(s.x,s.y)),this.isDragging&&this.draggedCreature&&(this.ghostPreview={region:this.draggedCreature.preset.region,x:s.x-this.draggedCreature.offsetX,y:s.y-this.draggedCreature.offsetY})}handleMouseUp(t){if(this.isSelecting&&this.selection){const s={startX:Math.min(this.selection.startX,this.selection.endX),startY:Math.min(this.selection.startY,this.selection.endY),endX:Math.max(this.selection.startX,this.selection.endX),endY:Math.max(this.selection.startY,this.selection.endY)};s.endX>s.startX&&s.endY>s.startY?(this.selection=s,this.callbacks.onSelectionComplete?.(s)):this.selection=null,this.callbacks.onSelectionChange?.(this.selection)}this.isSelecting=!1,this.isDrawing=!1}handleMouseLeave(t){this.isSelecting&&(this.isSelecting=!1,this.selection=null,this.callbacks.onSelectionChange?.(null)),this.isDrawing=!1,this.ghostPreview=null}handleTouchStart(t){if(t.touches.length!==1)return;this.mode!=="view"&&t.preventDefault();const s=t.touches[0],n=this.getTouchSimCoords(s);switch(this.mode){case"select":this.isSelecting=!0,this.selection={startX:n.x,startY:n.y,endX:n.x,endY:n.y},this.callbacks.onSelectionChange?.(this.selection);break;case"draw":this.isDrawing=!0,this.callbacks.onDraw?.(n.x,n.y);break;case"erase":this.isDrawing=!0,this.callbacks.onErase?.(n.x,n.y);break}}handleTouchMove(t){if(t.touches.length!==1)return;this.mode!=="view"&&(this.isDrawing||this.isSelecting)&&t.preventDefault();const s=t.touches[0],n=this.getTouchSimCoords(s);this.isSelecting&&this.selection&&(this.selection.endX=n.x,this.selection.endY=n.y,this.callbacks.onSelectionChange?.(this.selection)),this.isDrawing&&(this.mode==="draw"?this.callbacks.onDraw?.(n.x,n.y):this.mode==="erase"&&this.callbacks.onErase?.(n.x,n.y))}handleTouchEnd(t){if(this.mode!=="view"&&(this.isDrawing||this.isSelecting)&&t.preventDefault(),this.isSelecting&&this.selection){const s={startX:Math.min(this.selection.startX,this.selection.endX),startY:Math.min(this.selection.startY,this.selection.endY),endX:Math.max(this.selection.startX,this.selection.endX),endY:Math.max(this.selection.startY,this.selection.endY)};s.endX>s.startX&&s.endY>s.startY?(this.selection=s,this.callbacks.onSelectionComplete?.(s)):this.selection=null,this.callbacks.onSelectionChange?.(this.selection)}this.isSelecting=!1,this.isDrawing=!1}getTouchSimCoords(t){const s=this.canvas.getBoundingClientRect(),n=t.clientX-s.left,r=t.clientY-s.top,a=this.simulation.getWidth(),i=this.simulation.getHeight();return{x:Math.floor(n/s.width*a),y:Math.floor(r/s.height*i)}}handleKeyDown(t){const s=t.target;s.tagName==="INPUT"||s.tagName==="TEXTAREA"||(t.key==="v"||t.key==="Escape"?this.setMode("view"):t.key==="s"?this.setMode("select"):t.key==="d"?this.setMode("draw"):t.key==="e"&&this.setMode("erase"),t.key==="["?(this.setBrushSize(this.brushSize-1),this.callbacks.onBrushSizeChange?.(this.brushSize)):t.key==="]"&&(this.setBrushSize(this.brushSize+1),this.callbacks.onBrushSizeChange?.(this.brushSize)))}getSimCoords(t){const s=this.canvas.getBoundingClientRect(),n=t.clientX-s.left,r=t.clientY-s.top,a=this.simulation.getWidth(),i=this.simulation.getHeight();return{x:Math.floor(n/s.width*a),y:Math.floor(r/s.height*i)}}getBrushSize(){return this.brushSize}getBrushIntensity(){return this.brushIntensity}}var vc=T('<div class="simulation-view svelte-145nxqv"><div class="canvas-frame svelte-145nxqv"><div class="canvas-header svelte-145nxqv"><span class="dim-label svelte-145nxqv"> </span></div> <div class="canvas-container svelte-145nxqv"><canvas class="svelte-145nxqv"></canvas> <div class="corner-marker top-left svelte-145nxqv"></div> <div class="corner-marker top-right svelte-145nxqv"></div> <div class="corner-marker bottom-left svelte-145nxqv"></div> <div class="corner-marker bottom-right svelte-145nxqv"></div> <div class="canvas-scanlines svelte-145nxqv"></div></div></div></div>');function Ar(e,t){ft(t,!1);const s=()=>H(dt,"$settings",i),n=()=>H(le,"$simulationStore",i),r=()=>H(en,"$currentScheme",i),a=()=>H(qa,"$renderTrigger",i),[i,o]=Bt();let l=oe(),c=oe(),u=oe(null),g=oe(null);const d=512;Qs(()=>{const M=Xs();!M||!f(c)||(Ir.set(f(c)),F(u,new uc(f(c),{colorScheme:s().colorScheme,showGrid:s().showGrid,showSelection:s().showSelection,brushSize:s().brushSize,brushIntensity:s().brushIntensity,backend:n().backend})),F(g,new fc(f(c),M,f(u),{onSelectionChange:()=>p(),onSelectionComplete:()=>{},onDrop:(I,y,$)=>{M.placeRegion(I.region,y,$),p()},onDraw:(I,y)=>{M.drawAt(I,y,s().brushSize,s().brushIntensity),p()},onErase:(I,y)=>{M.eraseAt(I,y,s().brushSize),p()},onModeChange:()=>{},onBrushSizeChange:()=>{}})),Mn.set(f(g)),p())}),Ta(()=>{Mn.set(null),Ir.set(null),F(u,null),F(g,null)});function p(){if(!f(u))return;const M=Xs();if(!M)return;const I=M.getState(),y=f(g)?.getSelection(),$=f(g)?.getGhostPreview();f(u).render(I,y,$)}st(()=>(n(),f(u)),()=>{n().state&&f(u)&&p()}),st(()=>(f(g),s()),()=>{f(g)&&s().mode&&f(g).setMode(s().mode)}),st(()=>(f(g),s()),()=>{f(g)&&(f(g).setBrushSize(s().brushSize),f(g).setBrushIntensity(s().brushIntensity))}),st(()=>(f(u),s()),()=>{f(u)&&s().colorScheme&&(f(u).updateSettings({colorScheme:s().colorScheme}),p())}),st(()=>(f(u),r()),()=>{f(u)&&r()&&(f(u).setThemeColors({primary:r().colors.primary,secondary:r().colors.secondary,tertiary:r().colors.tertiary}),p())}),st(()=>(a(),f(u)),()=>{a()&&f(u)&&p()}),Js(),Ts();var b=vc(),E=v(b),_=v(E),w=v(_),P=v(w),C=h(_,2),S=v(C);ze(S,"width",d),ze(S,"height",d),ss(S,M=>F(c,M),()=>f(c)),ss(C,M=>F(l,M),()=>f(l)),z(()=>D(P,`${n(),G(()=>n().config.width)??""}x${n(),G(()=>n().config.height)??""}`)),k(e,b),vt(),o()}var dc=T("<button> </button>"),hc=T('<span class="icon svelte-xicwp9">⏸</span>'),pc=T('<span class="icon svelte-xicwp9">▶</span>'),gc=T('<button><span class="icon svelte-xicwp9"> </span> <span class="label svelte-xicwp9"> </span></button>'),_c=T('<div class="brush-row svelte-xicwp9"><label class="svelte-xicwp9">INTENSITY</label> <input type="range" min="0" max="100" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div>'),mc=T('<div class="brush-settings svelte-xicwp9"><div class="brush-row svelte-xicwp9"><label class="svelte-xicwp9">SIZE</label> <input type="range" min="1" max="30" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <!></div>'),bc=T("<button> </button>"),wc=T('<img class="svelte-xicwp9"/>'),yc=T('<div class="preset-placeholder svelte-xicwp9"></div>'),xc=T('<div class="preset-item svelte-xicwp9" role="button" tabindex="0"><!> <span class="preset-name svelte-xicwp9"> </span> <span class="preset-size svelte-xicwp9"> </span></div>'),Sc=T('<div class="empty-state svelte-xicwp9">No saved patterns</div>'),Ec=T('<button class="builtin-btn svelte-xicwp9"><span class="builtin-name svelte-xicwp9"> </span> <span class="builtin-desc svelte-xicwp9"> </span></button>'),Mc=T('<div class="evo-progress svelte-xicwp9"><span class="evo-label svelte-xicwp9">GEN</span> <span class="evo-value svelte-xicwp9"> </span></div> <div class="evo-progress svelte-xicwp9"><span class="evo-label svelte-xicwp9">FIT</span> <span class="evo-value highlight svelte-xicwp9"> </span></div> <div class="evo-bar svelte-xicwp9"><div class="evo-bar-fill svelte-xicwp9"></div></div>',1),kc=T('<div class="evo-progress svelte-xicwp9"><span class="evo-label svelte-xicwp9">RESULT</span> <span class="evo-value success svelte-xicwp9"> </span></div> <div class="evo-reason svelte-xicwp9"> </div>',1),Tc=T('<span class="evo-ready svelte-xicwp9">READY</span>'),Cc=T('<button class="evo-btn danger svelte-xicwp9">STOP</button>'),$c=T('<button class="evo-btn secondary svelte-xicwp9">LOAD</button>'),Ic=T('<button class="evo-btn primary svelte-xicwp9">EVOLVE</button> <!>',1),Ac=T("<button></button>"),Pc=T('<div class="bottom-sheet svelte-xicwp9"><div class="mobile-stats svelte-xicwp9"><div class="stats-group svelte-xicwp9"><span>STEP: <strong class="svelte-xicwp9"> </strong></span> <span>MASS: <strong class="svelte-xicwp9"> </strong></span> <span>FPS: <strong class="svelte-xicwp9"> </strong></span></div> <div class="backend-toggle svelte-xicwp9"><span>CPU</span> <button aria-label="Toggle between CPU and GPU backend"><span class="toggle-knob svelte-xicwp9"></span></button> <span>GPU</span></div></div> <div class="tabs svelte-xicwp9"></div> <div class="panels-container svelte-xicwp9"><div><div class="panel svelte-xicwp9"><div class="playback-controls svelte-xicwp9"><button><!></button> <button class="ctrl-btn svelte-xicwp9"><span class="icon svelte-xicwp9">⏭</span></button> <button class="ctrl-btn svelte-xicwp9"><span class="icon svelte-xicwp9">↺</span></button> <div class="speed-control svelte-xicwp9"><button class="speed-btn svelte-xicwp9">−</button> <strong> </strong> <button class="speed-btn svelte-xicwp9">+</button></div></div> <div class="tools-grid svelte-xicwp9"></div> <!></div> <div class="panel svelte-xicwp9"><div class="display-section svelte-xicwp9"><label class="section-label svelte-xicwp9">COLOR SCHEME</label> <div class="scheme-grid svelte-xicwp9"></div></div> <div class="display-section svelte-xicwp9"><label class="section-label svelte-xicwp9">EFFECTS</label> <div class="toggle-row svelte-xicwp9"><span>CRT Scanlines</span> <button aria-label="Toggle CRT scanlines effect"><span class="toggle-knob svelte-xicwp9"></span></button></div></div></div> <div class="panel svelte-xicwp9"><div class="preset-actions svelte-xicwp9"><button class="action-btn svelte-xicwp9">IMPORT</button> <button class="action-btn svelte-xicwp9">EXPORT</button></div> <div class="preset-grid svelte-xicwp9"></div></div> <div class="panel svelte-xicwp9"><div class="builtin-grid svelte-xicwp9"></div></div> <div class="panel evolve-panel svelte-xicwp9"><div class="evo-header svelte-xicwp9"><canvas width="48" height="48" class="evo-preview svelte-xicwp9"></canvas> <div class="evo-status svelte-xicwp9"><!></div></div> <div class="evo-controls svelte-xicwp9"><!></div> <div class="evo-settings svelte-xicwp9"><div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">POP</label> <input type="range" min="10" max="50" step="5" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">GENS</label> <input type="range" min="20" max="100" step="10" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">MUT%</label> <input type="range" min="5" max="30" step="5" class="svelte-xicwp9"/> <span class="svelte-xicwp9"> </span></div> <div class="evo-row svelte-xicwp9"><label class="svelte-xicwp9">GOAL</label> <select class="svelte-xicwp9"><option>Survival</option><option>Glider</option><option>Oscillator</option><option>Complex</option></select></div></div></div></div></div> <div class="swipe-indicator svelte-xicwp9"></div></div>');function Dc(e,t){ft(t,!0);const s=()=>H(pe,"$evolutionStore",u),n=()=>H(Ne,"$mobileStore",u),r=()=>H(ml,"$currentTabIndex",u),a=()=>H(Ra,"$formattedStep",u),i=()=>H(Oa,"$formattedMass",u),o=()=>H(le,"$simulationStore",u),l=()=>H(dt,"$settings",u),c=()=>H(tn,"$presets",u),[u,g]=Bt();let d,p=0,b=0,E=Se(1),_=Se(20),w=Se(50),P=Se(15),C=Se("survival"),S,M=null;ms(()=>{S&&!M&&(M=S.getContext("2d"))}),ms(()=>{M&&s().bestState&&I(s().bestState)});function I(m){if(!M||!S)return;const{width:x,height:A,channels:N}=m;if(!N||N.length===0)return;const V=N[0];if(!V||V.length===0)return;const K=S.width,ae=S.height,de=M.createImageData(x,A);for(let Z=0;Z<V.length;Z++){const Ie=Math.floor(Math.min(1,Math.max(0,V[Z]))*255);de.data[Z*4]=Ie,de.data[Z*4+1]=Ie,de.data[Z*4+2]=Ie,de.data[Z*4+3]=255}const xe=new OffscreenCanvas(x,A),Ye=xe.getContext("2d");Ye&&(Ye.putImageData(de,0,0),M.imageSmoothingEnabled=!1,M.clearRect(0,0,K,ae),M.drawImage(xe,0,0,K,ae))}function y(m){switch(m){case"glider":return[{metric:"Persistence",weight:1},{metric:"Locomotion",weight:1.5},{metric:"Compactness",weight:.5}];case"oscillator":return[{metric:"Persistence",weight:1},{metric:"Stability",weight:.8},{metric:"Compactness",weight:.5}];case"complex":return[{metric:"Persistence",weight:1},{metric:"Complexity",weight:1.2},{metric:"MassConcentration",weight:.3}];default:return[{metric:"Persistence",weight:1},{metric:"Compactness",weight:.5},{metric:"Stability",weight:.3}]}}function $(){return{...Ba(),population:{size:f(_),max_generations:f(w),target_fitness:.95,stagnation_limit:Math.max(5,Math.floor(f(w)/3))},algorithm:{type:"GeneticAlgorithm",config:{mutation_rate:f(P)/100,crossover_rate:.7,mutation_strength:.1,elitism:Math.max(1,Math.floor(f(_)/10)),selection:{method:"Tournament",size:3}}},fitness:{metrics:y(f(C)),aggregation:"WeightedSum"}}}async function R(){if(!s().initialized)try{await Fa()}catch{return}const m=$();try{await Ya(m)}catch(x){X(`Failed to start evolution: ${x}`,"error")}}function L(){Gn()}function j(){Ua()}function B(m){switch(m){case"TargetReached":return"TARGET";case"MaxGenerations":return"MAX GENS";case"Stagnation":return"STAGNANT";case"Cancelled":return"CANCELLED";default:return m}}function se(m){const x=m.touches[0];p=x.clientX,b=x.clientX,Ne.startSwipe()}function J(m){if(!n().isSwiping)return;b=m.touches[0].clientX;const A=b-p,N=r();N===0&&A>0||N===fn.length-1&&A<0?Ne.updateSwipe(A*.3):Ne.updateSwipe(A)}function O(){!n().isSwiping||!d||Ne.endSwipe(d.clientWidth)}function ne(m){Ne.setTab(m)}function ie(m){F(E,Math.max(1,Math.min(10,f(E)+m)),!0),cl(f(E))}const ge=[{id:"view",label:"VIEW",icon:"◉"},{id:"select",label:"SEL",icon:"□"},{id:"draw",label:"DRAW",icon:"✎"},{id:"erase",label:"ERASE",icon:"✗"}],we=[{id:"theme",label:"THEME"},{id:"grayscale",label:"GRAY"},{id:"thermal",label:"THERMAL"},{id:"viridis",label:"VIRIDIS"}];function _e(m){const x=Xs();if(!x)return;const A=Math.floor((x.getWidth()-m.region.width)/2),N=Math.floor((x.getHeight()-m.region.height)/2);x.placeRegion(m.region,A,N)}function Ce(m){ys(m.seed),X(`Loaded: ${m.name}`,"info")}let $e=null;function Et(m){$e=setTimeout(()=>{confirm(`Delete "${m.name}"?`)&&ja(m.id)},500)}function ht(){$e&&(clearTimeout($e),$e=null)}function We(){const m=document.createElement("input");m.type="file",m.accept=".json",m.onchange=async x=>{const A=x.target.files?.[0];if(!A)return;const N=await A.text();try{Wa(N)}catch{}},m.click()}let ve=_o(()=>{const m=-r()*100,x=d?n().swipeOffset/d.clientWidth*100:0;return`translateX(${m+x}%)`});var Fe=Pc(),pt=v(Fe),Yt=v(pt),Ut=v(Yt),Cs=h(v(Ut)),W=v(Cs),ye=h(Ut,2),He=h(v(ye)),Mt=v(He),kt=h(ye,2),me=h(v(kt)),Be=v(me),Xt=h(Yt,2),qt=v(Xt);let jt;var gt=h(qt,2);let $s;gt.__click=()=>Da(o().backend==="cpu"?"gpu":"cpu");var sn=h(gt,2);let Is;var zn=h(pt,2);Ue(zn,21,()=>fn,nt,(m,x)=>{var A=dc();let N;A.__click=()=>ne(f(x));var V=v(A);z(K=>{N=re(A,1,"tab svelte-xicwp9",null,N,{active:n().activeTab===f(x)}),D(V,K)},[()=>f(x).toUpperCase()]),k(m,A)});var Tt=h(zn,2);Tt.__touchstart=se,Tt.__touchmove=J,Tt.__touchend=O;var nn=v(Tt);let Fn;var Bn=v(nn),Yn=v(Bn),As=v(Yn);let Un;As.__click=()=>o().playing?On():Aa();var Va=v(As);{var Ka=m=>{var x=hc();k(m,x)},Ja=m=>{var x=pc();k(m,x)};Q(Va,m=>{o().playing?m(Ka):m(Ja,!1)})}var Xn=h(As,2);Xn.__click=()=>Pa();var qn=h(Xn,2);qn.__click=()=>ys();var Za=h(qn,2),jn=v(Za);jn.__click=()=>ie(-1);var Wn=h(jn,2),Qa=v(Wn),ei=h(Wn,2);ei.__click=()=>ie(1);var Hn=h(Yn,2);Ue(Hn,21,()=>ge,nt,(m,x)=>{var A=gc();let N;A.__click=()=>Na(f(x).id);var V=v(A),K=v(V),ae=h(V,2),de=v(ae);z(()=>{N=re(A,1,"tool-btn svelte-xicwp9",null,N,{active:l().mode===f(x).id}),D(K,f(x).icon),D(de,f(x).label)}),k(m,A)});var ti=h(Hn,2);{var si=m=>{var x=mc(),A=v(x),N=h(v(A),2);N.__input=xe=>Ga(parseInt(xe.currentTarget.value));var V=h(N,2),K=v(V),ae=h(A,2);{var de=xe=>{var Ye=_c(),Z=h(v(Ye),2);Z.__input=cs=>za(parseInt(cs.currentTarget.value)/100);var Ie=h(Z,2),ln=v(Ie);z((cs,ki)=>{wn(Z,cs),D(ln,`${ki??""}%`)},[()=>Math.round(l().brushIntensity*100),()=>Math.round(l().brushIntensity*100)]),k(xe,Ye)};Q(ae,xe=>{l().mode==="draw"&&xe(de)})}z(()=>{wn(N,l().brushSize),D(K,l().brushSize)}),k(m,x)};Q(ti,m=>{(l().mode==="draw"||l().mode==="erase")&&m(si)})}var Vn=h(Bn,2),Kn=v(Vn),ni=h(v(Kn),2);Ue(ni,21,()=>we,nt,(m,x)=>{var A=bc();let N;A.__click=()=>dl(f(x).id);var V=v(A);z(()=>{N=re(A,1,"scheme-btn svelte-xicwp9",null,N,{active:l().colorScheme===f(x).id}),D(V,f(x).label)}),k(m,A)});var ri=h(Kn,2),ai=h(v(ri),2),Jn=h(v(ai),2);let Zn;Jn.__click=function(...m){hl?.apply(this,m)};var Qn=h(Vn,2),er=v(Qn),tr=v(er);tr.__click=We;var ii=h(tr,2);ii.__click=function(...m){Ha?.apply(this,m)};var oi=h(er,2);Ue(oi,5,c,m=>m.id,(m,x)=>{var A=xc();A.__click=()=>_e(f(x)),A.__keydown=Z=>Z.key==="Enter"&&_e(f(x)),A.__touchstart=()=>Et(f(x)),A.__touchend=ht,A.__touchmove=ht;var N=v(A);{var V=Z=>{var Ie=wc();z(()=>{ze(Ie,"src",f(x).thumbnail),ze(Ie,"alt",f(x).name)}),k(Z,Ie)},K=Z=>{var Ie=yc();k(Z,Ie)};Q(N,Z=>{f(x).thumbnail?Z(V):Z(K,!1)})}var ae=h(N,2),de=v(ae),xe=h(ae,2),Ye=v(xe);z(()=>{D(de,f(x).name),D(Ye,`${f(x).region.width??""}×${f(x).region.height??""}`)}),k(m,A)},m=>{var x=Sc();k(m,x)});var sr=h(Qn,2),li=v(sr);Ue(li,21,()=>Xa,nt,(m,x)=>{var A=Ec();A.__click=()=>Ce(f(x));var N=v(A),V=v(N),K=h(N,2),ae=v(K);z(()=>{D(V,f(x).name),D(ae,f(x).description)}),k(m,A)});var ci=h(sr,2),nr=v(ci),rr=v(nr);ss(rr,m=>S=m,()=>S);var ui=h(rr,2),fi=v(ui);{var vi=m=>{var x=Mc(),A=Ee(x),N=h(v(A),2),V=v(N),K=h(A,2),ae=h(v(K),2),de=v(ae),xe=h(K,2),Ye=v(xe);z(Z=>{D(V,`${s().progress.generation??""}/${f(w)??""}`),D(de,Z),ws(Ye,`width: ${s().progress.generation/f(w)*100}%`)},[()=>s().progress.best_fitness.toFixed(3)]),k(m,x)},di=m=>{var x=Us(),A=Ee(x);{var N=K=>{var ae=kc(),de=Ee(ae),xe=h(v(de),2),Ye=v(xe),Z=h(de,2),Ie=v(Z);z((ln,cs)=>{D(Ye,ln),D(Ie,cs)},[()=>s().result.stats.best_fitness.toFixed(3),()=>B(s().result.stats.stop_reason)]),k(K,ae)},V=K=>{var ae=Tc();k(K,ae)};Q(A,K=>{s().result?K(N):K(V,!1)},!0)}k(m,x)};Q(fi,m=>{s().running&&s().progress?m(vi):m(di,!1)})}var ar=h(nr,2),hi=v(ar);{var pi=m=>{var x=Cc();x.__click=L,k(m,x)},gi=m=>{var x=Ic(),A=Ee(x);A.__click=R;var N=h(A,2);{var V=K=>{var ae=$c();ae.__click=j,k(K,ae)};Q(N,K=>{s().bestState&&K(V)})}k(m,x)};Q(hi,m=>{s().running?m(pi):m(gi,!1)})}var _i=h(ar,2),ir=v(_i),or=h(v(ir),2),mi=h(or,2),bi=v(mi),lr=h(ir,2),cr=h(v(lr),2),wi=h(cr,2),yi=v(wi),ur=h(lr,2),fr=h(v(ur),2),xi=h(fr,2),Si=v(xi),Ei=h(ur,2),vr=h(v(Ei),2),rn=v(vr);rn.value=rn.__value="survival";var an=h(rn);an.value=an.__value="glider";var on=h(an);on.value=on.__value="oscillator";var dr=h(on);dr.value=dr.__value="complex",ss(Tt,m=>d=m,()=>d);var Mi=h(Tt,2);Ue(Mi,21,()=>fn,nt,(m,x,A)=>{var N=Ac();let V;N.__click=()=>Ne.setTab(f(x)),z(()=>{V=re(N,1,"dot svelte-xicwp9",null,V,{active:r()===A}),ze(N,"aria-label",`Go to ${f(x)??""} panel`)}),k(m,N)}),z(()=>{D(W,a()),D(Mt,i()),D(Be,o().fps),jt=re(qt,1,"backend-label svelte-xicwp9",null,jt,{active:o().backend==="cpu"}),$s=re(gt,1,"toggle-btn svelte-xicwp9",null,$s,{gpu:o().backend==="gpu"}),gt.disabled=!o().gpuAvailable,Is=re(sn,1,"backend-label svelte-xicwp9",null,Is,{active:o().backend==="gpu",unavailable:!o().gpuAvailable}),Fn=re(nn,1,"panels-wrapper svelte-xicwp9",null,Fn,{swiping:n().isSwiping}),ws(nn,`transform: ${f(ve)??""}`),Un=re(As,1,"play-btn svelte-xicwp9",null,Un,{active:o().playing}),D(Qa,`${f(E)??""}X`),Zn=re(Jn,1,"toggle-btn small svelte-xicwp9",null,Zn,{on:l().showScanlines}),D(bi,f(_)),D(yi,f(w)),D(Si,f(P))}),wa("touchcancel",Tt,O),$t(or,()=>f(_),m=>F(_,m)),$t(cr,()=>f(w),m=>F(w,m)),$t(fr,()=>f(P),m=>F(P,m)),Ma(vr,()=>f(C),m=>F(C,m)),k(e,Fe),vt(),g()}ls(["click","touchstart","touchmove","touchend","input","keydown"]);var Lc=T('<div class="loading-screen svelte-1n46o8q"><div class="loading-content svelte-1n46o8q"><div class="glitch-text svelte-1n46o8q" data-text="FLOW_LENIA">FLOW_LENIA</div> <div class="loading-status svelte-1n46o8q"><span class="animate-pulse">INITIALIZING SUBSTRATE</span> <span class="animate-blink">_</span></div></div></div>'),Oc=T('<div class="error-screen svelte-1n46o8q"><div class="error-content svelte-1n46o8q"><div class="error-title svelte-1n46o8q">SYSTEM FAILURE</div> <div class="error-message svelte-1n46o8q"> </div> <div class="error-hint svelte-1n46o8q">Ensure WASM is built: <code class="svelte-1n46o8q">wasm-pack build --target web --release</code></div></div></div>'),Rc=T('<div class="mobile-header svelte-1n46o8q"><span class="mobile-title svelte-1n46o8q">FLOW_LENIA</span></div> <div class="mobile-canvas-container svelte-1n46o8q"><!></div> <!>',1),Nc=T('<!> <div class="main-content svelte-1n46o8q"><!> <!> <!></div> <!>',1),Gc=T('<div class="scanlines"></div>'),zc=T('<div><!></div> <!> <div class="vignette"></div>',1);function Fc(e,t){ft(t,!1);const s=()=>H(le,"$simulationStore",i),n=()=>H(en,"$currentScheme",i),r=()=>H(Ne,"$mobileStore",i),a=()=>H(dt,"$settings",i),[i,o]=Bt();let l=oe(!1),c=oe(null),u=oe(),g=oe("");function d(w,P){const C=parseInt(w.slice(1,3),16),S=parseInt(w.slice(3,5),16),M=parseInt(w.slice(5,7),16);return`rgba(${C}, ${S}, ${M}, ${P})`}Qs(async()=>{gl(),Ne.checkViewport(),window.addEventListener("resize",Ne.checkViewport),X("SYS.BOOT","info"),X("Loading WASM module...","info");try{await ul(),F(l,!0),X("WASM initialized","success"),X(`Backend: ${s().backend.toUpperCase()}`,"info"),X(`Theme: ${n().name}`,"info"),s().gpuAvailable?X("WebGPU available","success"):X("WebGPU not available","warn"),X("SYSTEM READY","success")}catch(w){F(c,String(w)),X(`INIT FAILED: ${w}`,"error")}}),Ta(()=>{window.removeEventListener("resize",Ne.checkViewport)}),st(()=>(s(),n()),()=>{const{width:w,height:P}=s().config,C=Math.max(1,w*P),S=s().totalMass/C,I=.15+Math.min(1,Math.max(0,S))*.45,y=n().colors;F(g,[`--color-primary-glow: ${d(y.primary,I)}`,`--color-secondary-glow: ${d(y.secondary,I)}`,`--color-tertiary-glow: ${d(y.tertiary,I)}`].join("; "))}),Js(),Ts();var p=Us(),b=Ee(p);{var E=w=>{var P=Lc();k(w,P)},_=w=>{var P=Us(),C=Ee(P);{var S=I=>{var y=Oc(),$=v(y),R=h(v($),2),L=v(R);z(()=>D(L,f(c))),k(I,y)},M=I=>{var y=zc(),$=Ee(y);let R;var L=v($);{var j=O=>{var ne=Rc(),ie=h(Ee(ne),2),ge=v(ie);Ar(ge,{});var we=h(ie,2);Dc(we,{}),k(O,ne)},B=O=>{var ne=Nc(),ie=Ee(ne);yl(ie,{});var ge=h(ie,2),we=v(ge);zl(we,{});var _e=h(we,2);Ar(_e,{});var Ce=h(_e,2);cc(Ce,{});var $e=h(ge,2);Sl($e),k(O,ne)};Q(L,O=>{r(),G(()=>r().isMobile)?O(j):O(B,!1)})}ss($,O=>F(u,O),()=>f(u));var se=h($,2);{var J=O=>{var ne=Gc();k(O,ne)};Q(se,O=>{a(),G(()=>a().showScanlines)&&O(J)})}z(()=>{R=re($,1,"app-container svelte-1n46o8q",null,R,{"mobile-layout":r().isMobile}),ws($,f(g))}),k(I,y)};Q(C,I=>{f(c)?I(S):I(M,!1)},!0)}k(w,P)};Q(b,w=>{!f(l)&&!f(c)?w(E):w(_,!1)})}k(e,p),vt(),o()}Fo(Fc,{target:document.getElementById("app")});
